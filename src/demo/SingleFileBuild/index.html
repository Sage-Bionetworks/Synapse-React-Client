<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous"
    />
    <!-- production version of react-- errors obfuscated -->
    <!-- <script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script> -->
    <!-- <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script> -->
    <script
      crossorigin
      src="https://unpkg.com/prop-types@15.6/prop-types.min.js"
    ></script>

    <!-- development version of react -->
    <script
      crossorigin
      src="https://unpkg.com/react@16/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"
    ></script>

    <!-- react-router-dom -->
    <script src="https://unpkg.com/react-router/umd/react-router.min.js"></script>
    <script src="https://unpkg.com/react-router-dom/umd/react-router-dom.min.js"></script>

    <!-- katex -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
      integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y"
      crossorigin="anonymous"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
      integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz"
      crossorigin="anonymous"
    ></script>

    <!-- react-measure -->
    <script src="https://unpkg.com/react-measure@2.2.2/dist/index.umd.js"></script>

    <!-- react-tooltip -->
    <script
      crossorigin
      src="https://unpkg.com/react-tooltip@3.9.2/standalone/react-tooltip.min.js"
    ></script>

    <!-- plotly -->
    <script
      crossorigin
      src="https://cdn.plot.ly/plotly-basic-1.47.3.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-plotly.js@1.0.2/dist/create-plotly-component.js"
    ></script>

    <!-- rss-parser -->
    <script src="https://unpkg.com/browse/rss-parser@3.7.2/dist/rss-parser.min.js"></script>

    <!-- react-native-parser -->
    <script src="https://unpkg.com/browse/react-mailchimp-subscribe@2.1.0/umd/react-mailchimp-subscribe.min.js"></script>

    <!-- markdown imports  -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@8.4.2/dist/markdown-it.min.js"></script>
    <script src="https://unpkg.com/markdown-it-synapse@1.1.1/dist/markdown-it-synapse.min.js"></script>
    <script src="https://unpkg.com/markdown-it-center-text@1.0.4/dist/markdown-it-center-text.min.js"></script>
    <script src="https://unpkg.com/markdown-it-synapse-heading@1.0.1/dist/markdown-it-synapse-heading.min.js"></script>
    <script src="https://unpkg.com/markdown-it-synapse-table@1.0.6/dist/markdown-it-synapse-table.min.js"></script>
    <script src="https://unpkg.com/markdown-it-strikethrough-alt@1.0.0/dist/markdown-it-strikethrough-alt.min.js"></script>
    <script src="https://unpkg.com/markdown-it-emphasis-alt@1.0.8/dist/markdown-it-emphasis-alt.min.js"></script>
    <script src="https://unpkg.com/markdown-it-synapse-math@3.0.4/dist/markdown-it-math.min.js"></script>
    <script src="https://unpkg.com/markdown-it-sup-alt@1.0.2/dist/markdown-it-sup.min.js"></script>
    <script src="https://unpkg.com/markdown-it-sub-alt@1.0.0/dist/markdown-it-sub.min.js"></script>
    <script src="https://unpkg.com/markdown-it-inline-comments@1.0.1/dist/markdown-it-inline-comments.min.js"></script>
    <script src="https://unpkg.com/markdown-it-br@1.0.0/dist/markdown-it-br.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it-container@2.0.0/dist/markdown-it-container.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sanitize-html@1.20.0/dist/sanitize-html.min.js"></script>
    <script
      crossorigin
      src="https://unpkg.com/universal-cookie@3/umd/universalCookie.min.js"
    ></script>
    <!-- end imports -->

    <!-- react-css-transition-group -->
    <script src="https://unpkg.com/react-transition-group@2.6.0/dist/react-transition-group.min.js"></script>

    <!-- react json schema form -->
    <script src="https://unpkg.com/react-jsonschema-form/dist/react-jsonschema-form.js"></script>

    <!-- local imports-- change in prod -->
    <link
      rel="stylesheet"
      href="../../umd/synapse-react-client.production.styles.css"
    />

    <!--
      Notice the use of %PUBLIC_URL% in the tag above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Synapse React Client</title>
  </head>
  <style>
    /* Configure css */
    .SRC-primary-background-color-hover:hover {
      background: #d53f77 !important;
      color: white;
    }

    .SRC-primary-background-color-hover:hover > * {
      background: #d53f77;
      color: white;
    }
  </style>
  <body>
    <button id="signoutButton" class="btn btn-primary" onclick="signout()">Sign Out</button>
    <div id="panel1"></div>
    <!-- spacer div below -->
    <div id="panel2"></div>
    <div id="panel3"></div>
    <div id="panel4"></div>
    <div id="panel5"></div>
    <div id="panel6"></div>
    <div id="panel7"></div>
    <div id="panel8"></div>
    <div style="height: 300px;"></div>
    <!--
      This HTML file is a an example configuration of SRC used in a plain HTML page,
      if you open it directly in the browser, you will see some components render.
    -->
  </body>
  <!-- bootstrap components -->
  <script
    src="https://unpkg.com/react-bootstrap@next/dist/react-bootstrap.min.js"
    crossorigin
  ></script>
  <script src="../../umd/synapse-react-client.production.min.js"></script>
  <script type="text/javascript">
    // set portal endpoints
    // window.SRC.OVERRIDE_ENDPOINT_CONFIG = {
    //   REPO: 'https://repo-staging.prod.sagebase.org/',
    //   PORTAL: 'https://staging.synapse.org/',
    // }
    
    //attempt to read session token from cookies
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }
    function signout() {
      document.cookie = "org.sagebionetworks.security.user.login.token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"
      location.reload()
    }
    const token = getCookie("org.sagebionetworks.security.user.login.token")
    const e = React.createElement // utility for creating elements
    const renderInTryCatch = (reactNode, container, name) => {
      try {
        ReactDOM.render(reactNode, container)
      } catch (e) {
        console.error('Error rendering: ', name)
        // error  message isn't informative
      }
    }
    const queryWrapperMenuContainer = document.querySelector('#panel1')
    const queryWrapperProps = {
      token,
      menuConfig: [
        {
          facet: 'Organism',
          sql: 'SELECT * FROM syn9886254',
          entityId: 'syn9886254',
          unitDescription: 'data files',
          visibleColumnCount: 3,
          title: 'my title',
        },
        {
          facet: 'Study',
          sql: 'SELECT * FROM syn9886254',
          entityId: 'syn9886254',
          unitDescription: 'data files',
          visibleColumnCount: 5,
        },
      ],
      rgbIndex: 2,
    }
    const markdownContainer = document.querySelector('#panel2')
    const markdownProps = {
      token,
      wikiId: '582150',
      ownerId: 'syn14306197',
    }

    const userCardSmallContainer = document.querySelector('#panel3')
    const userCardPropsSmall = {
      ownerId: '3374422',
      size: SRC.SynapseConstants.SMALL_USER_CARD,
    }

    const UserCardMediumAndLargeContainer = document.querySelector('#panel4')
    const userCardPropsMedium = {
      ownerId: '3374422',
      size: SRC.SynapseConstants.MEDIUM_USER_CARD,
    }

    renderInTryCatch(
      e(SRC.SynapseComponents.QueryWrapperMenu, queryWrapperProps, null),
      queryWrapperMenuContainer,
      'QueryWrapperMenu',
    )

    renderInTryCatch(
      e(SRC.SynapseComponents.Markdown, markdownProps, null),
      markdownContainer,
      'MarkdownSynapse',
    )

    renderInTryCatch(
      e(SRC.SynapseComponents.UserCard, userCardPropsSmall, null),
      userCardSmallContainer,
      'UserCardSmall',
    )

    renderInTryCatch(
      e(SRC.SynapseComponents.UserCard, userCardPropsMedium, null),
      UserCardMediumAndLargeContainer,
      'UserCardMediumAndLargeContainer',
    )

    const formContainer = document.querySelector('#panel5')
    const entityFormProps = {
      parentContainerId: 'syn20355732',
      token,
      formSchemaEntityId: 'syn20184776',
      formUiSchemaEntityId: 'syn20184771',
      initFormData: false,
    }

    renderInTryCatch(
      e(SRC.SynapseComponents.EntityForm, entityFormProps, null),
      formContainer,
      'EntityForm',
    )

    const statsPlotProps = {
      token,
      request: {
        concreteType:
          'org.sagebionetworks.repo.model.statistics.ProjectFilesStatisticsRequest',
        objectId: 'syn5585645',
        fileDownloads: true,
        fileUploads: true,
      },
      endpoint: 'https://repo-staging.prod.sagebase.org/',
    }

    const statsPlotContainer = document.querySelector('#panel6')
    renderInTryCatch(
      e(SRC.SynapseComponents.StatisticsPlot, statsPlotProps, null),
      statsPlotContainer,
      'EntityForm',
    )

    // verified window.SRC.OVERRIDE_ENDPOINT_CONFIG is used in Login component (including Forgot Password and Register links)
    if (!token) {
      const loginContainer = document.querySelector('#panel7')
      const loginProps = {
        sessionCallback: () => {
          console.log('session was just changed!')
          location.reload()
        },
      }
      renderInTryCatch(
        e(SRC.SynapseComponents.Login, loginProps, null),
        loginContainer,
        'Login',
      )
      const signoutButtonEl = document.getElementById("signoutButton")
      signoutButtonEl.style.display = "none"
    }
    const hasAccessContainer = document.querySelector('#panel8')
    const hasAccessProps = {
      token,
      synapseId: 'syn12664802',
    }
    renderInTryCatch(
      e(SRC.SynapseComponents.HasAccess, hasAccessProps, null),
      hasAccessContainer,
      'HasAccess',
    )
  </script>
</html>

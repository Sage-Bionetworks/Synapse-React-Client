import{j as p,a as F,F as U}from"./jsx-runtime.2e925369.js";import{S as bt}from"./Skeleton.bf1489f0.js";import{E as It,y as Nt,u as xt,v as Vt,s as At,B as kt,z as Qt,V as Me,A as He}from"./index.87d1c7b9.js";import{C as M}from"./ColumnType.744125d2.js";import"./assert.ee5a549a.js";import{i as Ue}from"./TypeUtils.a2c41307.js";import{u as pt}from"./use-deep-compare-effect.esm.9d3fc03b.js";import{p as qt,a as Dt}from"./sqlFunctions.b49ac766.js";import{a as Lt,i as Pt,b as Mt}from"./useGetQueryResultBundle.ee3fdd0e.js";import{u as Ht}from"./useEntity.a3aec278.js";import{c as H}from"./cloneDeep.b49f3b67.js";import{u as de}from"./unCamelCase.d070537b.js";import{E as mt}from"./ElementWithTooltip.2f03cc18.js";import{C as Ut,a as ft}from"./Collapse.b335a5d4.js";import{u as ze}from"./useGetInfoFromIds.fd3ee364.js";import{I as Re}from"./IconSvg.d5022c82.js";import{C as ht}from"./Checkbox.995e1545.js";import{I as $t,a as Bt}from"./IconMinus.f135ad99.js";import{D as te}from"./Dropdown.edf6576c.js";import{R as Yt}from"./RadioGroup.ff23c1de.js";import{h as We}from"./moment.81704e1d.js";import{_ as De}from"./utils.ebacc06c.js";import{_ as j}from"./classCallCheck.8304ed06.js";import{f as zt,a as V,g as ee}from"./withStyles.4f64abe1.js";import{_ as se}from"./inherits.428c75c6.js";import{b as A,_ as Ke}from"./toConsumableArray.5f669646.js";import{B as Wt}from"./Button.77571428.js";function le(e,n){if(n&&(zt(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return V(e)}function K(e){return K=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},K(e)}const Kt=window.React.createContext,$e=window.React.useContext,$=Kt(void 0),pe=({children:e,queryContext:n})=>p($.Provider,{value:n,children:e});function Be(){const e=$e($);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function va(){const e=$e($);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function ga(){const e=$e($);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const we=$.Consumer;try{$.displayName="QueryContext",$.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:$.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{pe.displayName="QueryContextProvider",pe.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:pe.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{we.displayName="QueryContextConsumer",we.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:we.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}const me=e=>p(bt,{style:{...e.style,display:"inline-block"},...e});try{me.displayName="SkeletonInlineBlock",me.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:me.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const jt=()=>{try{return JSON.parse(sessionStorage.getItem(It)||"")}catch{return[]}},Gt=()=>{try{return JSON.parse(sessionStorage.getItem(Nt)||"")}catch{return[]}};var Xt=(e=>(e.LIKE="LIKE",e))(Xt||{}),Jt=(e=>(e.HAS="HAS",e.HAS_LIKE="HAS_LIKE",e))(Jt||{});const Zt="org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",en="org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",tn="org.sagebionetworks.repo.model.table.TextMatchesQueryFilter",je=Ue(tn),Fe=Ue(Zt),Oe=Ue(en),nn=window.React.createContext,an=window.React.useContext,be=window.React.useEffect,Ie=window.React.useState,Z=nn(void 0),fe=({children:e,queryVisualizationContext:n})=>p(Z.Provider,{value:n,children:e});function yt(){const e=an(Z);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const Ne=Z.Consumer;function xe(e){var y,_;const{data:n,getLastQueryRequest:a,isFacetsAvailable:t,isLoadingNewBundle:r}=Be(),[i,s]=Ie({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(y=e.defaultShowFacetVisualization)!=null?y:!0,showSearchBar:(_=e.defaultShowSearchBar)!=null?_:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});be(()=>{t||s(v=>({...v,showFacetFilter:!1,showFacetVisualization:!1}))},[t]),be(()=>{r&&c([])},[r]);const[o,l]=Ie([]),[u,c]=Ie([]),h=a(),m=n==null?void 0:n.selectColumns;be(()=>{var v,R;l((R=m==null?void 0:m.slice(0,(v=e.visibleColumnCount)!=null?v:1/0).map(C=>C.name))!=null?R:[])},[m,h.query.sql,e.visibleColumnCount]);const d={topLevelControlsState:i,setTopLevelControlsState:s,columnsToShowInTable:o,setColumnsToShowInTable:l,selectedRowIndices:u,setSelectedRowIndices:c,facetAliases:e.facetAliases,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn},{children:f}=e;return p(fe,{queryVisualizationContext:d,children:f})}try{xe.displayName="QueryVisualizationWrapper",xe.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:xe.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{Z.displayName="QueryVisualizationContext",Z.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:Z.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{fe.displayName="QueryVisualizationContextProvider",fe.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:fe.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{Ne.displayName="QueryVisualizationContextConsumer",Ne.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:Ne.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}function vt(e,n){return`${e}${n}`}function rn(e,n){const a=window.location.search,t=`${e}=${n}`;return a?a.includes(`${e}=`)?window.location.search.slice(a.indexOf("?")+1).split("&").map(s=>s.split("=")[0]===e?`${t}`:s).join("&"):`${a.substr(1)}&${t}`:t}function on(e,n){if(!window.location.search)return;const a=vt(e,n),r=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(i=>i.split("=")[0]===a).map(i=>i.split("=")[1])[0];return r?decodeURIComponent(r):void 0}function sn(e,n,a){const t=n!==void 0?vt(e,n):e,r=rn(t,a),i=window.location,s=`${i.protocol}//${i.hostname}${i.port?":"+i.port:""}${i.pathname}?${r}`;window.history.replaceState("object or string","Title",s)}function ln(e,n){const a=on(e,n);let t;if(a){const r=JSON.parse(a);r.sql&&(t={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:xt|Vt|At|kt,entityId:qt(r.sql),query:r})}return t}const un=window.React,Ge=window.React.useEffect,cn=window.React.useMemo,Xe=window.React.useState,gt="isShowingFacetFilters",St="isHidingFacetFilters";function Ve(e){var E,I,N,g;const{initQueryRequest:n,onQueryChange:a,onQueryResultBundleChange:t}=e,[r,i]=Xe(n),[s,o]=Xe(void 0),{data:l,isLoading:u,error:c,isPreviousData:h,remove:m}=Lt(r,{keepPreviousData:!0},o),d=l==null?void 0:l.responseBody,f=u||h,{entityId:y,versionNumber:_}=Dt(r.query.sql),{data:v}=Ht(y,_),R=(E=r.query.limit)!=null?E:Qt,C=Math.ceil((((I=r.query.offset)!=null?I:0)+Number(R))/R),b=O=>{const x=Q();x.query.limit=O,B(x)},D=async O=>{const x=Q();x.query.offset=(O-1)*R,B(x)};pt(()=>{a&&a(JSON.stringify(r.query))},[a,r.query]),Ge(()=>{d&&t&&t(JSON.stringify(d))},[d,t]);const q=(N=e.componentIndex)!=null?N:0,L=d?Pt(d.facets,d.selectColumns):!0;Ge(()=>{const O=ln("QueryWrapper",q);O&&i(O)},[]);const Q=un.useCallback(()=>H(r),[r]);function k(){return H(e.initQueryRequest)}function B(O){const x=H(O);if(i(x),x.query){const P=JSON.stringify(x.query),J=encodeURIComponent(P);e.shouldDeepLink&&(e.onQueryChange?e.onQueryChange(P):sn("QueryWrapper",q,J))}m()}const T={data:cn(()=>{var x,P;const O=(x=e.lockedFacet)==null?void 0:x.facet;if(O&&d){const J=H(d),Ft=(P=J.facets)==null?void 0:P.filter(Ot=>Ot.columnName.toLowerCase()!==O.toLowerCase());return J.facets=Ft,J}else return d},[d,(g=e.lockedFacet)==null?void 0:g.facet]),currentPage:C,pageSize:R,setPageSize:b,isLoadingNewBundle:f,getLastQueryRequest:Q,getInitQueryRequest:k,error:c,entity:v,executeQueryRequest:B,isFacetsAvailable:L,asyncJobStatus:s,goToPage:D},{children:S}=e;return p(pe,{queryContext:T,children:p("div",{className:`SRC-wrapper ${f?"SRC-logo-cursor":""} ${L?"has-facets":""}`,children:S})})}try{Ve.displayName="QueryWrapper",Ve.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedFacet:{defaultValue:null,description:"",name:"lockedFacet",required:!1,type:{name:"LockedFacet"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:Ve.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}const re=e=>{let n,a="";if("facetWithSelection"in e){const{facetWithSelection:r}=e;r.facet.facetType==="enumeration"?n=r.displayValue===Me?He:r.displayValue:n=`${r.facet.selectedMin} 
        - ${r.facet.selectedMax}`,a=`${de(r.facet.columnName)}: ${n}`}else if("filter"in e){const{filter:r}=e;let i=r.value;(i==null?void 0:i.startsWith("%"))&&(i==null?void 0:i.endsWith("%"))&&(i=i.substring(1,i.length-1)),n=i,a=`Text matches: "${i}"`,r.columnName&&(n=`"${i}" in ${de(r==null?void 0:r.columnName)}`,a=`${de(r==null?void 0:r.columnName)}: ${i}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const t=encodeURIComponent(a);return p(mt,{idForToolTip:`selectionCriteria_${t}`,tooltipText:a,callbackFn:()=>{},children:F("label",{className:"SelectionCriteriaPill",children:[p("span",{children:n}),p("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:p(Ut,{})})]},`SelectionCriteriaPill ${t}`)})};try{re.displayName="SelectionCriteriaPill",re.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:re.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const ie=({label:e,isCollapsed:n,onClick:a,facetAliases:t})=>F("div",{className:"FacetFilterHeader",children:[p("label",{className:"FacetFilterHeader__label",children:de(e,t)}),p("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>a(!n),children:n?p($t,{className:"icon-plus",title:"Expand Menu"}):p(Bt,{className:"icon-minus",title:"Collapse Menu"})})]});try{ie.displayName="FacetFilterHeader",ie.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"Function"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!0,type:{name:"{} | undefined"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:ie.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}const _t=window.React,Y=window.React.useState;function dn(e){return e.replace(/\s/g,"").toLowerCase()}function Je(e,n=[],a=[]){const{value:t}=e;let r=t;t===Me&&(r=He);const i=n.find(o=>o.ownerId===t);i&&(r=i?i.userName:`unknown (${t})`);const s=a.find(o=>o.id===t);return s&&(r=s?s.name:`unknown (${t})`),`${r}`}function pn(e,n,a){const t=[...e.sort((r,i)=>i.count-r.count)];return n||t.length<=a||t.slice(a).find(r=>r.isSelected)?t:t.splice(0,a)}const he=({facetValues:e,columnModel:n,onClear:a,onChange:t,facetAliases:r,containerAs:i="Collapsible",dropdownType:s="Icon",collapsed:o=!1})=>{const[l,u]=Y(!1),[c,h]=Y(o),[m,d]=Y(!1),[f,y]=Y(!1),[_,v]=Y(""),[R,C]=Y(e);pt(()=>{C(e)},[e]);const b=5,D=1500,q=_t.createRef(),L={};let Q;const k=e.filter(g=>g.isSelected).length===0,B=(n==null?void 0:n.columnType)===M.USERID||(n==null?void 0:n.columnType)===M.USERID_LIST?e.map(g=>g.value):[],X=ze({ids:B,type:"USER_PROFILE"}),T=(n==null?void 0:n.columnType)===M.ENTITYID||(n==null?void 0:n.columnType)===M.ENTITYID_LIST?e.map(g=>g.value):[],S=ze({ids:T,type:"ENTITY_HEADER"}),w=g=>{const O=g.target.value;if(v(O),u(!0),!O)e.forEach(x=>{x.isSelected=!1}),C(e);else{const x=e.filter(P=>Je(P,X,S).toLowerCase().indexOf(O.trim().toLowerCase())>-1?P:null);C(x)}};if(!n)return p(U,{});const E=i==="Dropdown",I=F("div",{className:E?"EnumFacetFilter__dropdown_menu":"",children:[F("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[F("div",{className:f?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[p("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{C(e),y(!1),u(!1)},children:p("span",{className:"EnumFacetFilter__previous",children:p(Re,{options:{icon:"arrowBack"}})})}),_.length>0&&p("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var g;v(""),(g=q.current)==null||g.focus()},children:p("span",{className:"EnumFacetFilter__reset",children:p(Re,{options:{icon:"close"}})})}),p("input",{type:"text",placeholder:"Find values",value:_,ref:q,onChange:g=>{w(g)}})]}),!f&&F("div",{className:"EnumFacetFilter__checkAll",children:[p(ht,{className:"EnumFacetFilter__checkbox",onChange:()=>{a()},checked:k,label:"All",isSelectAll:!0},"select_all"),p("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var g;v(""),y(!0),(g=q.current)==null||g.focus()},children:p("span",{className:"EnumFacetFilter__searchicon",children:p(Re,{options:{icon:"search"}})})})]})]}),F("div",{children:[R.length>0&&pn(R,l||E,b).map((g,O)=>p(mn,{id:dn(g.value),index:O,label:Je(g,X,S),count:g.count,isDropdown:E,initialIsSelected:g.isSelected,onChange:x=>{L[g.value]=x,clearTimeout(Q),Q=setTimeout(()=>{t(L),d(!1)},D)}},`checkLabel${O}`)),!E&&F(U,{children:[!l&&R.length>b&&p("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>u(!0),children:p("div",{className:"EnumFacetFilter__checkboxContainer",children:F("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",R.length,")"]})})}),l&&R.length>b&&p("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>u(!1),children:p("div",{className:"EnumFacetFilter__checkboxContainer",children:p("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),R.length<=0&&p("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),N=()=>d(!m);return E?s==="SelectBox"?F(te,{className:"EnumFacetFilter EnumFacetFilterSelect",show:m,onToggle:N,children:[F(te.Toggle,{className:"secondary-caret",variant:"gray-select",children:[k&&"All",!k&&e.filter(g=>g.isSelected).length===1&&e.filter(g=>g.isSelected)[0].value,!k&&e.filter(g=>g.isSelected).length>1&&"Multiple Values Selected"]}),p(te.Menu,{children:I})]}):F(te,{className:"EnumFacetFilter",show:m,onToggle:N,children:[p(mt,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),p(te.Menu,{children:I})]}):F(U,{children:[p(ie,{facetAliases:r,isCollapsed:c,label:n.name,onClick:g=>h(g)}),p(ft,{className:"EnumFacetFilter",in:!c,children:I})]})};function mn({id:e,index:n,label:a,count:t,isDropdown:r,initialIsSelected:i,onChange:s}){const[o,l]=Y(i);return _t.useEffect(()=>{l(i)},[i]),F("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{r&&(l(!o),s(!o))},children:[p(ht,{className:"EnumFacetFilter__checkbox",onClick:u=>u.stopPropagation(),onChange:u=>{l(u),s(u)},checked:o,label:a},`${e}-${n}`),r&&F("span",{className:"EnumFacetFilter__count",children:["(",t,")"]}),!r&&p("div",{className:"EnumFacetFilter__count",children:t})]})}try{he.displayName="EnumFacetFilter",he.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:he.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const Ze=window.React.useState,ye=e=>{const n="Min value should be less then max value",[a,t]=Ze(!1),[r,i]=Ze(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:We(e.initialValues.min).format("YYYY-MM-DD"),max:We(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),s=e.className?`range ${e.className}`:"range",o=({min:u,max:c},h="number")=>u==null||c===null||c===void 0?(t(!1),!0):h==="number"&&Number(u)>Number(c)||Date.parse(u)>Date.parse(c)?(t(!0),!1):(t(!1),!0),l=(u,c,h="number")=>{o(u,h)&&c(u)};return F("div",{className:s,style:{display:"flex",flexWrap:"wrap"},children:[F("div",{style:{marginRight:"10px"},children:[p("input",{type:e.type,value:r.min,onChange:({target:u})=>i({min:u.value,max:r.max})},"range_min"),p("div",{children:"to"}),p("input",{type:e.type,value:r.max,onChange:({target:u})=>i({min:r.min,max:u.value})},"range_max")]}),p("button",{className:"btn btn-link SRC-noPadding",onClick:()=>l(r,e.onChange,e.type),children:"Apply"}),a&&p("div",{className:"SRC-danger-color",children:e.errorText||n})]})};try{ye.displayName="Range",ye.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"Function"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:ye.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}var W=function(){for(var n=arguments.length,a=new Array(n),t=0;t<n;t++)a[t]=arguments[t];return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return a.forEach(function(o){return o&&o.apply(void 0,i)})}};function et(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),a.push.apply(a,t)}return a}function fn(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?et(Object(a),!0).forEach(function(t){A(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):et(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}const hn=window.React,yn=window.React.Component;var Te=function(e){se(n,e);function n(){var a,t;j(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=le(this,(a=K(n)).call.apply(a,[this].concat(i))),A(V(t),"getRailProps",function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=t.props,u=l.emitMouse,c=l.emitTouch;return fn({},o,{onMouseDown:W(o.onMouseDown,u),onTouchStart:W(o.onTouchStart,c)})}),t}return ee(n,[{key:"render",value:function(){var t=this.getRailProps,r=this.props,i=r.getEventData,s=r.activeHandleID,o=r.children,l=o({getEventData:i,activeHandleID:s,getRailProps:t});return l&&hn.Children.only(l)}}]),n}(yn);Te.propTypes={};const vn=window.React,gn=window.React.Component;var ue=function(e){se(n,e);function n(){return j(this,n),le(this,K(n).apply(this,arguments))}return ee(n,[{key:"render",value:function(){var t=this.props,r=t.children,i=t.values,s=t.scale,o=t.count,l=t.getEventData,u=t.activeHandleID,c=(i||s.getTicks(o)).map(function(m){return{id:"$$-".concat(m),value:m,percent:s.getValue(m)}}),h=r({getEventData:l,activeHandleID:u,ticks:c});return h&&vn.Children.only(h)}}]),n}(gn);ue.propTypes={};ue.defaultProps={count:10};function tt(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),a.push.apply(a,t)}return a}function Sn(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?tt(Object(a),!0).forEach(function(t){A(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):tt(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}const _n=window.React,Cn=window.React.Component;var ce=function(e){se(n,e);function n(){var a,t;j(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=le(this,(a=K(n)).call.apply(a,[this].concat(i))),A(V(t),"getTrackProps",function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=t.props,u=l.emitMouse,c=l.emitTouch;return Sn({},o,{onMouseDown:W(o.onMouseDown,u),onTouchStart:W(o.onTouchStart,c)})}),t}return ee(n,[{key:"render",value:function(){for(var t=this.getTrackProps,r=this.props,i=r.children,s=r.left,o=r.right,l=r.scale,u=r.handles,c=r.getEventData,h=r.activeHandleID,m=l.getDomain(),d=[],f=0;f<u.length+1;f++){var y=u[f-1],_=u[f];f===0&&s===!0?y={id:"$",value:m[0],percent:0}:f===u.length&&o===!0&&(_={id:"$",value:m[1],percent:100}),y&&_&&d.push({id:"".concat(y.id,"-").concat(_.id),source:y,target:_})}var v=i({getEventData:c,activeHandleID:h,tracks:d,getTrackProps:t});return v&&_n.Children.only(v)}}]),n}(Cn);ce.propTypes={};ce.defaultProps={left:!0,right:!0};function nt(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),a.push.apply(a,t)}return a}function Tn(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?nt(Object(a),!0).forEach(function(t){A(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nt(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}const En=window.React,Rn=window.React.Component;var Ee=function(e){se(n,e);function n(){var a,t;j(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=le(this,(a=K(n)).call.apply(a,[this].concat(i))),A(V(t),"autofocus",function(o){o.target.focus()}),A(V(t),"getHandleProps",function(o){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=t.props,c=u.emitKeyboard,h=u.emitMouse,m=u.emitTouch;return Tn({},l,{onKeyDown:W(l.onKeyDown,function(d){return c(d,o)}),onMouseDown:W(l.onMouseDown,t.autofocus,function(d){return h(d,o)}),onTouchStart:W(l.onTouchStart,function(d){return m(d,o)})})}),t}return ee(n,[{key:"render",value:function(){var t=this.getHandleProps,r=this.props,i=r.activeHandleID,s=r.children,o=r.handles,l=s({handles:o,activeHandleID:i,getHandleProps:t});return l&&En.Children.only(l)}}]),n}(Rn);Ee.propTypes={};function Ct(e){return function(a,t){return a.val>t.val?e?-1:1:t.val>a.val?e?1:-1:0}}function oe(e,n,a,t){var r=e.findIndex(function(l){return l.key===n});if(r!==-1){var i=e[r],s=i.key,o=i.val;return o===a?e:[].concat(Ke(e.slice(0,r)),[{key:s,val:a}],Ke(e.slice(r+1))).sort(Ct(t))}return e}function ne(e,n){if(!e)return[0,0];var a=e.getBoundingClientRect(),t=n?a.top:a.left,r=n?a.bottom:a.right;return[t,r]}function at(e){var n=e.type,a=n===void 0?"":n,t=e.touches;return!t||t.length>1||a.toLowerCase()==="touchend"&&t.length>0}function Ae(e,n){return e?n.touches[0].clientY:n.touches[0].pageX}function rt(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,t=0,r=e.map(function(i){var s=a.getValue(i);return i!==s&&(t+=1),s}).map(function(i,s){return{key:"$$-".concat(s),val:i}}).sort(Ct(n));return{handles:r,changes:t}}function wn(e,n){return n}function Fn(e,n){for(var a=0;a<e.length;a++)if(e[a].key!==n[a].key||n[a+1]&&n[a].val===n[a+1].val)return e;return n}function Le(e,n,a,t,r){for(var i=-1,s=!0,o=0;o<e.length;o++){var l=e[o],u=n[o];if(!u||u.key!==l.key)return e;u.val!==l.val&&(i=o,s=u.val-l.val>0)}if(i===-1)return e;for(var c=s?a:-a,h=0;h<n.length;h++){var m=n[h],d=n[h+1];if(d&&m.val===d.val)if(h===i){var f=d.val+c;if(r(f)===f){var y=oe(n,d.key,d.val+c,t),_=Le(n,y,a,t,r);return _===n?e:_}else return e}else{var v=m.val+c;if(r(v)===v){var R=oe(n,m.key,m.val+c,t),C=Le(n,R,a,t,r);return C===n?e:C}else return e}}return n}function Tt(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function On(e){return e.length===1&&(e=bn(e)),{left:function(n,a,t,r){for(t==null&&(t=0),r==null&&(r=n.length);t<r;){var i=t+r>>>1;e(n[i],a)<0?t=i+1:r=i}return t},right:function(n,a,t,r){for(t==null&&(t=0),r==null&&(r=n.length);t<r;){var i=t+r>>>1;e(n[i],a)>0?r=i:t=i+1}return t}}}function bn(e){return function(n,a){return Tt(e(n),a)}}On(Tt);var it=Math.sqrt(50),ot=Math.sqrt(10),st=Math.sqrt(2);function In(e,n,a){var t,r=-1,i,s,o;if(n=+n,e=+e,a=+a,e===n&&a>0)return[e];if((t=n<e)&&(i=e,e=n,n=i),(o=Nn(e,n,a))===0||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),n=Math.floor(n/o),s=new Array(i=Math.ceil(n-e+1));++r<i;)s[r]=(e+r)*o;else for(e=Math.floor(e*o),n=Math.ceil(n*o),s=new Array(i=Math.ceil(e-n+1));++r<i;)s[r]=(e-r)/o;return t&&s.reverse(),s}function Nn(e,n,a){var t=(n-e)/Math.max(0,a),r=Math.floor(Math.log(t)/Math.LN10),i=t/Math.pow(10,r);return r>=0?(i>=it?10:i>=ot?5:i>=st?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(i>=it?10:i>=ot?5:i>=st?2:1)}var xn=function(){function e(){j(this,e),this.domain=[0,1],this.range=[0,1],this.interpolator=null}return ee(e,[{key:"createInterpolator",value:function(a,t){var r=a[0],i=a[1],s=t[0],o=t[1];return i<r?(r=this.deinterpolateValue(i,r),s=this.interpolateValue(o,s)):(r=this.deinterpolateValue(r,i),s=this.interpolateValue(s,o)),function(l){return s(r(l))}}},{key:"interpolateValue",value:function(a,t){return a=+a,t-=a,function(i){return a+t*i}}},{key:"deinterpolateValue",value:function(a,t){return(t-=a=+a)?function(r){return(r-a)/t}:function(){return t}}},{key:"rescale",value:function(){return this.interpolator=null,this}},{key:"getValue",value:function(a){var t=this.domain,r=this.range;return(this.interpolator||(this.interpolator=this.createInterpolator(t,r)))(+a)}},{key:"setDomain",value:function(a){return this.domain=a.map(function(t){return+t}),this.rescale(),this}},{key:"getDomain",value:function(){return this.domain}},{key:"setRange",value:function(a){return this.range=a.map(function(t){return+t}),this}},{key:"getTicks",value:function(a){var t=this.domain;return In(t[0],t[t.length-1],a||10)}}]),e}();function lt(e,n,a){return Math.min(Math.max(e,n),a)}var ut=function e(){var n=this;j(this,e),A(this,"setDomain",function(a){return n.domain=a.slice(),n}),A(this,"setRange",function(a){return n.range=a.slice(),n}),A(this,"setStep",function(a){return n.step=a,n}),A(this,"getValue",function(a){var t=De(n.domain,2),r=t[0],i=t[1],s=De(n.range,2),o=s[0],l=s[1],u=n.step,c=(lt(a,r,i)-r)/(i-r),h=u*Math.round(c*(l-o)/u)+o;return lt(h,o<l?o:l,l>o?l:o)}),this.step=1,this.domain=[0,1],this.range=[0,1]};const ke=window.React,Vn=window.React.PureComponent;window.React.Fragment;var ae=typeof window!="undefined"&&typeof document!="undefined",z=function(){},An=function(n){return function(a,t,r){return a&&n[r]===t}},kn=function(n,a){return n===a||n.length===a.length&&n.reduce(An(a),!0)},Qn=function(n,a,t,r){var i=r?n-a:n+a;return r?Math.max(t[0],i):Math.min(t[1],i)},qn=function(n,a,t,r){var i=r?n+a:n-a;return r?Math.min(t[1],i):Math.max(t[0],i)},G=function(e){se(n,e);function n(){var a,t;j(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=le(this,(a=K(n)).call.apply(a,[this].concat(i))),A(V(t),"state",{step:null,values:null,domain:null,handles:[],reversed:null,activeHandleID:null,valueToPerc:null,valueToStep:null,pixelToStep:null}),A(V(t),"slider",ke.createRef()),A(V(t),"onKeyDown",function(o,l){var u=["ArrowRight","ArrowUp"],c=["ArrowDown","ArrowLeft"],h=V(t),m=h.state.handles,d=h.props,f=d.step,y=d.reversed,_=d.vertical,v=d.domain,R=o.key||o.keyCode;if(!!u.concat(c).includes(R)){if(_){var C=[c,u];u=C[0],c=C[1]}o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault();var b=m.find(function(Q){return Q.key===l});if(!!b){var D=b.val,q=D;u.includes(R)?q=Qn(D,f,v,y):c.includes(R)&&(q=qn(D,f,v,y));var L=m.map(function(Q){return Q.key===l?{key:Q.key,val:q}:Q});t.submitUpdate(L,!0)}}}),A(V(t),"onMouseDown",function(o,l){t.onStart(o,l,!1)}),A(V(t),"onTouchStart",function(o,l){at(o)||t.onStart(o,l,!0)}),A(V(t),"getEventData",function(o,l){var u=V(t),c=u.state,h=c.pixelToStep,m=c.valueToPerc,d=u.props.vertical;h.setDomain(ne(t.slider.current,d));var f;return l?f=h.getValue(Ae(d,o)):f=h.getValue(d?o.clientY:o.pageX),{value:f,percent:m.getValue(f)}}),A(V(t),"onMouseMove",function(o){var l=V(t),u=l.state,c=u.handles,h=u.pixelToStep,m=u.activeHandleID,d=l.props,f=d.vertical,y=d.reversed;h.setDomain(ne(t.slider.current,f));var _=h.getValue(f?o.clientY:o.pageX),v=oe(c,m,_,y);t.submitUpdate(v)}),A(V(t),"onTouchMove",function(o){var l=V(t),u=l.state,c=u.handles,h=u.pixelToStep,m=u.activeHandleID,d=l.props,f=d.vertical,y=d.reversed;if(!at(o)){h.setDomain(ne(t.slider.current,f));var _=h.getValue(Ae(f,o)),v=oe(c,m,_,y);t.submitUpdate(v)}}),A(V(t),"onMouseUp",function(){var o=V(t),l=o.state,u=l.handles,c=l.activeHandleID,h=o.props,m=h.onChange,d=h.onSlideEnd;m(u.map(function(f){return f.val})),d(u.map(function(f){return f.val}),{activeHandleID:c}),t.setState({activeHandleID:null}),ae&&(document.removeEventListener("mousemove",t.onMouseMove),document.removeEventListener("mouseup",t.onMouseUp))}),A(V(t),"onTouchEnd",function(){var o=V(t),l=o.state,u=l.handles,c=l.activeHandleID,h=o.props,m=h.onChange,d=h.onSlideEnd;m(u.map(function(f){return f.val})),d(u.map(function(f){return f.val}),{activeHandleID:c}),t.setState({activeHandleID:null}),ae&&(document.removeEventListener("touchmove",t.onTouchMove),document.removeEventListener("touchend",t.onTouchEnd))}),t}return ee(n,[{key:"componentDidMount",value:function(){var t=this.state.pixelToStep,r=this.props.vertical;t.setDomain(ne(this.slider.current,r))}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"removeListeners",value:function(){ae&&(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"onStart",value:function(t,r,i){var s=this.state.handles,o=this.props.onSlideStart;i||t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation();var l=s.find(function(u){return u.key===r});l?(this.setState({activeHandleID:r}),o(s.map(function(u){return u.val}),{activeHandleID:r}),i?this.addTouchEvents():this.addMouseEvents()):(this.setState({activeHandleID:null}),this.handleRailAndTrackClicks(t,i))}},{key:"handleRailAndTrackClicks",value:function(t,r){var i=this,s=this.state,o=s.handles,l=s.pixelToStep,u=this.props,c=u.vertical,h=u.reversed,m=this.slider;l.setDomain(ne(m.current,c));var d;r?d=l.getValue(Ae(c,t)):d=l.getValue(c?t.clientY:t.pageX);for(var f=null,y=1/0,_=0;_<o.length;_++){var v=o[_],R=v.key,C=v.val,b=Math.abs(C-d);b<y&&(f=R,y=b)}var D=oe(o,f,d,h);this.setState({activeHandleID:f},function(){i.submitUpdate(D,!0),r?i.addTouchEvents():i.addMouseEvents()})}},{key:"addMouseEvents",value:function(){ae&&(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}},{key:"addTouchEvents",value:function(){ae&&(document.addEventListener("touchmove",this.onTouchMove),document.addEventListener("touchend",this.onTouchEnd))}},{key:"submitUpdate",value:function(t,r){var i=this.props,s=i.mode,o=i.step,l=i.onUpdate,u=i.onChange,c=i.reversed,h=this.state.valueToStep.getValue;this.setState(function(m){var d=m.handles,f;if(typeof s=="function")f=s(d,t,o,c,h);else switch(s){case 1:f=wn(d,t);break;case 2:f=Fn(d,t);break;case 3:f=Le(d,t,o,c,h);break;default:f=t}return l(f.map(function(y){return y.val})),r&&u(f.map(function(y){return y.val})),{handles:f}})}},{key:"render",value:function(){var t=this,r=this.state,i=r.handles,s=r.valueToPerc,o=r.activeHandleID,l=this.props,u=l.className,c=l.rootStyle,h=l.rootProps,m=l.component,d=l.disabled,f=l.flatten,y=i.map(function(v){var R=v.key,C=v.val;return{id:R,value:C,percent:s.getValue(C)}}),_=ke.Children.map(this.props.children,function(v){return v&&(v.type.name===Te.name||v.type.name===ue.name||v.type.name===ce.name||v.type.name===Ee.name)?ke.cloneElement(v,{scale:s,handles:y,activeHandleID:o,getEventData:t.getEventData,emitKeyboard:d?z:t.onKeyDown,emitMouse:d?z:t.onMouseDown,emitTouch:d?z:t.onTouchStart}):v});return f?F(U,{children:[p(m,{...h,style:c,className:u,ref:this.slider}),_]}):p(m,{...h,style:c,className:u,ref:this.slider,children:_})}}],[{key:"getDerivedStateFromProps",value:function(t,r){var i=t.step,s=t.values,o=t.domain,l=t.reversed,u=t.onUpdate,c=t.onChange,h=t.warnOnChanges,m=r.valueToPerc,d=r.valueToStep,f=r.pixelToStep,y={};if((!m||!d||!f)&&(m=new xn,d=new ut,f=new ut,y.valueToPerc=m,y.valueToStep=d,y.pixelToStep=f),r.step===null||r.domain===null||r.reversed===null||i!==r.step||o[0]!==r.domain[0]||o[1]!==r.domain[1]||l!==r.reversed){var _=De(o,2),v=_[0],R=_[1];d.setStep(i).setRange([v,R]).setDomain([v,R]),l===!0?(m.setDomain([v,R]).setRange([100,0]),f.setStep(i).setRange([R,v])):(m.setDomain([v,R]).setRange([0,100]),f.setStep(i).setRange([v,R]));var C=rt(s||r.values,l,d,h),b=C.handles,D=C.changes;(D||s===void 0||s===r.values)&&(u(b.map(function(k){return k.val})),c(b.map(function(k){return k.val}))),y.step=i,y.values=s,y.domain=o,y.handles=b,y.reversed=l}else if(!kn(s,r.values)){var q=rt(s,l,d,h),L=q.handles,Q=q.changes;Q&&(u(L.map(function(k){return k.val})),c(L.map(function(k){return k.val}))),y.values=s,y.handles=L}return Object.keys(y).length?y:null}}]),n}(Vn);G.propTypes={};G.defaultProps={mode:1,step:.1,domain:[0,100],component:"div",rootProps:{},rootStyle:{},vertical:!1,reversed:!1,onChange:z,onUpdate:z,onSlideStart:z,onSlideEnd:z,disabled:!1,flatten:!1,warnOnChanges:!1};G.Rail=Te;G.Ticks=ue;G.Tracks=ce;G.Handles=Ee;const Dn=window.React.useState,ve=({domain:[e,n],handle:{id:a,value:t,percent:r},getHandleProps:i})=>p("div",{role:"slider",className:"RangeSlider__handle","aria-valuemin":e,"aria-valuemax":n,"aria-valuenow":t,style:{left:`${r}%`},...i(a)}),ge=({source:e,target:n,getTrackProps:a})=>p("div",{className:"RangeSlider__track",style:{left:`${e.percent}%`,width:`${n.percent-e.percent}%`},...a()}),Se=({tick:e,count:n,mode:a="SHOWMINMAX"})=>F("div",{children:[p("div",{className:"RangeSlider__tick",style:{left:`${e.percent}%`}}),p("div",{className:"RangeSlider__tickInner",style:{marginLeft:`${-(100/n)/2}%`,width:`${100/n}%`,left:`${e.percent}%`},children:(a==="SHOWALL"||a==="SHOWMINMAX"&&(e.percent==0||e.percent==100))&&e.value})]});function ct(e,n){return[e.min?Number(e.min):Number(n[0]),e.max?Number(e.max):Number(n[1])]}const _e=({doUpdateOnApply:e=!0,...n})=>{const a=l=>l.map(u=>Number(u)),[t,r]=Dn(()=>ct(n.initialValues,n.domain)),i=a(n.domain),s=(l,u)=>{r([...l]),u&&u({min:l[0],max:l[1]})};let o=i[1]-i[0];return n.maxTickCount&&o>n.maxTickCount&&(o=n.maxTickCount),F("div",{className:"RangeSlider",children:[F("div",{className:"RangeSlider__values",children:[t[0]," - ",t[1]]}),F("div",{className:`RangeSlider__wrapper${e?"--flex":"--block"}`,children:[F(G,{mode:1,step:n.step,domain:a(n.domain),className:"RangeSlider__slider",onChange:l=>s(l,e?void 0:n.onChange),values:ct(n.initialValues,n.domain),children:[p(Te,{children:({getRailProps:l})=>p("div",{className:"RangeSlider__rail",...l()})}),p(Ee,{children:({handles:l,getHandleProps:u})=>p("div",{className:"slider-handles",children:l.map(c=>p(ve,{handle:c,domain:a(n.domain),getHandleProps:u},c.id+c.percent))})}),p(ce,{left:!0,right:!0,children:({tracks:l,getTrackProps:u})=>p("div",{children:l.map(({id:c,source:h,target:m})=>p(ge,{source:h,target:m,getTrackProps:u},c))})}),p(ue,{count:o,children:({ticks:l})=>p("div",{children:l.map(u=>p(Se,{tick:u,count:l.length},u.id))})})]}),e&&p("button",{className:"RangeSlider__btnApply",onClick:()=>n.onChange({min:t[0],max:t[1]}),children:"Apply"})]})]})};try{ve.displayName="Handle",ve.__docgenInfo={description:"",displayName:"Handle",props:{domain:{defaultValue:null,description:"",name:"domain",required:!0,type:{name:"number[]"}},handle:{defaultValue:null,description:"",name:"handle",required:!0,type:{name:"SliderItem"}},getHandleProps:{defaultValue:null,description:"",name:"getHandleProps",required:!0,type:{name:"GetHandleProps"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/RangeSlider.tsx#Handle"]={docgenInfo:ve.__docgenInfo,name:"Handle",path:"src/lib/containers/widgets/RangeSlider.tsx#Handle"})}catch{}try{ge.displayName="Track",ge.__docgenInfo={description:"",displayName:"Track",props:{source:{defaultValue:null,description:"",name:"source",required:!0,type:{name:"SliderItem"}},target:{defaultValue:null,description:"",name:"target",required:!0,type:{name:"SliderItem"}},getTrackProps:{defaultValue:null,description:"",name:"getTrackProps",required:!0,type:{name:"GetTrackProps"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/RangeSlider.tsx#Track"]={docgenInfo:ge.__docgenInfo,name:"Track",path:"src/lib/containers/widgets/RangeSlider.tsx#Track"})}catch{}try{Se.displayName="Tick",Se.__docgenInfo={description:"",displayName:"Tick",props:{key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},tick:{defaultValue:null,description:"",name:"tick",required:!0,type:{name:"SliderItem"}},count:{defaultValue:null,description:"",name:"count",required:!0,type:{name:"number"}},mode:{defaultValue:{value:"SHOWMINMAX"},description:"",name:"mode",required:!1,type:{name:"enum",value:[{value:'"SHOWALL"'},{value:'"SHOWNONE"'},{value:'"SHOWMINMAX"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/RangeSlider.tsx#Tick"]={docgenInfo:Se.__docgenInfo,name:"Tick",path:"src/lib/containers/widgets/RangeSlider.tsx#Tick"})}catch{}try{_e.displayName="RangeSlider",_e.__docgenInfo={description:"",displayName:"RangeSlider",props:{domain:{defaultValue:null,description:"",name:"domain",required:!0,type:{name:"string[]"}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!0,type:{name:"RangeValues"}},step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"number"}},doUpdateOnApply:{defaultValue:{value:"true"},description:"",name:"doUpdateOnApply",required:!1,type:{name:"boolean"}},maxTickCount:{defaultValue:null,description:"",name:"maxTickCount",required:!1,type:{name:"number"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"Function"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/RangeSlider.tsx#RangeSlider"]={docgenInfo:_e.__docgenInfo,name:"RangeSlider",path:"src/lib/containers/widgets/RangeSlider.tsx#RangeSlider"})}catch{}const dt=window.React.useState;var Pe=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(Pe||{});const Ce=({facetResult:e,columnModel:n,onChange:a,facetAliases:t,collapsed:r=!1})=>{const[i,s]=dt(r),o=[{label:He,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:l,columnMax:u,selectedMin:c,selectedMax:h}=e;const m=!c&&!h;c=c||l,h=h||u;const d=n.columnType==="DOUBLE"?"number":"date",f=(C,b)=>b?"":C===Me?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",y=(C,b)=>{v(C),C!=="RANGE"&&b([C,C])},[_,v]=dt(f(c,m));return F("div",{children:[p(ie,{isCollapsed:i,label:n.name,onClick:C=>s(C),facetAliases:t}),F(ft,{in:!i,children:[p(Yt,{value:_,id:"rangeSelector",options:o,onChange:C=>y(C,a)}),_==="RANGE"&&(l===u?p("label",{children:u}):F(U,{children:[n.columnType==="INTEGER"&&F(_e,{domain:[l,u],initialValues:{min:c,max:h},step:1,doUpdateOnApply:!0,onChange:C=>a([C.min,C.max]),children:[") ",">"]},"RangeSlider"),(n.columnType==="DATE"||n.columnType==="DOUBLE")&&p(ye,{initialValues:{min:c,max:h},type:d,onChange:C=>a([C.min,C.max])},"Range")]}))]})]})};try{Ce.displayName="RangeFacetFilter",Ce.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"Function"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:Ce.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const Et=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(n=>n.isSelected===!0).map(n=>n.value)}),Ln=e=>{let n={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(n={...n,min:e.columnMin,max:e.columnMax}),n},Ye=(e,n)=>{var i,s;const a=(s=(i=n==null?void 0:n.query)==null?void 0:i.selectedFacets)!=null?s:[],t=a.findIndex(o=>o.columnName===e.columnName),r=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return t>-1?r?a.splice(t,1):a[t]=e:a.push(e),a};function Rt(e,n,a,t,r=!1){t?n.facetValues.forEach(o=>{o.value===t&&(o.isSelected=r)}):n.facetValues.forEach(o=>{o.isSelected=!1});const i=Et(n),s=Ye(i,e);a(s)}const Pn=(e,n,a,t)=>{const r=t&&Object.keys(t)||[];r.length&&n.facetValues.forEach(o=>{r.includes(o.value)&&(o.isSelected=t?!!t[o.value]:!1)});const i=Et(n),s=Ye(i,e);a(s)},wt=(e,n,a,t)=>{n.columnMin=t[0],n.columnMax=t[1];const r=Ln(n),i=Ye(r,e);a(i)},Qe=({facetsToFilter:e})=>{const{data:n,isLoadingNewBundle:a,getLastQueryRequest:t,executeQueryRequest:r}=Be(),{facetAliases:i,topLevelControlsState:s}=yt();if(!n)return p(U,{});const{showFacetFilter:o}=s,l=n.selectColumns;let u=n.facets;e&&(u=u.filter(m=>e.includes(m.columnName)));const c=t(),h=m=>{const d=t();d.query.selectedFacets=m,d.query.offset=0,r(d)};return F("div",{className:`QueryFilter ${o?gt:St}`,children:[p("h4",{className:"QueryFilter__title",children:"Filter By"}),a&&p("div",{children:"Loading..."}),!a&&u.map((m,d)=>{const f=l.find(_=>_.name===m.columnName),y=d>2;if(!Mt(m))return F("div",{className:"QueryFilter__facet",children:[m.facetType==="enumeration"&&f&&p(he,{containerAs:"Collapsible",collapsed:y,facetValues:m.facetValues,columnModel:f,facetAliases:i,onChange:_=>Pn(c,m,h,_),onClear:()=>Rt(c,m,h)}),m.facetType==="range"&&f&&p(Ce,{facetResult:m,columnModel:f,facetAliases:i,collapsed:y,onChange:_=>wt(c,m,h,_)})]},m.columnName)})]})};try{Qe.displayName="QueryFilter",Qe.__docgenInfo={description:"",displayName:"QueryFilter",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"]={docgenInfo:Qe.__docgenInfo,name:"QueryFilter",path:"src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"})}catch{}const Mn=window.React.useCallback,Hn=window.React.useEffect,Un=window.React.useState,$n=window.React.createElement,qe=({style:e,frontText:n,endText:a="",showNotch:t=!1})=>{var X;const{data:r,isLoadingNewBundle:i,getLastQueryRequest:s,executeQueryRequest:o,getInitQueryRequest:l,error:u}=Be(),{topLevelControlsState:c,unitDescription:h}=yt(),m=r==null?void 0:r.queryCount,[d,f]=Un([]),y=T=>{const S=H(s());S.query.selectedFacets=T,S.query.offset=0,o(S)},_=T=>T.filter(E=>E.facetType==="enumeration").filter(E=>E.facetValues.filter(I=>I.isSelected===!0).length>0),v=T=>T.filter(E=>E.facetType==="range").filter(E=>E.selectedMax||E.selectedMin),R=(T,S)=>{var E;const w=T.find(I=>I.id===S);return(E=w==null?void 0:w.name)!=null?E:S},C=(T,S)=>{const w=T.find(E=>E.ownerId===S);return(w==null?void 0:w.userName)||S},b=Mn((T,S)=>{const w=jt(),E=Gt(),I=[];return T.forEach(N=>{const g=S.find(O=>O.name===N.columnName);N.facetValues.forEach(O=>{if(O.isSelected){let x=O.value;(g==null?void 0:g.columnType)===M.ENTITYID||(g==null?void 0:g.columnType)===M.ENTITYID_LIST?x=R(w,O.value):((g==null?void 0:g.columnType)===M.USERID||(g==null?void 0:g.columnType)===M.USERID_LIST)&&(x=C(E,O.value)),I.push({facet:N,displayValue:x,selectedValue:O})}})}),I},[]);Hn(()=>{if(r){const T=v(r.facets),S=_(r.facets),w=T.map(I=>({facet:I})),E=b(S,r.columnModels);f([...w,...E])}},[r,b]);const D=T=>{const{facet:S,selectedValue:w}=T;S.facetType==="enumeration"?Rt(s(),S,y,w==null?void 0:w.value,!1):wt(s(),S,y,[Pe.ANY,Pe.ANY])},q=(T,S)=>{var E;const w=H(s());!w.query.additionalFilters||(w.query.additionalFilters=(E=w.query.additionalFilters)==null?void 0:E.reduce(function(I,N){if(Fe(N)||Oe(N)){const g={columnName:N.columnName,values:N.columnName===T?N.values.filter(O=>O!==S):N.values,operator:Fe(N)?N.operator:void 0,function:Oe(N)?N.function:void 0,concreteType:N.concreteType};g.values.length>0&&I.push(g)}else I.push(N);return I},[]),o(w))},L=T=>{const S=H(s());!S.query.additionalFilters||(S.query.additionalFilters=S.query.additionalFilters.filter(w=>!(je(w)&&w.searchExpression===T.searchExpression)),o(S))},Q=()=>{const T=H(l());T.query.additionalFilters=[],o(T)},k=(X=s().query.additionalFilters)==null?void 0:X.reduce((T,S)=>{if(je(S))T.push({key:`fulltextsearch-${S.searchExpression}`,filter:{value:S.searchExpression},onRemove:()=>L(S)});else if(Fe(S)||Oe(S)){const{columnName:w}=S;S.values.forEach(E=>{T.push({key:`columnsearch-${E}`,filter:{columnName:w,value:E},onRemove:()=>q(S.columnName,E)})})}else console.warn("Encountered unexpected QueryFilter: ",S);return T},[]),B=c==null?void 0:c.showFacetFilter;return u?p(U,{}):p("div",{className:`TotalQueryResults ${t?"notch-down":""} ${B?gt:St}`,style:e,children:i?p(me,{width:100}):F(U,{children:[F("span",{className:"SRC-boldText SRC-text-title SRC-centerContent",children:[n," ",m==null?void 0:m.toLocaleString()," ",h," ",a]}),F("div",{className:"TotalQueryResults__selections",children:[k&&k.map(T=>$n(re,{...T,key:T.key})),d.map((T,S)=>{var w,E,I;return p(re,{facetWithSelection:T,onRemove:()=>D(T)},`facets-${(I=(E=(w=T.selectedValue)==null?void 0:w.value)!=null?E:T.displayValue)!=null?I:S}`)})]}),(d.length>0||k&&k.length>0)&&p(Wt,{onClick:Q,variant:"light",className:"TotalQueryResults__clearall",children:"Clear All"})]})})};try{qe.displayName="TotalQueryResults",qe.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},showNotch:{defaultValue:{value:"false"},description:"",name:"showNotch",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:qe.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}export{Jt as C,he as E,xe as Q,me as S,qe as T,we as a,pe as b,sn as c,Be as d,yt as e,Ve as f,ln as g,Pn as h,Rt as i,gt as j,St as k,Ne as l,Qe as m,Fe as n,Oe as o,Xt as p,va as q,ga as u};
//# sourceMappingURL=TotalQueryResults.5e23b993.js.map

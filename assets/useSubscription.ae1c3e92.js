import{r as T,a as C,j as g}from"./jsx-runtime.d95d6493.js";import{h as c,bR as O,k as y,bS as q,bT as F,bU as P,R as o,bV as N,bW as x,bX as Q,bY as D,bZ as G,b_ as V,b$ as J,c0 as Y}from"./index.a967ac4c.js";import{u as l}from"./useMutation.d7ef8afa.js";import{u as I}from"./useInfiniteQuery.6acea356.js";import{g as K}from"./DiscussionSearchResult.a7585a19.js";import{M as H}from"./MarkdownEditor.b1e0fc24.js";import{B as E}from"./Button.a2dbd16c.js";import{D as W}from"./EntityChildren.50133102.js";function fe(e,n,a,s,r,t){const{accessToken:i}=c();return I(["forumthread",e,"infinite",n,r,a,s],async u=>O(i,e,u.pageParam,n,a,s,r),{...t,getNextPageParam:(u,d)=>{if(u.results.length>0)return d.length*n}})}function Te(e){const{data:n,isLoading:a}=X(e),{data:s,isLoading:r}=Z(n,{enabled:!!n});return{threadData:n,threadBody:s,isLoading:r||a}}function X(e,n){const{accessToken:a}=c();return y(["thread",e,a],()=>q(e,a),n)}function Z(e,n){var r;const{accessToken:a}=c(),s=F((r=e==null?void 0:e.messageKey)!=null?r:"",a);return y(["thread",e==null?void 0:e.id,e==null?void 0:e.messageKey,a],async()=>K((await s).messageUrl),n)}function $(e){const n=o(),{accessToken:a}=c();return l(s=>N(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",r.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function z(e){const n=o(),{accessToken:a}=c();return l(s=>x(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",r.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function j(e){const n=o(),{accessToken:a}=c();return l(s=>Q(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["forumthread",s.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function ye(e,n,a,s,r,t){const{accessToken:i}=c();return I(["thread",e,"infinite",a,r,s,n],async u=>P(i,e,a,u.pageParam,s,n,r),{...t,getNextPageParam:(u,d)=>{if(u.results.length>0)return d.length*a}})}function ee(e){const n=o(),{accessToken:a}=c();return l(s=>D(s,a),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",s.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function se(e){const n=o(),{accessToken:a}=c();return l(s=>G(s,a),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",s.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}var ae=(e=>(e.FORUM="FORUM",e.THREAD="THREAD",e.DATA_ACCESS_SUBMISSION="DATA_ACCESS_SUBMISSION",e.DATA_ACCESS_SUBMISSION_STATUS="DATA_ACCESS_SUBMISSION_STATUS",e))(ae||{}),p=(e=>(e.SUBSCRIPTION_ID="SUBSCRIPTION_ID",e.SUBSCRIBER_ID="SUBSCRIBER_ID",e.OBJECT_ID="OBJECT_ID",e.OBJECT_TYPE="OBJECT_TYPE",e.CREATED_ON="CREATED_ON",e))(p||{});const f=({initialText:e,initialTitle:n,id:a,onClose:s,isReply:r})=>{const[t,i]=T.exports.useState(n!=null?n:""),[u,d]=T.exports.useState(e!=null?e:""),{mutate:m,isLoading:L}=$({onSuccess:()=>s()}),{mutate:R,isLoading:b}=z({onSuccess:()=>s()}),{mutate:A,isLoading:k}=j({onSuccess:()=>s()}),{mutate:B,isLoading:v}=ee({onSuccess:()=>s()}),{mutate:w,isLoading:M}=se({onSuccess:()=>s()}),h=b||v||k||L||M,U=(S,_)=>{r?e?w({replyId:a,messageMarkdown:S}):B({threadId:a,messageMarkdown:S}):n?(m({title:_,threadId:a}),R({messageMarkdown:S,threadId:a})):A({forumId:a,title:_,messageMarkdown:S})};return C("div",{className:"bootstrap-4-backport",children:[!r&&g("input",{placeholder:"Title",type:"text",style:{width:"100%",padding:"4px"},value:t,onChange:S=>i(S.target.value)}),g(H,{text:u,setText:d}),C("div",{style:{display:"flex",justifyContent:"flex-end"},children:[g(E,{onClick:s,variant:"light",children:"Cancel"}),g(E,{disabled:h,onClick:()=>U(u,t),variant:"primary",children:h?"Saving":"Save"})]})]})};try{f.displayName="ForumThreadEditor",f.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"]={docgenInfo:f.__docgenInfo,name:"ForumThreadEditor",path:"src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"})}catch{}function ne(e,n,a){const{accessToken:s}=c();return y([s,"subscription",e,n],async()=>{const t={objectType:n,idList:[e],sortByType:p.OBJECT_ID,sortDirection:W.ASC};return(await Y(s,t)).results[0]},a)}function re(e){const n=o(),{accessToken:a}=c();return l(s=>V(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries([a,"subscription"]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function te(e){const n=o(),{accessToken:a}=c();return l(s=>J(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries([a,"subscription"]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}const he=(e,n)=>{const{data:a,isLoading:s}=ne(e,n),{mutate:r,isLoading:t}=re(),{mutate:i,isLoading:u}=te(),d=s||t||u,m=T.exports.useCallback(()=>{a?i(a.subscriptionId):r({objectId:e,objectType:n})},[i,e,n,r,a]);return{isLoading:d,subscription:a,toggleSubscribed:m}};export{f as F,ae as S,he as a,ye as b,fe as c,Te as u};

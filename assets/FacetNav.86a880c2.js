import{ah as tt,ai as nt,af as at,B as rt,ae as st,ar as ot,H as it,E as lt,as as ee,at as ye,f as ct,a7 as ut,ad as dt,au as pt,av as mt}from"./index.219651a3.js";import{j as n,a as S,F as B}from"./jsx-runtime.00d70968.js";import{i as ft,r as yt,a as He}from"./queryUtils.8f784f58.js";import{a as ze,b as ht,u as _t}from"./use-deep-compare-effect.esm.0387ba0e.js";import{p as St,a as Ct}from"./sqlFunctions.02978512.js";import{c as $}from"./cloneDeep.0f6934c3.js";import{u as H,E as te}from"./ElementWithTooltip.e257405f.js";import{u as ke}from"./useGetInfoFromIds.d217a33c.js";import{C as P}from"./ColumnType.744125d2.js";import"./assert.cba23eb4.js";import{I as se}from"./IconSvg.debd858a.js";import{C as Ke}from"./Checkbox.c68b07e0.js";import{D as Y}from"./Dropdown.b0dc465f.js";import{C as Ge,a as gt}from"./Collapse.1f37bc76.js";import{R as Ft}from"./RadioGroup.d19dd04f.js";import{h as Be}from"./moment.a565bb48.js";import{R as Et}from"./RangeSlider.df5d4da8.js";import{c as Rt,P as Nt}from"./factory.50319b99.js";import{r as Tt}from"./react-sizeme.1c5f980e.js";import{S as vt}from"./Skeleton.99b24529.js";import{g as bt}from"./ColorGradient.16f0e0f2.js";import{l as xt}from"./LoadingScreen.91642215.js";import{T as wt}from"./Tooltip.6d92cd5b.js";import{M as re}from"./Modal.1fb607f9.js";import{B as Oe}from"./Button.fda23eee.js";import{I as It}from"./InfoOutlined.60e019a4.js";import{i as Ae}from"./TypeUtils.a2c41307.js";const j=e=>n(vt,{style:{...e.style,display:"inline-block"},...e});try{j.displayName="SkeletonInlineBlock",j.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:j.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const Ot=window.React.createContext,Ve=window.React.useContext,D=Ot(void 0),oe=({children:e,queryContext:t})=>n(D.Provider,{value:t,children:e});function G(){const e=Ve(D);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function zn(){const e=Ve(D);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function Kn(){const e=Ve(D);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const he=D.Consumer;try{D.displayName="QueryContext",D.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:D.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{oe.displayName="QueryContextProvider",oe.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:oe.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{he.displayName="QueryContextConsumer",he.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:he.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}function je(e,t){return`${e}${t}`}function At(e,t){const o=window.location.search,a=`${e}=${t}`;return o?o.includes(`${e}=`)?window.location.search.slice(o.indexOf("?")+1).split("&").map(i=>i.split("=")[0]===e?`${a}`:i).join("&"):`${o.substr(1)}&${a}`:a}function Vt(e,t){if(!window.location.search)return;const o=je(e,t),s=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(r=>r.split("=")[0]===o).map(r=>r.split("=")[1])[0];return s?decodeURIComponent(s):void 0}function Qt(e,t,o){const a=t!==void 0?je(e,t):e,s=At(a,o),r=window.location,i=`${r.protocol}//${r.hostname}${r.port?":"+r.port:""}${r.pathname}?${s}`;window.history.replaceState("object or string","Title",i)}function qt(e,t){const o=Vt(e,t);let a;if(o){const s=JSON.parse(o);s.sql&&(a={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:tt|nt|at|rt,entityId:St(s.sql),query:s})}return a}const Lt=window.React.useCallback,kt=window.React.useEffect,Bt=window.React.useState;function Pt(e){var y,l;const{initQueryRequest:t,componentIndex:o=0,shouldDeepLink:a=!1,onQueryChange:s}=e,[r,i]=Bt(t);kt(()=>{const d=qt("QueryWrapper",o);d&&i(d)},[o]);const u=Lt(()=>$(r),[r]);function F(){return $(t)}function m(d){let c;typeof d=="function"?c=d(u()):c=d;const T=$(c);if(i(T),T.query){const g=JSON.stringify(T.query);if(a){const x=encodeURIComponent(g);Qt("QueryWrapper",o,x)}s&&s(g)}}const{entityId:f,versionNumber:b}=Ct(r.query.sql),E=(y=r.query.limit)!=null?y:st,w=Math.ceil((((l=r.query.offset)!=null?l:0)+Number(E))/E);function C(d){m(c=>(c.query.limit=d,c))}function I(d){m(c=>(c.query.offset=(d-1)*E,c))}return{entityId:f,versionNumber:b,getInitQueryRequest:F,getLastQueryRequest:u,setQuery:m,pageSize:E,currentPage:w,setPageSize:C,goToPage:I}}const Pe=window.React.useMemo,Yt=window.React.useState,Qe="isShowingFacetFilters",qe="isHidingFacetFilters";function _e(e){const{initQueryRequest:t,onQueryChange:o,onQueryResultBundleChange:a,lockedColumn:s,componentIndex:r,shouldDeepLink:i}=e,[u,F]=Yt(void 0),{entityId:m,versionNumber:f,getInitQueryRequest:b,getLastQueryRequest:E,setQuery:w,currentPage:C,pageSize:I,goToPage:y,setPageSize:l}=Pt({initQueryRequest:t,shouldDeepLink:i,componentIndex:r,onQueryChange:o}),d=Pe(()=>E(),[E]),{data:c,isLoading:T,error:g,isPreviousData:x}=ot(d,{keepPreviousData:!0},F),Q=c==null?void 0:c.responseBody,U=T||x,{data:L}=it(m,f);ze(()=>{Q&&a&&a(JSON.stringify(Q))},[Q,a]);const N=Q?ft(Q.facets,Q.selectColumns):!0,A={data:Pe(()=>yt(Q,s),[Q,s]),currentPage:C,pageSize:I,setPageSize:l,isLoadingNewBundle:U,getLastQueryRequest:E,getInitQueryRequest:b,error:g,entity:L,executeQueryRequest:w,isFacetsAvailable:N,asyncJobStatus:u,goToPage:y},{children:p}=e;return n(oe,{queryContext:A,children:n("div",{className:`SRC-wrapper ${U?"SRC-logo-cursor":""} ${N?"has-facets":""}`,children:p})})}try{_e.displayName="QueryWrapper",_e.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:_e.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}const Ut=window.React.createContext,Dt=window.React.useContext,Se=window.React.useEffect,Ce=window.React.useState,z=Ut(void 0),ie=({children:e,queryVisualizationContext:t})=>n(z.Provider,{value:t,children:e});function ae(){const e=Dt(z);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const ge=z.Consumer;function Fe(e){var I,y;const{data:t,getLastQueryRequest:o,isFacetsAvailable:a,isLoadingNewBundle:s}=G(),[r,i]=Ce({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(I=e.defaultShowFacetVisualization)!=null?I:!0,showSearchBar:(y=e.defaultShowSearchBar)!=null?y:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});Se(()=>{a||i(l=>({...l,showFacetFilter:!1,showFacetVisualization:!1}))},[a]),Se(()=>{s&&f([])},[s]);const[u,F]=Ce([]),[m,f]=Ce([]),b=o(),E=ht(t==null?void 0:t.selectColumns);Se(()=>{var l,d;F((d=E==null?void 0:E.slice(0,(l=e.visibleColumnCount)!=null?l:1/0).map(c=>c.name))!=null?d:[])},[E,b.query.sql,e.visibleColumnCount]);const w={topLevelControlsState:r,setTopLevelControlsState:i,columnsToShowInTable:u,setColumnsToShowInTable:F,selectedRowIndices:m,setSelectedRowIndices:f,facetAliases:e.facetAliases,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn},{children:C}=e;return n(ie,{queryVisualizationContext:w,children:C})}try{Fe.displayName="QueryVisualizationWrapper",Fe.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:Fe.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{z.displayName="QueryVisualizationContext",z.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:z.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{ie.displayName="QueryVisualizationContextProvider",ie.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:ie.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{ge.displayName="QueryVisualizationContextConsumer",ge.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:ge.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}const Ee=()=>{const{error:e}=G();return n(lt,{error:e})};try{Ee.displayName="QueryWrapperErrorBanner",Ee.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"]={docgenInfo:Ee.__docgenInfo,name:"QueryWrapperErrorBanner",path:"src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"})}catch{}var Mt=(e=>(e.LIKE="LIKE",e))(Mt||{}),$t=(e=>(e.HAS="HAS",e.HAS_LIKE="HAS_LIKE",e))($t||{});const Wt="org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",Ht="org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",zt="org.sagebionetworks.repo.model.table.TextMatchesQueryFilter",Ye=Ae(zt),Re=Ae(Wt),Ne=Ae(Ht),le=e=>{var t;return S("svg",{...e,className:`Icon-Plus ${(t=e.className)!=null?t:""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]})};try{le.displayName="IconPlus",le.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconPlus.tsx#IconPlus"]={docgenInfo:le.__docgenInfo,name:"IconPlus",path:"src/lib/assets/icons/IconPlus.tsx#IconPlus"})}catch{}const ce=e=>{var t;return S("svg",{...e,className:`Icon-Minus ${(t=e.className)!=null?t:""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]})};try{ce.displayName="IconMinus",ce.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconMinus.tsx#IconMinus"]={docgenInfo:ce.__docgenInfo,name:"IconMinus",path:"src/lib/assets/icons/IconMinus.tsx#IconMinus"})}catch{}const J=({label:e,isCollapsed:t,onClick:o,facetAliases:a})=>S("div",{className:"FacetFilterHeader",children:[n("label",{className:"FacetFilterHeader__label",children:H(e,a)}),n("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>o(!t),children:t?n(le,{className:"icon-plus",title:"Expand Menu"}):n(ce,{className:"icon-minus",title:"Collapse Menu"})})]});try{J.displayName="FacetFilterHeader",J.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"Function"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!0,type:{name:"{} | undefined"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:J.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}const Je=window.React,M=window.React.useState;function Kt(e){return e.replace(/\s/g,"").toLowerCase()}function Ue(e,t=[],o=[]){const{value:a}=e;let s=a;a===ee&&(s=ye);const r=t.find(u=>u.ownerId===a);r&&(s=r?r.userName:`unknown (${a})`);const i=o.find(u=>u.id===a);return i&&(s=i?i.name:`unknown (${a})`),`${s}`}function Gt(e,t,o){const a=[...e.sort((s,r)=>r.count-s.count)];return t||a.length<=o||a.slice(o).find(s=>s.isSelected)?a:a.splice(0,o)}const K=({facetValues:e,columnModel:t,onClear:o,onChange:a,facetAliases:s,containerAs:r="Collapsible",dropdownType:i="Icon",collapsed:u=!1})=>{const[F,m]=M(!1),[f,b]=M(u),[E,w]=M(!1),[C,I]=M(!1),[y,l]=M(""),[d,c]=M(e);_t(()=>{c(e)},[e]);const T=5,g=1500,x=Je.createRef(),Q={};let U;const L=e.filter(_=>_.isSelected).length===0,N=(t==null?void 0:t.columnType)===P.USERID||(t==null?void 0:t.columnType)===P.USERID_LIST?e.map(_=>_.value):[],O=ke({ids:N,type:"USER_PROFILE"}),A=(t==null?void 0:t.columnType)===P.ENTITYID||(t==null?void 0:t.columnType)===P.ENTITYID_LIST?e.map(_=>_.value):[],p=ke({ids:A,type:"ENTITY_HEADER"}),h=_=>{const V=_.target.value;if(l(V),m(!0),!V)e.forEach(k=>{k.isSelected=!1}),c(e);else{const k=e.filter(W=>Ue(W,O,p).toLowerCase().indexOf(V.trim().toLowerCase())>-1?W:null);c(k)}};if(!t)return n(B,{});const R=r==="Dropdown",v=S("div",{className:R?"EnumFacetFilter__dropdown_menu":"",children:[S("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[S("div",{className:C?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[n("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{c(e),I(!1),m(!1)},children:n("span",{className:"EnumFacetFilter__previous",children:n(se,{options:{icon:"arrowBack"}})})}),y.length>0&&n("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var _;l(""),(_=x.current)==null||_.focus()},children:n("span",{className:"EnumFacetFilter__reset",children:n(se,{options:{icon:"close"}})})}),n("input",{type:"text",placeholder:"Find values",value:y,ref:x,onChange:_=>{h(_)}})]}),!C&&S("div",{className:"EnumFacetFilter__checkAll",children:[n(Ke,{className:"EnumFacetFilter__checkbox",onChange:()=>{o()},checked:L,label:"All",isSelectAll:!0},"select_all"),n("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var _;l(""),I(!0),(_=x.current)==null||_.focus()},children:n("span",{className:"EnumFacetFilter__searchicon",children:n(se,{options:{icon:"search"}})})})]})]}),S("div",{children:[d.length>0&&Gt(d,F||R,T).map((_,V)=>n(jt,{id:Kt(_.value),index:V,label:Ue(_,O,p),count:_.count,isDropdown:R,initialIsSelected:_.isSelected,onChange:k=>{Q[_.value]=k,clearTimeout(U),U=setTimeout(()=>{a(Q),w(!1)},g)}},`checkLabel${V}`)),!R&&S(B,{children:[!F&&d.length>T&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>m(!0),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:S("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",d.length,")"]})})}),F&&d.length>T&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>m(!1),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:n("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),d.length<=0&&n("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),q=()=>w(!E);return R?i==="SelectBox"?S(Y,{className:"EnumFacetFilter EnumFacetFilterSelect",show:E,onToggle:q,children:[S(Y.Toggle,{className:"secondary-caret",variant:"gray-select",children:[L&&"All",!L&&e.filter(_=>_.isSelected).length===1&&e.filter(_=>_.isSelected)[0].value,!L&&e.filter(_=>_.isSelected).length>1&&"Multiple Values Selected"]}),n(Y.Menu,{children:v})]}):S(Y,{className:"EnumFacetFilter",show:E,onToggle:q,children:[n(te,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),n(Y.Menu,{children:v})]}):S(B,{children:[n(J,{facetAliases:s,isCollapsed:f,label:t.name,onClick:_=>b(_)}),n(Ge,{className:"EnumFacetFilter",in:!f,children:v})]})};function jt({id:e,index:t,label:o,count:a,isDropdown:s,initialIsSelected:r,onChange:i}){const[u,F]=M(r);return Je.useEffect(()=>{F(r)},[r]),S("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{s&&(F(!u),i(!u))},children:[n(Ke,{className:"EnumFacetFilter__checkbox",onClick:m=>m.stopPropagation(),onChange:m=>{F(m),i(m)},checked:u,label:o},`${e}-${t}`),s&&S("span",{className:"EnumFacetFilter__count",children:["(",a,")"]}),!s&&n("div",{className:"EnumFacetFilter__count",children:a})]})}try{K.displayName="EnumFacetFilter",K.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:K.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const ue=({facet:e,isChecked:t,onClick:o})=>{const{facetAliases:a}=ae();return S("button",{className:`Chip ${t?"Checked":""}`,onClick:o,children:[H(e.columnName,a),n(se,{options:{icon:t?"check":"add",size:"14px",padding:"left"}})]})};try{ue.displayName="FacetChip",ue.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"]={docgenInfo:ue.__docgenInfo,name:"FacetChip",path:"src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"})}catch{}const De=window.React.useState,de=e=>{const t="Min value should be less then max value",[o,a]=De(!1),[s,r]=De(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Be(e.initialValues.min).format("YYYY-MM-DD"),max:Be(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),i=e.className?`range ${e.className}`:"range",u=({min:m,max:f},b="number")=>{if(m==null||f===null||f===void 0)return a(!1),!0;if(b==="number"){if(Number(m)>Number(f))return a(!0),!1}else if(Date.parse(m)>Date.parse(f))return a(!0),!1;return a(!1),!0},F=(m,f,b="number")=>{u(m,b)&&f(m)};return S("div",{className:i,style:{display:"flex",flexWrap:"wrap"},children:[S("div",{style:{marginRight:"10px"},children:[n("input",{"aria-label":"min",type:e.type,value:s.min,onChange:({target:m})=>r({min:m.value,max:s.max})},"range_min"),n("div",{children:"to"}),n("input",{"aria-label":"max",type:e.type,value:s.max,onChange:({target:m})=>r({min:s.min,max:m.value})},"range_max")]}),n("button",{className:"btn btn-link SRC-noPadding",onClick:()=>F(s,e.onChange,e.type),children:"Apply"}),o&&n("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{de.displayName="Range",de.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:de.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}const Me=window.React.useState;var we=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(we||{});const pe=({facetResult:e,columnModel:t,onChange:o,facetAliases:a,collapsed:s=!1})=>{const[r,i]=Me(s),u=[{label:ye,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:F,columnMax:m,selectedMin:f,selectedMax:b}=e;const E=!f&&!b;f=f||F,b=b||m;const w=t.columnType==="DOUBLE"?"number":"date",C=(c,T)=>T?"":c===ee?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",I=(c,T)=>{l(c),c!=="RANGE"&&T([c,c])},[y,l]=Me(C(f,E));return S("div",{children:[n(J,{isCollapsed:r,label:t.name,onClick:c=>i(c),facetAliases:a}),S(Ge,{in:!r,children:[n(Ft,{value:y,id:"rangeSelector",options:u,onChange:c=>I(c,o)}),y==="RANGE"&&(F===m?n("label",{children:m}):S(B,{children:[t.columnType==="INTEGER"&&S(Et,{domain:[F,m],initialValues:{min:f,max:b},step:1,doUpdateOnApply:!0,onChange:c=>o([c.min,c.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&n(de,{initialValues:{min:f,max:b},type:w,onChange:c=>o([c.min,c.max])},"Range")]}))]})]})};try{pe.displayName="RangeFacetFilter",pe.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:pe.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const Jt=window.React,Ze=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected===!0).map(t=>t.value)}),Zt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Le=(e,t)=>{var r,i;const o=(i=(r=t==null?void 0:t.query)==null?void 0:r.selectedFacets)!=null?i:[],a=o.findIndex(u=>u.columnName===e.columnName),s=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return a>-1?s?o.splice(a,1):o[a]=e:o.push(e),o};function ne(e,t,o,a,s=!1){a?t.facetValues.forEach(u=>{u.value===a&&(u.isSelected=s)}):t.facetValues.forEach(u=>{u.isSelected=!1});const r=Ze(t),i=Le(r,e);o(i)}const Ie=(e,t,o,a)=>{const s=a&&Object.keys(a)||[];s.length&&t.facetValues.forEach(u=>{s.includes(u.value)&&(u.isSelected=a?!!a[u.value]:!1)});const r=Ze(t),i=Le(r,e);o(i)},Xe=(e,t,o,a)=>{t.columnMin=a[0],t.columnMax=a[1];const s=Zt(t),r=Le(s,e);o(r)},Te=({facetsToFilter:e})=>{var y;const{data:t,isLoadingNewBundle:o,getLastQueryRequest:a,executeQueryRequest:s}=G(),r=t==null?void 0:t.facets;let i;e==null?i=(y=r==null?void 0:r.map(l=>l.columnName))!=null?y:[]:i=e;const[u,F]=Jt.useState([]),{facetAliases:m,topLevelControlsState:f}=ae(),{showFacetFilter:b}=f;if(ze(()=>{F(i.slice(0,3))},[t==null?void 0:t.facets]),!t)return n(B,{});const E=t.selectColumns,w=a(),C=l=>{const d=a();d.query.selectedFacets=l,d.query.offset=0,s(d)},I=l=>{let d=[...u!=null?u:[""],l.columnName];u.includes(l.columnName)&&(d=d.filter(c=>c!=l.columnName)),F(d)};return S("div",{className:`QueryFilter ${b?Qe:qe}`,children:[o&&n("div",{children:"Loading..."}),!o&&(r!=null?r:[]).filter(l=>u.includes(l.columnName)).map((l,d)=>{const c=E.find(T=>T.name===l.columnName);if(!He(l))return S("div",{className:"QueryFilter__facet",children:[l.facetType==="enumeration"&&c&&n(K,{containerAs:"Collapsible",collapsed:!1,facetValues:l.facetValues,columnModel:c,facetAliases:m,onChange:T=>Ie(w,l,C,T),onClear:()=>ne(w,l,C)}),l.facetType==="range"&&c&&n(pe,{facetResult:l,columnModel:c,facetAliases:m,collapsed:!1,onChange:T=>Xe(w,l,C,T)})]},l.columnName)}),S("div",{children:[n("div",{className:"AvailableFacet",children:n("label",{className:"AvailableFacet__label",children:"Available Facets"})}),(r!=null?r:[]).filter(l=>i.includes(l.columnName)).map(l=>n(ue,{facet:l,onClick:()=>I(l),isChecked:u.includes(l.columnName)},l.columnName))]})]})};try{Te.displayName="QueryFilter",Te.__docgenInfo={description:"",displayName:"QueryFilter",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"]={docgenInfo:Te.__docgenInfo,name:"QueryFilter",path:"src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"})}catch{}const Xt=window.React.useCallback,en=window.React.useEffect,$e=window.React.useState,tn=Rt(Nt),nn=19,an=30,rn={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},sn=(e,t)=>{t=t||0;let o=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let a=0;a<t;a++)o.indexOf(".")!==-1&&(o=o.replace("0%","%"),o=o.replace(".%","%"));return o};function et(e,t){if(!e)return e;const o=e.trim();return o.length>t?o.substr(0,t-1)+"\u2026":e}async function on(e,t,o,a,s){var C,I;const{colorPalette:r}=bt(o,e.facetValues.length),i=async(y,l,d)=>{const c=new Map;c.set(ee,ye);const T=y.map(g=>g.value).filter(g=>g!==ee);if(l===P.ENTITYID||l===P.ENTITYID_LIST){const g=await ut(T,d);for(const x of g.results)c.set(x.id,x.name)}else if(l===P.USERID||l===P.USERID_LIST){const g=await dt(T,d);for(const x of g.children)c.set(x.ownerId,x.userName)}return y.map(g=>({facet:g,label:u(g,!1,c),truncatedLabel:u(g,!0,c),count:g.count}))},u=(y,l,d)=>{var T;let c=(T=d.get(y.value))!=null?T:y.value;return l&&(c=et(c,nn)),c},F=await i(e.facetValues,t,s),m=F.map(y=>y.truncatedLabel),b=e.facetValues.some(y=>y.isSelected)?e.facetValues.map((y,l)=>y.isSelected?r[l]:r[l].replace("rgb(","rgba(").replace(")",", 0.25)")):r,E={values:a==="PIE"?e.facetValues.map(y=>y.count):void 0,labels:F.map(y=>y.label),text:m,x:a==="BAR"?e.facetValues.map(y=>{var l,d;return(d=(l=F.find(c=>c.facet===y))==null?void 0:l.label)!=null?d:y.value}):void 0,y:a==="BAR"?e.facetValues.map(y=>y.count):void 0,facetEnumerationValues:e.facetValues.map(y=>y.value),name:e.columnName,hovertemplate:a==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:a==="PIE"?"pie":"bar",pull:a==="PIE"?e.facetValues.map(y=>y.isSelected?.1:0):void 0,marker:{colors:a==="PIE"?b:void 0,color:a==="BAR"?b:void 0}};return{data:[E],labels:F,colors:a==="PIE"?(C=E.marker)==null?void 0:C.colors:(I=E.marker)==null?void 0:I.color}}const ln=(e,t,o)=>{if(e.points&&e.points[0]){const a=e.points[0],s=a.data.facetEnumerationValues[a.pointNumber],r=t.facetValues.find(i=>i.value===s);o(t,r,!r.isSelected)}};function cn(e,t,o){const s=e?e*(t==="BAR"?.8:.6):200;let r=t==="PIE"?s:s/3;return r>o&&(r=o),{width:`${s}px`,height:`${r}px`}}function me(e){const{labels:t,colors:o=[],isExpanded:a}=e;if(!t)return n(B,{});const s=a?Math.min(t.length,9):Math.min(t.length,3);if(s===0)return n(B,{});const r=t.reduce((i,u)=>i+u.count,0);return n("div",{className:`FacetNavPanel__body__legend${a?"--expanded":""}`,children:t.slice(0,s).map((i,u)=>{const m=`(${sn(i.count/r,1)}) ${i.label}`,f=et(m,an);return n(te,{idForToolTip:i.label,tooltipText:i.label,children:S("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[n("div",{style:{backgroundColor:o[u]}}),n("label",{children:f})]},`legendLabel_${u}`)},i.label)})})}const un=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",Z=e=>{const{onHide:t,isModalView:o,applyChangesToFacetFilter:a,applyChangesToGraphSlice:s,index:r,facetToPlot:i,plotType:u,onSetPlotType:F}=e,{accessToken:m}=ct(),{data:f,isLoadingNewBundle:b,getLastQueryRequest:E}=G(),{facetAliases:w}=ae(),[C,I]=$e(),[y,l]=$e(!1),d=H(i.columnName,w),c=Xt(()=>{var g,x;return(x=(g=f==null?void 0:f.columnModels)==null?void 0:g.find(Q=>Q.name===i.columnName))==null?void 0:x.columnType},[f,i.columnName]);en(()=>{let g=!0;if(i)on(i,c(),r,u,m).then(x=>{g&&I(x)});else return;return()=>{g=!1}},[i,f,r,u,m,c]);const T=()=>S("div",{onClick:g=>{g.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),S(Y,{children:[n(Y.Toggle,{className:"secondary-caret",variant:"gray-select",children:u==="PIE"?"Pie Chart":"Bar Chart"}),S(Y.Menu,{className:"chart-tools",children:[n(Y.Item,{as:"button",onClick:()=>F("BAR"),children:"Bar Chart"}),n(Y.Item,{as:"button",onClick:()=>F("PIE"),children:"Pie Chart"})]})]})]});return!f&&b||!i?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:xt}):S(B,{children:[S(re,{animation:!1,show:y,onHide:()=>l(!1),backdrop:"static",children:[n(re.Header,{closeButton:!0,children:n(re.Title,{children:d!=null?d:""})}),S(re.Body,{children:[n(Z,{...e,isModalView:!0}),n("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:n(Oe,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>l(!1),children:"Apply Filters"})})]})]}),S("div",{role:"graphics-document",className:`FacetNavPanel${o?"--expanded":""}`,children:[!o&&S("div",{className:"FacetNavPanel__title",children:[!f&&b?n(j,{width:100}):n("span",{className:"FacetNavPanel__title__name",children:d}),S("div",{className:"FacetNavPanel__title__tools",children:[n(K,{facetValues:i.facetValues,columnModel:f==null?void 0:f.columnModels.find(g=>g.name===i.columnName),facetAliases:w,onChange:g=>{Ie(E(),i,a,g)},onClear:()=>{ne(E(),i,a)},containerAs:"Dropdown"}),n(te,{idForToolTip:"expandGraph",tooltipText:"Expand to large graph",callbackFn:()=>l(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),n(te,{idForToolTip:"hideGraph",tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),o&&S(B,{children:[S("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),n(K,{facetValues:i.facetValues,columnModel:f==null?void 0:f.columnModels.find(g=>g.name===i.columnName),facetAliases:w,onChange:g=>{Ie(E(),i,a,g)},onClear:()=>{ne(E(),i,a)},containerAs:"Dropdown",dropdownType:"SelectBox"}),n(wt,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:n(It,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),n(T,{})]}),S("div",{className:`FacetNavPanel__body${o?"--expanded":""}`,children:[n(Tt.SizeMe,{monitorHeight:!0,children:({size:g})=>{var x;return n("div",{className:un(o,u),children:n(tn,{layout:rn,data:(x=C==null?void 0:C.data)!=null?x:[],style:cn(g.width,u,o?300:150),config:{displayModeBar:!1},onClick:Q=>ln(Q,i,s)},`${i.columnName}-${u}-${g.width}`)})}}),n(me,{labels:C==null?void 0:C.labels,colors:C==null?void 0:C.colors,isExpanded:o})]})]})]})};try{me.displayName="FacetPlotLegend",me.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"]={docgenInfo:me.__docgenInfo,name:"FacetPlotLegend",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"})}catch{}try{Z.displayName="FacetNavPanel",Z.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"]={docgenInfo:Z.__docgenInfo,name:"FacetNavPanel",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"})}catch{}const dn=()=>{try{return JSON.parse(sessionStorage.getItem(pt)||"")}catch{return[]}},pn=()=>{try{return JSON.parse(sessionStorage.getItem(mt)||"")}catch{return[]}},X=e=>{let t,o="";if("facetWithSelection"in e){const{facetWithSelection:s}=e;s.facet.facetType==="enumeration"?t=s.displayValue===ee?ye:s.displayValue:t=`${s.facet.selectedMin} 
        - ${s.facet.selectedMax}`,o=`${H(s.facet.columnName)}: ${t}`}else if("filter"in e){const{filter:s}=e;let r=s.value;(r==null?void 0:r.startsWith("%"))&&(r==null?void 0:r.endsWith("%"))&&(r=r.substring(1,r.length-1)),t=r,o=`Text matches: "${r}"`,s.columnName&&(t=`"${r}" in ${H(s==null?void 0:s.columnName)}`,o=`${H(s==null?void 0:s.columnName)}: ${r}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const a=encodeURIComponent(o);return n(te,{idForToolTip:`selectionCriteria_${a}`,tooltipText:o,callbackFn:()=>{},children:S("div",{className:"SelectionCriteriaPill",children:[n("span",{children:t}),n("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:n(gt,{})})]},`SelectionCriteriaPill ${a}`)})};try{X.displayName="SelectionCriteriaPill",X.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:X.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const mn=window.React.useCallback,fn=window.React.useEffect,yn=window.React.useState,hn=window.React.createElement,fe=({style:e,frontText:t,endText:o="",hideIfUnfiltered:a=!1})=>{var A;const{data:s,isLoadingNewBundle:r,getLastQueryRequest:i,executeQueryRequest:u,getInitQueryRequest:F,error:m}=G(),{topLevelControlsState:f,unitDescription:b}=ae(),E=s==null?void 0:s.queryCount,[w,C]=yn([]),I=p=>{const h=$(i());h.query.selectedFacets=p,h.query.offset=0,u(h)},y=p=>p.filter(v=>v.facetType==="enumeration").filter(v=>v.facetValues.filter(q=>q.isSelected===!0).length>0),l=p=>p.filter(v=>v.facetType==="range").filter(v=>v.selectedMax||v.selectedMin),d=(p,h)=>{var v;const R=p.find(q=>q.id===h);return(v=R==null?void 0:R.name)!=null?v:h},c=(p,h)=>{const R=p.find(v=>v.ownerId===h);return(R==null?void 0:R.userName)||h},T=mn((p,h)=>{const R=dn(),v=pn(),q=[];return p.forEach(_=>{const V=h.find(k=>k.name===_.columnName);_.facetValues.forEach(k=>{if(k.isSelected){let W=k.value;(V==null?void 0:V.columnType)===P.ENTITYID||(V==null?void 0:V.columnType)===P.ENTITYID_LIST?W=d(R,k.value):((V==null?void 0:V.columnType)===P.USERID||(V==null?void 0:V.columnType)===P.USERID_LIST)&&(W=c(v,k.value)),q.push({facet:_,displayValue:W,selectedValue:k})}})}),q},[]);fn(()=>{if(s){const p=l(s.facets),h=y(s.facets),R=p.map(q=>({facet:q})),v=T(h,s.columnModels);C([...R,...v])}},[s,T]);const g=p=>{const{facet:h,selectedValue:R}=p;h.facetType==="enumeration"?ne(i(),h,I,R==null?void 0:R.value,!1):Xe(i(),h,I,[we.ANY,we.ANY])},x=(p,h)=>{var v;const R=$(i());!R.query.additionalFilters||(R.query.additionalFilters=(v=R.query.additionalFilters)==null?void 0:v.reduce(function(q,_){if(Re(_)||Ne(_)){const V={columnName:_.columnName,values:_.columnName===p?_.values.filter(k=>k!==h):_.values,operator:Re(_)?_.operator:void 0,function:Ne(_)?_.function:void 0,concreteType:_.concreteType};V.values.length>0&&q.push(V)}else q.push(_);return q},[]),u(R))},Q=p=>{const h=$(i());!h.query.additionalFilters||(h.query.additionalFilters=h.query.additionalFilters.filter(R=>!(Ye(R)&&R.searchExpression===p.searchExpression)),u(h))},U=()=>{const p=$(F());p.query.additionalFilters=[],u(p)},L=(A=i().query.additionalFilters)==null?void 0:A.reduce((p,h)=>{if(Ye(h))p.push({key:`fulltextsearch-${h.searchExpression}`,filter:{value:h.searchExpression},onRemove:()=>Q(h)});else if(Re(h)||Ne(h)){const{columnName:R}=h;h.values.forEach(v=>{p.push({key:`columnsearch-${v}`,filter:{columnName:R,value:v},onRemove:()=>x(h.columnName,v)})})}else console.warn("Encountered unexpected QueryFilter: ",h);return p},[]),N=f==null?void 0:f.showFacetFilter,O=w.length>0||L&&L.length>0;return m?n(B,{}):n("div",{className:`TotalQueryResults ${N?Qe:qe}`,style:e,children:r?n(j,{width:100}):S(B,{children:[(O||!a)&&S("span",{className:"SRC-boldText SRC-centerContent",children:[t," ",E==null?void 0:E.toLocaleString()," ",b," ",o]}),S("div",{className:"TotalQueryResults__selections",children:[L&&L.map(p=>hn(X,{...p,key:p.key})),w.map((p,h)=>{var R,v,q;return n(X,{facetWithSelection:p,onRemove:()=>g(p)},`facets-${(q=(v=(R=p.selectedValue)==null?void 0:R.value)!=null?v:p.displayValue)!=null?q:h}`)}),(w.length>2||L&&L.length>2)&&n(Oe,{onClick:U,variant:"light",className:"TotalQueryResults__clearall",children:"Clear All"})]})]})})};try{fe.displayName="TotalQueryResults",fe.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:{value:"false"},description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:fe.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}const _n=window.React.useEffect,Sn=window.React.useMemo,We=window.React.useState,ve=2;function be(e,t){var a,s;return(s=(a=e==null?void 0:e.facets)==null?void 0:a.filter(r=>r.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(r.columnName)>-1)&&r.facetValues.length>0&&!He(r)))!=null?s:[]}const xe=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:o,isLoadingNewBundle:a,executeQueryRequest:s,error:r,asyncJobStatus:i}=G(),{topLevelControlsState:u}=ae(),[F,m]=We([]),[f,b]=We(!0),{showFacetVisualization:E,showFacetFilter:w}=u,C=o();_n(()=>{const N=be(t,e);N.length!==0&&f&&(m(N.map((O,A)=>({name:O.columnName,isHidden:A>=ve,plotType:"PIE"}))),b(!1))},[t,f,e]);const I=N=>{m(O=>O.map((A,p)=>N?{...A,isHidden:!1}:{...A,isHidden:p>=ve}))},y=N=>{C.query.selectedFacets=N,C.query.offset=0,s(C)},l=N=>F.find(p=>p.name===N&&p.isHidden===!0)!==void 0,d=Sn(()=>F.find(N=>N.isHidden===!0)?"MORE":F.length<=ve?"NONE":"LESS",[F]),c=N=>{x(N,"isHidden",!0)},T=(N,O)=>{x(N,"plotType",O)},g=N=>{var A;const O=(A=F.find(p=>p.name===N))==null?void 0:A.plotType;return O!=null?O:"PIE"},x=(N,O,A)=>{m(p=>p.map(h=>h.name===N?{...h,[O]:A}:h))},Q=be(t,e),U=be(t,e).map((N,O)=>({columnName:N.columnName,colorIndex:O})),L=(C==null?void 0:C.query.selectedFacets)!==void 0&&C.query.selectedFacets.length>0||(C==null?void 0:C.query.additionalFilters)!==void 0&&(C==null?void 0:C.query.additionalFilters.length)>0;return r?n(B,{}):!t&&a?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(i==null?void 0:i.progressMessage)&&S("div",{children:[n("span",{className:"spinner"}),i.progressMessage]})}):S(B,{children:[n(fe,{frontText:"",endText:L?"filtered by":"",hideIfUnfiltered:!0}),Q.length>0&&S("div",{className:`FacetNav ${E?"":"hidden"} ${w?Qe:qe} ${d==="LESS"?"less":""}`,children:[n("div",{className:"FacetNav__row",role:"list",children:Q.map(N=>{var O;return n("div",{className:"col-sm-12 col-md-4",style:{display:l(N.columnName)?"none":"block"},children:n(Z,{index:(O=U.find(A=>A.columnName===N.columnName))==null?void 0:O.colorIndex,onHide:()=>c(N.columnName),plotType:g(N.columnName),onSetPlotType:A=>T(N.columnName,A),facetToPlot:N,applyChangesToFacetFilter:y,applyChangesToGraphSlice:(A,p,h)=>ne(C,A,y,p==null?void 0:p.value,h),isModalView:!1})},N.columnName)})}),d!=="NONE"&&n("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:n(Oe,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>I(d==="MORE"),style:{zIndex:500},children:d==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{xe.displayName="FacetNav",xe.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"]={docgenInfo:xe.__docgenInfo,name:"FacetNav",path:"src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"})}catch{}export{$t as C,K as E,xe as F,ce as I,Qe as Q,j as S,fe as T,qe as a,ae as b,Pt as c,oe as d,Ne as e,Mt as f,zn as g,Ie as h,Re as i,ne as j,Fe as k,he as l,ge as m,Ee as n,Te as o,_e as p,Kn as q,be as r,on as s,cn as t,G as u,me as v,le as w};

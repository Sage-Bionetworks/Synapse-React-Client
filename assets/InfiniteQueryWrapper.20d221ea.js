import{u as ue}from"./useGetInfoFromIds.ee4692b2.js";import{D as ee,O as F,M as J,G as me,F as pe}from"./index.5bc93d3f.js";import{C as ye}from"./ColumnType.744125d2.js";import"./assert.85e7f902.js";import{g as P,G as fe}from"./GenericCard.d56ce602.js";import{l as Ce}from"./LoadingScreen.85210ad1.js";import{u as he,T as ge,g as _e,b as Re,c as Se}from"./TotalQueryResults.bb6c9bee.js";import{c as be}from"./calculateFriendlyFileSize.9c20c573.js";import{I as ve,C as Oe,a as Le,S as Ne}from"./index.04c2a606.js";import{P as H}from"./getEndpoint.0de7fccf.js";import{a as u,j as e,F as ne}from"./jsx-runtime.2e925369.js";import{B as Y}from"./Button.77571428.js";import{U as qe}from"./UserCard.76fda060.js";import{I as te}from"./IconSvg.f48e59e1.js";import{h as we}from"./moment.81704e1d.js";import{S as Ie}from"./SkeletonTable.7a1d1e31.js";import{S as j}from"./Skeleton.bf1489f0.js";import{S as xe}from"./SearchResultsNotFound.4e0bd261.js";import{U as Ae}from"./UserCardList.910cc84e.js";import{u as Te}from"./use-deep-compare-effect.esm.9d3fc03b.js";import{u as Ee,i as ke}from"./useGetQueryResultBundle.f4ad1a42.js";import{a as Ve}from"./sqlFunctions.b49ac766.js";import{u as Qe}from"./useEntity.2eed4ee1.js";import{c as I}from"./cloneDeep.d077462b.js";const De=window.React;class v extends De.Component{constructor(t){super(t),this.handleLinkClick=a=>i=>{i.preventDefault(),window.open(`${H.PORTAL}#!Synapse:${a}`,"_blank")},this.handleLinkClick=this.handleLinkClick.bind(this)}render(){const{data:t,schema:a,selectColumns:i,columnModels:o}=this.props,p=t[a.datasetName],c=t[a.summary],m=P({columnName:"tumorType",value:t[a.tumorType],selectColumns:i,columnModels:o}).str,r=P({columnName:"diseaseFocus",value:t[a.diseaseFocus],selectColumns:i,columnModels:o}).str,s=t[a.id],_=t[a.fundingAgency],C=t[a.fileCount],b=be(t[a.fileSize]),L=[["FUNDER",P({columnName:"fundingAgency",value:_,selectColumns:i,columnModels:o}).str],["SIZE",b],["FILES",C]];return u("div",{className:"SRC-portalCard SRC-typeDataset  ",children:[u("div",{className:"SRC-cardThumbnail",children:[e(ve,{type:ee}),e("div",{children:b})]}),u("div",{className:"SRC-cardContent SRC-dataset",children:[e("div",{className:"SRC-type",children:"Dataset "}),e("div",{children:e("h3",{children:e("a",{target:"_self",href:`${H.PORTAL}#!Synapse:${s}`,children:p})})}),u("div",{className:"SRC-description-dataset",children:[e("p",{className:"SRC-description-text",children:c}),e("div",{className:"SRC-cardAction bootstrap-4-backport",children:e(Y,{className:"pill SRC-datasetButton",onClick:this.handleLinkClick(s),variant:"secondary",children:"Download Dataset"})})]}),e("div",{className:"SRC-cardAnnotations",children:e(Oe,{chips:[m,r]})})]}),e(Le,{isHeader:!1,secondaryLabelLimit:this.props.secondaryLabelLimit,values:L})]})}}try{v.displayName="Dataset",v.__docgenInfo={description:"",displayName:"Dataset",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"any"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"any"}},secondaryLabelLimit:{defaultValue:null,description:"",name:"secondaryLabelLimit",required:!1,type:{name:"number"}},selectColumns:{defaultValue:null,description:"",name:"selectColumns",required:!1,type:{name:"SelectColumn[]"}},columnModels:{defaultValue:null,description:"",name:"columnModels",required:!1,type:{name:"ColumnModel[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/Dataset.tsx#Dataset"]={docgenInfo:v.__docgenInfo,name:"Dataset",path:"src/lib/containers/row_renderers/Dataset.tsx#Dataset"})}catch{}const Fe=window.React;class x extends Fe.Component{constructor(t){super(t),this.handleLinkClick=a=>i=>{i.preventDefault(),window.open(a,"_blank")},this.handleLinkClick=this.handleLinkClick.bind(this)}render(){const{data:t,schema:a}=this.props,i=t[a.organizationName],o=t[a.organizationPath],p=t[a.summary],c=t[a.website],m=t[a.logo];let r=c.replace("https://","");r=r.replace("http://",""),r.charAt(r.length-1)==="/"&&(r=r.substring(0,r.length-1));const s=window.location.hash.substring(1)===o,_={};let C;return s?_.paddingBottom="42px":C=e("div",{className:"SRC-marginAuto SRC-cardAction bootstrap-4-backport",children:e(Y,{className:"pill-xl",href:o,variant:"secondary",children:"View Funded Research"})}),u("div",{className:"SRC-portalCard SRC-typeFunder ",style:_,children:[u("div",{className:"SRC-cardContent",children:[e("div",{className:"SRC-type",children:"Organization"}),m&&e("div",{className:"SRC-cardThumbnail",children:e("img",{alt:"funder logo",className:"SRC-logo",src:m})}),e("div",{children:u("h3",{children:[s&&i,!s&&e("a",{href:o,children:i})]})}),e("div",{className:"SRC-website",children:e("a",{rel:"noopener noreferrer",target:"_blank",href:c,children:r})}),e("div",{className:"SRC-description",children:p})]}),C]})}}try{x.displayName="Funder",x.__docgenInfo={description:"",displayName:"Funder",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"any"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/Funder.tsx#Funder"]={docgenInfo:x.__docgenInfo,name:"Funder",path:"src/lib/containers/row_renderers/Funder.tsx#Funder"})}catch{}try{v.displayName="Dataset",v.__docgenInfo={description:"",displayName:"Dataset",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"any"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"any"}},secondaryLabelLimit:{defaultValue:null,description:"",name:"secondaryLabelLimit",required:!1,type:{name:"number"}},selectColumns:{defaultValue:null,description:"",name:"selectColumns",required:!1,type:{name:"SelectColumn[]"}},columnModels:{defaultValue:null,description:"",name:"columnModels",required:!1,type:{name:"ColumnModel[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/index.tsx#Dataset"]={docgenInfo:v.__docgenInfo,name:"Dataset",path:"src/lib/containers/row_renderers/index.tsx#Dataset"})}catch{}try{rowrenderers.displayName="rowrenderers",rowrenderers.__docgenInfo={description:"",displayName:"rowrenderers",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"any"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/index.tsx#rowrenderers"]={docgenInfo:rowrenderers.__docgenInfo,name:"rowrenderers",path:"src/lib/containers/row_renderers/index.tsx#rowrenderers"})}catch{}const O=(n,t)=>n>0?`${n} ${t}${n>1?"s":""} `:"",Pe=(n,t)=>{const a=we.duration(n,t),i=a.years(),o=a.months()%12,p=a.days()%31,c=a.hours()%24,m=a.minutes()%60,r=a.seconds()%60;return`${O(i,"year")}${O(o,"month")}${O(p,"day")}${O(c,"hour")}${O(m,"minute")}${O(r,"second")}`.trim()},A=({data:n,schema:t})=>{const a=n[t.submitterName],i=n[t.submitterUserId],o=n[t.time],p=n[t.timeUnits],c=n[t.text],m=n[t.tag];return u("div",{className:"SRC-portalCard ObservationCard",children:[u("div",{className:"ObservationCard__submitter",children:[!i&&e("div",{children:a}),i&&e(qe,{size:"SMALL USER CARD",ownerId:i})]}),o&&u("div",{className:"ObservationCard__time",children:[e(te,{options:{icon:"time"}}),e("span",{children:Pe(o,p)})]}),e("div",{className:"ObservationCard__text",children:e(Ne,{summary:c})}),e("div",{className:"ObservationCard__tags",children:m&&e("span",{className:"SRC-tag",children:m})})]})},T=()=>u("div",{className:"SRC-portalCard ObservationCard",children:[e("div",{className:"ObservationCard__submitter",children:e("span",{children:e(j,{width:"100px"})})}),e("div",{className:"ObservationCard__time",children:e(te,{options:{icon:"time"}})}),e("div",{className:"ObservationCard__text",children:e(Ie,{numCols:1,numRows:4})}),e("div",{className:"ObservationCard__tags",children:e(j,{width:"80px"})})]});try{A.displayName="ObservationCard",A.__docgenInfo={description:`Specialized Observation Card, initially implemented for the NF portal.
Expects the following columns: submitterName, submitterUserId, time, timeUnits, text, and tag.`,displayName:"ObservationCard",props:{schema:{defaultValue:null,description:"",name:"schema",required:!0,type:{name:"ObservationCardSchema"}},data:{defaultValue:null,description:"",name:"data",required:!0,type:{name:"Record<string, string>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/ObservationCard.tsx#ObservationCard"]={docgenInfo:A.__docgenInfo,name:"ObservationCard",path:"src/lib/containers/row_renderers/ObservationCard.tsx#ObservationCard"})}catch{}try{T.displayName="LoadingObservationCard",T.__docgenInfo={description:"",displayName:"LoadingObservationCard",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/ObservationCard.tsx#LoadingObservationCard"]={docgenInfo:T.__docgenInfo,name:"LoadingObservationCard",path:"src/lib/containers/row_renderers/ObservationCard.tsx#LoadingObservationCard"})}catch{}function Be(){return u(ne,{children:[e("p",{className:"SRC-no-results-title",children:"There is currently no content here."}),e("p",{className:"SRC-no-results-description",children:"Information is always being updated, so check back later to see if content has been added."})]})}const B=n=>{const{isHeader:t=!1,unitDescription:a,type:i,isLoading:o,secondaryLabelLimit:p=3,title:c,...m}=n,r=he(),{data:s,getLastQueryRequest:_,appendNextPageToResults:C,hasNextPage:b}=r,L=_(),E=(d,l)=>{switch(l){case ee:return e(v,{...d});case pe:return e(x,{...d});case me:return e(fe,{...d,queryContext:r});case F:return e(A,{...d});default:return e("div",{},d.key)}},k=s!=null&&s.queryResult.queryResults.tableId?[s==null?void 0:s.queryResult.queryResults.tableId]:[],w=ue({ids:k,type:"ENTITY_HEADER"});if(s){if(s&&s.queryResult.queryResults.rows.length===0)return L.query.additionalFilters?e(xe,{}):e(Be,{})}else return u("div",{children:[o&&i===F&&e(T,{}),o&&i!==F&&Ce]});const N={};s.queryResult.queryResults.headers.forEach((d,l)=>{N[d.name]=l});const V=b&&e("div",{className:"SRC-viewMore bootstrap-4-backport",children:e(Y,{variant:"secondary",className:"pill-xl",onClick:()=>{C()},children:"View More"})});let q;if(i===J){const d=s.queryResult.queryResults.headers.findIndex(h=>h.columnType===ye.USERID);if(d===-1)throw Error("Type MEDIUM_USER_CARD specified but no columnType USERID found");const l=s.queryResult.queryResults.rows.map(h=>h.values[d]);q=e(Ae,{data:s,list:l,size:J})}else{const d=s.queryResult.queryResults.rows;q=d.length?d.map(l=>{const Q={key:JSON.stringify(l.values),type:i,schema:N,isHeader:t,secondaryLabelLimit:p,data:l.values,selectColumns:s.selectColumns,columnModels:s.columnModels,tableEntityConcreteType:w[0]&&w[0].type,tableId:s==null?void 0:s.queryResult.queryResults.tableId,...m};return E(Q,i)}):e(ne,{})}return u("div",{role:"list",children:[c&&e("h2",{className:"SRC-card-overview-title",children:c}),!c&&a&&e(ge,{frontText:"Displaying"}),q,V]})};try{B.displayName="CardContainer",B.__docgenInfo={description:"",displayName:"CardContainer",props:{isHeader:{defaultValue:null,description:"",name:"isHeader",required:!1,type:{name:"boolean"}},isAlignToLeftNav:{defaultValue:null,description:"",name:"isAlignToLeftNav",required:!1,type:{name:"boolean"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!1,type:{name:"boolean"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"string"}},hasInternalLink:{defaultValue:null,description:"",name:"hasInternalLink",required:!1,type:{name:"boolean"}},iconOptions:{defaultValue:null,description:"",name:"iconOptions",required:!1,type:{name:"IconOptions"}},genericCardSchema:{defaultValue:null,description:"",name:"genericCardSchema",required:!1,type:{name:"GenericCardSchema"}},secondaryLabelLimit:{defaultValue:null,description:"",name:"secondaryLabelLimit",required:!1,type:{name:"number"}},titleLinkConfig:{defaultValue:null,description:"",name:"titleLinkConfig",required:!1,type:{name:"CardLink"}},ctaLinkConfig:{defaultValue:null,description:"",name:"ctaLinkConfig",required:!1,type:{name:"CTACardLink"}},labelLinkConfig:{defaultValue:null,description:"",name:"labelLinkConfig",required:!1,type:{name:"LabelLinkConfig"}},descriptionConfig:{defaultValue:null,description:"",name:"descriptionConfig",required:!1,type:{name:"DescriptionConfig"}},rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},columnIconOptions:{defaultValue:null,description:"",name:"columnIconOptions",required:!1,type:{name:"ColumnIconConfigs"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/CardContainer.tsx#CardContainer"]={docgenInfo:B.__docgenInfo,name:"CardContainer",path:"src/lib/containers/CardContainer.tsx#CardContainer"})}catch{}const Me=window.React,Z=window.React.useEffect,X=window.React.useMemo,M=window.React.useState;function U(n){var z,G;const{initQueryRequest:t,onQueryChange:a,onQueryResultBundleChange:i}=n,[o,p]=M(t),[c,m]=M(void 0),{data:r,hasNextPage:s,fetchPreviousPage:_,fetchNextPage:C,isFetchingNextPage:b,isLoading:L,error:E,isPreviousData:k,remove:w}=Ee(o,{keepPreviousData:!0},m),N=L||k,{entityId:V,versionNumber:q}=Ve(o.query.sql),{data:d}=Qe(V,q),[l,h]=M(0);async function Q(){if(!s)throw new Error("Called appendNextPageToResults when there is no next page");await C(),h("ALL")}async function ae(){if(!s)throw new Error("Called goToNextPage when there is no next page");if(l==="ALL")throw new Error("Cannot go to next page when all pages are displayed");await C(),h(l+1)}const $=l!=="ALL"&&l>0;async function re(){if(l==="ALL")throw new Error("Cannot go to previous page when all pages are displayed");if(!$)throw new Error("Called goToNextPage when there is no next page");await _(),h(l-1)}const y=X(()=>{var f,g,R,S;if(!(r==null||r.pages.length===0||r.pages[0].responseBody==null))return l==="ALL"?{...r==null?void 0:r.pages[0].responseBody,queryResult:{...(f=r==null?void 0:r.pages[0].responseBody)==null?void 0:f.queryResult,queryResults:{...(R=(g=r==null?void 0:r.pages[0].responseBody)==null?void 0:g.queryResult)==null?void 0:R.queryResults,rows:(S=r.pages.flatMap(D=>D.responseBody.queryResult.queryResults.rows))!=null?S:[]}}}:r==null?void 0:r.pages[l].responseBody},[l,r]);Te(()=>{a&&a(JSON.stringify(o.query))},[a,o.query]),Z(()=>{y&&i&&i(JSON.stringify(y))},[y,i]);const K=(z=n.componentIndex)!=null?z:0,W=y?ke(y.facets,y.selectColumns):!0;Z(()=>{const f=_e("QueryWrapper",K);f&&p(f)},[]);const se=Me.useCallback(()=>I(o),[o]);function ie(){return I(n.initQueryRequest)}function oe(f){const g=I(f);if(p(g),h(0),g.query){const R=JSON.stringify(g.query),S=encodeURIComponent(R);n.shouldDeepLink&&(n.onQueryChange?n.onQueryChange(R):Se("QueryWrapper",K,S))}w()}const le={data:X(()=>{var g,R;const f=(g=n.lockedFacet)==null?void 0:g.facet;if(f&&y){const S=I(y),D=(R=S.facets)==null?void 0:R.filter(ce=>ce.columnName.toLowerCase()!==f.toLowerCase());return S.facets=D,S}else return y},[y,(G=n.lockedFacet)==null?void 0:G.facet]),isLoadingNewPage:b,hasNextPage:!!s,hasPreviousPage:!!$,isLoadingNewBundle:N,getLastQueryRequest:se,getInitQueryRequest:ie,error:E,entity:d,executeQueryRequest:oe,isFacetsAvailable:W,asyncJobStatus:c,appendNextPageToResults:Q,goToNextPage:ae,goToPreviousPage:re},{children:de}=n;return e(Re,{queryContext:le,children:e("div",{className:`SRC-wrapper ${N||b?"SRC-logo-cursor":""} ${W?"has-facets":""}`,children:de})})}try{U.displayName="InfiniteQueryWrapper",U.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"InfiniteQueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedFacet:{defaultValue:null,description:"",name:"lockedFacet",required:!1,type:{name:"LockedFacet"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/InfiniteQueryWrapper.tsx#InfiniteQueryWrapper"]={docgenInfo:U.__docgenInfo,name:"InfiniteQueryWrapper",path:"src/lib/containers/InfiniteQueryWrapper.tsx#InfiniteQueryWrapper"})}catch{}export{B as C,U as I};
//# sourceMappingURL=InfiniteQueryWrapper.20d221ea.js.map

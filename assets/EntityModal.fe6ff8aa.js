import{a as n,j as a,F as R,r as A}from"./jsx-runtime.abb726e8.js";import{W as q,c3 as C,a7 as K,E as Y,cl as U,cm as $,a8 as j,a9 as H}from"./EntityTypeUtils.68b1ba2e.js";import{g as I,B as P}from"./getEndpoint.f1f195f5.js";import{H as G,G as z,S as J,E as X,f as W,P as Q,u as F}from"./HelpPopover.63ffb224.js";import{M as p}from"./Modal.5c5237e2.js";import{T as Z}from"./Typography.1b6708c1.js";import{S as D}from"./Skeleton.a4e29131.js";import{a as ee}from"./Tooltip.6e0804a9.js";import{B as ae}from"./Button.adf7cc86.js";import{d as te}from"./ToastMessage.34e9245f.js";import{u as ne,S as oe}from"./SchemaDrivenAnnotationEditor.f73f288a.js";import{c as ie}from"./useEntity.bdfc55d0.js";import{S as le}from"./SkeletonTable.2b1bbbfa.js";import{i as se}from"./isEmpty.75a1cd8d.js";import{d as g}from"./dayjs.min.5866c853.js";import{f as v}from"./DateFormatter.b167d8c8.js";import{U as L}from"./UserCard.d62c0381.js";function V(e){var l;const{copy:i,skeleton:t,...o}=e;return e.skeleton?a(D,{variant:"rectangular",width:150}):a(ee,{title:(l=o["data-tip"])!=null?l:"",placement:"top",enterNextDelay:300,children:a(ae,{...o,children:i})})}const b=e=>{var i,t,o;return n(p,{className:`FluidModal bootstrap-4-backport ${(i=e.className)!=null?i:""}`,backdrop:"static",animation:!1,show:e.show,onHide:e.onClose,children:[a(p.Header,{closeButton:!0,children:a(p.Title,{children:n(Z,{variant:"headline1",component:"span",children:[e.title,e.titlePopoverProps&&a(G,{placement:"right",...e.titlePopoverProps,className:"SRC-margin-left-5 "+((o=(t=e.titlePopoverProps)==null?void 0:t.className)!=null?o:"")})]})})}),a(p.Body,{children:e.children}),n(p.Footer,{children:[e.secondaryActions&&e.secondaryActions.reverse().map((l,s)=>a(V,{variant:"outline",...l},s)),e.primaryAction&&a(V,{variant:"sds-primary",...e.primaryAction})]})]})};try{b.displayName="FluidModal",b.__docgenInfo={description:"Full-screen modal that scales with screen size. Fits requirements defined in SWC-5801",displayName:"FluidModal",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string | Element"}},titlePopoverProps:{defaultValue:null,description:"",name:"titlePopoverProps",required:!1,type:{name:"HelpPopoverProps"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},primaryAction:{defaultValue:null,description:"",name:"primaryAction",required:!1,type:{name:"ModalAction"}},secondaryActions:{defaultValue:null,description:"",name:"secondaryActions",required:!1,type:{name:"ModalAction[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/FluidModal.tsx#FluidModal"]={docgenInfo:b.__docgenInfo,name:"FluidModal",path:"src/lib/containers/FluidModal.tsx#FluidModal"})}catch{}const h=({entityId:e})=>{const{isInExperimentalMode:i}=q(),{entityMetadata:t,annotations:o,isLoading:l}=ie(e),{data:s}=ne(e,{enabled:i});return l?a(le,{numRows:3,numCols:2}):n(R,{children:[t&&o&&se(o)?n("div",{className:"placeholder",children:["This"," ",C(K(t.concreteType))," ","has no annotations."]}):null,a("table",{className:"AnnotationsTable",children:n("tbody",{children:[o&&Object.keys(o).map(r=>n("tr",{className:"AnnotationsTable__Row",children:[a("td",{className:"AnnotationsTable__Row__Key",children:r}),a("td",{className:"AnnotationsTable__Row__Value",children:Array.isArray(o[r])?o[r].join(", "):o[r].toString()})]},r)),s&&i?n("tr",{className:"AnnotationsTable__Row",children:[a("td",{className:"AnnotationsTable__Row__Key Schema",children:"Validation Schema"}),a("td",{className:"AnnotationsTable__Row__Value",children:a("a",{href:`${I(P.REPO_ENDPOINT)}repo/v1/schema/type/registered/${s.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:s.jsonSchemaVersionInfo.schemaName})})]}):null]})})]})};try{h.displayName="AnnotationsTable",h.__docgenInfo={description:"",displayName:"AnnotationsTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/entity/metadata/AnnotationsTable.tsx#AnnotationsTable"]={docgenInfo:h.__docgenInfo,name:"AnnotationsTable",path:"src/lib/containers/entity/metadata/AnnotationsTable.tsx#AnnotationsTable"})}catch{}const re="Synapse Storage",de=1;function ce(e){switch(e.concreteType){case Q:return e.filePath;case W:return e.bucket;case X:return e.externalURL;case J:return[null,de].includes(e.storageLocationId)?re:`s3://${e.bucketName}`;case z:return`gs://${e.bucketName}`;default:throw new Error(`Couldn't determine location name for file handle: ${JSON.stringify(e)}`)}}function ue(e){let i;return e.entityType===Y.FILE&&(i=e.fileHandles.filter(t=>t.id===e.entity.dataFileHandleId)[0]),i}const N=({entityId:e,versionNumber:i})=>{var r,c,y,u,m,_;const{data:t}=F(e,i),o=t&&U(t.entity),l=t?ue(t):void 0;let s;return l&&(s=ce(l)),t?a("table",{className:"MetadataTable",children:n("tbody",{children:[n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Name"}),a("td",{className:"MetadataTable__Row__Value",children:(r=t.entity)==null?void 0:r.name})]}),n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Type"}),a("td",{className:"MetadataTable__Row__Value",children:C(t.entityType)})]}),n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),a("td",{className:"MetadataTable__Row__Value",children:(c=t.entity)==null?void 0:c.id})]}),o&&n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Version"}),a("td",{className:"MetadataTable__Row__Value",children:$(t.entity)})]}),s&&n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Storage"}),a("td",{className:"MetadataTable__Row__Value",children:s})]}),n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),n("td",{className:"MetadataTable__Row__Value",children:[a(L,{size:"SMALL USER CARD",ownerId:(y=t.entity)==null?void 0:y.modifiedBy})," ","at ",v(g((u=t.entity)==null?void 0:u.modifiedOn))]})]}),n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Created By"}),n("td",{className:"MetadataTable__Row__Value",children:[a(L,{size:"SMALL USER CARD",ownerId:(m=t.entity)==null?void 0:m.createdBy})," ","at ",v(g((_=t.entity)==null?void 0:_.createdOn))]})]})]})}):null};try{N.displayName="MetadataTable",N.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/entity/metadata/MetadataTable.tsx#MetadataTable"]={docgenInfo:N.__docgenInfo,name:"MetadataTable",path:"src/lib/containers/entity/metadata/MetadataTable.tsx#MetadataTable"})}catch{}var O=(e=>(e.METADATA="METADATA",e.ANNOTATIONS="ANNOTATIONS",e))(O||{});const M=({entityId:e,versionNumber:i,show:t,onClose:o,initialTab:l="METADATA",showTabs:s=!0})=>{const r=A.exports.useRef(null),[c,y]=A.exports.useState(l),[u,m]=A.exports.useState(!1),[_,B]=A.exports.useState(!1),{data:d}=F(e,i),k=d&&d.permissions.canEdit,S=d&&j(d.entityType),w=S&&d.entity.isLatestVersion;let T,f;return d?window.location.href.includes(e)||(T={skeleton:!1,copy:`Open ${C(d.entityType)}`,onClick:()=>window.open(`${I(P.PORTAL_ENDPOINT)}#!Synapse:${e}`,"_blank","noopener")}):(T={skeleton:!0},f=void 0),c==="ANNOTATIONS"&&(u?(T={copy:"Save Annotations",onClick:()=>{r.current.formElement.dispatchEvent(new CustomEvent("submit",{cancelable:!0,bubbles:!0}))}},f=[{copy:_?"Are you sure? Unsaved changes will be lost":"Cancel",onClick:()=>{_&&m(!1),B(!_)}}]):k&&(f=[{copy:"Edit",disabled:S&&!w,"data-for":"entityModalTooltip","data-tip":S&&!w?"Annotations can only be edited on the latest version":void 0,onClick:()=>{m(!0)}}])),a(R,{children:a(b,{className:`EntityMetadata ${u?"isInEditMode":""}`,title:d?a(p.Title,{children:d.entity.name}):a(D,{width:"40%"}),show:t,onClose:o,primaryAction:T,secondaryActions:f,children:n(R,{children:[s&&!u?a("div",{className:"Tabs",children:Object.keys(O).map(E=>a("div",{className:"Tab",role:"tab",onClick:x=>{x.stopPropagation(),y(O[E])},"aria-selected":E===c,children:E},E))}):null,a("div",{style:c==="ANNOTATIONS"?{}:{display:"none"},children:u?a(H,{children:a(oe,{entityId:e,formRef:r,onSuccess:()=>{te("Annotations successfully updated.","success"),m(!1)},onCancel:()=>m(!1)})}):a(h,{entityId:e,versionNumber:i})}),a("div",{style:c==="METADATA"?{}:{display:"none"},children:a(N,{entityId:e,versionNumber:i})})]})})})};try{M.displayName="EntityModal",M.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:{value:"EntityModalTabs.METADATA"},description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:{value:"true"},description:"",name:"showTabs",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/entity/metadata/EntityModal.tsx#EntityModal"]={docgenInfo:M.__docgenInfo,name:"EntityModal",path:"src/lib/containers/entity/metadata/EntityModal.tsx#EntityModal"})}catch{}export{M as E,b as F,O as a};

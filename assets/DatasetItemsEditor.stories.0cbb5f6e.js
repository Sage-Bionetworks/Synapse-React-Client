import{F as oe,A as re,B as ne,a as ie,D as se,b as ae,c as de,C as le,M as me,d as ce,P as pe,e as ue}from"./EntityFinder.4c4872f8.js";import{S as fe}from"./SkeletonTable.c7e4aa2c.js";import{p as he,dv as Ie,dw as ye}from"./index.7efab905.js";import{E as Se}from"./EntityTypeUtils.05da9c5d.js";import"./assert.f23afcb3.js";import{T as z}from"./Typography.bfdf676e.js";import{E as Ee}from"./EntityFinderModal.ae783fe7.js";import{I as Ce}from"./IconSvg.3d20df6f.js";import{B as ge}from"./LoadingScreen.56f18e4f.js";import{W as De}from"./WarningModal.db1d2b8d.js";import{d as b}from"./ToastMessage.f82ed562.js";import{C as we}from"./Checkbox.60e96e17.js";import{a as h,j as r,F as K}from"./jsx-runtime.2e925369.js";import{i as ve}from"./isEqual.2e2c2810.js";import{S as be}from"./Skeleton.8dd0668e.js";import{B as g}from"./Button.c582ea4c.js";import"./iframe.f1cdf68b.js";import"./objectWithoutPropertiesLoose.090b3c10.js";import"./toConsumableArray.b3669986.js";import"./index.06f4a415.js";import"./withStyles.8be28b48.js";import"./react-sizeme.be47c76c.js";import"./Arrow.c6e8b887.js";import"./sqlFunctions.b49ac766.js";import"./use-deep-compare-effect.esm.9d3fc03b.js";import"./useGetEntityChildren.ed2feb7f.js";import"./EntityChildren.50133102.js";import"./index.f252d424.js";import"./stateManager-845a3300.esm.2aae5abd.js";import"./classCallCheck.8304ed06.js";import"./inherits.98d6a15d.js";import"./HelpPopover.6cc2661a.js";import"./MarkdownPopover.ca143645.js";import"./usePopperMarginModifiers.31225551.js";import"./useWaitForDOMRef.c89dbc64.js";import"./Alert.eafe86e9.js";import"./Transition.d42a873e.js";import"./hasClass.56fd144a.js";import"./MarkdownSynapse.5a23097b.js";import"./UserCard.b3329a1f.js";import"./getEndpoint.0de7fccf.js";import"./IconCopy.b1eba79c.js";import"./Tooltip.6c95fe7b.js";import"./createSvgIcon.d78a924b.js";import"./SvgIcon.31249d58.js";import"./useTheme.8804f8cd.js";import"./makeStyles.9dfaa099.js";import"./Overlay.88992b99.js";import"./factory.d3bc09f6.js";import"./SynapseVideo.89fa53cf.js";import"./react-intersection-observer.m.66de6abb.js";import"./DateFormatter.9c7cb4c8.js";import"./moment.53181859.js";import"./useEntityBundle.769a6fab.js";import"./EntityIcon.0795f6e4.js";import"./SynapseTableConstants.07ecdebd.js";import"./SchemaDrivenAnnotationEditor.3cf1cd17.js";import"./isEmpty.0a3496ec.js";import"./toString.8ef640ae.js";import"./lodash.1d6a9e66.js";import"./useListState.7f5a3e64.js";import"./FullWidthAlert.e7125a09.js";import"./Collapse.fe074047.js";import"./groupBy.a63e64ed.js";import"./_baseMap.03971987.js";import"./_baseIsEqual.d269c940.js";import"./_cacheHas.b50a3c05.js";import"./_setToArray.a82100c8.js";import"./CalendarWithIconFormGroup.9867f613.js";import"./index.5ef2ed87.js";import"./index.8cde812d.js";import"./Modal.58357e58.js";import"./useWillUnmount.4a16e5cd.js";import"./removeClass.27874bcb.js";import"./EntityModal.1af19f23.js";import"./ExternalFileHandleInterface.8a5a754d.js";import"./LockTwoTone.32ff1570.js";import"./cloneDeep.dc186dc5.js";import"./Dropdown.c29f5884.js";import"./isRequiredForA11y.61bbc671.js";import"./Sort.5ec835a1.js";import"./EntityLink.fb84a7d4.js";import"./useFavorites.297295e8.js";import"./times.318dcaf9.js";import"./toInteger.bbe63e35.js";import"./TypeUtils.a2c41307.js";import"./InfoOutlined.22a371fd.js";import"./uniqueId.fa0dadf5.js";const Re=window.React.useState;function Te(m){const[c,p]=Re(new Set(m));function u(...I){const a=new Set(c);for(const _ of I)a.add(_);p(a)}function T(I){const a=new Set(c);a.delete(I),p(a)}function d(){p(new Set)}return{set:c,add:u,remove:T,clear:d}}const H=window.React.useEffect,D=window.React.useState,R="Add Files",_e="Remove Files",ke="No files in this Dataset",Ae="Save the Dataset to continue.",Ne="Create a Version of this Dataset to freeze it in its current state",Fe="Dataset Saved",j=42,Be=350;function w(m){var P;const{entityId:c,onSave:p,onClose:u}=m,[T,d]=D(!1),[I,a]=D(!1),[_,F]=D(!1),[o,$]=D(),[y,W]=D(),v=e=>{F(!0),$(e)},{data:S,refetch:q}=he(c,void 0,{enabled:!o});H(()=>{!o&&S&&(S.items==null&&(S.items=[]),v(S),F(!1))},[S,o]);const{set:E,add:B,remove:G,clear:k}=Te(),O=!!(o&&o.items.length===E.size);H(()=>{if(y&&o&&!ve(y,o)){const e=J();b(Ae,"info",{title:e,primaryButtonConfig:{text:"Save changes to Draft",onClick:()=>N.mutate(o)}})}W(o)},[o]);const{data:A}=Ie(c),U=(P=A==null?void 0:A.path[1])==null?void 0:P.id,N=ye({onSuccess:()=>{p?p():b(Ne,"success",{title:Fe})},onError:e=>{e.status===412?b("Re-retrieve the dataset to get the latest changes. Your current changes will be lost.","warning",{title:"Dataset Updated since Last Fetched",primaryButtonConfig:{text:"Retrieve Dataset",onClick:()=>{q()}}}):b(e.reason,"danger",{title:"An Error Occurred"})}}),Y=o==null?void 0:o.items.map(e=>({...e,isSelected:E.has(e.entityId),setSelected:t=>t?B(e.entityId):G(e.entityId)}));function x(e,t){let n=e.filter(l=>!t.find(s=>s.entityId===l.entityId));const i=[...n],{updatedItems:f,newItems:C}=t.reduce((l,s)=>{const V=e.find(te=>te.entityId===s.entityId);return V?s.versionNumber!==V.versionNumber?l.updatedItems.push(s):n.push(s):l.newItems.push(s),l},{updatedItems:[],newItems:[]});return{unchangedItems:n,updatedItems:f,newItems:C,deletedItems:i}}function J(){const{updatedItems:e,newItems:t,deletedItems:n}=x(y==null?void 0:y.items,o==null?void 0:o.items);let i="";return n.length>0?i+=`${n.length} Item${n.length===1?"":"s"} removed`:(i+=`${t.length} Item${t.length===1?"":"s"} added`,e.length>0&&(i+=` and ${e.length} Item${e.length===1?"":"s"} updated`)),i}function Z(e){v(t=>{if(t){const n=e.map(s=>({entityId:s.targetId,versionNumber:s.targetVersionNumber})),{unchangedItems:i,updatedItems:f,newItems:C}=x(t.items,n),l=[...i,...f,...C];return{...t,items:l}}else return console.warn("Cannot add items to the Dataset because it is undefined. The Dataset may not have been fetched yet."),t}),k()}function Q(){v(e=>({...e,items:e.items.filter(t=>!E.has(t.entityId))})),k()}function X(e,t){v(n=>({...n,items:n.items.map(i=>i.entityId===e?{entityId:e,versionNumber:t}:i)}))}const L=[{key:"errorState",width:30,cellRenderer:ie},{key:"isSelected",width:40,dataKey:"isSelected",headerRenderer:o?r(e=>{const{datasetToUpdate:t,clearSelectedIds:n,addSelectedId:i}=e,f=O;return t?r("div",{"data-testid":"Select All",style:{cursor:"pointer"},onClick:()=>{f?n():i(...t.items.map(C=>C.entityId))},children:r(we,{label:"",className:"SRC-pointer-events-none",checked:f,disabled:t.items.length===0,onChange:()=>{}})}):r(K,{})},{datasetToUpdate:o,selectedIds:E,clearSelectedIds:k,addSelectedId:B,allItemsAreSelected:O}):r(K,{}),cellRenderer:se},{key:"name",width:350,dataKey:"entityId",title:"Name",resizable:!0,cellRenderer:ae},{key:"status",width:80,dataKey:"entityId",resizable:!0,cellRenderer:de},{key:"id",width:140,title:"ID",dataKey:"entityId",resizable:!0},{key:"version",width:150,title:"Version",dataKey:"entityId",cellRenderer:e=>r(ue,{...e,toggleSelection:t=>{X(t.entityId,t.versionNumber)}})},{key:"createdOn",width:200,title:"Created On",dataKey:"entityId",resizable:!0,cellRenderer:le},{key:"modifiedOn",width:200,title:"Modified On",dataKey:"entityId",resizable:!0,cellRenderer:me},{key:"modifiedBy",width:250,title:"Modified By",dataKey:"entityId",resizable:!0,cellRenderer:ce},{key:"projectId",width:300,title:"Project",dataKey:"entityId",resizable:!0,cellRenderer:pe}],M=L.reduce((e,t)=>e+t.width,0);function ee(){return h("div",{className:"NoItemsPlaceholder",children:[r(z,{variant:"headline3",children:ke}),h(g,{className:"AddItemsButton",variant:"sds-primary",onClick:()=>d(!0),children:[r(Ce,{options:{icon:"addCircleTwoTone"}}),r("span",{children:R})]})]})}return h("div",{className:"DatasetEditor bootstrap-4-backport",children:[r(Ee,{configuration:{projectId:U,selectMultiple:!0,initialScope:oe.ALL_PROJECTS,initialContainer:null,selectableTypes:[Se.FILE],mustSelectVersionNumber:!0},titlePopoverProps:{markdownText:"Use the left pane to browse Projects and Folders to find Files to add to this Dataset. Files in a Dataset can be added from multiple folders. You can also use Search to find and select Files.",helpUrl:"https://help.synapse.org/docs/Datasets.2611281979.html"},promptCopy:"Find Files located across one or more Folders to add to the Dataset.",show:T,onClose:()=>{d(!1)},title:R+" to Dataset",confirmButtonCopy:R,onConfirm:e=>{Z(e),d(!1)},onCancel:()=>d(!1)}),r(De,{title:"Unsaved Changes",modalBody:"Any unsaved changes will be lost. Are you sure you want to close the editor?",confirmButtonText:"Close Editor",onConfirm:()=>{u&&(a(!1),u())},show:I,onConfirmCallbackArgs:[],onCancel:()=>a(!1)}),h("div",{className:"DatasetEditorTopBottomPanel",children:[r(ge,{show:N.isLoading}),r("div",{className:"ItemCount",children:o?h(z,{variant:"headline3",children:[o.items.length===0?"No":o.items.length.toLocaleString()," ","File",o.items.length!==1&&"s"]}):r(be,{variant:"rect",width:200})}),r(g,{variant:"sds-primary",disabled:o==null,onClick:()=>d(!0),children:R}),r(g,{disabled:E.size===0,variant:"outline",onClick:Q,children:_e})]}),r("div",{className:"DatasetEditorTableContainer",children:o?o.items.length===0?r(ee,{}):r(re,{height:Be,children:({height:e,width:t})=>r(ne,{classPrefix:"DatasetEditorTable",data:Y,height:e,width:t>M?t:M,rowHeight:j,overscanRowCount:5,columns:L,rowClassName:"DatasetEditorRow",rowProps:({rowData:n})=>({"aria-selected":n.isSelected}),headerCellProps:{role:"columnheader"}})}):r(fe,{className:"DatasetItemsEditorSkeleton",numRows:8,numCols:6,rowHeight:`${j}px`})}),h("div",{className:"DatasetEditorTopBottomPanel",children:[r(g,{variant:"outline",onClick:()=>{_?a(!0):u&&u()},children:"Cancel"}),r(g,{disabled:!o,variant:"sds-primary",onClick:()=>N.mutate(o),children:"Save"})]})]})}try{w.displayName="DatasetItemsEditor",w.__docgenInfo={description:"",displayName:"DatasetItemsEditor",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!1,type:{name:"(() => void)"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/table/datasets/DatasetItemsEditor.tsx#DatasetItemsEditor"]={docgenInfo:w.__docgenInfo,name:"DatasetItemsEditor",path:"src/lib/containers/table/datasets/DatasetItemsEditor.tsx#DatasetItemsEditor"})}catch{}var Co={parameters:{storySource:{source:`import React from 'react'
import { ComponentStory, ComponentMeta } from '@storybook/react'
import { DatasetItemsEditor } from './DatasetItemsEditor'

export default {
  title: 'Synapse/DatasetItemsEditor',
  component: DatasetItemsEditor,
} as ComponentMeta<typeof DatasetItemsEditor>

const Template: ComponentStory<typeof DatasetItemsEditor> = args => (
  <DatasetItemsEditor {...args} />
)

export const Demo = Template.bind({})
Demo.args = {
  entityId: 'syn26302617',
}
`,locationsMap:{demo:{startLoc:{col:60,line:10},endLoc:{col:1,line:12},startBody:{col:60,line:10},endBody:{col:1,line:12}}}}},title:"Synapse/DatasetItemsEditor",component:w};const Oe=m=>r(w,{...m}),xe=Oe.bind({});xe.args={entityId:"syn26302617"};const go=["Demo"];export{xe as Demo,go as __namedExportsOrder,Co as default};
//# sourceMappingURL=DatasetItemsEditor.stories.0cbb5f6e.js.map

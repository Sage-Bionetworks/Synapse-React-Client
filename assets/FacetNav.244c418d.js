import{ap as $e,aq as Ke,an as Ge,C as je,am as Je,E as Ze,N as Be,az as te,aA as ye,h as Xe,ag as et,al as tt,aB as nt,aC as at}from"./index.444e3572.js";import{j as n,r as F,a as y,R as Ie,F as P}from"./jsx-runtime.ed0bc2e8.js";import{b as rt,i as st,r as ot,c as Pe}from"./queryUtils.b6e7a174.js";import{a as Ye,b as it,u as lt}from"./use-deep-compare-effect.esm.63a03aa5.js";import{u as ct}from"./useEntity.a73b6a7f.js";import{a as ut,b as dt}from"./sqlFunctions.1d7d9843.js";import{c as W}from"./cloneDeep.c1db8169.js";import{u as z,E as ne}from"./ElementWithTooltip.aa21c398.js";import{u as Qe}from"./useGetInfoFromIds.fc63d11c.js";import{C as Y}from"./ColumnType.744125d2.js";import{I as j}from"./IconSvg.af973a0c.js";import{C as Ue}from"./Checkbox.fc5ecb82.js";import{D as U}from"./Dropdown.cea6d11d.js";import{R as pt}from"./RadioGroup.0bddc76f.js";import{h as qe}from"./moment.a565bb48.js";import{R as mt}from"./RangeSlider.e5b4fec2.js";import{c as ft,P as yt}from"./factory.ee8ba69d.js";import{r as ht}from"./react-sizeme.22227f3d.js";import{S as _t}from"./Skeleton.d97a08a6.js";import{g as St}from"./ColorGradient.16f0e0f2.js";import{l as Ct}from"./LoadingScreen.d5fc7030.js";import{T as gt}from"./Tooltip.9455954b.js";import{M as se}from"./Modal.2df339d5.js";import{B as De}from"./Button.ead7d59a.js";import{I as Ft}from"./InfoOutlined.10c65527.js";import{i as we}from"./TypeUtils.a2c41307.js";import{C as Et}from"./Close.2a111ba4.js";const J=e=>n(_t,{style:{...e.style,display:"inline-block"},...e});try{J.displayName="SkeletonInlineBlock",J.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:J.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const M=F.exports.createContext(void 0),oe=({children:e,queryContext:t})=>n(M.Provider,{value:t,children:e});function G(){const e=F.exports.useContext(M);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function xn(){const e=F.exports.useContext(M);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function Nn(){const e=F.exports.useContext(M);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const he=M.Consumer;try{M.displayName="QueryContext",M.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:M.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{oe.displayName="QueryContextProvider",oe.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:oe.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{he.displayName="QueryContextConsumer",he.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:he.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}function Me(e,t){return`${e}${t}`}function xt(e,t){const r=window.location.search,a=`${e}=${t}`;return r?r.includes(`${e}=`)?window.location.search.slice(r.indexOf("?")+1).split("&").map(i=>i.split("=")[0]===e?`${a}`:i).join("&"):`${r.substr(1)}&${a}`:a}function Nt(e,t){if(!window.location.search)return;const r=Me(e,t),s=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(o=>o.split("=")[0]===r).map(o=>o.split("=")[1])[0];return s?decodeURIComponent(s):void 0}function Tt(e,t,r){const a=t!==void 0?Me(e,t):e,s=xt(a,r),o=window.location,i=`${o.protocol}//${o.hostname}${o.port?":"+o.port:""}${o.pathname}?${s}`;window.history.replaceState("object or string","Title",i)}function Rt(e,t){const r=Nt(e,t);let a;if(r){const s=JSON.parse(r);s.sql&&(a={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:$e|Ke|Ge|je,entityId:ut(s.sql),query:s})}return a}function vt(e){var h,E;const{initQueryRequest:t,componentIndex:r=0,shouldDeepLink:a=!1,onQueryChange:s}=e,[o,i]=F.exports.useState(t);F.exports.useEffect(()=>{const _=Rt("QueryWrapper",r);_&&i(_)},[r]);const c=F.exports.useCallback(()=>W(o),[o]);function C(){return W(t)}function d(_){let l;typeof _=="function"?l=_(c()):l=_;const T=W(l);if(i(T),T.query){const m=JSON.stringify(T.query);if(a){const v=encodeURIComponent(m);Tt("QueryWrapper",r,v)}s&&s(m)}}const{entityId:p,versionNumber:I}=dt(o.query.sql),x=(h=o.query.limit)!=null?h:Je,A=Math.ceil((((E=o.query.offset)!=null?E:0)+Number(x))/x);function g(_){d(l=>(l.query.limit=_,l))}function w(_){d(l=>(l.query.offset=(_-1)*x,l))}return{entityId:p,versionNumber:I,getInitQueryRequest:C,getLastQueryRequest:c,setQuery:d,pageSize:x,currentPage:A,setPageSize:g,goToPage:w}}const Oe="isShowingFacetFilters",Ae="isHidingFacetFilters";function _e(e){const{initQueryRequest:t,onQueryChange:r,onQueryResultBundleChange:a,lockedColumn:s,componentIndex:o,shouldDeepLink:i}=e,[c,C]=F.exports.useState(void 0),{entityId:d,versionNumber:p,getInitQueryRequest:I,getLastQueryRequest:x,setQuery:A,currentPage:g,pageSize:w,goToPage:h,setPageSize:E}=vt({initQueryRequest:t,shouldDeepLink:i,componentIndex:o,onQueryChange:r}),_=F.exports.useMemo(()=>x(),[x]),{data:l,isLoading:T,error:m,isPreviousData:v}=rt(_,{keepPreviousData:!0},C),q=l==null?void 0:l.responseBody,D=T||v,{data:k}=ct(d,p);Ye(()=>{q&&a&&a(JSON.stringify(q))},[q,a]);const R=q?st(q.facets,q.selectColumns):!0,V={data:F.exports.useMemo(()=>ot(q,s),[q,s]),currentPage:g,pageSize:w,setPageSize:E,isLoadingNewBundle:D,getLastQueryRequest:x,getInitQueryRequest:I,error:m,entity:k,executeQueryRequest:A,isFacetsAvailable:R,asyncJobStatus:c,goToPage:h},{children:u}=e;return n(oe,{queryContext:V,children:n("div",{className:`SRC-wrapper ${D?"SRC-logo-cursor":""} ${R?"has-facets":""}`,children:u})})}try{_e.displayName="QueryWrapper",_e.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:_e.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}const $=F.exports.createContext(void 0),ie=({children:e,queryVisualizationContext:t})=>n($.Provider,{value:t,children:e});function re(){const e=F.exports.useContext($);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const Se=$.Consumer;function Ce(e){var w,h;const{data:t,getLastQueryRequest:r,isFacetsAvailable:a,isLoadingNewBundle:s}=G(),[o,i]=F.exports.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(w=e.defaultShowFacetVisualization)!=null?w:!0,showSearchBar:(h=e.defaultShowSearchBar)!=null?h:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});F.exports.useEffect(()=>{a||i(E=>({...E,showFacetFilter:!1,showFacetVisualization:!1}))},[a]),F.exports.useEffect(()=>{s&&p([])},[s]);const[c,C]=F.exports.useState([]),[d,p]=F.exports.useState([]),I=r(),x=it(t==null?void 0:t.selectColumns);F.exports.useEffect(()=>{var E,_;C((_=x==null?void 0:x.slice(0,(E=e.visibleColumnCount)!=null?E:1/0).map(l=>l.name))!=null?_:[])},[x,I.query.sql,e.visibleColumnCount]);const A={topLevelControlsState:o,setTopLevelControlsState:i,columnsToShowInTable:c,setColumnsToShowInTable:C,selectedRowIndices:d,setSelectedRowIndices:p,facetAliases:e.facetAliases,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn},{children:g}=e;return n(ie,{queryVisualizationContext:A,children:g})}try{Ce.displayName="QueryVisualizationWrapper",Ce.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:Ce.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{$.displayName="QueryVisualizationContext",$.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:$.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{ie.displayName="QueryVisualizationContextProvider",ie.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:ie.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{Se.displayName="QueryVisualizationContextConsumer",Se.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:Se.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}const ge=()=>{const{error:e}=G();return n(Ze,{error:e})};try{ge.displayName="QueryWrapperErrorBanner",ge.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"]={docgenInfo:ge.__docgenInfo,name:"QueryWrapperErrorBanner",path:"src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"})}catch{}var bt=(e=>(e.LIKE="LIKE",e))(bt||{}),It=(e=>(e.HAS="HAS",e.HAS_LIKE="HAS_LIKE",e))(It||{});const wt="org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",Ot="org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",At="org.sagebionetworks.repo.model.table.TextMatchesQueryFilter",Le=we(At),Fe=we(wt),Ee=we(Ot),le=e=>{var t;return y("svg",{...e,className:`Icon-Plus ${(t=e.className)!=null?t:""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]})};try{le.displayName="IconPlus",le.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconPlus.tsx#IconPlus"]={docgenInfo:le.__docgenInfo,name:"IconPlus",path:"src/lib/assets/icons/IconPlus.tsx#IconPlus"})}catch{}const ce=e=>{var t;return y("svg",{...e,className:`Icon-Minus ${(t=e.className)!=null?t:""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]})};try{ce.displayName="IconMinus",ce.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconMinus.tsx#IconMinus"]={docgenInfo:ce.__docgenInfo,name:"IconMinus",path:"src/lib/assets/icons/IconMinus.tsx#IconMinus"})}catch{}const Z=({label:e,isCollapsed:t,onClick:r,facetAliases:a})=>y("div",{className:"FacetFilterHeader",children:[n("label",{className:"FacetFilterHeader__label",children:z(e,a)}),n("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>r(!t),children:t?n(le,{className:"icon-plus",title:"Expand Menu"}):n(ce,{className:"icon-minus",title:"Collapse Menu"})})]});try{Z.displayName="FacetFilterHeader",Z.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"Function"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!0,type:{name:"{} | undefined"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:Z.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}function Vt(e){return e.replace(/\s/g,"").toLowerCase()}function ke(e,t=[],r=[]){const{value:a}=e;let s=a;a===te&&(s=ye);const o=t.find(c=>c.ownerId===a);o&&(s=o?o.userName:`unknown (${a})`);const i=r.find(c=>c.id===a);return i&&(s=i?i.name:`unknown (${a})`),`${s}`}function Qt(e,t,r){const a=[...e.sort((s,o)=>o.count-s.count)];return t||a.length<=r||a.slice(r).find(s=>s.isSelected)?a:a.splice(0,r)}const K=({facetValues:e,columnModel:t,onClear:r,onChange:a,facetAliases:s,containerAs:o="Collapsible",dropdownType:i="Icon",collapsed:c=!1})=>{const[C,d]=F.exports.useState(!1),[p,I]=F.exports.useState(c),[x,A]=F.exports.useState(!1),[g,w]=F.exports.useState(!1),[h,E]=F.exports.useState(""),[_,l]=F.exports.useState(e);lt(()=>{l(e)},[e]);const T=5,m=1500,v=Ie.createRef(),q={};let D;const k=e.filter(S=>S.isSelected).length===0,R=(t==null?void 0:t.columnType)===Y.USERID||(t==null?void 0:t.columnType)===Y.USERID_LIST?e.map(S=>S.value):[],O=Qe({ids:R,type:"USER_PROFILE"}),V=(t==null?void 0:t.columnType)===Y.ENTITYID||(t==null?void 0:t.columnType)===Y.ENTITYID_LIST?e.map(S=>S.value):[],u=Qe({ids:V,type:"ENTITY_HEADER"}),f=S=>{const Q=S.target.value;if(E(Q),d(!0),!Q)e.forEach(B=>{B.isSelected=!1}),l(e);else{const B=e.filter(H=>ke(H,O,u).toLowerCase().indexOf(Q.trim().toLowerCase())>-1?H:null);l(B)}};if(!t)return n(P,{});const N=o==="Dropdown",b=y("div",{className:N?"EnumFacetFilter__dropdown_menu":"",children:[y("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[y("div",{className:g?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[n("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{l(e),w(!1),d(!1)},children:n("span",{className:"EnumFacetFilter__previous",children:n(j,{options:{icon:"arrowBack"}})})}),h.length>0&&n("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var S;E(""),(S=v.current)==null||S.focus()},children:n("span",{className:"EnumFacetFilter__reset",children:n(j,{options:{icon:"close"}})})}),n("input",{type:"text",placeholder:"Find values",value:h,ref:v,onChange:S=>{f(S)}})]}),!g&&y("div",{className:"EnumFacetFilter__checkAll",children:[n(Ue,{className:"EnumFacetFilter__checkbox",onChange:()=>{r()},checked:k,label:"All",isSelectAll:!0},"select_all"),n("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var S;E(""),w(!0),(S=v.current)==null||S.focus()},children:n("span",{className:"EnumFacetFilter__searchicon",children:n(j,{options:{icon:"search"}})})})]})]}),y("div",{children:[_.length>0&&Qt(_,C||N,T).map((S,Q)=>n(qt,{id:Vt(S.value),index:Q,label:ke(S,O,u),count:S.count,isDropdown:N,initialIsSelected:S.isSelected,onChange:B=>{q[S.value]=B,clearTimeout(D),D=setTimeout(()=>{a(q),A(!1)},m)}},`checkLabel${Q}`)),!N&&y(P,{children:[!C&&_.length>T&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!0),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:y("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",_.length,")"]})})}),C&&_.length>T&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!1),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:n("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),_.length<=0&&n("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),L=()=>A(!x);return N?i==="SelectBox"?y(U,{className:"EnumFacetFilter EnumFacetFilterSelect",show:x,onToggle:L,children:[y(U.Toggle,{className:"secondary-caret",variant:"gray-select",children:[k&&"All",!k&&e.filter(S=>S.isSelected).length===1&&e.filter(S=>S.isSelected)[0].value,!k&&e.filter(S=>S.isSelected).length>1&&"Multiple Values Selected"]}),n(U.Menu,{children:b})]}):y(U,{className:"EnumFacetFilter",show:x,onToggle:L,children:[n(ne,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),n(U.Menu,{children:b})]}):y(P,{children:[n(Z,{facetAliases:s,isCollapsed:p,label:t.name,onClick:S=>I(S)}),n(Be,{className:"EnumFacetFilter",in:!p,children:b})]})};function qt({id:e,index:t,label:r,count:a,isDropdown:s,initialIsSelected:o,onChange:i}){const[c,C]=F.exports.useState(o);return Ie.useEffect(()=>{C(o)},[o]),y("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{s&&(C(!c),i(!c))},children:[n(Ue,{className:"EnumFacetFilter__checkbox",onClick:d=>d.stopPropagation(),onChange:d=>{C(d),i(d)},checked:c,label:r},`${e}-${t}`),s&&y("span",{className:"EnumFacetFilter__count",children:["(",a,")"]}),!s&&n("div",{className:"EnumFacetFilter__count",children:a})]})}try{K.displayName="EnumFacetFilter",K.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:K.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const ue=({facet:e,isChecked:t,onClick:r})=>{const{facetAliases:a}=re();return y("button",{className:`Chip ${t?"Checked":""}`,onClick:r,children:[z(e.columnName,a),n(j,{options:{icon:t?"check":"add",size:"14px",padding:"left"}})]})};try{ue.displayName="FacetChip",ue.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"]={docgenInfo:ue.__docgenInfo,name:"FacetChip",path:"src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"})}catch{}const de=e=>{const t="Min value should be less then max value",[r,a]=F.exports.useState(!1),[s,o]=F.exports.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:qe(e.initialValues.min).format("YYYY-MM-DD"),max:qe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),i=e.className?`range ${e.className}`:"range",c=({min:d,max:p},I="number")=>{if(d==null||p===null||p===void 0)return a(!1),!0;if(I==="number"){if(Number(d)>Number(p))return a(!0),!1}else if(Date.parse(d)>Date.parse(p))return a(!0),!1;return a(!1),!0},C=(d,p,I="number")=>{c(d,I)&&p(d)};return y("div",{className:i,style:{display:"flex",flexWrap:"wrap"},children:[y("div",{style:{marginRight:"10px"},children:[n("input",{"aria-label":"min",type:e.type,value:s.min,onChange:({target:d})=>o({min:d.value,max:s.max})},"range_min"),n("div",{children:"to"}),n("input",{"aria-label":"max",type:e.type,value:s.max,onChange:({target:d})=>o({min:s.min,max:d.value})},"range_max")]}),n("button",{className:"btn btn-link SRC-noPadding",onClick:()=>C(s,e.onChange,e.type),children:"Apply"}),r&&n("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{de.displayName="Range",de.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:de.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}var ve=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(ve||{});const pe=({facetResult:e,columnModel:t,onChange:r,facetAliases:a,collapsed:s=!1})=>{const[o,i]=F.exports.useState(s),c=[{label:ye,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:C,columnMax:d,selectedMin:p,selectedMax:I}=e;const x=!p&&!I;p=p||C,I=I||d;const A=t.columnType==="DOUBLE"?"number":"date",g=(l,T)=>T?"":l===te?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",w=(l,T)=>{E(l),l!=="RANGE"&&T([l,l])},[h,E]=F.exports.useState(g(p,x));return y("div",{children:[n(Z,{isCollapsed:o,label:t.name,onClick:l=>i(l),facetAliases:a}),y(Be,{in:!o,children:[n(pt,{value:h,id:"rangeSelector",options:c,onChange:l=>w(l,r)}),h==="RANGE"&&(C===d?n("label",{children:d}):y(P,{children:[t.columnType==="INTEGER"&&y(mt,{domain:[C,d],initialValues:{min:p,max:I},step:1,doUpdateOnApply:!0,onChange:l=>r([l.min,l.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&n(de,{initialValues:{min:p,max:I},type:A,onChange:l=>r([l.min,l.max])},"Range")]}))]})]})};try{pe.displayName="RangeFacetFilter",pe.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:pe.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const We=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected===!0).map(t=>t.value)}),Lt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Ve=(e,t)=>{var o,i;const r=(i=(o=t==null?void 0:t.query)==null?void 0:o.selectedFacets)!=null?i:[],a=r.findIndex(c=>c.columnName===e.columnName),s=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return a>-1?s?r.splice(a,1):r[a]=e:r.push(e),r};function ae(e,t,r,a,s=!1){a?t.facetValues.forEach(c=>{c.value===a&&(c.isSelected=s)}):t.facetValues.forEach(c=>{c.isSelected=!1});const o=We(t),i=Ve(o,e);r(i)}const be=(e,t,r,a)=>{const s=a&&Object.keys(a)||[];s.length&&t.facetValues.forEach(c=>{s.includes(c.value)&&(c.isSelected=a?!!a[c.value]:!1)});const o=We(t),i=Ve(o,e);r(i)},He=(e,t,r,a)=>{t.columnMin=a[0],t.columnMax=a[1];const s=Lt(t),o=Ve(s,e);r(o)};function xe(e){var E,_;const{facetsToFilter:t}=e,{data:r,isLoadingNewBundle:a,getLastQueryRequest:s,executeQueryRequest:o}=G(),i=(E=r==null?void 0:r.facets)==null?void 0:E.filter(l=>!Pe(l));let c;t==null?c=(_=i==null?void 0:i.map(l=>l.columnName))!=null?_:[]:c=t;const[C,d]=Ie.useState([]),{facetAliases:p,topLevelControlsState:I}=re(),{showFacetFilter:x}=I;if(Ye(()=>{d(c.slice(0,3))},[r==null?void 0:r.facets]),!r)return n(P,{});const A=r.selectColumns,g=s(),w=l=>{const T=s();T.query.selectedFacets=l,T.query.offset=0,o(T)},h=l=>{let T=[...C!=null?C:[""],l.columnName];C.includes(l.columnName)&&(T=T.filter(m=>m!=l.columnName)),d(T)};return y("div",{className:`FacetFilterControls ${x?Oe:Ae}`,children:[a&&n("div",{children:"Loading..."}),!a&&(i!=null?i:[]).filter(l=>C.includes(l.columnName)).map((l,T)=>{const m=A.find(v=>v.name===l.columnName);return y("div",{className:"FacetFilterControls__facet",children:[l.facetType==="enumeration"&&m&&n(K,{containerAs:"Collapsible",collapsed:!1,facetValues:l.facetValues,columnModel:m,facetAliases:p,onChange:v=>be(g,l,w,v),onClear:()=>ae(g,l,w)}),l.facetType==="range"&&m&&n(pe,{facetResult:l,columnModel:m,facetAliases:p,collapsed:!1,onChange:v=>He(g,l,w,v)})]},l.columnName)}),y("div",{children:[n("div",{className:"AvailableFacet",children:n("label",{className:"AvailableFacet__label",children:"Available Facets"})}),(i!=null?i:[]).filter(l=>c.includes(l.columnName)).map(l=>n(ue,{facet:l,onClick:()=>h(l),isChecked:C.includes(l.columnName)},l.columnName))]})]})}try{xe.displayName="FacetFilterControls",xe.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"]={docgenInfo:xe.__docgenInfo,name:"FacetFilterControls",path:"src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"})}catch{}const kt=ft(yt),Bt=19,Pt=30,Yt={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},Ut=(e,t)=>{t=t||0;let r=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let a=0;a<t;a++)r.indexOf(".")!==-1&&(r=r.replace("0%","%"),r=r.replace(".%","%"));return r};function ze(e,t){if(!e)return e;const r=e.trim();return r.length>t?r.substr(0,t-1)+"\u2026":e}async function Dt(e,t,r,a,s){var g,w;const{colorPalette:o}=St(r,e.facetValues.length),i=async(h,E,_)=>{const l=new Map;l.set(te,ye);const T=h.map(m=>m.value).filter(m=>m!==te);if(E===Y.ENTITYID||E===Y.ENTITYID_LIST){const m=await et(T,_);for(const v of m.results)l.set(v.id,v.name)}else if(E===Y.USERID||E===Y.USERID_LIST){const m=await tt(T,_);for(const v of m.children)l.set(v.ownerId,v.userName)}return h.map(m=>({facet:m,label:c(m,!1,l),truncatedLabel:c(m,!0,l),count:m.count}))},c=(h,E,_)=>{var T;let l=(T=_.get(h.value))!=null?T:h.value;return E&&(l=ze(l,Bt)),l},C=await i(e.facetValues,t,s),d=C.map(h=>h.truncatedLabel),I=e.facetValues.some(h=>h.isSelected)?e.facetValues.map((h,E)=>h.isSelected?o[E]:o[E].replace("rgb(","rgba(").replace(")",", 0.25)")):o,x={values:a==="PIE"?e.facetValues.map(h=>h.count):void 0,labels:C.map(h=>h.label),text:d,x:a==="BAR"?e.facetValues.map(h=>{var E,_;return(_=(E=C.find(l=>l.facet===h))==null?void 0:E.label)!=null?_:h.value}):void 0,y:a==="BAR"?e.facetValues.map(h=>h.count):void 0,facetEnumerationValues:e.facetValues.map(h=>h.value),name:e.columnName,hovertemplate:a==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:a==="PIE"?"pie":"bar",pull:a==="PIE"?e.facetValues.map(h=>h.isSelected?.1:0):void 0,marker:{colors:a==="PIE"?I:void 0,color:a==="BAR"?I:void 0}};return{data:[x],labels:C,colors:a==="PIE"?(g=x.marker)==null?void 0:g.colors:(w=x.marker)==null?void 0:w.color}}const Mt=(e,t,r)=>{if(e.points&&e.points[0]){const a=e.points[0],s=a.data.facetEnumerationValues[a.pointNumber],o=t.facetValues.find(i=>i.value===s);r(t,o,!o.isSelected)}};function Wt(e,t,r){const s=e?e*(t==="BAR"?.8:.6):200;let o=t==="PIE"?s:s/3;return o>r&&(o=r),{width:`${s}px`,height:`${o}px`}}function me(e){const{labels:t,colors:r=[],isExpanded:a}=e;if(!t)return n(P,{});const s=a?Math.min(t.length,9):Math.min(t.length,3);if(s===0)return n(P,{});const o=t.reduce((i,c)=>i+c.count,0);return n("div",{className:`FacetNavPanel__body__legend${a?"--expanded":""}`,children:t.slice(0,s).map((i,c)=>{const d=`(${Ut(i.count/o,1)}) ${i.label}`,p=ze(d,Pt);return n(ne,{idForToolTip:i.label,tooltipText:i.label,children:y("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[n("div",{style:{backgroundColor:r[c]}}),n("label",{children:p})]},`legendLabel_${c}`)},i.label)})})}const Ht=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",X=e=>{const{onHide:t,isModalView:r,applyChangesToFacetFilter:a,applyChangesToGraphSlice:s,index:o,facetToPlot:i,plotType:c,onSetPlotType:C}=e,{accessToken:d}=Xe(),{data:p,isLoadingNewBundle:I,getLastQueryRequest:x}=G(),{facetAliases:A}=re(),[g,w]=F.exports.useState(),[h,E]=F.exports.useState(!1),_=z(i.columnName,A),l=F.exports.useCallback(()=>{var m,v;return(v=(m=p==null?void 0:p.columnModels)==null?void 0:m.find(q=>q.name===i.columnName))==null?void 0:v.columnType},[p,i.columnName]);F.exports.useEffect(()=>{let m=!0;if(i)Dt(i,l(),o,c,d).then(v=>{m&&w(v)});else return;return()=>{m=!1}},[i,p,o,c,d,l]);const T=()=>y("div",{onClick:m=>{m.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),y(U,{children:[n(U.Toggle,{className:"secondary-caret",variant:"gray-select",children:c==="PIE"?"Pie Chart":"Bar Chart"}),y(U.Menu,{className:"chart-tools",children:[n(U.Item,{as:"button",onClick:()=>C("BAR"),children:"Bar Chart"}),n(U.Item,{as:"button",onClick:()=>C("PIE"),children:"Pie Chart"})]})]})]});return!p&&I||!i?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:Ct}):y(P,{children:[y(se,{animation:!1,show:h,onHide:()=>E(!1),backdrop:"static",children:[n(se.Header,{closeButton:!0,children:n(se.Title,{children:_!=null?_:""})}),y(se.Body,{children:[n(X,{...e,isModalView:!0}),n("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:n(De,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>E(!1),children:"Apply Filters"})})]})]}),y("div",{role:"graphics-document",className:`FacetNavPanel${r?"--expanded":""}`,children:[!r&&y("div",{className:"FacetNavPanel__title",children:[!p&&I?n(J,{width:100}):n("span",{className:"FacetNavPanel__title__name",children:_}),y("div",{className:"FacetNavPanel__title__tools",children:[n(K,{facetValues:i.facetValues,columnModel:p==null?void 0:p.columnModels.find(m=>m.name===i.columnName),facetAliases:A,onChange:m=>{be(x(),i,a,m)},onClear:()=>{ae(x(),i,a)},containerAs:"Dropdown"}),n(ne,{idForToolTip:"expandGraph",tooltipText:"Expand to large graph",callbackFn:()=>E(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),n(ne,{idForToolTip:"hideGraph",tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),r&&y(P,{children:[y("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),n(K,{facetValues:i.facetValues,columnModel:p==null?void 0:p.columnModels.find(m=>m.name===i.columnName),facetAliases:A,onChange:m=>{be(x(),i,a,m)},onClear:()=>{ae(x(),i,a)},containerAs:"Dropdown",dropdownType:"SelectBox"}),n(gt,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:n(Ft,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),n(T,{})]}),y("div",{className:`FacetNavPanel__body${r?"--expanded":""}`,children:[n(ht.SizeMe,{monitorHeight:!0,children:({size:m})=>{var v;return n("div",{className:Ht(r,c),children:n(kt,{layout:Yt,data:(v=g==null?void 0:g.data)!=null?v:[],style:Wt(m.width,c,r?300:150),config:{displayModeBar:!1},onClick:q=>Mt(q,i,s)},`${i.columnName}-${c}-${m.width}`)})}}),n(me,{labels:g==null?void 0:g.labels,colors:g==null?void 0:g.colors,isExpanded:r})]})]})]})};try{me.displayName="FacetPlotLegend",me.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"]={docgenInfo:me.__docgenInfo,name:"FacetPlotLegend",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"})}catch{}try{X.displayName="FacetNavPanel",X.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"]={docgenInfo:X.__docgenInfo,name:"FacetNavPanel",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"})}catch{}const zt=()=>{try{return JSON.parse(sessionStorage.getItem(nt)||"")}catch{return[]}},$t=()=>{try{return JSON.parse(sessionStorage.getItem(at)||"")}catch{return[]}},ee=e=>{let t,r="";if("facetWithSelection"in e){const{facetWithSelection:s}=e;s.facet.facetType==="enumeration"?t=s.displayValue===te?ye:s.displayValue:t=`${s.facet.selectedMin} 
        - ${s.facet.selectedMax}`,r=`${z(s.facet.columnName)}: ${t}`}else if("filter"in e){const{filter:s}=e;let o=s.value;(o==null?void 0:o.startsWith("%"))&&(o==null?void 0:o.endsWith("%"))&&(o=o.substring(1,o.length-1)),t=o,r=`Text matches: "${o}"`,s.columnName&&(t=`"${o}" in ${z(s==null?void 0:s.columnName)}`,r=`${z(s==null?void 0:s.columnName)}: ${o}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const a=encodeURIComponent(r);return n(ne,{idForToolTip:`selectionCriteria_${a}`,tooltipText:r,callbackFn:()=>{},children:y("div",{className:"SelectionCriteriaPill",children:[n("span",{children:t}),n("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:n(Et,{})})]},`SelectionCriteriaPill ${a}`)})};try{ee.displayName="SelectionCriteriaPill",ee.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:ee.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const fe=({style:e,frontText:t,endText:r="",hideIfUnfiltered:a=!1})=>{var V;const{data:s,isLoadingNewBundle:o,getLastQueryRequest:i,executeQueryRequest:c,getInitQueryRequest:C,error:d}=G(),{topLevelControlsState:p,unitDescription:I}=re(),x=s==null?void 0:s.queryCount,[A,g]=F.exports.useState([]),w=u=>{const f=W(i());f.query.selectedFacets=u,f.query.offset=0,c(f)},h=u=>u.filter(b=>b.facetType==="enumeration").filter(b=>b.facetValues.filter(L=>L.isSelected===!0).length>0),E=u=>u.filter(b=>b.facetType==="range").filter(b=>b.selectedMax||b.selectedMin),_=(u,f)=>{var b;const N=u.find(L=>L.id===f);return(b=N==null?void 0:N.name)!=null?b:f},l=(u,f)=>{const N=u.find(b=>b.ownerId===f);return(N==null?void 0:N.userName)||f},T=F.exports.useCallback((u,f)=>{const N=zt(),b=$t(),L=[];return u.forEach(S=>{const Q=f.find(B=>B.name===S.columnName);S.facetValues.forEach(B=>{if(B.isSelected){let H=B.value;(Q==null?void 0:Q.columnType)===Y.ENTITYID||(Q==null?void 0:Q.columnType)===Y.ENTITYID_LIST?H=_(N,B.value):((Q==null?void 0:Q.columnType)===Y.USERID||(Q==null?void 0:Q.columnType)===Y.USERID_LIST)&&(H=l(b,B.value)),L.push({facet:S,displayValue:H,selectedValue:B})}})}),L},[]);F.exports.useEffect(()=>{if(s){const u=E(s.facets),f=h(s.facets),N=u.map(L=>({facet:L})),b=T(f,s.columnModels);g([...N,...b])}},[s,T]);const m=u=>{const{facet:f,selectedValue:N}=u;f.facetType==="enumeration"?ae(i(),f,w,N==null?void 0:N.value,!1):He(i(),f,w,[ve.ANY,ve.ANY])},v=(u,f)=>{var b;const N=W(i());!N.query.additionalFilters||(N.query.additionalFilters=(b=N.query.additionalFilters)==null?void 0:b.reduce(function(L,S){if(Fe(S)||Ee(S)){const Q={columnName:S.columnName,values:S.columnName===u?S.values.filter(B=>B!==f):S.values,operator:Fe(S)?S.operator:void 0,function:Ee(S)?S.function:void 0,concreteType:S.concreteType};Q.values.length>0&&L.push(Q)}else L.push(S);return L},[]),c(N))},q=u=>{const f=W(i());!f.query.additionalFilters||(f.query.additionalFilters=f.query.additionalFilters.filter(N=>!(Le(N)&&N.searchExpression===u.searchExpression)),c(f))},D=()=>{const u=W(C());u.query.additionalFilters=[],c(u)},k=(V=i().query.additionalFilters)==null?void 0:V.reduce((u,f)=>{if(Le(f))u.push({key:`fulltextsearch-${f.searchExpression}`,filter:{value:f.searchExpression},onRemove:()=>q(f)});else if(Fe(f)||Ee(f)){const{columnName:N}=f;f.values.forEach(b=>{u.push({key:`columnsearch-${b}`,filter:{columnName:N,value:b},onRemove:()=>v(f.columnName,b)})})}else console.warn("Encountered unexpected QueryFilter: ",f);return u},[]),R=p==null?void 0:p.showFacetFilter,O=A.length>0||k&&k.length>0;return d?n(P,{}):n("div",{className:`TotalQueryResults ${R?Oe:Ae} ${O?"hasFilters":""}`,style:e,children:o?n(J,{width:100}):y(P,{children:[(O||!a)&&y("div",{className:"TotalQueryResults__topbar",children:[y("span",{className:"SRC-boldText",children:[t," ",x==null?void 0:x.toLocaleString()," ",I," ",r]}),(A.length>0||k&&k.length>2)&&y("a",{onClick:D,className:"TotalQueryResults__topbar__clearall",children:[n(j,{options:{icon:"deleteSweep"}}),"Clear all filters"]})]}),y("div",{className:"TotalQueryResults__selections",children:[k&&k.map(u=>F.exports.createElement(ee,{...u,key:u.key})),A.map((u,f)=>{var N,b,L;return n(ee,{facetWithSelection:u,onRemove:()=>m(u)},`facets-${(L=(b=(N=u.selectedValue)==null?void 0:N.value)!=null?b:u.displayValue)!=null?L:f}`)})]})]})})};try{fe.displayName="TotalQueryResults",fe.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:{value:"false"},description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:fe.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}const Ne=2;function Te(e,t){var a,s;return(s=(a=e==null?void 0:e.facets)==null?void 0:a.filter(o=>o.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(o.columnName)>-1)&&o.facetValues.length>0&&!Pe(o)))!=null?s:[]}const Re=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:r,isLoadingNewBundle:a,executeQueryRequest:s,error:o,asyncJobStatus:i}=G(),{topLevelControlsState:c}=re(),[C,d]=F.exports.useState([]),[p,I]=F.exports.useState(!0),{showFacetVisualization:x,showFacetFilter:A}=c,g=r();F.exports.useEffect(()=>{const R=Te(t,e);R.length!==0&&p&&(d(R.map((O,V)=>({name:O.columnName,isHidden:V>=Ne,plotType:"PIE"}))),I(!1))},[t,p,e]);const w=R=>{d(O=>O.map((V,u)=>R?{...V,isHidden:!1}:{...V,isHidden:u>=Ne}))},h=R=>{g.query.selectedFacets=R,g.query.offset=0,s(g)},E=R=>C.find(u=>u.name===R&&u.isHidden===!0)!==void 0,_=F.exports.useMemo(()=>C.find(R=>R.isHidden===!0)?"MORE":C.length<=Ne?"NONE":"LESS",[C]),l=R=>{v(R,"isHidden",!0)},T=(R,O)=>{v(R,"plotType",O)},m=R=>{var V;const O=(V=C.find(u=>u.name===R))==null?void 0:V.plotType;return O!=null?O:"PIE"},v=(R,O,V)=>{d(u=>u.map(f=>f.name===R?{...f,[O]:V}:f))},q=Te(t,e),D=Te(t,e).map((R,O)=>({columnName:R.columnName,colorIndex:O})),k=(g==null?void 0:g.query.selectedFacets)!==void 0&&g.query.selectedFacets.length>0||(g==null?void 0:g.query.additionalFilters)!==void 0&&(g==null?void 0:g.query.additionalFilters.length)>0;return o?n(P,{}):!t&&a?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(i==null?void 0:i.progressMessage)&&y("div",{children:[n("span",{className:"spinner"}),i.progressMessage]})}):y(P,{children:[n(fe,{frontText:"",endText:k?"filtered by":"",hideIfUnfiltered:!0}),q.length>0&&y("div",{className:`FacetNav ${x?"":"hidden"} ${A?Oe:Ae} ${_==="LESS"?"less":""}`,children:[n("div",{className:"FacetNav__row",role:"list",children:q.map(R=>{var O;return n("div",{className:"col-sm-12 col-md-4",style:{display:E(R.columnName)?"none":"block"},children:n(X,{index:(O=D.find(V=>V.columnName===R.columnName))==null?void 0:O.colorIndex,onHide:()=>l(R.columnName),plotType:m(R.columnName),onSetPlotType:V=>T(R.columnName,V),facetToPlot:R,applyChangesToFacetFilter:h,applyChangesToGraphSlice:(V,u,f)=>ae(g,V,h,u==null?void 0:u.value,f),isModalView:!1})},R.columnName)})}),_!=="NONE"&&n("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:n(De,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>w(_==="MORE"),style:{zIndex:500},children:_==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Re.displayName="FacetNav",Re.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"]={docgenInfo:Re.__docgenInfo,name:"FacetNav",path:"src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"})}catch{}export{It as C,K as E,xe as F,ce as I,Oe as Q,J as S,fe as T,Ae as a,re as b,vt as c,oe as d,Ee as e,bt as f,xn as g,be as h,Fe as i,ae as j,Ce as k,he as l,Se as m,ge as n,Re as o,_e as p,Nn as q,Te as r,Dt as s,Wt as t,G as u,me as v,le as w};

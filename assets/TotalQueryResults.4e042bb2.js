import{j as s,a as E,F as Y}from"./jsx-runtime.00d70968.js";import{S as We}from"./Skeleton.c897a2bf.js";import{x as Pe,y as ze,s as $e,t as Ke,q as He,B as Me,z as Ge,o as Je,A as je,V as fe,C as he}from"./index.849736b1.js";import{C as A}from"./ColumnType.744125d2.js";import"./assert.45cab6dc.js";import{i as _e}from"./TypeUtils.a2c41307.js";import{a as Xe,u as ve,b as Ze}from"./use-deep-compare-effect.esm.76673280.js";import{a as et,p as tt}from"./sqlFunctions.59c64146.js";import{i as nt,a as at}from"./queryUtils.b5b6609b.js";import{c as L}from"./cloneDeep.c70449c0.js";import{u as J,E as we}from"./ElementWithTooltip.1955bcf7.js";import{C as rt,a as be}from"./Collapse.a100796c.js";import{u as Ee}from"./useGetInfoFromIds.214300b6.js";import{I as ae}from"./IconSvg.e3afc045.js";import{C as Ie}from"./Checkbox.96de280e.js";import{I as it,a as st}from"./IconMinus.3805e4f5.js";import{D as H}from"./Dropdown.13d94a98.js";import{R as ot}from"./RadioGroup.7c46be31.js";import{h as Fe}from"./moment.a565bb48.js";import{R as lt}from"./RangeSlider.df5d4da8.js";import{B as ct}from"./Button.fda23eee.js";const ut=window.React.createContext,Ce=window.React.useContext,k=ut(void 0),j=({children:e,queryContext:t})=>s(k.Provider,{value:t,children:e});function Se(){const e=Ce(k);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function an(){const e=Ce(k);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function rn(){const e=Ce(k);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const re=k.Consumer;try{k.displayName="QueryContext",k.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:k.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{j.displayName="QueryContextProvider",j.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:j.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{re.displayName="QueryContextConsumer",re.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:re.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}const X=e=>s(We,{style:{...e.style,display:"inline-block"},...e});try{X.displayName="SkeletonInlineBlock",X.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:X.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const dt=()=>{try{return JSON.parse(sessionStorage.getItem(Pe)||"")}catch{return[]}},pt=()=>{try{return JSON.parse(sessionStorage.getItem(ze)||"")}catch{return[]}};var mt=(e=>(e.LIKE="LIKE",e))(mt||{}),yt=(e=>(e.HAS="HAS",e.HAS_LIKE="HAS_LIKE",e))(yt||{});const ft="org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",ht="org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",_t="org.sagebionetworks.repo.model.table.TextMatchesQueryFilter",Re=_e(_t),ie=_e(ft),se=_e(ht),Ct=window.React.createContext,St=window.React.useContext,oe=window.React.useEffect,le=window.React.useState,z=Ct(void 0),Z=({children:e,queryVisualizationContext:t})=>s(z.Provider,{value:t,children:e});function qe(){const e=St(z);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const ce=z.Consumer;function ue(e){var v,x;const{data:t,getLastQueryRequest:i,isFacetsAvailable:a,isLoadingNewBundle:n}=Se(),[r,c]=le({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(v=e.defaultShowFacetVisualization)!=null?v:!0,showSearchBar:(x=e.defaultShowSearchBar)!=null?x:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});oe(()=>{a||c(w=>({...w,showFacetFilter:!1,showFacetVisualization:!1}))},[a]),oe(()=>{n&&_([])},[n]);const[p,F]=le([]),[m,_]=le([]),R=i(),h=Xe(t==null?void 0:t.selectColumns);oe(()=>{var w,Q;F((Q=h==null?void 0:h.slice(0,(w=e.visibleColumnCount)!=null?w:1/0).map(g=>g.name))!=null?Q:[])},[h,R.query.sql,e.visibleColumnCount]);const S={topLevelControlsState:r,setTopLevelControlsState:c,columnsToShowInTable:p,setColumnsToShowInTable:F,selectedRowIndices:m,setSelectedRowIndices:_,facetAliases:e.facetAliases,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn},{children:N}=e;return s(Z,{queryVisualizationContext:S,children:N})}try{ue.displayName="QueryVisualizationWrapper",ue.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:ue.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{z.displayName="QueryVisualizationContext",z.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:z.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{Z.displayName="QueryVisualizationContextProvider",Z.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:Z.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{ce.displayName="QueryVisualizationContextConsumer",ce.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:ce.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}function Oe(e,t){return`${e}${t}`}function gt(e,t){const i=window.location.search,a=`${e}=${t}`;return i?i.includes(`${e}=`)?window.location.search.slice(i.indexOf("?")+1).split("&").map(c=>c.split("=")[0]===e?`${a}`:c).join("&"):`${i.substr(1)}&${a}`:a}function Et(e,t){if(!window.location.search)return;const i=Oe(e,t),n=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(r=>r.split("=")[0]===i).map(r=>r.split("=")[1])[0];return n?decodeURIComponent(n):void 0}function Ft(e,t,i){const a=t!==void 0?Oe(e,t):e,n=gt(a,i),r=window.location,c=`${r.protocol}//${r.hostname}${r.port?":"+r.port:""}${r.pathname}?${n}`;window.history.replaceState("object or string","Title",c)}function Rt(e,t){const i=Et(e,t);let a;if(i){const n=JSON.parse(i);n.sql&&(a={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:$e|Ke|He|Me,entityId:et(n.sql),query:n})}return a}const Tt=window.React,xt=window.React.useEffect,Qt=window.React.useMemo,Te=window.React.useState,Ve="isShowingFacetFilters",Ae="isHidingFacetFilters";function de(e){var d,y,T,o;const{initQueryRequest:t,onQueryChange:i,onQueryResultBundleChange:a}=e,[n,r]=Te(t),[c,p]=Te(void 0),{data:F,isLoading:m,error:_,isPreviousData:R,remove:h}=Ge(n,{keepPreviousData:!0},p),S=F==null?void 0:F.responseBody,N=m||R,{entityId:v,versionNumber:x}=tt(n.query.sql),{data:w}=Je(v,x),Q=(d=n.query.limit)!=null?d:je,g=Math.ceil((((y=n.query.offset)!=null?y:0)+Number(Q))/Q),I=f=>{const C=V();C.query.limit=f,B(C)},$=f=>{const C=V();C.query.offset=(f-1)*Q,B(C)};ve(()=>{i&&i(JSON.stringify(n.query))},[i,n.query]),Ze(()=>{S&&a&&a(JSON.stringify(S))},[S,a]);const O=(T=e.componentIndex)!=null?T:0,U=S?nt(S.facets,S.selectColumns):!0;xt(()=>{const f=Rt("QueryWrapper",O);f&&r(f)},[]);const V=Tt.useCallback(()=>L(n),[n]);function b(){return L(e.initQueryRequest)}function B(f){const C=L(f);if(r(C),C.query){const q=JSON.stringify(C.query),P=encodeURIComponent(q);e.shouldDeepLink&&(e.onQueryChange?e.onQueryChange(q):Ft("QueryWrapper",O,P))}h()}const W={data:Qt(()=>{var C,q;const f=(C=e.lockedFacet)==null?void 0:C.facet;if(f&&S){const P=L(S),De=(q=P.facets)==null?void 0:q.filter(Ye=>Ye.columnName.toLowerCase()!==f.toLowerCase());return P.facets=De,P}else return S},[S,(o=e.lockedFacet)==null?void 0:o.facet]),currentPage:g,pageSize:Q,setPageSize:I,isLoadingNewBundle:N,getLastQueryRequest:V,getInitQueryRequest:b,error:_,entity:w,executeQueryRequest:B,isFacetsAvailable:U,asyncJobStatus:c,goToPage:$},{children:u}=e;return s(j,{queryContext:W,children:s("div",{className:`SRC-wrapper ${N?"SRC-logo-cursor":""} ${U?"has-facets":""}`,children:u})})}try{de.displayName="QueryWrapper",de.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedFacet:{defaultValue:null,description:"",name:"lockedFacet",required:!1,type:{name:"LockedFacet"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:de.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}const M=e=>{let t,i="";if("facetWithSelection"in e){const{facetWithSelection:n}=e;n.facet.facetType==="enumeration"?t=n.displayValue===fe?he:n.displayValue:t=`${n.facet.selectedMin} 
        - ${n.facet.selectedMax}`,i=`${J(n.facet.columnName)}: ${t}`}else if("filter"in e){const{filter:n}=e;let r=n.value;(r==null?void 0:r.startsWith("%"))&&(r==null?void 0:r.endsWith("%"))&&(r=r.substring(1,r.length-1)),t=r,i=`Text matches: "${r}"`,n.columnName&&(t=`"${r}" in ${J(n==null?void 0:n.columnName)}`,i=`${J(n==null?void 0:n.columnName)}: ${r}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const a=encodeURIComponent(i);return s(we,{idForToolTip:`selectionCriteria_${a}`,tooltipText:i,callbackFn:()=>{},children:E("label",{className:"SelectionCriteriaPill",children:[s("span",{children:t}),s("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:s(rt,{})})]},`SelectionCriteriaPill ${a}`)})};try{M.displayName="SelectionCriteriaPill",M.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:M.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const G=({label:e,isCollapsed:t,onClick:i,facetAliases:a})=>E("div",{className:"FacetFilterHeader",children:[s("label",{className:"FacetFilterHeader__label",children:J(e,a)}),s("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>i(!t),children:t?s(it,{className:"icon-plus",title:"Expand Menu"}):s(st,{className:"icon-minus",title:"Collapse Menu"})})]});try{G.displayName="FacetFilterHeader",G.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"Function"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!0,type:{name:"{} | undefined"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:G.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}const Le=window.React,D=window.React.useState;function Nt(e){return e.replace(/\s/g,"").toLowerCase()}function xe(e,t=[],i=[]){const{value:a}=e;let n=a;a===fe&&(n=he);const r=t.find(p=>p.ownerId===a);r&&(n=r?r.userName:`unknown (${a})`);const c=i.find(p=>p.id===a);return c&&(n=c?c.name:`unknown (${a})`),`${n}`}function vt(e,t,i){const a=[...e.sort((n,r)=>r.count-n.count)];return t||a.length<=i||a.slice(i).find(n=>n.isSelected)?a:a.splice(0,i)}const ee=({facetValues:e,columnModel:t,onClear:i,onChange:a,facetAliases:n,containerAs:r="Collapsible",dropdownType:c="Icon",collapsed:p=!1})=>{const[F,m]=D(!1),[_,R]=D(p),[h,S]=D(!1),[N,v]=D(!1),[x,w]=D(""),[Q,g]=D(e);ve(()=>{g(e)},[e]);const I=5,$=1500,O=Le.createRef(),U={};let V;const b=e.filter(o=>o.isSelected).length===0,B=(t==null?void 0:t.columnType)===A.USERID||(t==null?void 0:t.columnType)===A.USERID_LIST?e.map(o=>o.value):[],K=Ee({ids:B,type:"USER_PROFILE"}),W=(t==null?void 0:t.columnType)===A.ENTITYID||(t==null?void 0:t.columnType)===A.ENTITYID_LIST?e.map(o=>o.value):[],u=Ee({ids:W,type:"ENTITY_HEADER"}),l=o=>{const f=o.target.value;if(w(f),m(!0),!f)e.forEach(C=>{C.isSelected=!1}),g(e);else{const C=e.filter(q=>xe(q,K,u).toLowerCase().indexOf(f.trim().toLowerCase())>-1?q:null);g(C)}};if(!t)return s(Y,{});const d=r==="Dropdown",y=E("div",{className:d?"EnumFacetFilter__dropdown_menu":"",children:[E("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[E("div",{className:N?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[s("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{g(e),v(!1),m(!1)},children:s("span",{className:"EnumFacetFilter__previous",children:s(ae,{options:{icon:"arrowBack"}})})}),x.length>0&&s("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var o;w(""),(o=O.current)==null||o.focus()},children:s("span",{className:"EnumFacetFilter__reset",children:s(ae,{options:{icon:"close"}})})}),s("input",{type:"text",placeholder:"Find values",value:x,ref:O,onChange:o=>{l(o)}})]}),!N&&E("div",{className:"EnumFacetFilter__checkAll",children:[s(Ie,{className:"EnumFacetFilter__checkbox",onChange:()=>{i()},checked:b,label:"All",isSelectAll:!0},"select_all"),s("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var o;w(""),v(!0),(o=O.current)==null||o.focus()},children:s("span",{className:"EnumFacetFilter__searchicon",children:s(ae,{options:{icon:"search"}})})})]})]}),E("div",{children:[Q.length>0&&vt(Q,F||d,I).map((o,f)=>s(wt,{id:Nt(o.value),index:f,label:xe(o,K,u),count:o.count,isDropdown:d,initialIsSelected:o.isSelected,onChange:C=>{U[o.value]=C,clearTimeout(V),V=setTimeout(()=>{a(U),S(!1)},$)}},`checkLabel${f}`)),!d&&E(Y,{children:[!F&&Q.length>I&&s("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>m(!0),children:s("div",{className:"EnumFacetFilter__checkboxContainer",children:E("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",Q.length,")"]})})}),F&&Q.length>I&&s("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>m(!1),children:s("div",{className:"EnumFacetFilter__checkboxContainer",children:s("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),Q.length<=0&&s("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),T=()=>S(!h);return d?c==="SelectBox"?E(H,{className:"EnumFacetFilter EnumFacetFilterSelect",show:h,onToggle:T,children:[E(H.Toggle,{className:"secondary-caret",variant:"gray-select",children:[b&&"All",!b&&e.filter(o=>o.isSelected).length===1&&e.filter(o=>o.isSelected)[0].value,!b&&e.filter(o=>o.isSelected).length>1&&"Multiple Values Selected"]}),s(H.Menu,{children:y})]}):E(H,{className:"EnumFacetFilter",show:h,onToggle:T,children:[s(we,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),s(H.Menu,{children:y})]}):E(Y,{children:[s(G,{facetAliases:n,isCollapsed:_,label:t.name,onClick:o=>R(o)}),s(be,{className:"EnumFacetFilter",in:!_,children:y})]})};function wt({id:e,index:t,label:i,count:a,isDropdown:n,initialIsSelected:r,onChange:c}){const[p,F]=D(r);return Le.useEffect(()=>{F(r)},[r]),E("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{n&&(F(!p),c(!p))},children:[s(Ie,{className:"EnumFacetFilter__checkbox",onClick:m=>m.stopPropagation(),onChange:m=>{F(m),c(m)},checked:p,label:i},`${e}-${t}`),n&&E("span",{className:"EnumFacetFilter__count",children:["(",a,")"]}),!n&&s("div",{className:"EnumFacetFilter__count",children:a})]})}try{ee.displayName="EnumFacetFilter",ee.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:ee.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const Qe=window.React.useState,te=e=>{const t="Min value should be less then max value",[i,a]=Qe(!1),[n,r]=Qe(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Fe(e.initialValues.min).format("YYYY-MM-DD"),max:Fe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),c=e.className?`range ${e.className}`:"range",p=({min:m,max:_},R="number")=>{if(m==null||_===null||_===void 0)return a(!1),!0;if(R==="number"){if(Number(m)>Number(_))return a(!0),!1}else if(Date.parse(m)>Date.parse(_))return a(!0),!1;return a(!1),!0},F=(m,_,R="number")=>{p(m,R)&&_(m)};return E("div",{className:c,style:{display:"flex",flexWrap:"wrap"},children:[E("div",{style:{marginRight:"10px"},children:[s("input",{"aria-label":"min",type:e.type,value:n.min,onChange:({target:m})=>r({min:m.value,max:n.max})},"range_min"),s("div",{children:"to"}),s("input",{"aria-label":"max",type:e.type,value:n.max,onChange:({target:m})=>r({min:n.min,max:m.value})},"range_max")]}),s("button",{className:"btn btn-link SRC-noPadding",onClick:()=>F(n,e.onChange,e.type),children:"Apply"}),i&&s("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{te.displayName="Range",te.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:te.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}const Ne=window.React.useState;var ye=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(ye||{});const ne=({facetResult:e,columnModel:t,onChange:i,facetAliases:a,collapsed:n=!1})=>{const[r,c]=Ne(n),p=[{label:he,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:F,columnMax:m,selectedMin:_,selectedMax:R}=e;const h=!_&&!R;_=_||F,R=R||m;const S=t.columnType==="DOUBLE"?"number":"date",N=(g,I)=>I?"":g===fe?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",v=(g,I)=>{w(g),g!=="RANGE"&&I([g,g])},[x,w]=Ne(N(_,h));return E("div",{children:[s(G,{isCollapsed:r,label:t.name,onClick:g=>c(g),facetAliases:a}),E(be,{in:!r,children:[s(ot,{value:x,id:"rangeSelector",options:p,onChange:g=>v(g,i)}),x==="RANGE"&&(F===m?s("label",{children:m}):E(Y,{children:[t.columnType==="INTEGER"&&E(lt,{domain:[F,m],initialValues:{min:_,max:R},step:1,doUpdateOnApply:!0,onChange:g=>i([g.min,g.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&s(te,{initialValues:{min:_,max:R},type:S,onChange:g=>i([g.min,g.max])},"Range")]}))]})]})};try{ne.displayName="RangeFacetFilter",ne.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:ne.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const ke=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected===!0).map(t=>t.value)}),bt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},ge=(e,t)=>{var r,c;const i=(c=(r=t==null?void 0:t.query)==null?void 0:r.selectedFacets)!=null?c:[],a=i.findIndex(p=>p.columnName===e.columnName),n=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return a>-1?n?i.splice(a,1):i[a]=e:i.push(e),i};function Ue(e,t,i,a,n=!1){a?t.facetValues.forEach(p=>{p.value===a&&(p.isSelected=n)}):t.facetValues.forEach(p=>{p.isSelected=!1});const r=ke(t),c=ge(r,e);i(c)}const It=(e,t,i,a)=>{const n=a&&Object.keys(a)||[];n.length&&t.facetValues.forEach(p=>{n.includes(p.value)&&(p.isSelected=a?!!a[p.value]:!1)});const r=ke(t),c=ge(r,e);i(c)},Be=(e,t,i,a)=>{t.columnMin=a[0],t.columnMax=a[1];const n=bt(t),r=ge(n,e);i(r)},pe=({facetsToFilter:e})=>{const{data:t,isLoadingNewBundle:i,getLastQueryRequest:a,executeQueryRequest:n}=Se(),{facetAliases:r,topLevelControlsState:c}=qe();if(!t)return s(Y,{});const{showFacetFilter:p}=c,F=t.selectColumns;let m=t.facets;e&&(m=m.filter(h=>e.includes(h.columnName)));const _=a(),R=h=>{const S=a();S.query.selectedFacets=h,S.query.offset=0,n(S)};return E("div",{className:`QueryFilter ${p?Ve:Ae}`,children:[i&&s("div",{children:"Loading..."}),!i&&m.map((h,S)=>{const N=F.find(x=>x.name===h.columnName),v=S>2;if(!at(h))return E("div",{className:"QueryFilter__facet",children:[h.facetType==="enumeration"&&N&&s(ee,{containerAs:"Collapsible",collapsed:v,facetValues:h.facetValues,columnModel:N,facetAliases:r,onChange:x=>It(_,h,R,x),onClear:()=>Ue(_,h,R)}),h.facetType==="range"&&N&&s(ne,{facetResult:h,columnModel:N,facetAliases:r,collapsed:v,onChange:x=>Be(_,h,R,x)})]},h.columnName)})]})};try{pe.displayName="QueryFilter",pe.__docgenInfo={description:"",displayName:"QueryFilter",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"]={docgenInfo:pe.__docgenInfo,name:"QueryFilter",path:"src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"})}catch{}const qt=window.React.useCallback,Ot=window.React.useEffect,Vt=window.React.useState,At=window.React.createElement,me=({style:e,frontText:t,endText:i="",hideIfUnfiltered:a=!1})=>{var W;const{data:n,isLoadingNewBundle:r,getLastQueryRequest:c,executeQueryRequest:p,getInitQueryRequest:F,error:m}=Se(),{topLevelControlsState:_,unitDescription:R}=qe(),h=n==null?void 0:n.queryCount,[S,N]=Vt([]),v=u=>{const l=L(c());l.query.selectedFacets=u,l.query.offset=0,p(l)},x=u=>u.filter(y=>y.facetType==="enumeration").filter(y=>y.facetValues.filter(T=>T.isSelected===!0).length>0),w=u=>u.filter(y=>y.facetType==="range").filter(y=>y.selectedMax||y.selectedMin),Q=(u,l)=>{var y;const d=u.find(T=>T.id===l);return(y=d==null?void 0:d.name)!=null?y:l},g=(u,l)=>{const d=u.find(y=>y.ownerId===l);return(d==null?void 0:d.userName)||l},I=qt((u,l)=>{const d=dt(),y=pt(),T=[];return u.forEach(o=>{const f=l.find(C=>C.name===o.columnName);o.facetValues.forEach(C=>{if(C.isSelected){let q=C.value;(f==null?void 0:f.columnType)===A.ENTITYID||(f==null?void 0:f.columnType)===A.ENTITYID_LIST?q=Q(d,C.value):((f==null?void 0:f.columnType)===A.USERID||(f==null?void 0:f.columnType)===A.USERID_LIST)&&(q=g(y,C.value)),T.push({facet:o,displayValue:q,selectedValue:C})}})}),T},[]);Ot(()=>{if(n){const u=w(n.facets),l=x(n.facets),d=u.map(T=>({facet:T})),y=I(l,n.columnModels);N([...d,...y])}},[n,I]);const $=u=>{const{facet:l,selectedValue:d}=u;l.facetType==="enumeration"?Ue(c(),l,v,d==null?void 0:d.value,!1):Be(c(),l,v,[ye.ANY,ye.ANY])},O=(u,l)=>{var y;const d=L(c());!d.query.additionalFilters||(d.query.additionalFilters=(y=d.query.additionalFilters)==null?void 0:y.reduce(function(T,o){if(ie(o)||se(o)){const f={columnName:o.columnName,values:o.columnName===u?o.values.filter(C=>C!==l):o.values,operator:ie(o)?o.operator:void 0,function:se(o)?o.function:void 0,concreteType:o.concreteType};f.values.length>0&&T.push(f)}else T.push(o);return T},[]),p(d))},U=u=>{const l=L(c());!l.query.additionalFilters||(l.query.additionalFilters=l.query.additionalFilters.filter(d=>!(Re(d)&&d.searchExpression===u.searchExpression)),p(l))},V=()=>{const u=L(F());u.query.additionalFilters=[],p(u)},b=(W=c().query.additionalFilters)==null?void 0:W.reduce((u,l)=>{if(Re(l))u.push({key:`fulltextsearch-${l.searchExpression}`,filter:{value:l.searchExpression},onRemove:()=>U(l)});else if(ie(l)||se(l)){const{columnName:d}=l;l.values.forEach(y=>{u.push({key:`columnsearch-${y}`,filter:{columnName:d,value:y},onRemove:()=>O(l.columnName,y)})})}else console.warn("Encountered unexpected QueryFilter: ",l);return u},[]),B=_==null?void 0:_.showFacetFilter,K=S.length>0||b&&b.length>0;return m?s(Y,{}):s("div",{className:`TotalQueryResults ${B?Ve:Ae}`,style:e,children:r?s(X,{width:100}):E(Y,{children:[(K||!a)&&E("span",{className:"SRC-boldText SRC-centerContent",children:[t," ",h==null?void 0:h.toLocaleString()," ",R," ",i]}),E("div",{className:"TotalQueryResults__selections",children:[b&&b.map(u=>At(M,{...u,key:u.key})),S.map((u,l)=>{var d,y,T;return s(M,{facetWithSelection:u,onRemove:()=>$(u)},`facets-${(T=(y=(d=u.selectedValue)==null?void 0:d.value)!=null?y:u.displayValue)!=null?T:l}`)}),(S.length>2||b&&b.length>2)&&s(ct,{onClick:V,variant:"light",className:"TotalQueryResults__clearall",children:"Clear All"})]})]})})};try{me.displayName="TotalQueryResults",me.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:{value:"false"},description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:me.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}export{yt as C,ee as E,j as Q,X as S,me as T,Ft as a,ue as b,re as c,Se as d,qe as e,de as f,Rt as g,It as h,Ue as i,Ve as j,Ae as k,ce as l,pe as m,ie as n,se as o,mt as p,an as q,rn as u};

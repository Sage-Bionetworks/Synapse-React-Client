import{w as R,aJ as C,cp as S,c5 as k}from"./index.c2aad7f2.js";import{g as q,B as O}from"./getEndpoint.0de7fccf.js";import{d as E}from"./useGetAccessRequirement.2b65aa0a.js";import{u as N}from"./useEntityBundle.e0bb0495.js";import{i as x}from"./TypeUtils.a2c41307.js";import"./assert.9b9a314c.js";import{R as I,a as F,A as D,c as L}from"./AccessRequirementList.fd724d3d.js";import{I as V}from"./IconSvg.3d20df6f.js";import{j as t,F as p,a as w}from"./jsx-runtime.2e925369.js";const B="org.sagebionetworks.repo.model.FileEntity",v=x(B),u=window.React,Y={AccessBlockedToAnonymous:{icon:"accessClosed",color:e=>e.colors.warning,tooltipText:"You must sign in to access this file."},AccessBlockedByRestriction:{icon:"accessClosed",color:e=>e.colors.warning,tooltipText:"You must request access to this restricted file."},AccessBlockedByACL:{icon:"accessClosed",color:e=>e.colors.warning,tooltipText:"You do not have download access for this item."},Accessible:{icon:"accessOpen",color:e=>e.colors.success,tooltipText:""},NoFileHandle:{icon:"accessOpen",color:e=>e.colors.success,tooltipText:""}};function _(e){const{downloadType:n}=e;if(n){const c=Y[n];return t(S.Consumer,{children:i=>t(V,{options:{icon:c.icon,color:c.color(i),label:c.tooltipText}})})}return t(p,{})}function y(e,n){const[c,i]=u.useState(),{accessToken:f}=R(),{data:o,error:T}=N(e,{includeEntity:!0,includePermissions:!0},parseInt(n!=null?n:"")),r=u.useMemo(()=>({restrictableObjectType:I.ENTITY,objectId:e}),[e]),{data:m}=E(r),l=o==null?void 0:o.entity,s=o==null?void 0:o.permissions;return u.useEffect(()=>{m&&m.hasUnmetAccessRequirement?i("AccessBlockedByRestriction"):l&&(s==null?void 0:s.canDownload)?v(l)&&l.dataFileHandleId?i("Accessible"):i("NoFileHandle"):s&&!s.canDownload&&i(f?"AccessBlockedByACL":"AccessBlockedToAnonymous")},[f,l,T,s,m]),c}function h(e){const[n,c]=u.useState(!1),[i,f]=u.useState([]),{entityId:o,entityVersionNumber:T}=e,r=y(o,T),{accessToken:m}=R(),l=u.useMemo(()=>({restrictableObjectType:I.ENTITY,objectId:o}),[o]),{data:s}=E(l),b=()=>{const{entityId:a}=e;k(m,a).then(d=>{L(d)?window.open(`${q(O.PORTAL_ENDPOINT)}#!AccessRequirements:ID=${a}&TYPE=ENTITY`,"_blank"):(f(d),c(!0))})},g=()=>{const{entityId:a}=e;if(!s)return t(p,{});const d=s==null?void 0:s.hasUnmetAccessRequirement,H=s==null?void 0:s.restrictionLevel;let A="";if(d)A="Request Access";else{if(F.OPEN===H)return t(p,{});A="View Terms"}return w(p,{children:[t("a",{style:{fontSize:"14px",cursor:"pointer",marginLeft:"5px",verticalAlign:"middle"},className:e.className,onClick:b,children:A}),n&&t(D,{entityId:a,accessRequirementFromProps:i,renderAsModal:!0,onHide:()=>{c(!1)}})]})};return r===void 0?t(p,{}):w("span",{style:{whiteSpace:"nowrap"},children:[r==="AccessBlockedToAnonymous"?t("button",{type:"button",className:C,onClick:a=>{if(a.isTrusted){const d=new MouseEvent("click",{bubbles:!0});a.currentTarget.dispatchEvent(d)}},children:t(_,{downloadType:r})}):t(_,{downloadType:r}),t(g,{})]})}try{y.displayName="useGetFileHandleDownloadType",y.__docgenInfo={description:`Determines whether an Entity is accessible for download, or if it is blocked by the ACL or unmet Access Requirements.

To make download available, and determine if the file is downloadable via the web, see {@link DirectDownload.tsx }`,displayName:"useGetFileHandleDownloadType",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/HasAccessV2.tsx#useGetFileHandleDownloadType"]={docgenInfo:y.__docgenInfo,name:"useGetFileHandleDownloadType",path:"src/lib/containers/HasAccessV2.tsx#useGetFileHandleDownloadType"})}catch{}try{h.displayName="HasAccessV2",h.__docgenInfo={description:`HasAccess shows if the user has access to the file or not.

The component's behavior changes whether it's passed in a FileHandle or not.
If passed a file handle then it will give more detailed information about the download.`,displayName:"HasAccessV2",props:{onHide:{defaultValue:null,description:"",name:"onHide",required:!1,type:{name:"(() => void)"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},entityVersionNumber:{defaultValue:null,description:"",name:"entityVersionNumber",required:!1,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/HasAccessV2.tsx#HasAccessV2"]={docgenInfo:h.__docgenInfo,name:"HasAccessV2",path:"src/lib/containers/HasAccessV2.tsx#HasAccessV2"})}catch{}export{h as H};
//# sourceMappingURL=HasAccessV2.a71c6982.js.map

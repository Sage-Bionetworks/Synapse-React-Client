import{u as ce}from"./useGetInfoFromIds.617f3767.js";import{D as ne,O as P,M as H,G as ue,F as me,o as pe}from"./index.05abe325.js";import{C as ye}from"./ColumnType.744125d2.js";import"./assert.c27a8558.js";import{g as B,G as fe}from"./GenericCard.0c7f20e6.js";import{l as Ce}from"./LoadingScreen.e3fe6e43.js";import{u as he,T as ge,g as _e,b as Re,c as Se}from"./TotalQueryResults.3b69f5d9.js";import{c as be}from"./calculateFriendlyFileSize.9c20c573.js";import{I as ve,C as Oe,a as Le,S as Ne}from"./index.6f0fba5e.js";import{P as j}from"./getEndpoint.0de7fccf.js";import{a as m,j as e,F as qe}from"./jsx-runtime.2e925369.js";import{B as $}from"./Button.c582ea4c.js";import{U as we}from"./UserCard.0e7f72e7.js";import{I as te}from"./IconSvg.3d20df6f.js";import{h as Ie}from"./moment.53181859.js";import{S as xe}from"./SkeletonTable.b956c12d.js";import{S as Z}from"./Skeleton.8dd0668e.js";import{S as Ae,N as Ee}from"./SearchResultsNotFound.263a233e.js";import{U as Te}from"./UserCardList.e8616161.js";import{u as ke}from"./use-deep-compare-effect.esm.9d3fc03b.js";import{u as Ve,i as Qe}from"./queryUtils.df9babdd.js";import{a as De}from"./sqlFunctions.b49ac766.js";import{c as x}from"./cloneDeep.1251cc82.js";const Fe=window.React;class v extends Fe.Component{constructor(t){super(t),this.handleLinkClick=a=>i=>{i.preventDefault(),window.open(`${j.PORTAL}#!Synapse:${a}`,"_blank")},this.handleLinkClick=this.handleLinkClick.bind(this)}render(){const{data:t,schema:a,selectColumns:i,columnModels:o}=this.props,p=t[a.datasetName],c=t[a.summary],u=B({columnName:"tumorType",value:t[a.tumorType],selectColumns:i,columnModels:o}).str,r=B({columnName:"diseaseFocus",value:t[a.diseaseFocus],selectColumns:i,columnModels:o}).str,s=t[a.id],_=t[a.fundingAgency],C=t[a.fileCount],b=be(t[a.fileSize]),L=[["FUNDER",B({columnName:"fundingAgency",value:_,selectColumns:i,columnModels:o}).str],["SIZE",b],["FILES",C]];return m("div",{className:"SRC-portalCard SRC-typeDataset  ",children:[m("div",{className:"SRC-cardThumbnail",children:[e(ve,{type:ne}),e("div",{children:b})]}),m("div",{className:"SRC-cardContent SRC-dataset",children:[e("div",{className:"SRC-type",children:"Dataset "}),e("div",{children:e("h3",{children:e("a",{target:"_self",href:`${j.PORTAL}#!Synapse:${s}`,children:p})})}),m("div",{className:"SRC-description-dataset",children:[e("p",{className:"SRC-description-text",children:c}),e("div",{className:"SRC-cardAction bootstrap-4-backport",children:e($,{className:"pill SRC-datasetButton",onClick:this.handleLinkClick(s),variant:"secondary",children:"Download Dataset"})})]}),e("div",{className:"SRC-cardAnnotations",children:e(Oe,{chips:[u,r]})})]}),e(Le,{isHeader:!1,secondaryLabelLimit:this.props.secondaryLabelLimit,values:L})]})}}try{v.displayName="Dataset",v.__docgenInfo={description:"",displayName:"Dataset",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"any"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"any"}},secondaryLabelLimit:{defaultValue:null,description:"",name:"secondaryLabelLimit",required:!1,type:{name:"number"}},selectColumns:{defaultValue:null,description:"",name:"selectColumns",required:!1,type:{name:"SelectColumn[]"}},columnModels:{defaultValue:null,description:"",name:"columnModels",required:!1,type:{name:"ColumnModel[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/Dataset.tsx#Dataset"]={docgenInfo:v.__docgenInfo,name:"Dataset",path:"src/lib/containers/row_renderers/Dataset.tsx#Dataset"})}catch{}const Pe=window.React;class A extends Pe.Component{constructor(t){super(t),this.handleLinkClick=a=>i=>{i.preventDefault(),window.open(a,"_blank")},this.handleLinkClick=this.handleLinkClick.bind(this)}render(){const{data:t,schema:a}=this.props,i=t[a.organizationName],o=t[a.organizationPath],p=t[a.summary],c=t[a.website],u=t[a.logo];let r=c.replace("https://","");r=r.replace("http://",""),r.charAt(r.length-1)==="/"&&(r=r.substring(0,r.length-1));const s=window.location.hash.substring(1)===o,_={};let C;return s?_.paddingBottom="42px":C=e("div",{className:"SRC-marginAuto SRC-cardAction bootstrap-4-backport",children:e($,{className:"pill-xl",href:o,variant:"secondary",children:"View Funded Research"})}),m("div",{className:"SRC-portalCard SRC-typeFunder ",style:_,children:[m("div",{className:"SRC-cardContent",children:[e("div",{className:"SRC-type",children:"Organization"}),u&&e("div",{className:"SRC-cardThumbnail",children:e("img",{alt:"funder logo",className:"SRC-logo",src:u})}),e("div",{children:m("h3",{children:[s&&i,!s&&e("a",{href:o,children:i})]})}),e("div",{className:"SRC-website",children:e("a",{rel:"noopener noreferrer",target:"_blank",href:c,children:r})}),e("div",{className:"SRC-description",children:p})]}),C]})}}try{A.displayName="Funder",A.__docgenInfo={description:"",displayName:"Funder",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"any"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/Funder.tsx#Funder"]={docgenInfo:A.__docgenInfo,name:"Funder",path:"src/lib/containers/row_renderers/Funder.tsx#Funder"})}catch{}try{v.displayName="Dataset",v.__docgenInfo={description:"",displayName:"Dataset",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"any"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"any"}},secondaryLabelLimit:{defaultValue:null,description:"",name:"secondaryLabelLimit",required:!1,type:{name:"number"}},selectColumns:{defaultValue:null,description:"",name:"selectColumns",required:!1,type:{name:"SelectColumn[]"}},columnModels:{defaultValue:null,description:"",name:"columnModels",required:!1,type:{name:"ColumnModel[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/index.tsx#Dataset"]={docgenInfo:v.__docgenInfo,name:"Dataset",path:"src/lib/containers/row_renderers/index.tsx#Dataset"})}catch{}try{rowrenderers.displayName="rowrenderers",rowrenderers.__docgenInfo={description:"",displayName:"rowrenderers",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"any"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/index.tsx#rowrenderers"]={docgenInfo:rowrenderers.__docgenInfo,name:"rowrenderers",path:"src/lib/containers/row_renderers/index.tsx#rowrenderers"})}catch{}const O=(n,t)=>n>0?`${n} ${t}${n>1?"s":""} `:"",Be=(n,t)=>{const a=Ie.duration(n,t),i=a.years(),o=a.months()%12,p=a.days()%31,c=a.hours()%24,u=a.minutes()%60,r=a.seconds()%60;return`${O(i,"year")}${O(o,"month")}${O(p,"day")}${O(c,"hour")}${O(u,"minute")}${O(r,"second")}`.trim()},E=({data:n,schema:t})=>{const a=n[t.submitterName],i=n[t.submitterUserId],o=n[t.time],p=n[t.timeUnits],c=n[t.text],u=n[t.tag];return m("div",{className:"SRC-portalCard ObservationCard",children:[m("div",{className:"ObservationCard__submitter",children:[!i&&e("div",{children:a}),i&&e(we,{size:"SMALL USER CARD",ownerId:i})]}),o&&m("div",{className:"ObservationCard__time",children:[e(te,{options:{icon:"time"}}),e("span",{children:Be(o,p)})]}),e("div",{className:"ObservationCard__text",children:e(Ne,{summary:c})}),e("div",{className:"ObservationCard__tags",children:u&&e("span",{className:"SRC-tag",children:u})})]})},T=()=>m("div",{className:"SRC-portalCard ObservationCard",children:[e("div",{className:"ObservationCard__submitter",children:e("span",{children:e(Z,{width:"100px"})})}),e("div",{className:"ObservationCard__time",children:e(te,{options:{icon:"time"}})}),e("div",{className:"ObservationCard__text",children:e(xe,{numCols:1,numRows:4})}),e("div",{className:"ObservationCard__tags",children:e(Z,{width:"80px"})})]});try{E.displayName="ObservationCard",E.__docgenInfo={description:`Specialized Observation Card, initially implemented for the NF portal.
Expects the following columns: submitterName, submitterUserId, time, timeUnits, text, and tag.`,displayName:"ObservationCard",props:{schema:{defaultValue:null,description:"",name:"schema",required:!0,type:{name:"ObservationCardSchema"}},data:{defaultValue:null,description:"",name:"data",required:!0,type:{name:"Record<string, string>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/ObservationCard.tsx#ObservationCard"]={docgenInfo:E.__docgenInfo,name:"ObservationCard",path:"src/lib/containers/row_renderers/ObservationCard.tsx#ObservationCard"})}catch{}try{T.displayName="LoadingObservationCard",T.__docgenInfo={description:"",displayName:"LoadingObservationCard",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/row_renderers/ObservationCard.tsx#LoadingObservationCard"]={docgenInfo:T.__docgenInfo,name:"LoadingObservationCard",path:"src/lib/containers/row_renderers/ObservationCard.tsx#LoadingObservationCard"})}catch{}const M=n=>{const{isHeader:t=!1,unitDescription:a,type:i,isLoading:o,secondaryLabelLimit:p=3,title:c,...u}=n,r=he(),{data:s,getLastQueryRequest:_,appendNextPageToResults:C,hasNextPage:b}=r,L=_(),k=(d,l)=>{switch(l){case ne:return e(v,{...d});case me:return e(A,{...d});case ue:return e(fe,{...d,queryContext:r});case P:return e(E,{...d});default:return e("div",{},d.key)}},V=s!=null&&s.queryResult.queryResults.tableId?[s==null?void 0:s.queryResult.queryResults.tableId]:[],w=ce({ids:V,type:"ENTITY_HEADER"});if(s){if(s&&s.queryResult.queryResults.rows.length===0)return L.query.additionalFilters?e(Ae,{}):e(Ee,{})}else return m("div",{children:[o&&i===P&&e(T,{}),o&&i!==P&&Ce]});const N={};s.queryResult.queryResults.headers.forEach((d,l)=>{N[d.name]=l});const Q=b&&e("div",{className:"SRC-viewMore bootstrap-4-backport",children:e($,{variant:"secondary",className:"pill-xl",onClick:()=>{C()},children:"View More"})});let q;if(i===H){const d=s.queryResult.queryResults.headers.findIndex(h=>h.columnType===ye.USERID);if(d===-1)throw Error("Type MEDIUM_USER_CARD specified but no columnType USERID found");const l=s.queryResult.queryResults.rows.map(h=>h.values[d]);q=e(Te,{data:s,list:l,size:H})}else{const d=s.queryResult.queryResults.rows;q=d.length?d.map(l=>{const D={key:JSON.stringify(l.values),type:i,schema:N,isHeader:t,secondaryLabelLimit:p,data:l.values,selectColumns:s.selectColumns,columnModels:s.columnModels,tableEntityConcreteType:w[0]&&w[0].type,tableId:s==null?void 0:s.queryResult.queryResults.tableId,...u};return k(D,i)}):e(qe,{})}return m("div",{role:"list",children:[c&&e("h2",{className:"SRC-card-overview-title",children:c}),!c&&a&&e(ge,{frontText:"Displaying"}),q,Q]})};try{M.displayName="CardContainer",M.__docgenInfo={description:"",displayName:"CardContainer",props:{isHeader:{defaultValue:null,description:"",name:"isHeader",required:!1,type:{name:"boolean"}},isAlignToLeftNav:{defaultValue:null,description:"",name:"isAlignToLeftNav",required:!1,type:{name:"boolean"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!1,type:{name:"boolean"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"string"}},hasInternalLink:{defaultValue:null,description:"",name:"hasInternalLink",required:!1,type:{name:"boolean"}},iconOptions:{defaultValue:null,description:"",name:"iconOptions",required:!1,type:{name:"IconOptions"}},genericCardSchema:{defaultValue:null,description:"",name:"genericCardSchema",required:!1,type:{name:"GenericCardSchema"}},secondaryLabelLimit:{defaultValue:null,description:"",name:"secondaryLabelLimit",required:!1,type:{name:"number"}},titleLinkConfig:{defaultValue:null,description:"",name:"titleLinkConfig",required:!1,type:{name:"CardLink"}},ctaLinkConfig:{defaultValue:null,description:"",name:"ctaLinkConfig",required:!1,type:{name:"CTACardLink"}},labelLinkConfig:{defaultValue:null,description:"",name:"labelLinkConfig",required:!1,type:{name:"LabelLinkConfig"}},descriptionConfig:{defaultValue:null,description:"",name:"descriptionConfig",required:!1,type:{name:"DescriptionConfig"}},rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},columnIconOptions:{defaultValue:null,description:"",name:"columnIconOptions",required:!1,type:{name:"ColumnIconConfigs"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/CardContainer.tsx#CardContainer"]={docgenInfo:M.__docgenInfo,name:"CardContainer",path:"src/lib/containers/CardContainer.tsx#CardContainer"})}catch{}const Me=window.React,X=window.React.useEffect,ee=window.React.useMemo,U=window.React.useState;function Y(n){var G,J;const{initQueryRequest:t,onQueryChange:a,onQueryResultBundleChange:i}=n,[o,p]=U(t),[c,u]=U(void 0),{data:r,hasNextPage:s,fetchPreviousPage:_,fetchNextPage:C,isFetchingNextPage:b,isLoading:L,error:k,isPreviousData:V,remove:w}=Ve(o,{keepPreviousData:!0},u),N=L||V,{entityId:Q,versionNumber:q}=De(o.query.sql),{data:d}=pe(Q,q),[l,h]=U(0);async function D(){if(!s)throw new Error("Called appendNextPageToResults when there is no next page");await C(),h("ALL")}async function ae(){if(!s)throw new Error("Called goToNextPage when there is no next page");if(l==="ALL")throw new Error("Cannot go to next page when all pages are displayed");await C(),h(l+1)}const K=l!=="ALL"&&l>0;async function re(){if(l==="ALL")throw new Error("Cannot go to previous page when all pages are displayed");if(!K)throw new Error("Called goToNextPage when there is no next page");await _(),h(l-1)}const y=ee(()=>{var f,g,R,S;if(!(r==null||r.pages.length===0||r.pages[0].responseBody==null))return l==="ALL"?{...r==null?void 0:r.pages[0].responseBody,queryResult:{...(f=r==null?void 0:r.pages[0].responseBody)==null?void 0:f.queryResult,queryResults:{...(R=(g=r==null?void 0:r.pages[0].responseBody)==null?void 0:g.queryResult)==null?void 0:R.queryResults,rows:(S=r.pages.flatMap(F=>{var I;return(I=F.responseBody.queryResult)==null?void 0:I.queryResults.rows}))!=null?S:[]}}}:r==null?void 0:r.pages[l].responseBody},[l,r]);ke(()=>{a&&a(JSON.stringify(o.query))},[a,o.query]),X(()=>{y&&i&&i(JSON.stringify(y))},[y,i]);const W=(G=n.componentIndex)!=null?G:0,z=y?Qe(y.facets,y.selectColumns):!0;X(()=>{const f=_e("QueryWrapper",W);f&&p(f)},[]);const se=Me.useCallback(()=>x(o),[o]);function ie(){return x(n.initQueryRequest)}function oe(f){const g=x(f);if(p(g),h(0),g.query){const R=JSON.stringify(g.query),S=encodeURIComponent(R);n.shouldDeepLink&&(n.onQueryChange?n.onQueryChange(R):Se("QueryWrapper",W,S))}w()}const le={data:ee(()=>{var g,R;const f=(g=n.lockedFacet)==null?void 0:g.facet;if(f&&y){const S=x(y),F=(R=S.facets)==null?void 0:R.filter(I=>I.columnName.toLowerCase()!==f.toLowerCase());return S.facets=F,S}else return y},[y,(J=n.lockedFacet)==null?void 0:J.facet]),isLoadingNewPage:b,hasNextPage:!!s,hasPreviousPage:!!K,isLoadingNewBundle:N,getLastQueryRequest:se,getInitQueryRequest:ie,error:k,entity:d,executeQueryRequest:oe,isFacetsAvailable:z,asyncJobStatus:c,appendNextPageToResults:D,goToNextPage:ae,goToPreviousPage:re},{children:de}=n;return e(Re,{queryContext:le,children:e("div",{className:`SRC-wrapper ${N||b?"SRC-logo-cursor":""} ${z?"has-facets":""}`,children:de})})}try{Y.displayName="InfiniteQueryWrapper",Y.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"InfiniteQueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedFacet:{defaultValue:null,description:"",name:"lockedFacet",required:!1,type:{name:"LockedFacet"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/InfiniteQueryWrapper.tsx#InfiniteQueryWrapper"]={docgenInfo:Y.__docgenInfo,name:"InfiniteQueryWrapper",path:"src/lib/containers/InfiniteQueryWrapper.tsx#InfiniteQueryWrapper"})}catch{}export{M as C,Y as I};
//# sourceMappingURL=InfiniteQueryWrapper.d5d9057a.js.map

import{j as p,a as O,F as H}from"./jsx-runtime.2e925369.js";import{S as Ot}from"./Skeleton.8dd0668e.js";import{q as bt,r as It,k as Nt,l as xt,h as Vt,B as At,s as kt,p as Qt,t as qt,V as Me,v as He}from"./index.4dca6b75.js";import{C as P}from"./ColumnType.744125d2.js";import"./assert.f4f45be2.js";import{i as Ue}from"./TypeUtils.a2c41307.js";import{a as Dt,u as dt,b as Lt}from"./use-deep-compare-effect.esm.76673280.js";import{p as Pt,a as Mt}from"./sqlFunctions.b49ac766.js";import{i as Ht,a as Ut}from"./queryUtils.c5c5b28e.js";import{c as M}from"./cloneDeep.81de84c9.js";import{u as de}from"./unCamelCase.d070537b.js";import{E as pt}from"./ElementWithTooltip.5b1c9332.js";import{C as $t,a as mt}from"./Collapse.fe074047.js";import{u as ze}from"./useGetInfoFromIds.6134a39b.js";import{I as Re}from"./IconSvg.c485205d.js";import{C as ft}from"./Checkbox.85bb9cd4.js";import{I as Bt,a as Yt}from"./IconMinus.f135ad99.js";import{D as te}from"./Dropdown.c29f5884.js";import{R as zt}from"./RadioGroup.16868f96.js";import{h as We}from"./moment.53181859.js";import{_ as De}from"./Tooltip.6c95fe7b.js";import{_ as K}from"./classCallCheck.8304ed06.js";import{i as Wt,a as V,j as Z}from"./withStyles.8be28b48.js";import{_ as se}from"./inherits.98d6a15d.js";import{b as A,_ as Ke}from"./toConsumableArray.b3669986.js";import{B as Kt}from"./Button.c582ea4c.js";function le(e,n){if(n&&(Wt(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return V(e)}function W(e){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},W(e)}const jt=window.React.createContext,$e=window.React.useContext,U=jt(void 0),pe=({children:e,queryContext:n})=>p(U.Provider,{value:n,children:e});function Be(){const e=$e(U);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function ga(){const e=$e(U);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function Sa(){const e=$e(U);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const we=U.Consumer;try{U.displayName="QueryContext",U.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:U.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{pe.displayName="QueryContextProvider",pe.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:pe.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{we.displayName="QueryContextConsumer",we.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:we.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}const me=e=>p(Ot,{style:{...e.style,display:"inline-block"},...e});try{me.displayName="SkeletonInlineBlock",me.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:me.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const Gt=()=>{try{return JSON.parse(sessionStorage.getItem(bt)||"")}catch{return[]}},Xt=()=>{try{return JSON.parse(sessionStorage.getItem(It)||"")}catch{return[]}};var Jt=(e=>(e.LIKE="LIKE",e))(Jt||{}),Zt=(e=>(e.HAS="HAS",e.HAS_LIKE="HAS_LIKE",e))(Zt||{});const en="org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",tn="org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",nn="org.sagebionetworks.repo.model.table.TextMatchesQueryFilter",je=Ue(nn),Fe=Ue(en),Oe=Ue(tn),an=window.React.createContext,rn=window.React.useContext,be=window.React.useEffect,Ie=window.React.useState,J=an(void 0),fe=({children:e,queryVisualizationContext:n})=>p(J.Provider,{value:n,children:e});function ht(){const e=rn(J);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const Ne=J.Consumer;function xe(e){var y,S;const{data:n,getLastQueryRequest:a,isFacetsAvailable:t,isLoadingNewBundle:r}=Be(),[i,s]=Ie({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(y=e.defaultShowFacetVisualization)!=null?y:!0,showSearchBar:(S=e.defaultShowSearchBar)!=null?S:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});be(()=>{t||s(g=>({...g,showFacetFilter:!1,showFacetVisualization:!1}))},[t]),be(()=>{r&&d([])},[r]);const[o,l]=Ie([]),[u,d]=Ie([]),h=a(),m=Dt(n==null?void 0:n.selectColumns);be(()=>{var g,R;l((R=m==null?void 0:m.slice(0,(g=e.visibleColumnCount)!=null?g:1/0).map(C=>C.name))!=null?R:[])},[m,h.query.sql,e.visibleColumnCount]);const c={topLevelControlsState:i,setTopLevelControlsState:s,columnsToShowInTable:o,setColumnsToShowInTable:l,selectedRowIndices:u,setSelectedRowIndices:d,facetAliases:e.facetAliases,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn},{children:f}=e;return p(fe,{queryVisualizationContext:c,children:f})}try{xe.displayName="QueryVisualizationWrapper",xe.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:xe.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{J.displayName="QueryVisualizationContext",J.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:J.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{fe.displayName="QueryVisualizationContextProvider",fe.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:fe.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{Ne.displayName="QueryVisualizationContextConsumer",Ne.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:Ne.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}function yt(e,n){return`${e}${n}`}function on(e,n){const a=window.location.search,t=`${e}=${n}`;return a?a.includes(`${e}=`)?window.location.search.slice(a.indexOf("?")+1).split("&").map(s=>s.split("=")[0]===e?`${t}`:s).join("&"):`${a.substr(1)}&${t}`:t}function sn(e,n){if(!window.location.search)return;const a=yt(e,n),r=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(i=>i.split("=")[0]===a).map(i=>i.split("=")[1])[0];return r?decodeURIComponent(r):void 0}function ln(e,n,a){const t=n!==void 0?yt(e,n):e,r=on(t,a),i=window.location,s=`${i.protocol}//${i.hostname}${i.port?":"+i.port:""}${i.pathname}?${r}`;window.history.replaceState("object or string","Title",s)}function un(e,n){const a=sn(e,n);let t;if(a){const r=JSON.parse(a);r.sql&&(t={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:Nt|xt|Vt|At,entityId:Pt(r.sql),query:r})}return t}const cn=window.React,dn=window.React.useEffect,pn=window.React.useMemo,Ge=window.React.useState,vt="isShowingFacetFilters",gt="isHidingFacetFilters";function Ve(e){var E,w,x,v;const{initQueryRequest:n,onQueryChange:a,onQueryResultBundleChange:t}=e,[r,i]=Ge(n),[s,o]=Ge(void 0),{data:l,isLoading:u,error:d,isPreviousData:h,remove:m}=kt(r,{keepPreviousData:!0},o),c=l==null?void 0:l.responseBody,f=u||h,{entityId:y,versionNumber:S}=Mt(r.query.sql),{data:g}=Qt(y,S),R=(E=r.query.limit)!=null?E:qt,C=Math.ceil((((w=r.query.offset)!=null?w:0)+Number(R))/R),I=F=>{const b=k();b.query.limit=F,$(b)},q=F=>{const b=k();b.query.offset=(F-1)*R,$(b)};dt(()=>{a&&a(JSON.stringify(r.query))},[a,r.query]),Lt(()=>{c&&t&&t(JSON.stringify(c))},[c,t]);const Q=(x=e.componentIndex)!=null?x:0,D=c?Ht(c.facets,c.selectColumns):!0;dn(()=>{const F=un("QueryWrapper",Q);F&&i(F)},[]);const k=cn.useCallback(()=>M(r),[r]);function N(){return M(e.initQueryRequest)}function $(F){const b=M(F);if(i(b),b.query){const L=JSON.stringify(b.query),X=encodeURIComponent(L);e.shouldDeepLink&&(e.onQueryChange?e.onQueryChange(L):ln("QueryWrapper",Q,X))}m()}const G={data:pn(()=>{var b,L;const F=(b=e.lockedFacet)==null?void 0:b.facet;if(F&&c){const X=M(c),wt=(L=X.facets)==null?void 0:L.filter(Ft=>Ft.columnName.toLowerCase()!==F.toLowerCase());return X.facets=wt,X}else return c},[c,(v=e.lockedFacet)==null?void 0:v.facet]),currentPage:C,pageSize:R,setPageSize:I,isLoadingNewBundle:f,getLastQueryRequest:k,getInitQueryRequest:N,error:d,entity:g,executeQueryRequest:$,isFacetsAvailable:D,asyncJobStatus:s,goToPage:q},{children:T}=e;return p(pe,{queryContext:G,children:p("div",{className:`SRC-wrapper ${f?"SRC-logo-cursor":""} ${D?"has-facets":""}`,children:T})})}try{Ve.displayName="QueryWrapper",Ve.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedFacet:{defaultValue:null,description:"",name:"lockedFacet",required:!1,type:{name:"LockedFacet"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:Ve.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}const re=e=>{let n,a="";if("facetWithSelection"in e){const{facetWithSelection:r}=e;r.facet.facetType==="enumeration"?n=r.displayValue===Me?He:r.displayValue:n=`${r.facet.selectedMin} 
        - ${r.facet.selectedMax}`,a=`${de(r.facet.columnName)}: ${n}`}else if("filter"in e){const{filter:r}=e;let i=r.value;(i==null?void 0:i.startsWith("%"))&&(i==null?void 0:i.endsWith("%"))&&(i=i.substring(1,i.length-1)),n=i,a=`Text matches: "${i}"`,r.columnName&&(n=`"${i}" in ${de(r==null?void 0:r.columnName)}`,a=`${de(r==null?void 0:r.columnName)}: ${i}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const t=encodeURIComponent(a);return p(pt,{idForToolTip:`selectionCriteria_${t}`,tooltipText:a,callbackFn:()=>{},children:O("label",{className:"SelectionCriteriaPill",children:[p("span",{children:n}),p("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:p($t,{})})]},`SelectionCriteriaPill ${t}`)})};try{re.displayName="SelectionCriteriaPill",re.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:re.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const ie=({label:e,isCollapsed:n,onClick:a,facetAliases:t})=>O("div",{className:"FacetFilterHeader",children:[p("label",{className:"FacetFilterHeader__label",children:de(e,t)}),p("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>a(!n),children:n?p(Bt,{className:"icon-plus",title:"Expand Menu"}):p(Yt,{className:"icon-minus",title:"Collapse Menu"})})]});try{ie.displayName="FacetFilterHeader",ie.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"Function"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!0,type:{name:"{} | undefined"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:ie.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}const St=window.React,B=window.React.useState;function mn(e){return e.replace(/\s/g,"").toLowerCase()}function Xe(e,n=[],a=[]){const{value:t}=e;let r=t;t===Me&&(r=He);const i=n.find(o=>o.ownerId===t);i&&(r=i?i.userName:`unknown (${t})`);const s=a.find(o=>o.id===t);return s&&(r=s?s.name:`unknown (${t})`),`${r}`}function fn(e,n,a){const t=[...e.sort((r,i)=>i.count-r.count)];return n||t.length<=a||t.slice(a).find(r=>r.isSelected)?t:t.splice(0,a)}const he=({facetValues:e,columnModel:n,onClear:a,onChange:t,facetAliases:r,containerAs:i="Collapsible",dropdownType:s="Icon",collapsed:o=!1})=>{const[l,u]=B(!1),[d,h]=B(o),[m,c]=B(!1),[f,y]=B(!1),[S,g]=B(""),[R,C]=B(e);dt(()=>{C(e)},[e]);const I=5,q=1500,Q=St.createRef(),D={};let k;const N=e.filter(v=>v.isSelected).length===0,$=(n==null?void 0:n.columnType)===P.USERID||(n==null?void 0:n.columnType)===P.USERID_LIST?e.map(v=>v.value):[],ee=ze({ids:$,type:"USER_PROFILE"}),G=(n==null?void 0:n.columnType)===P.ENTITYID||(n==null?void 0:n.columnType)===P.ENTITYID_LIST?e.map(v=>v.value):[],T=ze({ids:G,type:"ENTITY_HEADER"}),_=v=>{const F=v.target.value;if(g(F),u(!0),!F)e.forEach(b=>{b.isSelected=!1}),C(e);else{const b=e.filter(L=>Xe(L,ee,T).toLowerCase().indexOf(F.trim().toLowerCase())>-1?L:null);C(b)}};if(!n)return p(H,{});const E=i==="Dropdown",w=O("div",{className:E?"EnumFacetFilter__dropdown_menu":"",children:[O("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[O("div",{className:f?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[p("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{C(e),y(!1),u(!1)},children:p("span",{className:"EnumFacetFilter__previous",children:p(Re,{options:{icon:"arrowBack"}})})}),S.length>0&&p("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var v;g(""),(v=Q.current)==null||v.focus()},children:p("span",{className:"EnumFacetFilter__reset",children:p(Re,{options:{icon:"close"}})})}),p("input",{type:"text",placeholder:"Find values",value:S,ref:Q,onChange:v=>{_(v)}})]}),!f&&O("div",{className:"EnumFacetFilter__checkAll",children:[p(ft,{className:"EnumFacetFilter__checkbox",onChange:()=>{a()},checked:N,label:"All",isSelectAll:!0},"select_all"),p("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var v;g(""),y(!0),(v=Q.current)==null||v.focus()},children:p("span",{className:"EnumFacetFilter__searchicon",children:p(Re,{options:{icon:"search"}})})})]})]}),O("div",{children:[R.length>0&&fn(R,l||E,I).map((v,F)=>p(hn,{id:mn(v.value),index:F,label:Xe(v,ee,T),count:v.count,isDropdown:E,initialIsSelected:v.isSelected,onChange:b=>{D[v.value]=b,clearTimeout(k),k=setTimeout(()=>{t(D),c(!1)},q)}},`checkLabel${F}`)),!E&&O(H,{children:[!l&&R.length>I&&p("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>u(!0),children:p("div",{className:"EnumFacetFilter__checkboxContainer",children:O("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",R.length,")"]})})}),l&&R.length>I&&p("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>u(!1),children:p("div",{className:"EnumFacetFilter__checkboxContainer",children:p("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),R.length<=0&&p("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),x=()=>c(!m);return E?s==="SelectBox"?O(te,{className:"EnumFacetFilter EnumFacetFilterSelect",show:m,onToggle:x,children:[O(te.Toggle,{className:"secondary-caret",variant:"gray-select",children:[N&&"All",!N&&e.filter(v=>v.isSelected).length===1&&e.filter(v=>v.isSelected)[0].value,!N&&e.filter(v=>v.isSelected).length>1&&"Multiple Values Selected"]}),p(te.Menu,{children:w})]}):O(te,{className:"EnumFacetFilter",show:m,onToggle:x,children:[p(pt,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),p(te.Menu,{children:w})]}):O(H,{children:[p(ie,{facetAliases:r,isCollapsed:d,label:n.name,onClick:v=>h(v)}),p(mt,{className:"EnumFacetFilter",in:!d,children:w})]})};function hn({id:e,index:n,label:a,count:t,isDropdown:r,initialIsSelected:i,onChange:s}){const[o,l]=B(i);return St.useEffect(()=>{l(i)},[i]),O("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{r&&(l(!o),s(!o))},children:[p(ft,{className:"EnumFacetFilter__checkbox",onClick:u=>u.stopPropagation(),onChange:u=>{l(u),s(u)},checked:o,label:a},`${e}-${n}`),r&&O("span",{className:"EnumFacetFilter__count",children:["(",t,")"]}),!r&&p("div",{className:"EnumFacetFilter__count",children:t})]})}try{he.displayName="EnumFacetFilter",he.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:he.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const Je=window.React.useState,ye=e=>{const n="Min value should be less then max value",[a,t]=Je(!1),[r,i]=Je(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:We(e.initialValues.min).format("YYYY-MM-DD"),max:We(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),s=e.className?`range ${e.className}`:"range",o=({min:u,max:d},h="number")=>u==null||d===null||d===void 0?(t(!1),!0):h==="number"&&Number(u)>Number(d)||Date.parse(u)>Date.parse(d)?(t(!0),!1):(t(!1),!0),l=(u,d,h="number")=>{o(u,h)&&d(u)};return O("div",{className:s,style:{display:"flex",flexWrap:"wrap"},children:[O("div",{style:{marginRight:"10px"},children:[p("input",{"aria-label":"min",type:e.type,value:r.min,onChange:({target:u})=>i({min:u.value,max:r.max})},"range_min"),p("div",{children:"to"}),p("input",{"aria-label":"max",type:e.type,value:r.max,onChange:({target:u})=>i({min:r.min,max:u.value})},"range_max")]}),p("button",{className:"btn btn-link SRC-noPadding",onClick:()=>l(r,e.onChange,e.type),children:"Apply"}),a&&p("div",{className:"SRC-danger-color",children:e.errorText||n})]})};try{ye.displayName="Range",ye.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:ye.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}var z=function(){for(var n=arguments.length,a=new Array(n),t=0;t<n;t++)a[t]=arguments[t];return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return a.forEach(function(o){return o&&o.apply(void 0,i)})}};function Ze(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),a.push.apply(a,t)}return a}function yn(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Ze(Object(a),!0).forEach(function(t){A(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ze(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}const vn=window.React,gn=window.React.Component;var Te=function(e){se(n,e);function n(){var a,t;K(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=le(this,(a=W(n)).call.apply(a,[this].concat(i))),A(V(t),"getRailProps",function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=t.props,u=l.emitMouse,d=l.emitTouch;return yn({},o,{onMouseDown:z(o.onMouseDown,u),onTouchStart:z(o.onTouchStart,d)})}),t}return Z(n,[{key:"render",value:function(){var t=this.getRailProps,r=this.props,i=r.getEventData,s=r.activeHandleID,o=r.children,l=o({getEventData:i,activeHandleID:s,getRailProps:t});return l&&vn.Children.only(l)}}]),n}(gn);Te.propTypes={};const Sn=window.React,_n=window.React.Component;var ue=function(e){se(n,e);function n(){return K(this,n),le(this,W(n).apply(this,arguments))}return Z(n,[{key:"render",value:function(){var t=this.props,r=t.children,i=t.values,s=t.scale,o=t.count,l=t.getEventData,u=t.activeHandleID,d=(i||s.getTicks(o)).map(function(m){return{id:"$$-".concat(m),value:m,percent:s.getValue(m)}}),h=r({getEventData:l,activeHandleID:u,ticks:d});return h&&Sn.Children.only(h)}}]),n}(_n);ue.propTypes={};ue.defaultProps={count:10};function et(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),a.push.apply(a,t)}return a}function Cn(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?et(Object(a),!0).forEach(function(t){A(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):et(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}const Tn=window.React,En=window.React.Component;var ce=function(e){se(n,e);function n(){var a,t;K(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=le(this,(a=W(n)).call.apply(a,[this].concat(i))),A(V(t),"getTrackProps",function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=t.props,u=l.emitMouse,d=l.emitTouch;return Cn({},o,{onMouseDown:z(o.onMouseDown,u),onTouchStart:z(o.onTouchStart,d)})}),t}return Z(n,[{key:"render",value:function(){for(var t=this.getTrackProps,r=this.props,i=r.children,s=r.left,o=r.right,l=r.scale,u=r.handles,d=r.getEventData,h=r.activeHandleID,m=l.getDomain(),c=[],f=0;f<u.length+1;f++){var y=u[f-1],S=u[f];f===0&&s===!0?y={id:"$",value:m[0],percent:0}:f===u.length&&o===!0&&(S={id:"$",value:m[1],percent:100}),y&&S&&c.push({id:"".concat(y.id,"-").concat(S.id),source:y,target:S})}var g=i({getEventData:d,activeHandleID:h,tracks:c,getTrackProps:t});return g&&Tn.Children.only(g)}}]),n}(En);ce.propTypes={};ce.defaultProps={left:!0,right:!0};function tt(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),a.push.apply(a,t)}return a}function Rn(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?tt(Object(a),!0).forEach(function(t){A(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):tt(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}const wn=window.React,Fn=window.React.Component;var Ee=function(e){se(n,e);function n(){var a,t;K(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=le(this,(a=W(n)).call.apply(a,[this].concat(i))),A(V(t),"autofocus",function(o){o.target.focus()}),A(V(t),"getHandleProps",function(o){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=t.props,d=u.emitKeyboard,h=u.emitMouse,m=u.emitTouch;return Rn({},l,{onKeyDown:z(l.onKeyDown,function(c){return d(c,o)}),onMouseDown:z(l.onMouseDown,t.autofocus,function(c){return h(c,o)}),onTouchStart:z(l.onTouchStart,function(c){return m(c,o)})})}),t}return Z(n,[{key:"render",value:function(){var t=this.getHandleProps,r=this.props,i=r.activeHandleID,s=r.children,o=r.handles,l=s({handles:o,activeHandleID:i,getHandleProps:t});return l&&wn.Children.only(l)}}]),n}(Fn);Ee.propTypes={};function _t(e){return function(a,t){return a.val>t.val?e?-1:1:t.val>a.val?e?1:-1:0}}function oe(e,n,a,t){var r=e.findIndex(function(l){return l.key===n});if(r!==-1){var i=e[r],s=i.key,o=i.val;return o===a?e:[].concat(Ke(e.slice(0,r)),[{key:s,val:a}],Ke(e.slice(r+1))).sort(_t(t))}return e}function ne(e,n){if(!e)return[0,0];var a=e.getBoundingClientRect(),t=n?a.top:a.left,r=n?a.bottom:a.right;return[t,r]}function nt(e){var n=e.type,a=n===void 0?"":n,t=e.touches;return!t||t.length>1||a.toLowerCase()==="touchend"&&t.length>0}function Ae(e,n){return e?n.touches[0].clientY:n.touches[0].pageX}function at(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,t=0,r=e.map(function(i){var s=a.getValue(i);return i!==s&&(t+=1),s}).map(function(i,s){return{key:"$$-".concat(s),val:i}}).sort(_t(n));return{handles:r,changes:t}}function On(e,n){return n}function bn(e,n){for(var a=0;a<e.length;a++)if(e[a].key!==n[a].key||n[a+1]&&n[a].val===n[a+1].val)return e;return n}function Le(e,n,a,t,r){for(var i=-1,s=!0,o=0;o<e.length;o++){var l=e[o],u=n[o];if(!u||u.key!==l.key)return e;u.val!==l.val&&(i=o,s=u.val-l.val>0)}if(i===-1)return e;for(var d=s?a:-a,h=0;h<n.length;h++){var m=n[h],c=n[h+1];if(c&&m.val===c.val)if(h===i){var f=c.val+d;if(r(f)===f){var y=oe(n,c.key,c.val+d,t),S=Le(n,y,a,t,r);return S===n?e:S}else return e}else{var g=m.val+d;if(r(g)===g){var R=oe(n,m.key,m.val+d,t),C=Le(n,R,a,t,r);return C===n?e:C}else return e}}return n}function Ct(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function In(e){return e.length===1&&(e=Nn(e)),{left:function(n,a,t,r){for(t==null&&(t=0),r==null&&(r=n.length);t<r;){var i=t+r>>>1;e(n[i],a)<0?t=i+1:r=i}return t},right:function(n,a,t,r){for(t==null&&(t=0),r==null&&(r=n.length);t<r;){var i=t+r>>>1;e(n[i],a)>0?r=i:t=i+1}return t}}}function Nn(e){return function(n,a){return Ct(e(n),a)}}In(Ct);var rt=Math.sqrt(50),it=Math.sqrt(10),ot=Math.sqrt(2);function xn(e,n,a){var t,r=-1,i,s,o;if(n=+n,e=+e,a=+a,e===n&&a>0)return[e];if((t=n<e)&&(i=e,e=n,n=i),(o=Vn(e,n,a))===0||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),n=Math.floor(n/o),s=new Array(i=Math.ceil(n-e+1));++r<i;)s[r]=(e+r)*o;else for(e=Math.floor(e*o),n=Math.ceil(n*o),s=new Array(i=Math.ceil(e-n+1));++r<i;)s[r]=(e-r)/o;return t&&s.reverse(),s}function Vn(e,n,a){var t=(n-e)/Math.max(0,a),r=Math.floor(Math.log(t)/Math.LN10),i=t/Math.pow(10,r);return r>=0?(i>=rt?10:i>=it?5:i>=ot?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(i>=rt?10:i>=it?5:i>=ot?2:1)}var An=function(){function e(){K(this,e),this.domain=[0,1],this.range=[0,1],this.interpolator=null}return Z(e,[{key:"createInterpolator",value:function(a,t){var r=a[0],i=a[1],s=t[0],o=t[1];return i<r?(r=this.deinterpolateValue(i,r),s=this.interpolateValue(o,s)):(r=this.deinterpolateValue(r,i),s=this.interpolateValue(s,o)),function(l){return s(r(l))}}},{key:"interpolateValue",value:function(a,t){return a=+a,t-=a,function(i){return a+t*i}}},{key:"deinterpolateValue",value:function(a,t){return(t-=a=+a)?function(r){return(r-a)/t}:function(){return t}}},{key:"rescale",value:function(){return this.interpolator=null,this}},{key:"getValue",value:function(a){var t=this.domain,r=this.range;return(this.interpolator||(this.interpolator=this.createInterpolator(t,r)))(+a)}},{key:"setDomain",value:function(a){return this.domain=a.map(function(t){return+t}),this.rescale(),this}},{key:"getDomain",value:function(){return this.domain}},{key:"setRange",value:function(a){return this.range=a.map(function(t){return+t}),this}},{key:"getTicks",value:function(a){var t=this.domain;return xn(t[0],t[t.length-1],a||10)}}]),e}();function st(e,n,a){return Math.min(Math.max(e,n),a)}var lt=function e(){var n=this;K(this,e),A(this,"setDomain",function(a){return n.domain=a.slice(),n}),A(this,"setRange",function(a){return n.range=a.slice(),n}),A(this,"setStep",function(a){return n.step=a,n}),A(this,"getValue",function(a){var t=De(n.domain,2),r=t[0],i=t[1],s=De(n.range,2),o=s[0],l=s[1],u=n.step,d=(st(a,r,i)-r)/(i-r),h=u*Math.round(d*(l-o)/u)+o;return st(h,o<l?o:l,l>o?l:o)}),this.step=1,this.domain=[0,1],this.range=[0,1]};const ke=window.React,kn=window.React.PureComponent;window.React.Fragment;var ae=typeof window!="undefined"&&typeof document!="undefined",Y=function(){},Qn=function(n){return function(a,t,r){return a&&n[r]===t}},qn=function(n,a){return n===a||n.length===a.length&&n.reduce(Qn(a),!0)},Dn=function(n,a,t,r){var i=r?n-a:n+a;return r?Math.max(t[0],i):Math.min(t[1],i)},Ln=function(n,a,t,r){var i=r?n+a:n-a;return r?Math.min(t[1],i):Math.max(t[0],i)},j=function(e){se(n,e);function n(){var a,t;K(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=le(this,(a=W(n)).call.apply(a,[this].concat(i))),A(V(t),"state",{step:null,values:null,domain:null,handles:[],reversed:null,activeHandleID:null,valueToPerc:null,valueToStep:null,pixelToStep:null}),A(V(t),"slider",ke.createRef()),A(V(t),"onKeyDown",function(o,l){var u=["ArrowRight","ArrowUp"],d=["ArrowDown","ArrowLeft"],h=V(t),m=h.state.handles,c=h.props,f=c.step,y=c.reversed,S=c.vertical,g=c.domain,R=o.key||o.keyCode;if(!!u.concat(d).includes(R)){if(S){var C=[d,u];u=C[0],d=C[1]}o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault();var I=m.find(function(k){return k.key===l});if(!!I){var q=I.val,Q=q;u.includes(R)?Q=Dn(q,f,g,y):d.includes(R)&&(Q=Ln(q,f,g,y));var D=m.map(function(k){return k.key===l?{key:k.key,val:Q}:k});t.submitUpdate(D,!0)}}}),A(V(t),"onMouseDown",function(o,l){t.onStart(o,l,!1)}),A(V(t),"onTouchStart",function(o,l){nt(o)||t.onStart(o,l,!0)}),A(V(t),"getEventData",function(o,l){var u=V(t),d=u.state,h=d.pixelToStep,m=d.valueToPerc,c=u.props.vertical;h.setDomain(ne(t.slider.current,c));var f;return l?f=h.getValue(Ae(c,o)):f=h.getValue(c?o.clientY:o.pageX),{value:f,percent:m.getValue(f)}}),A(V(t),"onMouseMove",function(o){var l=V(t),u=l.state,d=u.handles,h=u.pixelToStep,m=u.activeHandleID,c=l.props,f=c.vertical,y=c.reversed;h.setDomain(ne(t.slider.current,f));var S=h.getValue(f?o.clientY:o.pageX),g=oe(d,m,S,y);t.submitUpdate(g)}),A(V(t),"onTouchMove",function(o){var l=V(t),u=l.state,d=u.handles,h=u.pixelToStep,m=u.activeHandleID,c=l.props,f=c.vertical,y=c.reversed;if(!nt(o)){h.setDomain(ne(t.slider.current,f));var S=h.getValue(Ae(f,o)),g=oe(d,m,S,y);t.submitUpdate(g)}}),A(V(t),"onMouseUp",function(){var o=V(t),l=o.state,u=l.handles,d=l.activeHandleID,h=o.props,m=h.onChange,c=h.onSlideEnd;m(u.map(function(f){return f.val})),c(u.map(function(f){return f.val}),{activeHandleID:d}),t.setState({activeHandleID:null}),ae&&(document.removeEventListener("mousemove",t.onMouseMove),document.removeEventListener("mouseup",t.onMouseUp))}),A(V(t),"onTouchEnd",function(){var o=V(t),l=o.state,u=l.handles,d=l.activeHandleID,h=o.props,m=h.onChange,c=h.onSlideEnd;m(u.map(function(f){return f.val})),c(u.map(function(f){return f.val}),{activeHandleID:d}),t.setState({activeHandleID:null}),ae&&(document.removeEventListener("touchmove",t.onTouchMove),document.removeEventListener("touchend",t.onTouchEnd))}),t}return Z(n,[{key:"componentDidMount",value:function(){var t=this.state.pixelToStep,r=this.props.vertical;t.setDomain(ne(this.slider.current,r))}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"removeListeners",value:function(){ae&&(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"onStart",value:function(t,r,i){var s=this.state.handles,o=this.props.onSlideStart;i||t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation();var l=s.find(function(u){return u.key===r});l?(this.setState({activeHandleID:r}),o(s.map(function(u){return u.val}),{activeHandleID:r}),i?this.addTouchEvents():this.addMouseEvents()):(this.setState({activeHandleID:null}),this.handleRailAndTrackClicks(t,i))}},{key:"handleRailAndTrackClicks",value:function(t,r){var i=this,s=this.state,o=s.handles,l=s.pixelToStep,u=this.props,d=u.vertical,h=u.reversed,m=this.slider;l.setDomain(ne(m.current,d));var c;r?c=l.getValue(Ae(d,t)):c=l.getValue(d?t.clientY:t.pageX);for(var f=null,y=1/0,S=0;S<o.length;S++){var g=o[S],R=g.key,C=g.val,I=Math.abs(C-c);I<y&&(f=R,y=I)}var q=oe(o,f,c,h);this.setState({activeHandleID:f},function(){i.submitUpdate(q,!0),r?i.addTouchEvents():i.addMouseEvents()})}},{key:"addMouseEvents",value:function(){ae&&(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}},{key:"addTouchEvents",value:function(){ae&&(document.addEventListener("touchmove",this.onTouchMove),document.addEventListener("touchend",this.onTouchEnd))}},{key:"submitUpdate",value:function(t,r){var i=this.props,s=i.mode,o=i.step,l=i.onUpdate,u=i.onChange,d=i.reversed,h=this.state.valueToStep.getValue;this.setState(function(m){var c=m.handles,f;if(typeof s=="function")f=s(c,t,o,d,h);else switch(s){case 1:f=On(c,t);break;case 2:f=bn(c,t);break;case 3:f=Le(c,t,o,d,h);break;default:f=t}return l(f.map(function(y){return y.val})),r&&u(f.map(function(y){return y.val})),{handles:f}})}},{key:"render",value:function(){var t=this,r=this.state,i=r.handles,s=r.valueToPerc,o=r.activeHandleID,l=this.props,u=l.className,d=l.rootStyle,h=l.rootProps,m=l.component,c=l.disabled,f=l.flatten,y=i.map(function(g){var R=g.key,C=g.val;return{id:R,value:C,percent:s.getValue(C)}}),S=ke.Children.map(this.props.children,function(g){return g&&(g.type.name===Te.name||g.type.name===ue.name||g.type.name===ce.name||g.type.name===Ee.name)?ke.cloneElement(g,{scale:s,handles:y,activeHandleID:o,getEventData:t.getEventData,emitKeyboard:c?Y:t.onKeyDown,emitMouse:c?Y:t.onMouseDown,emitTouch:c?Y:t.onTouchStart}):g});return f?O(H,{children:[p(m,{...h,style:d,className:u,ref:this.slider}),S]}):p(m,{...h,style:d,className:u,ref:this.slider,children:S})}}],[{key:"getDerivedStateFromProps",value:function(t,r){var i=t.step,s=t.values,o=t.domain,l=t.reversed,u=t.onUpdate,d=t.onChange,h=t.warnOnChanges,m=r.valueToPerc,c=r.valueToStep,f=r.pixelToStep,y={};if((!m||!c||!f)&&(m=new An,c=new lt,f=new lt,y.valueToPerc=m,y.valueToStep=c,y.pixelToStep=f),r.step===null||r.domain===null||r.reversed===null||i!==r.step||o[0]!==r.domain[0]||o[1]!==r.domain[1]||l!==r.reversed){var S=De(o,2),g=S[0],R=S[1];c.setStep(i).setRange([g,R]).setDomain([g,R]),l===!0?(m.setDomain([g,R]).setRange([100,0]),f.setStep(i).setRange([R,g])):(m.setDomain([g,R]).setRange([0,100]),f.setStep(i).setRange([g,R]));var C=at(s||r.values,l,c,h),I=C.handles,q=C.changes;(q||s===void 0||s===r.values)&&(u(I.map(function(N){return N.val})),d(I.map(function(N){return N.val}))),y.step=i,y.values=s,y.domain=o,y.handles=I,y.reversed=l}else if(!qn(s,r.values)){var Q=at(s,l,c,h),D=Q.handles,k=Q.changes;k&&(u(D.map(function(N){return N.val})),d(D.map(function(N){return N.val}))),y.values=s,y.handles=D}return Object.keys(y).length?y:null}}]),n}(kn);j.propTypes={};j.defaultProps={mode:1,step:.1,domain:[0,100],component:"div",rootProps:{},rootStyle:{},vertical:!1,reversed:!1,onChange:Y,onUpdate:Y,onSlideStart:Y,onSlideEnd:Y,disabled:!1,flatten:!1,warnOnChanges:!1};j.Rail=Te;j.Ticks=ue;j.Tracks=ce;j.Handles=Ee;const Pn=window.React.useState,ve=({domain:[e,n],handle:{id:a,value:t,percent:r},getHandleProps:i})=>p("div",{role:"slider",className:"RangeSlider__handle","aria-valuemin":e,"aria-valuemax":n,"aria-valuenow":t,style:{left:`${r}%`},...i(a)}),ge=({source:e,target:n,getTrackProps:a})=>p("div",{className:"RangeSlider__track",style:{left:`${e.percent}%`,width:`${n.percent-e.percent}%`},...a()}),Se=({tick:e,count:n,mode:a="SHOWMINMAX"})=>O("div",{children:[p("div",{className:"RangeSlider__tick",style:{left:`${e.percent}%`}}),p("div",{className:"RangeSlider__tickInner",style:{marginLeft:`${-(100/n)/2}%`,width:`${100/n}%`,left:`${e.percent}%`},children:(a==="SHOWALL"||a==="SHOWMINMAX"&&(e.percent==0||e.percent==100))&&e.value})]});function ut(e,n){return[e.min?Number(e.min):Number(n[0]),e.max?Number(e.max):Number(n[1])]}const _e=({doUpdateOnApply:e=!0,...n})=>{const a=l=>l.map(u=>Number(u)),[t,r]=Pn(()=>ut(n.initialValues,n.domain)),i=a(n.domain),s=(l,u)=>{r([...l]),u&&u({min:l[0],max:l[1]})};let o=i[1]-i[0];return n.maxTickCount&&o>n.maxTickCount&&(o=n.maxTickCount),O("div",{className:"RangeSlider",children:[O("div",{className:"RangeSlider__values",children:[t[0]," - ",t[1]]}),O("div",{className:`RangeSlider__wrapper${e?"--flex":"--block"}`,children:[O(j,{mode:1,step:n.step,domain:a(n.domain),className:"RangeSlider__slider",onChange:l=>s(l,e?void 0:n.onChange),values:ut(n.initialValues,n.domain),children:[p(Te,{children:({getRailProps:l})=>p("div",{className:"RangeSlider__rail",...l()})}),p(Ee,{children:({handles:l,getHandleProps:u})=>p("div",{className:"slider-handles",children:l.map(d=>p(ve,{handle:d,domain:a(n.domain),getHandleProps:u},d.id+d.percent))})}),p(ce,{left:!0,right:!0,children:({tracks:l,getTrackProps:u})=>p("div",{children:l.map(({id:d,source:h,target:m})=>p(ge,{source:h,target:m,getTrackProps:u},d))})}),p(ue,{count:o,children:({ticks:l})=>p("div",{children:l.map(u=>p(Se,{tick:u,count:l.length},u.id))})})]}),e&&p("button",{className:"RangeSlider__btnApply",onClick:()=>n.onChange({min:t[0],max:t[1]}),children:"Apply"})]})]})};try{ve.displayName="Handle",ve.__docgenInfo={description:"",displayName:"Handle",props:{domain:{defaultValue:null,description:"",name:"domain",required:!0,type:{name:"number[]"}},handle:{defaultValue:null,description:"",name:"handle",required:!0,type:{name:"SliderItem"}},getHandleProps:{defaultValue:null,description:"",name:"getHandleProps",required:!0,type:{name:"GetHandleProps"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/RangeSlider.tsx#Handle"]={docgenInfo:ve.__docgenInfo,name:"Handle",path:"src/lib/containers/widgets/RangeSlider.tsx#Handle"})}catch{}try{ge.displayName="Track",ge.__docgenInfo={description:"",displayName:"Track",props:{source:{defaultValue:null,description:"",name:"source",required:!0,type:{name:"SliderItem"}},target:{defaultValue:null,description:"",name:"target",required:!0,type:{name:"SliderItem"}},getTrackProps:{defaultValue:null,description:"",name:"getTrackProps",required:!0,type:{name:"GetTrackProps"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/RangeSlider.tsx#Track"]={docgenInfo:ge.__docgenInfo,name:"Track",path:"src/lib/containers/widgets/RangeSlider.tsx#Track"})}catch{}try{Se.displayName="Tick",Se.__docgenInfo={description:"",displayName:"Tick",props:{key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},tick:{defaultValue:null,description:"",name:"tick",required:!0,type:{name:"SliderItem"}},count:{defaultValue:null,description:"",name:"count",required:!0,type:{name:"number"}},mode:{defaultValue:{value:"SHOWMINMAX"},description:"",name:"mode",required:!1,type:{name:"enum",value:[{value:'"SHOWALL"'},{value:'"SHOWNONE"'},{value:'"SHOWMINMAX"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/RangeSlider.tsx#Tick"]={docgenInfo:Se.__docgenInfo,name:"Tick",path:"src/lib/containers/widgets/RangeSlider.tsx#Tick"})}catch{}try{_e.displayName="RangeSlider",_e.__docgenInfo={description:"",displayName:"RangeSlider",props:{domain:{defaultValue:null,description:"",name:"domain",required:!0,type:{name:"string[]"}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!0,type:{name:"RangeValues"}},step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"number"}},doUpdateOnApply:{defaultValue:{value:"true"},description:"",name:"doUpdateOnApply",required:!1,type:{name:"boolean"}},maxTickCount:{defaultValue:null,description:"",name:"maxTickCount",required:!1,type:{name:"number"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"Function"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/RangeSlider.tsx#RangeSlider"]={docgenInfo:_e.__docgenInfo,name:"RangeSlider",path:"src/lib/containers/widgets/RangeSlider.tsx#RangeSlider"})}catch{}const ct=window.React.useState;var Pe=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(Pe||{});const Ce=({facetResult:e,columnModel:n,onChange:a,facetAliases:t,collapsed:r=!1})=>{const[i,s]=ct(r),o=[{label:He,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:l,columnMax:u,selectedMin:d,selectedMax:h}=e;const m=!d&&!h;d=d||l,h=h||u;const c=n.columnType==="DOUBLE"?"number":"date",f=(C,I)=>I?"":C===Me?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",y=(C,I)=>{g(C),C!=="RANGE"&&I([C,C])},[S,g]=ct(f(d,m));return O("div",{children:[p(ie,{isCollapsed:i,label:n.name,onClick:C=>s(C),facetAliases:t}),O(mt,{in:!i,children:[p(zt,{value:S,id:"rangeSelector",options:o,onChange:C=>y(C,a)}),S==="RANGE"&&(l===u?p("label",{children:u}):O(H,{children:[n.columnType==="INTEGER"&&O(_e,{domain:[l,u],initialValues:{min:d,max:h},step:1,doUpdateOnApply:!0,onChange:C=>a([C.min,C.max]),children:[") ",">"]},"RangeSlider"),(n.columnType==="DATE"||n.columnType==="DOUBLE")&&p(ye,{initialValues:{min:d,max:h},type:c,onChange:C=>a([C.min,C.max])},"Range")]}))]})]})};try{Ce.displayName="RangeFacetFilter",Ce.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:Ce.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const Tt=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(n=>n.isSelected===!0).map(n=>n.value)}),Mn=e=>{let n={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(n={...n,min:e.columnMin,max:e.columnMax}),n},Ye=(e,n)=>{var i,s;const a=(s=(i=n==null?void 0:n.query)==null?void 0:i.selectedFacets)!=null?s:[],t=a.findIndex(o=>o.columnName===e.columnName),r=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return t>-1?r?a.splice(t,1):a[t]=e:a.push(e),a};function Et(e,n,a,t,r=!1){t?n.facetValues.forEach(o=>{o.value===t&&(o.isSelected=r)}):n.facetValues.forEach(o=>{o.isSelected=!1});const i=Tt(n),s=Ye(i,e);a(s)}const Hn=(e,n,a,t)=>{const r=t&&Object.keys(t)||[];r.length&&n.facetValues.forEach(o=>{r.includes(o.value)&&(o.isSelected=t?!!t[o.value]:!1)});const i=Tt(n),s=Ye(i,e);a(s)},Rt=(e,n,a,t)=>{n.columnMin=t[0],n.columnMax=t[1];const r=Mn(n),i=Ye(r,e);a(i)},Qe=({facetsToFilter:e})=>{const{data:n,isLoadingNewBundle:a,getLastQueryRequest:t,executeQueryRequest:r}=Be(),{facetAliases:i,topLevelControlsState:s}=ht();if(!n)return p(H,{});const{showFacetFilter:o}=s,l=n.selectColumns;let u=n.facets;e&&(u=u.filter(m=>e.includes(m.columnName)));const d=t(),h=m=>{const c=t();c.query.selectedFacets=m,c.query.offset=0,r(c)};return O("div",{className:`QueryFilter ${o?vt:gt}`,children:[a&&p("div",{children:"Loading..."}),!a&&u.map((m,c)=>{const f=l.find(S=>S.name===m.columnName),y=c>2;if(!Ut(m))return O("div",{className:"QueryFilter__facet",children:[m.facetType==="enumeration"&&f&&p(he,{containerAs:"Collapsible",collapsed:y,facetValues:m.facetValues,columnModel:f,facetAliases:i,onChange:S=>Hn(d,m,h,S),onClear:()=>Et(d,m,h)}),m.facetType==="range"&&f&&p(Ce,{facetResult:m,columnModel:f,facetAliases:i,collapsed:y,onChange:S=>Rt(d,m,h,S)})]},m.columnName)})]})};try{Qe.displayName="QueryFilter",Qe.__docgenInfo={description:"",displayName:"QueryFilter",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"]={docgenInfo:Qe.__docgenInfo,name:"QueryFilter",path:"src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"})}catch{}const Un=window.React.useCallback,$n=window.React.useEffect,Bn=window.React.useState,Yn=window.React.createElement,qe=({style:e,frontText:n,endText:a="",hideIfUnfiltered:t=!1})=>{var G;const{data:r,isLoadingNewBundle:i,getLastQueryRequest:s,executeQueryRequest:o,getInitQueryRequest:l,error:u}=Be(),{topLevelControlsState:d,unitDescription:h}=ht(),m=r==null?void 0:r.queryCount,[c,f]=Bn([]),y=T=>{const _=M(s());_.query.selectedFacets=T,_.query.offset=0,o(_)},S=T=>T.filter(w=>w.facetType==="enumeration").filter(w=>w.facetValues.filter(x=>x.isSelected===!0).length>0),g=T=>T.filter(w=>w.facetType==="range").filter(w=>w.selectedMax||w.selectedMin),R=(T,_)=>{var w;const E=T.find(x=>x.id===_);return(w=E==null?void 0:E.name)!=null?w:_},C=(T,_)=>{const E=T.find(w=>w.ownerId===_);return(E==null?void 0:E.userName)||_},I=Un((T,_)=>{const E=Gt(),w=Xt(),x=[];return T.forEach(v=>{const F=_.find(b=>b.name===v.columnName);v.facetValues.forEach(b=>{if(b.isSelected){let L=b.value;(F==null?void 0:F.columnType)===P.ENTITYID||(F==null?void 0:F.columnType)===P.ENTITYID_LIST?L=R(E,b.value):((F==null?void 0:F.columnType)===P.USERID||(F==null?void 0:F.columnType)===P.USERID_LIST)&&(L=C(w,b.value)),x.push({facet:v,displayValue:L,selectedValue:b})}})}),x},[]);$n(()=>{if(r){const T=g(r.facets),_=S(r.facets),E=T.map(x=>({facet:x})),w=I(_,r.columnModels);f([...E,...w])}},[r,I]);const q=T=>{const{facet:_,selectedValue:E}=T;_.facetType==="enumeration"?Et(s(),_,y,E==null?void 0:E.value,!1):Rt(s(),_,y,[Pe.ANY,Pe.ANY])},Q=(T,_)=>{var w;const E=M(s());!E.query.additionalFilters||(E.query.additionalFilters=(w=E.query.additionalFilters)==null?void 0:w.reduce(function(x,v){if(Fe(v)||Oe(v)){const F={columnName:v.columnName,values:v.columnName===T?v.values.filter(b=>b!==_):v.values,operator:Fe(v)?v.operator:void 0,function:Oe(v)?v.function:void 0,concreteType:v.concreteType};F.values.length>0&&x.push(F)}else x.push(v);return x},[]),o(E))},D=T=>{const _=M(s());!_.query.additionalFilters||(_.query.additionalFilters=_.query.additionalFilters.filter(E=>!(je(E)&&E.searchExpression===T.searchExpression)),o(_))},k=()=>{const T=M(l());T.query.additionalFilters=[],o(T)},N=(G=s().query.additionalFilters)==null?void 0:G.reduce((T,_)=>{if(je(_))T.push({key:`fulltextsearch-${_.searchExpression}`,filter:{value:_.searchExpression},onRemove:()=>D(_)});else if(Fe(_)||Oe(_)){const{columnName:E}=_;_.values.forEach(w=>{T.push({key:`columnsearch-${w}`,filter:{columnName:E,value:w},onRemove:()=>Q(_.columnName,w)})})}else console.warn("Encountered unexpected QueryFilter: ",_);return T},[]),$=d==null?void 0:d.showFacetFilter,ee=c.length>0||N&&N.length>0;return u?p(H,{}):p("div",{className:`TotalQueryResults ${$?vt:gt}`,style:e,children:i?p(me,{width:100}):O(H,{children:[(ee||!t)&&O("span",{className:"SRC-boldText SRC-centerContent",children:[n," ",m==null?void 0:m.toLocaleString()," ",h," ",a]}),O("div",{className:"TotalQueryResults__selections",children:[N&&N.map(T=>Yn(re,{...T,key:T.key})),c.map((T,_)=>{var E,w,x;return p(re,{facetWithSelection:T,onRemove:()=>q(T)},`facets-${(x=(w=(E=T.selectedValue)==null?void 0:E.value)!=null?w:T.displayValue)!=null?x:_}`)}),(c.length>2||N&&N.length>2)&&p(Kt,{onClick:k,variant:"light",className:"TotalQueryResults__clearall",children:"Clear All"})]})]})})};try{qe.displayName="TotalQueryResults",qe.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:{value:"false"},description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:qe.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}export{Zt as C,he as E,xe as Q,me as S,qe as T,we as a,pe as b,ln as c,Be as d,ht as e,Ve as f,un as g,Hn as h,Et as i,vt as j,gt as k,Ne as l,Qe as m,Fe as n,Oe as o,Jt as p,ga as q,Sa as u};
//# sourceMappingURL=TotalQueryResults.0b176e13.js.map

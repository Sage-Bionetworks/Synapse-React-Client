import{E as ae,w as te,V as G,v as ne,cr as re,y as oe}from"./index.0ee6b688.js";import{d as Q,e as j,S as le,E as U,h as W,i as $,T as se,j as ie,k as ce}from"./TotalQueryResults.8367ae47.js";import{j as a,F as R,a as g}from"./jsx-runtime.2e925369.js";import{a as de}from"./queryUtils.bf612cb7.js";import{c as ue,P as pe}from"./factory.818d3520.js";import{r as me}from"./react-sizeme.ece7c032.js";import{g as fe}from"./ColorGradient.16f0e0f2.js";import{E as D}from"./ElementWithTooltip.ce200a1e.js";import{u as he}from"./unCamelCase.d070537b.js";import{C as V}from"./ColumnType.744125d2.js";import"./assert.0d607308.js";import{l as ye}from"./LoadingScreen.56f18e4f.js";import{T as _e}from"./Tooltip.6c95fe7b.js";import{M as A}from"./Modal.58357e58.js";import{B as X}from"./Button.c582ea4c.js";import{I as ge}from"./InfoOutlined.22a371fd.js";import{D as B}from"./Dropdown.c29f5884.js";const O=()=>{const{error:e}=Q();return a(ae,{error:e})};try{O.displayName="QueryWrapperErrorBanner",O.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"]={docgenInfo:O.__docgenInfo,name:"QueryWrapperErrorBanner",path:"src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"})}catch{}const Se=window.React.useCallback,Ne=window.React.useEffect,K=window.React.useState,Ce=ue(pe),Fe=19,ve=30,be={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},Ee=(e,t)=>{t=t||0;let n=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let l=0;l<t;l++)n.indexOf(".")!==-1&&(n=n.replace("0%","%"),n=n.replace(".%","%"));return n};function Z(e,t){if(!e)return e;const n=e.trim();return n.length>t?n.substr(0,t-1)+"\u2026":e}async function we(e,t,n,l,h){var N,p;const{colorPalette:c}=fe(n,e.facetValues.length),o=async(s,m,C)=>{const f=new Map;f.set(G,ne);const w=s.map(r=>r.value).filter(r=>r!==G);if(m===V.ENTITYID||m===V.ENTITYID_LIST){const r=await re(w,C);for(const S of r.results)f.set(S.id,S.name)}else if(m===V.USERID||m===V.USERID_LIST){const r=await oe(w,C);for(const S of r.children)f.set(S.ownerId,S.userName)}return s.map(r=>({facet:r,label:u(r,!1,f),truncatedLabel:u(r,!0,f),count:r.count}))},u=(s,m,C)=>{var w;let f=(w=C.get(s.value))!=null?w:s.value;return m&&(f=Z(f,Fe)),f},b=await o(e.facetValues,t,h),F=b.map(s=>s.truncatedLabel),x=e.facetValues.some(s=>s.isSelected)?e.facetValues.map((s,m)=>s.isSelected?c[m]:c[m].replace("rgb(","rgba(").replace(")",", 0.25)")):c,E={values:l==="PIE"?e.facetValues.map(s=>s.count):void 0,labels:b.map(s=>s.label),text:F,x:l==="BAR"?e.facetValues.map(s=>{var m,C;return(C=(m=b.find(f=>f.facet===s))==null?void 0:m.label)!=null?C:s.value}):void 0,y:l==="BAR"?e.facetValues.map(s=>s.count):void 0,facetEnumerationValues:e.facetValues.map(s=>s.value),name:e.columnName,hovertemplate:l==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:l==="PIE"?"pie":"bar",pull:l==="PIE"?e.facetValues.map(s=>s.isSelected?.1:0):void 0,marker:{colors:l==="PIE"?x:void 0,color:l==="BAR"?x:void 0}};return{data:[E],labels:b,colors:l==="PIE"?(N=E.marker)==null?void 0:N.colors:(p=E.marker)==null?void 0:p.color}}const xe=(e,t,n)=>{if(e.points&&e.points[0]){const l=e.points[0],h=l.data.facetEnumerationValues[l.pointNumber],c=t.facetValues.find(o=>o.value===h);n(t,c,!c.isSelected)}};function Te(e,t,n){const h=e?e*(t==="BAR"?.8:.6):200;let c=t==="PIE"?h:h/3;return c>n&&(c=n),{width:`${h}px`,height:`${c}px`}}function M(e){const{labels:t,colors:n=[],isExpanded:l}=e;if(!t)return a(R,{});const h=l?Math.min(t.length,9):Math.min(t.length,3);if(h===0)return a(R,{});const c=t.reduce((o,u)=>o+u.count,0);return a("div",{className:`FacetNavPanel__body__legend${l?"--expanded":""}`,children:t.slice(0,h).map((o,u)=>{const F=`(${Ee(o.count/c,1)}) ${o.label}`,d=Z(F,ve);return a(D,{idForToolTip:o.label,tooltipText:o.label,children:g("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[a("div",{style:{backgroundColor:n[u]}}),a("label",{children:d})]},`legendLabel_${u}`)},o.label)})})}const Pe=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",L=e=>{const{onHide:t,isModalView:n,applyChangesToFacetFilter:l,applyChangesToGraphSlice:h,index:c,facetToPlot:o,plotType:u,onSetPlotType:b}=e,{accessToken:F}=te(),{data:d,isLoadingNewBundle:x,getLastQueryRequest:E}=Q(),{facetAliases:T}=j(),[N,p]=K(),[s,m]=K(!1),C=he(o.columnName,T),f=Se(()=>{var r,S;return(S=(r=d==null?void 0:d.columnModels)==null?void 0:r.find(P=>P.name===o.columnName))==null?void 0:S.columnType},[d,o.columnName]);Ne(()=>{let r=!0;if(o)we(o,f(),c,u,F).then(S=>{r&&p(S)});else return;return()=>{r=!1}},[o,d,c,u,F,f]);const w=()=>g("div",{onClick:r=>{r.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[a("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),g(B,{children:[a(B.Toggle,{className:"secondary-caret",variant:"gray-select",children:u==="PIE"?"Pie Chart":"Bar Chart"}),g(B.Menu,{className:"chart-tools",children:[a(B.Item,{as:"button",onClick:()=>b("BAR"),children:"Bar Chart"}),a(B.Item,{as:"button",onClick:()=>b("PIE"),children:"Pie Chart"})]})]})]});return!d&&x||!o?a("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:ye}):g(R,{children:[g(A,{animation:!1,show:s,onHide:()=>m(!1),backdrop:"static",children:[a(A.Header,{closeButton:!0,children:a(A.Title,{children:C!=null?C:""})}),g(A.Body,{children:[a(L,{...e,isModalView:!0}),a("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:a(X,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>m(!1),children:"Apply Filters"})})]})]}),g("div",{role:"graphics-document",className:`FacetNavPanel${n?"--expanded":""}`,children:[!n&&g("div",{className:"FacetNavPanel__title",children:[!d&&x?a(le,{width:100}):a("span",{className:"FacetNavPanel__title__name",children:C}),g("div",{className:"FacetNavPanel__title__tools",children:[a(U,{facetValues:o.facetValues,columnModel:d==null?void 0:d.columnModels.find(r=>r.name===o.columnName),facetAliases:T,onChange:r=>{W(E(),o,l,r)},onClear:()=>{$(E(),o,l)},containerAs:"Dropdown"}),a(D,{idForToolTip:"expandGraph",tooltipText:"Expand to large graph",callbackFn:()=>m(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),a(D,{idForToolTip:"hideGraph",tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),n&&g(R,{children:[g("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[a("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),a(U,{facetValues:o.facetValues,columnModel:d==null?void 0:d.columnModels.find(r=>r.name===o.columnName),facetAliases:T,onChange:r=>{W(E(),o,l,r)},onClear:()=>{$(E(),o,l)},containerAs:"Dropdown",dropdownType:"SelectBox"}),a(_e,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:a(ge,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),a(w,{})]}),g("div",{className:`FacetNavPanel__body${n?"--expanded":""}`,children:[a(me.SizeMe,{monitorHeight:!0,children:({size:r})=>{var S;return a("div",{className:Pe(n,u),children:a(Ce,{layout:be,data:(S=N==null?void 0:N.data)!=null?S:[],style:Te(r.width,u,n?300:150),config:{displayModeBar:!1},onClick:P=>xe(P,o,h)},`${o.columnName}-${u}-${r.width}`)})}}),a(M,{labels:N==null?void 0:N.labels,colors:N==null?void 0:N.colors,isExpanded:n})]})]})]})};try{M.displayName="FacetPlotLegend",M.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"]={docgenInfo:M.__docgenInfo,name:"FacetPlotLegend",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"})}catch{}try{L.displayName="FacetNavPanel",L.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"]={docgenInfo:L.__docgenInfo,name:"FacetNavPanel",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"})}catch{}const Re=window.React.useEffect,Ie=window.React.useMemo,z=window.React.useState,k=2;function q(e,t){var l,h;return(h=(l=e==null?void 0:e.facets)==null?void 0:l.filter(c=>c.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(c.columnName)>-1)&&c.facetValues.length>0&&!de(c)))!=null?h:[]}const H=({facetsToPlot:e,showNotch:t=!1})=>{const{data:n,getLastQueryRequest:l,isLoadingNewBundle:h,executeQueryRequest:c,error:o,asyncJobStatus:u}=Q(),{topLevelControlsState:b}=j(),[F,d]=z([]),[x,E]=z(!0),{showFacetVisualization:T,showFacetFilter:N}=b,p=l();Re(()=>{const i=q(n,e);i.length!==0&&x&&(d(i.map((y,_)=>({name:y.columnName,isHidden:_>=k,plotType:"PIE"}))),E(!1))},[n,x,e]);const s=i=>{d(y=>y.map((_,v)=>i?{..._,isHidden:!1}:{..._,isHidden:v>=k}))},m=i=>{p.query.selectedFacets=i,p.query.offset=0,c(p)},C=i=>F.find(v=>v.name===i&&v.isHidden===!0)!==void 0,f=Ie(()=>F.find(i=>i.isHidden===!0)?"MORE":F.length<=k?"NONE":"LESS",[F]),w=i=>{P(i,"isHidden",!0)},r=(i,y)=>{P(i,"plotType",y)},S=i=>{var _;const y=(_=F.find(v=>v.name===i))==null?void 0:_.plotType;return y!=null?y:"PIE"},P=(i,y,_)=>{d(v=>v.map(I=>I.name===i?{...I,[y]:_}:I))},J=(p==null?void 0:p.query.selectedFacets)!==void 0&&p.query.selectedFacets.length>0||(p==null?void 0:p.query.additionalFilters)!==void 0&&(p==null?void 0:p.query.additionalFilters.length)>0,Y=q(n,e),ee=q(n,e).map((i,y)=>({columnName:i.columnName,colorIndex:y}));return o?a(R,{}):!n&&h?a("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(u==null?void 0:u.progressMessage)&&g("div",{children:[a("span",{className:"spinner"}),u.progressMessage]})}):g(R,{children:[a(se,{frontText:"",endText:J?"Filtered By":"",showNotch:t}),Y.length>0&&g("div",{className:`FacetNav ${T?"":"hidden"} ${N?ie:ce} ${f==="LESS"?"less":""}`,children:[a("div",{className:"FacetNav__row",role:"list",children:Y.map(i=>{var y;return a("div",{className:"col-sm-12 col-md-4",style:{display:C(i.columnName)?"none":"block"},children:a(L,{index:(y=ee.find(_=>_.columnName===i.columnName))==null?void 0:y.colorIndex,onHide:()=>w(i.columnName),plotType:S(i.columnName),onSetPlotType:_=>r(i.columnName,_),facetToPlot:i,applyChangesToFacetFilter:m,applyChangesToGraphSlice:(_,v,I)=>$(p,_,m,v==null?void 0:v.value,I),isModalView:!1})},i.columnName)})}),f!=="NONE"&&a("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:a(X,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>s(f==="MORE"),style:{zIndex:500},children:f==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{H.displayName="FacetNav",H.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}},showNotch:{defaultValue:{value:"false"},description:"",name:"showNotch",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"]={docgenInfo:H.__docgenInfo,name:"FacetNav",path:"src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"})}catch{}export{M as F,O as Q,Te as a,H as b,we as e,q as g};
//# sourceMappingURL=FacetNav.26356ddd.js.map

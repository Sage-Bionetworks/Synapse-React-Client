import{r as y,a as _,j as g}from"./jsx-runtime.325e7137.js";import{h as c,k as m,bR as q,bS as O,bT as F,bU as P,R as d,bV as N,bW as x,bX as Q,bY as D,bZ as G,b_ as V,b$ as J,c0 as Y,c1 as K,c2 as H}from"./index.26ad4be5.js";import{u as o}from"./useMutation.f1179de1.js";import{u as I}from"./useInfiniteQuery.afe5b6da.js";import{g as W}from"./DiscussionSearchResult.c455ef4c.js";import{M as X}from"./MarkdownEditor.4efeb26f.js";import{B as E}from"./Button.2661b6a1.js";import{D as Z}from"./EntityChildren.50133102.js";function ye(e,n){const{accessToken:a}=c();return m(["moderators",e],()=>q(a,e),n)}function he(e,n,a,s,r,t){const{accessToken:i}=c();return I(["forumthread",e,"infinite",n,r,a,s],async u=>O(i,e,u.pageParam,n,a,s,r),{...t,getNextPageParam:(u,l)=>{if(u.results.length>0)return l.length*n}})}function Ce(e){const{data:n,isLoading:a}=$(e),{data:s,isLoading:r}=z(n,{enabled:!!n});return{threadData:n,threadBody:s,isLoading:r||a}}function $(e,n){const{accessToken:a}=c();return m(["thread",e,a],()=>F(e,a),n)}function z(e,n){var r;const{accessToken:a}=c(),s=P((r=e==null?void 0:e.messageKey)!=null?r:"",a);return m(["thread",e==null?void 0:e.id,e==null?void 0:e.messageKey,a],async()=>W((await s).messageUrl),n)}function j(e){const n=d(),{accessToken:a}=c();return o(s=>Q(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",r.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function ee(e){const n=d(),{accessToken:a}=c();return o(s=>D(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",r.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function se(e){const n=d(),{accessToken:a}=c();return o(s=>G(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["forumthread",s.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function _e(e){const n=d(),{accessToken:a}=c();return o(s=>N(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",r]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function Ee(e,n,a,s,r,t){const{accessToken:i}=c();return I(["thread",e,"infinite",a,r,s,n],async u=>x(i,e,a,u.pageParam,s,n,r),{...t,getNextPageParam:(u,l)=>{if(u.results.length>0)return l.length*a}})}function ae(e){const n=d(),{accessToken:a}=c();return o(s=>V(s,a),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",s.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function ne(e){const n=d(),{accessToken:a}=c();return o(s=>J(s,a),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",s.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}var re=(e=>(e.FORUM="FORUM",e.THREAD="THREAD",e.DATA_ACCESS_SUBMISSION="DATA_ACCESS_SUBMISSION",e.DATA_ACCESS_SUBMISSION_STATUS="DATA_ACCESS_SUBMISSION_STATUS",e))(re||{}),L=(e=>(e.SUBSCRIPTION_ID="SUBSCRIPTION_ID",e.SUBSCRIBER_ID="SUBSCRIBER_ID",e.OBJECT_ID="OBJECT_ID",e.OBJECT_TYPE="OBJECT_TYPE",e.CREATED_ON="CREATED_ON",e))(L||{});const T=({initialText:e,initialTitle:n,id:a,onClose:s,isReply:r})=>{const[t,i]=y.exports.useState(n!=null?n:""),[u,l]=y.exports.useState(e!=null?e:""),{mutate:f,isLoading:R}=j({onSuccess:()=>s()}),{mutate:b,isLoading:k}=ee({onSuccess:()=>s()}),{mutate:p,isLoading:A}=se({onSuccess:()=>s()}),{mutate:w,isLoading:B}=ae({onSuccess:()=>s()}),{mutate:M,isLoading:v}=ne({onSuccess:()=>s()}),h=k||B||A||R||v,U=(S,C)=>{r?e?M({replyId:a,messageMarkdown:S}):w({threadId:a,messageMarkdown:S}):n?(f({title:C,threadId:a}),b({messageMarkdown:S,threadId:a})):p({forumId:a,title:C,messageMarkdown:S})};return _("div",{className:"bootstrap-4-backport",children:[!r&&g("input",{placeholder:"Title",type:"text",style:{width:"100%",padding:"4px"},value:t,onChange:S=>i(S.target.value)}),g(X,{text:u,setText:l}),_("div",{style:{display:"flex",justifyContent:"flex-end"},children:[g(E,{onClick:s,variant:"light",children:"Cancel"}),g(E,{disabled:h,onClick:()=>U(u,t),variant:"primary",children:h?"Saving":"Save"})]})]})};try{T.displayName="ForumThreadEditor",T.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"]={docgenInfo:T.__docgenInfo,name:"ForumThreadEditor",path:"src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"})}catch{}function te(e,n,a){const{accessToken:s}=c();return m([s,"subscription",e,n],async()=>{const t={objectType:n,idList:[e],sortByType:L.OBJECT_ID,sortDirection:Z.ASC};return(await H(s,t)).results[0]},a)}function ce(e){const n=d(),{accessToken:a}=c();return o(s=>Y(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries([a,"subscription"]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function ue(e){const n=d(),{accessToken:a}=c();return o(s=>K(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries([a,"subscription"]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}const Ie=(e,n)=>{const{data:a,isLoading:s}=te(e,n),{mutate:r,isLoading:t}=ce(),{mutate:i,isLoading:u}=ue(),l=s||t||u,f=y.exports.useCallback(()=>{a?i(a.subscriptionId):r({objectId:e,objectType:n})},[i,e,n,r,a]);return{isLoading:l,subscription:a,toggleSubscribed:f}};export{T as F,re as S,ye as a,Ie as b,_e as c,Ee as d,he as e,Ce as u};

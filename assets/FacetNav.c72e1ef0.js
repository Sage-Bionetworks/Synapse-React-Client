import{ai as Ke,aj as $e,ag as Ge,B as je,af as Je,E as Ze,as as ee,at as ye,h as Xe,a9 as et,ae as tt,au as nt,av as at}from"./index.a37d8dd7.js";import{j as n,r as F,a as S,R as Be,F as P}from"./jsx-runtime.05444945.js";import{b as rt,i as st,r as ot,c as Pe}from"./queryUtils.517a1103.js";import{a as Ye,b as it,u as lt}from"./use-deep-compare-effect.esm.c3934740.js";import{u as ct}from"./useEntity.44d8fc6d.js";import{p as ut,a as dt}from"./sqlFunctions.02978512.js";import{c as W}from"./cloneDeep.9c8853b8.js";import{u as z,E as te}from"./ElementWithTooltip.7f3d40d3.js";import{u as Qe}from"./useGetInfoFromIds.086a064f.js";import{C as Y}from"./ColumnType.744125d2.js";import{I as se}from"./IconSvg.abab09ee.js";import{C as Ue}from"./Checkbox.d8bed1f5.js";import{D as U}from"./Dropdown.c0afb78a.js";import{C as De,a as pt}from"./Collapse.3aa549d7.js";import{R as mt}from"./RadioGroup.54d38b7b.js";import{h as qe}from"./moment.a565bb48.js";import{R as ft}from"./RangeSlider.f92e6857.js";import{c as yt,P as ht}from"./factory.e3a5734d.js";import{r as _t}from"./react-sizeme.3e30a9b5.js";import{S as St}from"./Skeleton.7e3a4321.js";import{g as Ct}from"./ColorGradient.16f0e0f2.js";import{l as gt}from"./LoadingScreen.fb5f4d08.js";import{T as Ft}from"./Tooltip.e02d1bf4.js";import{M as re}from"./Modal.45a88cca.js";import{B as Ie}from"./Button.0b1296fc.js";import{I as Et}from"./InfoOutlined.f00577f5.js";import{i as we}from"./TypeUtils.a2c41307.js";const j=e=>n(St,{style:{...e.style,display:"inline-block"},...e});try{j.displayName="SkeletonInlineBlock",j.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:j.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const M=F.exports.createContext(void 0),oe=({children:e,queryContext:t})=>n(M.Provider,{value:t,children:e});function G(){const e=F.exports.useContext(M);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function xn(){const e=F.exports.useContext(M);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function Nn(){const e=F.exports.useContext(M);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const he=M.Consumer;try{M.displayName="QueryContext",M.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:M.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{oe.displayName="QueryContextProvider",oe.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:oe.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{he.displayName="QueryContextConsumer",he.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:he.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}function Me(e,t){return`${e}${t}`}function xt(e,t){const o=window.location.search,a=`${e}=${t}`;return o?o.includes(`${e}=`)?window.location.search.slice(o.indexOf("?")+1).split("&").map(i=>i.split("=")[0]===e?`${a}`:i).join("&"):`${o.substr(1)}&${a}`:a}function Nt(e,t){if(!window.location.search)return;const o=Me(e,t),s=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(r=>r.split("=")[0]===o).map(r=>r.split("=")[1])[0];return s?decodeURIComponent(s):void 0}function Tt(e,t,o){const a=t!==void 0?Me(e,t):e,s=xt(a,o),r=window.location,i=`${r.protocol}//${r.hostname}${r.port?":"+r.port:""}${r.pathname}?${s}`;window.history.replaceState("object or string","Title",i)}function Rt(e,t){const o=Nt(e,t);let a;if(o){const s=JSON.parse(o);s.sql&&(a={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:Ke|$e|Ge|je,entityId:ut(s.sql),query:s})}return a}function vt(e){var y,l;const{initQueryRequest:t,componentIndex:o=0,shouldDeepLink:a=!1,onQueryChange:s}=e,[r,i]=F.exports.useState(t);F.exports.useEffect(()=>{const d=Rt("QueryWrapper",o);d&&i(d)},[o]);const u=F.exports.useCallback(()=>W(r),[r]);function E(){return W(t)}function m(d){let c;typeof d=="function"?c=d(u()):c=d;const R=W(c);if(i(R),R.query){const g=JSON.stringify(R.query);if(a){const I=encodeURIComponent(g);Tt("QueryWrapper",o,I)}s&&s(g)}}const{entityId:f,versionNumber:b}=dt(r.query.sql),x=(y=r.query.limit)!=null?y:Je,w=Math.ceil((((l=r.query.offset)!=null?l:0)+Number(x))/x);function C(d){m(c=>(c.query.limit=d,c))}function O(d){m(c=>(c.query.offset=(d-1)*x,c))}return{entityId:f,versionNumber:b,getInitQueryRequest:E,getLastQueryRequest:u,setQuery:m,pageSize:x,currentPage:w,setPageSize:C,goToPage:O}}const Oe="isShowingFacetFilters",Ae="isHidingFacetFilters";function _e(e){const{initQueryRequest:t,onQueryChange:o,onQueryResultBundleChange:a,lockedColumn:s,componentIndex:r,shouldDeepLink:i}=e,[u,E]=F.exports.useState(void 0),{entityId:m,versionNumber:f,getInitQueryRequest:b,getLastQueryRequest:x,setQuery:w,currentPage:C,pageSize:O,goToPage:y,setPageSize:l}=vt({initQueryRequest:t,shouldDeepLink:i,componentIndex:r,onQueryChange:o}),d=F.exports.useMemo(()=>x(),[x]),{data:c,isLoading:R,error:g,isPreviousData:I}=rt(d,{keepPreviousData:!0},E),q=c==null?void 0:c.responseBody,D=R||I,{data:k}=ct(m,f);Ye(()=>{q&&a&&a(JSON.stringify(q))},[q,a]);const T=q?st(q.facets,q.selectColumns):!0,V={data:F.exports.useMemo(()=>ot(q,s),[q,s]),currentPage:C,pageSize:O,setPageSize:l,isLoadingNewBundle:D,getLastQueryRequest:x,getInitQueryRequest:b,error:g,entity:k,executeQueryRequest:w,isFacetsAvailable:T,asyncJobStatus:u,goToPage:y},{children:p}=e;return n(oe,{queryContext:V,children:n("div",{className:`SRC-wrapper ${D?"SRC-logo-cursor":""} ${T?"has-facets":""}`,children:p})})}try{_e.displayName="QueryWrapper",_e.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:_e.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}const K=F.exports.createContext(void 0),ie=({children:e,queryVisualizationContext:t})=>n(K.Provider,{value:t,children:e});function ae(){const e=F.exports.useContext(K);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const Se=K.Consumer;function Ce(e){var O,y;const{data:t,getLastQueryRequest:o,isFacetsAvailable:a,isLoadingNewBundle:s}=G(),[r,i]=F.exports.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(O=e.defaultShowFacetVisualization)!=null?O:!0,showSearchBar:(y=e.defaultShowSearchBar)!=null?y:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});F.exports.useEffect(()=>{a||i(l=>({...l,showFacetFilter:!1,showFacetVisualization:!1}))},[a]),F.exports.useEffect(()=>{s&&f([])},[s]);const[u,E]=F.exports.useState([]),[m,f]=F.exports.useState([]),b=o(),x=it(t==null?void 0:t.selectColumns);F.exports.useEffect(()=>{var l,d;E((d=x==null?void 0:x.slice(0,(l=e.visibleColumnCount)!=null?l:1/0).map(c=>c.name))!=null?d:[])},[x,b.query.sql,e.visibleColumnCount]);const w={topLevelControlsState:r,setTopLevelControlsState:i,columnsToShowInTable:u,setColumnsToShowInTable:E,selectedRowIndices:m,setSelectedRowIndices:f,facetAliases:e.facetAliases,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn},{children:C}=e;return n(ie,{queryVisualizationContext:w,children:C})}try{Ce.displayName="QueryVisualizationWrapper",Ce.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:Ce.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{K.displayName="QueryVisualizationContext",K.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:K.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{ie.displayName="QueryVisualizationContextProvider",ie.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:ie.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{Se.displayName="QueryVisualizationContextConsumer",Se.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:Se.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}const ge=()=>{const{error:e}=G();return n(Ze,{error:e})};try{ge.displayName="QueryWrapperErrorBanner",ge.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"]={docgenInfo:ge.__docgenInfo,name:"QueryWrapperErrorBanner",path:"src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"})}catch{}var bt=(e=>(e.LIKE="LIKE",e))(bt||{}),It=(e=>(e.HAS="HAS",e.HAS_LIKE="HAS_LIKE",e))(It||{});const wt="org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",Ot="org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",At="org.sagebionetworks.repo.model.table.TextMatchesQueryFilter",Le=we(At),Fe=we(wt),Ee=we(Ot),le=e=>{var t;return S("svg",{...e,className:`Icon-Plus ${(t=e.className)!=null?t:""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]})};try{le.displayName="IconPlus",le.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconPlus.tsx#IconPlus"]={docgenInfo:le.__docgenInfo,name:"IconPlus",path:"src/lib/assets/icons/IconPlus.tsx#IconPlus"})}catch{}const ce=e=>{var t;return S("svg",{...e,className:`Icon-Minus ${(t=e.className)!=null?t:""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]})};try{ce.displayName="IconMinus",ce.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconMinus.tsx#IconMinus"]={docgenInfo:ce.__docgenInfo,name:"IconMinus",path:"src/lib/assets/icons/IconMinus.tsx#IconMinus"})}catch{}const J=({label:e,isCollapsed:t,onClick:o,facetAliases:a})=>S("div",{className:"FacetFilterHeader",children:[n("label",{className:"FacetFilterHeader__label",children:z(e,a)}),n("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>o(!t),children:t?n(le,{className:"icon-plus",title:"Expand Menu"}):n(ce,{className:"icon-minus",title:"Collapse Menu"})})]});try{J.displayName="FacetFilterHeader",J.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"Function"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!0,type:{name:"{} | undefined"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:J.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}function Vt(e){return e.replace(/\s/g,"").toLowerCase()}function ke(e,t=[],o=[]){const{value:a}=e;let s=a;a===ee&&(s=ye);const r=t.find(u=>u.ownerId===a);r&&(s=r?r.userName:`unknown (${a})`);const i=o.find(u=>u.id===a);return i&&(s=i?i.name:`unknown (${a})`),`${s}`}function Qt(e,t,o){const a=[...e.sort((s,r)=>r.count-s.count)];return t||a.length<=o||a.slice(o).find(s=>s.isSelected)?a:a.splice(0,o)}const $=({facetValues:e,columnModel:t,onClear:o,onChange:a,facetAliases:s,containerAs:r="Collapsible",dropdownType:i="Icon",collapsed:u=!1})=>{const[E,m]=F.exports.useState(!1),[f,b]=F.exports.useState(u),[x,w]=F.exports.useState(!1),[C,O]=F.exports.useState(!1),[y,l]=F.exports.useState(""),[d,c]=F.exports.useState(e);lt(()=>{c(e)},[e]);const R=5,g=1500,I=Be.createRef(),q={};let D;const k=e.filter(_=>_.isSelected).length===0,T=(t==null?void 0:t.columnType)===Y.USERID||(t==null?void 0:t.columnType)===Y.USERID_LIST?e.map(_=>_.value):[],A=Qe({ids:T,type:"USER_PROFILE"}),V=(t==null?void 0:t.columnType)===Y.ENTITYID||(t==null?void 0:t.columnType)===Y.ENTITYID_LIST?e.map(_=>_.value):[],p=Qe({ids:V,type:"ENTITY_HEADER"}),h=_=>{const Q=_.target.value;if(l(Q),m(!0),!Q)e.forEach(B=>{B.isSelected=!1}),c(e);else{const B=e.filter(H=>ke(H,A,p).toLowerCase().indexOf(Q.trim().toLowerCase())>-1?H:null);c(B)}};if(!t)return n(P,{});const N=r==="Dropdown",v=S("div",{className:N?"EnumFacetFilter__dropdown_menu":"",children:[S("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[S("div",{className:C?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[n("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{c(e),O(!1),m(!1)},children:n("span",{className:"EnumFacetFilter__previous",children:n(se,{options:{icon:"arrowBack"}})})}),y.length>0&&n("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var _;l(""),(_=I.current)==null||_.focus()},children:n("span",{className:"EnumFacetFilter__reset",children:n(se,{options:{icon:"close"}})})}),n("input",{type:"text",placeholder:"Find values",value:y,ref:I,onChange:_=>{h(_)}})]}),!C&&S("div",{className:"EnumFacetFilter__checkAll",children:[n(Ue,{className:"EnumFacetFilter__checkbox",onChange:()=>{o()},checked:k,label:"All",isSelectAll:!0},"select_all"),n("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var _;l(""),O(!0),(_=I.current)==null||_.focus()},children:n("span",{className:"EnumFacetFilter__searchicon",children:n(se,{options:{icon:"search"}})})})]})]}),S("div",{children:[d.length>0&&Qt(d,E||N,R).map((_,Q)=>n(qt,{id:Vt(_.value),index:Q,label:ke(_,A,p),count:_.count,isDropdown:N,initialIsSelected:_.isSelected,onChange:B=>{q[_.value]=B,clearTimeout(D),D=setTimeout(()=>{a(q),w(!1)},g)}},`checkLabel${Q}`)),!N&&S(P,{children:[!E&&d.length>R&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>m(!0),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:S("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",d.length,")"]})})}),E&&d.length>R&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>m(!1),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:n("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),d.length<=0&&n("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),L=()=>w(!x);return N?i==="SelectBox"?S(U,{className:"EnumFacetFilter EnumFacetFilterSelect",show:x,onToggle:L,children:[S(U.Toggle,{className:"secondary-caret",variant:"gray-select",children:[k&&"All",!k&&e.filter(_=>_.isSelected).length===1&&e.filter(_=>_.isSelected)[0].value,!k&&e.filter(_=>_.isSelected).length>1&&"Multiple Values Selected"]}),n(U.Menu,{children:v})]}):S(U,{className:"EnumFacetFilter",show:x,onToggle:L,children:[n(te,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),n(U.Menu,{children:v})]}):S(P,{children:[n(J,{facetAliases:s,isCollapsed:f,label:t.name,onClick:_=>b(_)}),n(De,{className:"EnumFacetFilter",in:!f,children:v})]})};function qt({id:e,index:t,label:o,count:a,isDropdown:s,initialIsSelected:r,onChange:i}){const[u,E]=F.exports.useState(r);return Be.useEffect(()=>{E(r)},[r]),S("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{s&&(E(!u),i(!u))},children:[n(Ue,{className:"EnumFacetFilter__checkbox",onClick:m=>m.stopPropagation(),onChange:m=>{E(m),i(m)},checked:u,label:o},`${e}-${t}`),s&&S("span",{className:"EnumFacetFilter__count",children:["(",a,")"]}),!s&&n("div",{className:"EnumFacetFilter__count",children:a})]})}try{$.displayName="EnumFacetFilter",$.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:$.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const ue=({facet:e,isChecked:t,onClick:o})=>{const{facetAliases:a}=ae();return S("button",{className:`Chip ${t?"Checked":""}`,onClick:o,children:[z(e.columnName,a),n(se,{options:{icon:t?"check":"add",size:"14px",padding:"left"}})]})};try{ue.displayName="FacetChip",ue.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"]={docgenInfo:ue.__docgenInfo,name:"FacetChip",path:"src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"})}catch{}const de=e=>{const t="Min value should be less then max value",[o,a]=F.exports.useState(!1),[s,r]=F.exports.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:qe(e.initialValues.min).format("YYYY-MM-DD"),max:qe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),i=e.className?`range ${e.className}`:"range",u=({min:m,max:f},b="number")=>{if(m==null||f===null||f===void 0)return a(!1),!0;if(b==="number"){if(Number(m)>Number(f))return a(!0),!1}else if(Date.parse(m)>Date.parse(f))return a(!0),!1;return a(!1),!0},E=(m,f,b="number")=>{u(m,b)&&f(m)};return S("div",{className:i,style:{display:"flex",flexWrap:"wrap"},children:[S("div",{style:{marginRight:"10px"},children:[n("input",{"aria-label":"min",type:e.type,value:s.min,onChange:({target:m})=>r({min:m.value,max:s.max})},"range_min"),n("div",{children:"to"}),n("input",{"aria-label":"max",type:e.type,value:s.max,onChange:({target:m})=>r({min:s.min,max:m.value})},"range_max")]}),n("button",{className:"btn btn-link SRC-noPadding",onClick:()=>E(s,e.onChange,e.type),children:"Apply"}),o&&n("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{de.displayName="Range",de.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:de.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}var ve=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(ve||{});const pe=({facetResult:e,columnModel:t,onChange:o,facetAliases:a,collapsed:s=!1})=>{const[r,i]=F.exports.useState(s),u=[{label:ye,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:E,columnMax:m,selectedMin:f,selectedMax:b}=e;const x=!f&&!b;f=f||E,b=b||m;const w=t.columnType==="DOUBLE"?"number":"date",C=(c,R)=>R?"":c===ee?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",O=(c,R)=>{l(c),c!=="RANGE"&&R([c,c])},[y,l]=F.exports.useState(C(f,x));return S("div",{children:[n(J,{isCollapsed:r,label:t.name,onClick:c=>i(c),facetAliases:a}),S(De,{in:!r,children:[n(mt,{value:y,id:"rangeSelector",options:u,onChange:c=>O(c,o)}),y==="RANGE"&&(E===m?n("label",{children:m}):S(P,{children:[t.columnType==="INTEGER"&&S(ft,{domain:[E,m],initialValues:{min:f,max:b},step:1,doUpdateOnApply:!0,onChange:c=>o([c.min,c.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&n(de,{initialValues:{min:f,max:b},type:w,onChange:c=>o([c.min,c.max])},"Range")]}))]})]})};try{pe.displayName="RangeFacetFilter",pe.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:pe.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const We=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected===!0).map(t=>t.value)}),Lt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Ve=(e,t)=>{var r,i;const o=(i=(r=t==null?void 0:t.query)==null?void 0:r.selectedFacets)!=null?i:[],a=o.findIndex(u=>u.columnName===e.columnName),s=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return a>-1?s?o.splice(a,1):o[a]=e:o.push(e),o};function ne(e,t,o,a,s=!1){a?t.facetValues.forEach(u=>{u.value===a&&(u.isSelected=s)}):t.facetValues.forEach(u=>{u.isSelected=!1});const r=We(t),i=Ve(r,e);o(i)}const be=(e,t,o,a)=>{const s=a&&Object.keys(a)||[];s.length&&t.facetValues.forEach(u=>{s.includes(u.value)&&(u.isSelected=a?!!a[u.value]:!1)});const r=We(t),i=Ve(r,e);o(i)},He=(e,t,o,a)=>{t.columnMin=a[0],t.columnMax=a[1];const s=Lt(t),r=Ve(s,e);o(r)},xe=({facetsToFilter:e})=>{var y;const{data:t,isLoadingNewBundle:o,getLastQueryRequest:a,executeQueryRequest:s}=G(),r=t==null?void 0:t.facets;let i;e==null?i=(y=r==null?void 0:r.map(l=>l.columnName))!=null?y:[]:i=e;const[u,E]=F.exports.useState([]),{facetAliases:m,topLevelControlsState:f}=ae(),{showFacetFilter:b}=f;if(Ye(()=>{E(i.slice(0,3))},[t==null?void 0:t.facets]),!t)return n(P,{});const x=t.selectColumns,w=a(),C=l=>{const d=a();d.query.selectedFacets=l,d.query.offset=0,s(d)},O=l=>{let d=[...u!=null?u:[""],l.columnName];u.includes(l.columnName)&&(d=d.filter(c=>c!=l.columnName)),E(d)};return S("div",{className:`QueryFilter ${b?Oe:Ae}`,children:[o&&n("div",{children:"Loading..."}),!o&&(r!=null?r:[]).filter(l=>u.includes(l.columnName)).map((l,d)=>{const c=x.find(R=>R.name===l.columnName);if(!Pe(l))return S("div",{className:"QueryFilter__facet",children:[l.facetType==="enumeration"&&c&&n($,{containerAs:"Collapsible",collapsed:!1,facetValues:l.facetValues,columnModel:c,facetAliases:m,onChange:R=>be(w,l,C,R),onClear:()=>ne(w,l,C)}),l.facetType==="range"&&c&&n(pe,{facetResult:l,columnModel:c,facetAliases:m,collapsed:!1,onChange:R=>He(w,l,C,R)})]},l.columnName)}),S("div",{children:[n("div",{className:"AvailableFacet",children:n("label",{className:"AvailableFacet__label",children:"Available Facets"})}),(r!=null?r:[]).filter(l=>i.includes(l.columnName)).map(l=>n(ue,{facet:l,onClick:()=>O(l),isChecked:u.includes(l.columnName)},l.columnName))]})]})};try{xe.displayName="QueryFilter",xe.__docgenInfo={description:"",displayName:"QueryFilter",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"]={docgenInfo:xe.__docgenInfo,name:"QueryFilter",path:"src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"})}catch{}const kt=yt(ht),Bt=19,Pt=30,Yt={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},Ut=(e,t)=>{t=t||0;let o=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let a=0;a<t;a++)o.indexOf(".")!==-1&&(o=o.replace("0%","%"),o=o.replace(".%","%"));return o};function ze(e,t){if(!e)return e;const o=e.trim();return o.length>t?o.substr(0,t-1)+"\u2026":e}async function Dt(e,t,o,a,s){var C,O;const{colorPalette:r}=Ct(o,e.facetValues.length),i=async(y,l,d)=>{const c=new Map;c.set(ee,ye);const R=y.map(g=>g.value).filter(g=>g!==ee);if(l===Y.ENTITYID||l===Y.ENTITYID_LIST){const g=await et(R,d);for(const I of g.results)c.set(I.id,I.name)}else if(l===Y.USERID||l===Y.USERID_LIST){const g=await tt(R,d);for(const I of g.children)c.set(I.ownerId,I.userName)}return y.map(g=>({facet:g,label:u(g,!1,c),truncatedLabel:u(g,!0,c),count:g.count}))},u=(y,l,d)=>{var R;let c=(R=d.get(y.value))!=null?R:y.value;return l&&(c=ze(c,Bt)),c},E=await i(e.facetValues,t,s),m=E.map(y=>y.truncatedLabel),b=e.facetValues.some(y=>y.isSelected)?e.facetValues.map((y,l)=>y.isSelected?r[l]:r[l].replace("rgb(","rgba(").replace(")",", 0.25)")):r,x={values:a==="PIE"?e.facetValues.map(y=>y.count):void 0,labels:E.map(y=>y.label),text:m,x:a==="BAR"?e.facetValues.map(y=>{var l,d;return(d=(l=E.find(c=>c.facet===y))==null?void 0:l.label)!=null?d:y.value}):void 0,y:a==="BAR"?e.facetValues.map(y=>y.count):void 0,facetEnumerationValues:e.facetValues.map(y=>y.value),name:e.columnName,hovertemplate:a==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:a==="PIE"?"pie":"bar",pull:a==="PIE"?e.facetValues.map(y=>y.isSelected?.1:0):void 0,marker:{colors:a==="PIE"?b:void 0,color:a==="BAR"?b:void 0}};return{data:[x],labels:E,colors:a==="PIE"?(C=x.marker)==null?void 0:C.colors:(O=x.marker)==null?void 0:O.color}}const Mt=(e,t,o)=>{if(e.points&&e.points[0]){const a=e.points[0],s=a.data.facetEnumerationValues[a.pointNumber],r=t.facetValues.find(i=>i.value===s);o(t,r,!r.isSelected)}};function Wt(e,t,o){const s=e?e*(t==="BAR"?.8:.6):200;let r=t==="PIE"?s:s/3;return r>o&&(r=o),{width:`${s}px`,height:`${r}px`}}function me(e){const{labels:t,colors:o=[],isExpanded:a}=e;if(!t)return n(P,{});const s=a?Math.min(t.length,9):Math.min(t.length,3);if(s===0)return n(P,{});const r=t.reduce((i,u)=>i+u.count,0);return n("div",{className:`FacetNavPanel__body__legend${a?"--expanded":""}`,children:t.slice(0,s).map((i,u)=>{const m=`(${Ut(i.count/r,1)}) ${i.label}`,f=ze(m,Pt);return n(te,{idForToolTip:i.label,tooltipText:i.label,children:S("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[n("div",{style:{backgroundColor:o[u]}}),n("label",{children:f})]},`legendLabel_${u}`)},i.label)})})}const Ht=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",Z=e=>{const{onHide:t,isModalView:o,applyChangesToFacetFilter:a,applyChangesToGraphSlice:s,index:r,facetToPlot:i,plotType:u,onSetPlotType:E}=e,{accessToken:m}=Xe(),{data:f,isLoadingNewBundle:b,getLastQueryRequest:x}=G(),{facetAliases:w}=ae(),[C,O]=F.exports.useState(),[y,l]=F.exports.useState(!1),d=z(i.columnName,w),c=F.exports.useCallback(()=>{var g,I;return(I=(g=f==null?void 0:f.columnModels)==null?void 0:g.find(q=>q.name===i.columnName))==null?void 0:I.columnType},[f,i.columnName]);F.exports.useEffect(()=>{let g=!0;if(i)Dt(i,c(),r,u,m).then(I=>{g&&O(I)});else return;return()=>{g=!1}},[i,f,r,u,m,c]);const R=()=>S("div",{onClick:g=>{g.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),S(U,{children:[n(U.Toggle,{className:"secondary-caret",variant:"gray-select",children:u==="PIE"?"Pie Chart":"Bar Chart"}),S(U.Menu,{className:"chart-tools",children:[n(U.Item,{as:"button",onClick:()=>E("BAR"),children:"Bar Chart"}),n(U.Item,{as:"button",onClick:()=>E("PIE"),children:"Pie Chart"})]})]})]});return!f&&b||!i?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:gt}):S(P,{children:[S(re,{animation:!1,show:y,onHide:()=>l(!1),backdrop:"static",children:[n(re.Header,{closeButton:!0,children:n(re.Title,{children:d!=null?d:""})}),S(re.Body,{children:[n(Z,{...e,isModalView:!0}),n("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:n(Ie,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>l(!1),children:"Apply Filters"})})]})]}),S("div",{role:"graphics-document",className:`FacetNavPanel${o?"--expanded":""}`,children:[!o&&S("div",{className:"FacetNavPanel__title",children:[!f&&b?n(j,{width:100}):n("span",{className:"FacetNavPanel__title__name",children:d}),S("div",{className:"FacetNavPanel__title__tools",children:[n($,{facetValues:i.facetValues,columnModel:f==null?void 0:f.columnModels.find(g=>g.name===i.columnName),facetAliases:w,onChange:g=>{be(x(),i,a,g)},onClear:()=>{ne(x(),i,a)},containerAs:"Dropdown"}),n(te,{idForToolTip:"expandGraph",tooltipText:"Expand to large graph",callbackFn:()=>l(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),n(te,{idForToolTip:"hideGraph",tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),o&&S(P,{children:[S("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),n($,{facetValues:i.facetValues,columnModel:f==null?void 0:f.columnModels.find(g=>g.name===i.columnName),facetAliases:w,onChange:g=>{be(x(),i,a,g)},onClear:()=>{ne(x(),i,a)},containerAs:"Dropdown",dropdownType:"SelectBox"}),n(Ft,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:n(Et,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),n(R,{})]}),S("div",{className:`FacetNavPanel__body${o?"--expanded":""}`,children:[n(_t.SizeMe,{monitorHeight:!0,children:({size:g})=>{var I;return n("div",{className:Ht(o,u),children:n(kt,{layout:Yt,data:(I=C==null?void 0:C.data)!=null?I:[],style:Wt(g.width,u,o?300:150),config:{displayModeBar:!1},onClick:q=>Mt(q,i,s)},`${i.columnName}-${u}-${g.width}`)})}}),n(me,{labels:C==null?void 0:C.labels,colors:C==null?void 0:C.colors,isExpanded:o})]})]})]})};try{me.displayName="FacetPlotLegend",me.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"]={docgenInfo:me.__docgenInfo,name:"FacetPlotLegend",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"})}catch{}try{Z.displayName="FacetNavPanel",Z.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"]={docgenInfo:Z.__docgenInfo,name:"FacetNavPanel",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"})}catch{}const zt=()=>{try{return JSON.parse(sessionStorage.getItem(nt)||"")}catch{return[]}},Kt=()=>{try{return JSON.parse(sessionStorage.getItem(at)||"")}catch{return[]}},X=e=>{let t,o="";if("facetWithSelection"in e){const{facetWithSelection:s}=e;s.facet.facetType==="enumeration"?t=s.displayValue===ee?ye:s.displayValue:t=`${s.facet.selectedMin} 
        - ${s.facet.selectedMax}`,o=`${z(s.facet.columnName)}: ${t}`}else if("filter"in e){const{filter:s}=e;let r=s.value;(r==null?void 0:r.startsWith("%"))&&(r==null?void 0:r.endsWith("%"))&&(r=r.substring(1,r.length-1)),t=r,o=`Text matches: "${r}"`,s.columnName&&(t=`"${r}" in ${z(s==null?void 0:s.columnName)}`,o=`${z(s==null?void 0:s.columnName)}: ${r}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const a=encodeURIComponent(o);return n(te,{idForToolTip:`selectionCriteria_${a}`,tooltipText:o,callbackFn:()=>{},children:S("div",{className:"SelectionCriteriaPill",children:[n("span",{children:t}),n("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:n(pt,{})})]},`SelectionCriteriaPill ${a}`)})};try{X.displayName="SelectionCriteriaPill",X.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:X.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const fe=({style:e,frontText:t,endText:o="",hideIfUnfiltered:a=!1})=>{var V;const{data:s,isLoadingNewBundle:r,getLastQueryRequest:i,executeQueryRequest:u,getInitQueryRequest:E,error:m}=G(),{topLevelControlsState:f,unitDescription:b}=ae(),x=s==null?void 0:s.queryCount,[w,C]=F.exports.useState([]),O=p=>{const h=W(i());h.query.selectedFacets=p,h.query.offset=0,u(h)},y=p=>p.filter(v=>v.facetType==="enumeration").filter(v=>v.facetValues.filter(L=>L.isSelected===!0).length>0),l=p=>p.filter(v=>v.facetType==="range").filter(v=>v.selectedMax||v.selectedMin),d=(p,h)=>{var v;const N=p.find(L=>L.id===h);return(v=N==null?void 0:N.name)!=null?v:h},c=(p,h)=>{const N=p.find(v=>v.ownerId===h);return(N==null?void 0:N.userName)||h},R=F.exports.useCallback((p,h)=>{const N=zt(),v=Kt(),L=[];return p.forEach(_=>{const Q=h.find(B=>B.name===_.columnName);_.facetValues.forEach(B=>{if(B.isSelected){let H=B.value;(Q==null?void 0:Q.columnType)===Y.ENTITYID||(Q==null?void 0:Q.columnType)===Y.ENTITYID_LIST?H=d(N,B.value):((Q==null?void 0:Q.columnType)===Y.USERID||(Q==null?void 0:Q.columnType)===Y.USERID_LIST)&&(H=c(v,B.value)),L.push({facet:_,displayValue:H,selectedValue:B})}})}),L},[]);F.exports.useEffect(()=>{if(s){const p=l(s.facets),h=y(s.facets),N=p.map(L=>({facet:L})),v=R(h,s.columnModels);C([...N,...v])}},[s,R]);const g=p=>{const{facet:h,selectedValue:N}=p;h.facetType==="enumeration"?ne(i(),h,O,N==null?void 0:N.value,!1):He(i(),h,O,[ve.ANY,ve.ANY])},I=(p,h)=>{var v;const N=W(i());!N.query.additionalFilters||(N.query.additionalFilters=(v=N.query.additionalFilters)==null?void 0:v.reduce(function(L,_){if(Fe(_)||Ee(_)){const Q={columnName:_.columnName,values:_.columnName===p?_.values.filter(B=>B!==h):_.values,operator:Fe(_)?_.operator:void 0,function:Ee(_)?_.function:void 0,concreteType:_.concreteType};Q.values.length>0&&L.push(Q)}else L.push(_);return L},[]),u(N))},q=p=>{const h=W(i());!h.query.additionalFilters||(h.query.additionalFilters=h.query.additionalFilters.filter(N=>!(Le(N)&&N.searchExpression===p.searchExpression)),u(h))},D=()=>{const p=W(E());p.query.additionalFilters=[],u(p)},k=(V=i().query.additionalFilters)==null?void 0:V.reduce((p,h)=>{if(Le(h))p.push({key:`fulltextsearch-${h.searchExpression}`,filter:{value:h.searchExpression},onRemove:()=>q(h)});else if(Fe(h)||Ee(h)){const{columnName:N}=h;h.values.forEach(v=>{p.push({key:`columnsearch-${v}`,filter:{columnName:N,value:v},onRemove:()=>I(h.columnName,v)})})}else console.warn("Encountered unexpected QueryFilter: ",h);return p},[]),T=f==null?void 0:f.showFacetFilter,A=w.length>0||k&&k.length>0;return m?n(P,{}):n("div",{className:`TotalQueryResults ${T?Oe:Ae}`,style:e,children:r?n(j,{width:100}):S(P,{children:[(A||!a)&&S("span",{className:"SRC-boldText SRC-centerContent",children:[t," ",x==null?void 0:x.toLocaleString()," ",b," ",o]}),S("div",{className:"TotalQueryResults__selections",children:[k&&k.map(p=>F.exports.createElement(X,{...p,key:p.key})),w.map((p,h)=>{var N,v,L;return n(X,{facetWithSelection:p,onRemove:()=>g(p)},`facets-${(L=(v=(N=p.selectedValue)==null?void 0:N.value)!=null?v:p.displayValue)!=null?L:h}`)}),(w.length>2||k&&k.length>2)&&n(Ie,{onClick:D,variant:"light",className:"TotalQueryResults__clearall",children:"Clear All"})]})]})})};try{fe.displayName="TotalQueryResults",fe.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:{value:"false"},description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:fe.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}const Ne=2;function Te(e,t){var a,s;return(s=(a=e==null?void 0:e.facets)==null?void 0:a.filter(r=>r.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(r.columnName)>-1)&&r.facetValues.length>0&&!Pe(r)))!=null?s:[]}const Re=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:o,isLoadingNewBundle:a,executeQueryRequest:s,error:r,asyncJobStatus:i}=G(),{topLevelControlsState:u}=ae(),[E,m]=F.exports.useState([]),[f,b]=F.exports.useState(!0),{showFacetVisualization:x,showFacetFilter:w}=u,C=o();F.exports.useEffect(()=>{const T=Te(t,e);T.length!==0&&f&&(m(T.map((A,V)=>({name:A.columnName,isHidden:V>=Ne,plotType:"PIE"}))),b(!1))},[t,f,e]);const O=T=>{m(A=>A.map((V,p)=>T?{...V,isHidden:!1}:{...V,isHidden:p>=Ne}))},y=T=>{C.query.selectedFacets=T,C.query.offset=0,s(C)},l=T=>E.find(p=>p.name===T&&p.isHidden===!0)!==void 0,d=F.exports.useMemo(()=>E.find(T=>T.isHidden===!0)?"MORE":E.length<=Ne?"NONE":"LESS",[E]),c=T=>{I(T,"isHidden",!0)},R=(T,A)=>{I(T,"plotType",A)},g=T=>{var V;const A=(V=E.find(p=>p.name===T))==null?void 0:V.plotType;return A!=null?A:"PIE"},I=(T,A,V)=>{m(p=>p.map(h=>h.name===T?{...h,[A]:V}:h))},q=Te(t,e),D=Te(t,e).map((T,A)=>({columnName:T.columnName,colorIndex:A})),k=(C==null?void 0:C.query.selectedFacets)!==void 0&&C.query.selectedFacets.length>0||(C==null?void 0:C.query.additionalFilters)!==void 0&&(C==null?void 0:C.query.additionalFilters.length)>0;return r?n(P,{}):!t&&a?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(i==null?void 0:i.progressMessage)&&S("div",{children:[n("span",{className:"spinner"}),i.progressMessage]})}):S(P,{children:[n(fe,{frontText:"",endText:k?"filtered by":"",hideIfUnfiltered:!0}),q.length>0&&S("div",{className:`FacetNav ${x?"":"hidden"} ${w?Oe:Ae} ${d==="LESS"?"less":""}`,children:[n("div",{className:"FacetNav__row",role:"list",children:q.map(T=>{var A;return n("div",{className:"col-sm-12 col-md-4",style:{display:l(T.columnName)?"none":"block"},children:n(Z,{index:(A=D.find(V=>V.columnName===T.columnName))==null?void 0:A.colorIndex,onHide:()=>c(T.columnName),plotType:g(T.columnName),onSetPlotType:V=>R(T.columnName,V),facetToPlot:T,applyChangesToFacetFilter:y,applyChangesToGraphSlice:(V,p,h)=>ne(C,V,y,p==null?void 0:p.value,h),isModalView:!1})},T.columnName)})}),d!=="NONE"&&n("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:n(Ie,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>O(d==="MORE"),style:{zIndex:500},children:d==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Re.displayName="FacetNav",Re.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"]={docgenInfo:Re.__docgenInfo,name:"FacetNav",path:"src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"})}catch{}export{It as C,$ as E,Re as F,ce as I,Oe as Q,j as S,fe as T,Ae as a,ae as b,vt as c,oe as d,Ee as e,bt as f,xn as g,be as h,Fe as i,ne as j,Ce as k,he as l,Se as m,ge as n,xe as o,_e as p,Nn as q,Te as r,Dt as s,Wt as t,G as u,me as v,le as w};

import{f as Be,E as Ge,L as De,h as je,aa as Je,ag as Ze}from"./index.95357afa.js";import{j as n,r as m,a as y,F as Q,R as Ae}from"./jsx-runtime.41b63a18.js";import{b as Xe,i as et,r as tt,h as nt,c as Me}from"./queryUtils.d3ddbdc4.js";import{a as Ue,b as at,u as rt}from"./use-deep-compare-effect.esm.89e0b2bf.js";import{s as ot}from"./NoSearchResults.f5a12ecf.js";import{N as st}from"./NoData.33ecea8a.js";import{u as lt}from"./unCamelCase.07e38083.js";import{C as L}from"./ColumnType.744125d2.js";import{q as it,r as ct,p as ut,i as dt,j as pt,o as mt,V as Z,w as ye,x as ft,y as yt,z as ht}from"./SynapseConstants.b6aa8bf5.js";import{u as _t}from"./useEntity.f187f17a.js";import{p as Ct,a as gt}from"./sqlFunctions.be6fa141.js";import{i as ve,a as Ie,c as St}from"./QueryFilter.425a36f4.js";import{c as _e}from"./cloneDeep.972a710a.js";import{i as te}from"./isEqual.c98a7e38.js";import{E as me}from"./ElementWithTooltip.a20fbba5.js";import{u as Ce}from"./useGetInfoFromIds.440675b0.js";import{I as W}from"./IconSvg.83d367d8.js";import{C as Ye}from"./Checkbox.f849d68d.js";import{D as q}from"./Dropdown.1ea1e7ae.js";import{R as Ft}from"./RadioGroup.42f82ea0.js";import{h as qe}from"./moment.a565bb48.js";import{R as Et}from"./RangeSlider.a2b8db98.js";import{c as xt,P as Tt}from"./factory.4d558efc.js";import{r as Nt}from"./react-sizeme.6754aec4.js";import{S as bt}from"./Skeleton.2b632001.js";import{g as Rt}from"./ColorGradient.16f0e0f2.js";import{l as vt}from"./LoadingScreen.8b1b27b2.js";import{T as It}from"./Tooltip.50b065de.js";import{M as ne}from"./Modal.493b8aac.js";import{B as $e}from"./Button.d66b1296.js";import{I as Vt}from"./InfoOutlined.62b2381c.js";import{S as wt}from"./SelectionCriteriaPill.5fe230c2.js";const At="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",Ot="org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",Ve=Be(At),Qt=Be(Ot),G=e=>n(bt,{style:{...e.style,display:"inline-block"},...e});try{G.displayName="SkeletonInlineBlock",G.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:G.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const B=m.exports.createContext(void 0),ae=({children:e,queryContext:t})=>n(B.Provider,{value:t,children:e});function M(){const e=m.exports.useContext(B);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function Wn(){const e=m.exports.useContext(B);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function Gn(){const e=m.exports.useContext(B);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const ge=B.Consumer;try{B.displayName="QueryContext",B.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:B.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{ae.displayName="QueryContextProvider",ae.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:ae.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{ge.displayName="QueryContextConsumer",ge.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:ge.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}function ze(e,t){return`${e}${t}`}function Lt(e,t){const a=window.location.search,r=`${e}=${t}`;return a?a.includes(`${e}=`)?window.location.search.slice(a.indexOf("?")+1).split("&").map(l=>l.split("=")[0]===e?`${r}`:l).join("&"):`${a.substr(1)}&${r}`:r}function kt(e,t){if(!window.location.search)return;const a=ze(e,t),o=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(s=>s.split("=")[0]===a).map(s=>s.split("=")[1])[0];return o?decodeURIComponent(o):void 0}function qt(e,t,a){const r=t!==void 0?ze(e,t):e,o=Lt(r,a),s=window.location,l=`${s.protocol}//${s.hostname}${s.port?":"+s.port:""}${s.pathname}?${o}`;window.history.replaceState("object or string","Title",l)}function Pt(e,t){const a=kt(e,t);let r;if(a){const o=JSON.parse(a);o.sql&&(r={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:it|ct|ut|dt|pt,entityId:Ct(o.sql),query:o})}return r}function Bt(e){var f,T;const{initQueryRequest:t,componentIndex:a=0,shouldDeepLink:r=!1,onQueryChange:o}=e,[s,l]=m.exports.useState(t);m.exports.useEffect(()=>{const N=Pt("QueryWrapper",a);N&&l(N)},[a]);const u=m.exports.useCallback(()=>_e(s),[s]),d=m.exports.useCallback(()=>_e(t),[t]),i=m.exports.useCallback(N=>{let b;typeof N=="function"?b=N(u()):b=N;const w=_e(b);if(l(w),w.query){const h=JSON.stringify(w.query);if(r){const _=encodeURIComponent(h);qt("QueryWrapper",a,_)}o&&o(h)}},[a,u,o,r]),{entityId:p,versionNumber:v}=m.exports.useMemo(()=>gt(s.query.sql),[s.query.sql]),E=(f=s.query.limit)!=null?f:mt,A=Math.ceil((((T=s.query.offset)!=null?T:0)+Number(E))/E),C=m.exports.useCallback(N=>{i(b=>(b.query.limit=N,b))},[i]),V=m.exports.useCallback(N=>{i(b=>(b.query.offset=(N-1)*E,b))},[E,i]),g=m.exports.useCallback(()=>{i(t)},[t,i]),x=m.exports.useCallback(N=>{i(b=>{var w;return b.query.selectedFacets=((w=b.query.selectedFacets)!=null?w:[]).filter(h=>!te(h,N)),b})},[i]),c=m.exports.useCallback((N,b)=>{i(w=>{var h;return w.query.selectedFacets=((h=w.query.selectedFacets)!=null?h:[]).map(_=>(Ve(_)&&te(_,N)&&(_.facetValues=_.facetValues.filter(F=>F!==b)),_)).filter(_=>Ve(_)?Array.isArray(_.facetValues)&&_.facetValues.length>0:!0),w})},[i]),S=m.exports.useCallback(N=>{i(b=>{var w;return b.query.additionalFilters=((w=b.query.additionalFilters)!=null?w:[]).filter(h=>!te(h,N)),b})},[i]),I=m.exports.useCallback((N,b)=>{i(w=>{var h;return w.query.additionalFilters=((h=w.query.additionalFilters)!=null?h:[]).map(_=>((ve(_)||Ie(_))&&te(_,N)&&(_.values=_.values.filter(F=>F!==b)),_)).filter(_=>ve(_)||Ie(_)?Array.isArray(_.values)&&_.values.length>0:!0),w})},[i]);return{entityId:p,versionNumber:v,getInitQueryRequest:d,getLastQueryRequest:u,setQuery:i,pageSize:E,currentPage:A,setPageSize:C,goToPage:V,resetQuery:g,removeSelectedFacet:x,removeValueFromSelectedFacet:c,removeQueryFilter:S,removeValueFromQueryFilter:I}}const Oe="isShowingFacetFilters",Qe="isHidingFacetFilters";function Se(e){const{initQueryRequest:t,onQueryChange:a,onQueryResultBundleChange:r,lockedColumn:o,componentIndex:s,shouldDeepLink:l}=e,[u,d]=m.exports.useState(void 0),{entityId:i,versionNumber:p,getInitQueryRequest:v,getLastQueryRequest:E,setQuery:A,currentPage:C,pageSize:V,goToPage:g,setPageSize:x,resetQuery:c,removeSelectedFacet:S,removeValueFromSelectedFacet:I,removeQueryFilter:f,removeValueFromQueryFilter:T}=Bt({initQueryRequest:t,shouldDeepLink:l,componentIndex:s,onQueryChange:a}),N=m.exports.useMemo(()=>E(),[E]),{data:b,isLoading:w,error:h,isPreviousData:_}=Xe(N,{keepPreviousData:!0},d),F=b==null?void 0:b.responseBody,O=w||_,{data:k}=_t(i,p);Ue(()=>{F&&r&&r(JSON.stringify(F))},[F,r]);const X=F?et(F.facets,F.selectColumns):!0,D=m.exports.useMemo(()=>tt(F,o),[F,o]),K=m.exports.useMemo(()=>{const $=E();return nt($.query,o)},[E,o]),ee=m.exports.useCallback($=>{var he,ke;return(ke=(he=F==null?void 0:F.columnModels)==null?void 0:he.find(We=>We.name===$))!=null?ke:null},[F==null?void 0:F.columnModels]),R={data:D,currentPage:C,pageSize:V,setPageSize:x,isLoadingNewBundle:O,getLastQueryRequest:E,getInitQueryRequest:v,error:h,entity:k,executeQueryRequest:A,isFacetsAvailable:X,asyncJobStatus:u,goToPage:g,hasResettableFilters:K,removeSelectedFacet:S,removeValueFromSelectedFacet:I,resetQuery:c,removeQueryFilter:f,removeValueFromQueryFilter:T,lockedColumn:o,getColumnModel:ee},{children:P}=e;return n(ae,{queryContext:R,children:n("div",{className:`SRC-wrapper ${O?"SRC-logo-cursor":""} ${X?"has-facets":""}`,children:P})})}try{Se.displayName="QueryWrapper",Se.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:Se.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}function Dt(){return y(Q,{children:[n("p",{className:"SRC-no-results-title",children:"There is currently no content here."}),n("p",{className:"SRC-no-results-description",children:"Information is always being updated, so check back later to see if content has been added."})]})}var re=(e=>(e.INTERACTIVE="INTERACTIVE",e.STATIC="STATIC",e))(re||{});function Mt(){return y("div",{className:"text-center",children:[ot,n("h4",{children:"No Matching Results"}),n("p",{children:"Try checking the spelling or removing filters."})]})}function Ut(){return y("div",{className:"text-center SRCBorderedPanel SRCBorderedPanel--padded2x",children:[st,n("div",{style:{marginTop:"20px",fontStyle:"italic"},children:"This table is currently empty"})]})}const Yt=()=>{try{return JSON.parse(sessionStorage.getItem(ft)||"")}catch{return[]}},$t=()=>{try{return JSON.parse(sessionStorage.getItem(yt)||"")}catch{return[]}},zt=()=>{try{return JSON.parse(sessionStorage.getItem(ht)||"")}catch{return[]}},Ht=e=>{var a;const t=Yt().find(r=>r.id===e);return(a=t==null?void 0:t.name)!=null?a:e},Kt=e=>{const t=zt().find(a=>a.id===e);return(t==null?void 0:t.name)||e},Wt=e=>{const t=$t().find(a=>a.ownerId===e);return(t==null?void 0:t.userName)||e},Gt=(e,t)=>{if(e===Z)return ye;switch(t){case L.ENTITYID:case L.ENTITYID_LIST:return Ht(e);case L.USERID:case L.USERID_LIST:return Wt(e);case L.EVALUATIONID:return Kt(e);default:return e}},z=m.exports.createContext(void 0),oe=({children:e,queryVisualizationContext:t})=>n(z.Provider,{value:t,children:e});function U(){const e=m.exports.useContext(z);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const Fe=z.Consumer;function Ee(e){var I,f;const{noContentPlaceholderType:t=re.INTERACTIVE}=e,{data:a,getLastQueryRequest:r,isFacetsAvailable:o,isLoadingNewBundle:s,hasResettableFilters:l}=M(),{columnAliases:u={}}=e,[d,i]=m.exports.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(I=e.defaultShowFacetVisualization)!=null?I:!0,showSearchBar:(f=e.defaultShowSearchBar)!=null?f:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});m.exports.useEffect(()=>{o||i(T=>({...T,showFacetFilter:!1,showFacetVisualization:!1}))},[o]),m.exports.useEffect(()=>{s&&A([])},[s]);const[p,v]=m.exports.useState([]),[E,A]=m.exports.useState([]),C=r(),V=at(a==null?void 0:a.selectColumns);m.exports.useEffect(()=>{var T,N;v((N=V==null?void 0:V.slice(0,(T=e.visibleColumnCount)!=null?T:1/0).map(b=>b.name))!=null?N:[])},[V,C.query.sql,e.visibleColumnCount]);const g=m.exports.useCallback(T=>{const N=localStorage.getItem("force-display-original-column-names")==="true";return!T||N?T:u[T]?u[T]:lt(T)},[u]),x=m.exports.useCallback(()=>{switch(t){case re.INTERACTIVE:return l?n(Mt,{}):n(Ut,{});case re.STATIC:default:return n(Dt,{})}},[t,l]),c={topLevelControlsState:d,setTopLevelControlsState:i,columnsToShowInTable:p,setColumnsToShowInTable:v,selectedRowIndices:E,setSelectedRowIndices:A,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:g,getDisplayValue:Gt,NoContentPlaceholder:x},{children:S}=e;return n(oe,{queryVisualizationContext:c,children:S})}try{Ee.displayName="QueryVisualizationWrapper",Ee.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}},noContentPlaceholderType:{defaultValue:null,description:"Default is INTERACTIVE",name:"noContentPlaceholderType",required:!1,type:{name:"enum",value:[{value:'"INTERACTIVE"'},{value:'"STATIC"'}]}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:Ee.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{z.displayName="QueryVisualizationContext",z.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:z.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{oe.displayName="QueryVisualizationContextProvider",oe.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:oe.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{Fe.displayName="QueryVisualizationContextConsumer",Fe.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:Fe.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}const xe=()=>{const{error:e}=M();return n(Ge,{error:e})};try{xe.displayName="QueryWrapperErrorBanner",xe.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"]={docgenInfo:xe.__docgenInfo,name:"QueryWrapperErrorBanner",path:"src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"})}catch{}const se=e=>{var t;return y("svg",{...e,className:`Icon-Plus ${(t=e.className)!=null?t:""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]})};try{se.displayName="IconPlus",se.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconPlus.tsx#IconPlus"]={docgenInfo:se.__docgenInfo,name:"IconPlus",path:"src/lib/assets/icons/IconPlus.tsx#IconPlus"})}catch{}const le=e=>{var t;return y("svg",{...e,className:`Icon-Minus ${(t=e.className)!=null?t:""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]})};try{le.displayName="IconMinus",le.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconMinus.tsx#IconMinus"]={docgenInfo:le.__docgenInfo,name:"IconMinus",path:"src/lib/assets/icons/IconMinus.tsx#IconMinus"})}catch{}const j=({label:e,isCollapsed:t,onClick:a})=>{const{getColumnDisplayName:r}=U();return y("div",{className:"FacetFilterHeader",children:[n("label",{className:"FacetFilterHeader__label",children:r(e)}),n("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>a(!t),children:t?n(se,{className:"icon-plus",title:"Expand Menu"}):n(le,{className:"icon-minus",title:"Collapse Menu"})})]})};try{j.displayName="FacetFilterHeader",j.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:j.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}function jt(e){return e.replace(/\s/g,"").toLowerCase()}function Pe(e,t=[],a=[],r=[]){const{value:o}=e;let s=o;o===Z&&(s=ye);const l=t.find(i=>i.ownerId===o);l&&(s=l?l.userName:`unknown (${o})`);const u=a.find(i=>i.id===o);u&&(s=u?u.name:`unknown (${o})`);const d=r.find(i=>i.id===o);return d!=null&&d.name&&(s=d.name),`${s}`}function Jt(e,t,a){const r=[...e.sort((o,s)=>s.count-o.count)];return t||r.length<=a||r.slice(a).find(o=>o.isSelected)?r:r.splice(0,a)}const H=({facetValues:e,columnModel:t,onClear:a,onChange:r,containerAs:o="Collapsible",dropdownType:s="Icon",collapsed:l=!1})=>{const[u,d]=m.exports.useState(!1),[i,p]=m.exports.useState(l),[v,E]=m.exports.useState(!1),[A,C]=m.exports.useState(!1),[V,g]=m.exports.useState(""),[x,c]=m.exports.useState(e);rt(()=>{c(e)},[e]);const S=5,I=1500,f=Ae.createRef(),T={};let N;const b=e.filter(R=>R.isSelected).length===0,w=(t==null?void 0:t.columnType)===L.USERID||(t==null?void 0:t.columnType)===L.USERID_LIST?e.map(R=>R.value):[],h=Ce({ids:w,type:"USER_PROFILE"}),_=(t==null?void 0:t.columnType)===L.ENTITYID||(t==null?void 0:t.columnType)===L.ENTITYID_LIST?e.map(R=>R.value):[],F=Ce({ids:_,type:"ENTITY_HEADER"}),O=(t==null?void 0:t.columnType)===L.EVALUATIONID?e.map(R=>R.value):[],k=Ce({ids:O,type:"EVALUATION_QUEUE"}),X=R=>{const P=R.target.value;if(g(P),d(!0),!P)e.forEach(Y=>{Y.isSelected=!1}),c(e);else{const Y=e.filter($=>Pe($,h,F,k).toLowerCase().indexOf(P.trim().toLowerCase())>-1?$:null);c(Y)}};if(!t)return n(Q,{});const D=o==="Dropdown",K=y("div",{className:D?"EnumFacetFilter__dropdown_menu":"",children:[y("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[y("div",{className:A?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[n("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{c(e),C(!1),d(!1)},children:n("span",{className:"EnumFacetFilter__previous",children:n(W,{options:{icon:"arrowBack"}})})}),V.length>0&&n("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var R;g(""),(R=f.current)==null||R.focus()},children:n("span",{className:"EnumFacetFilter__reset",children:n(W,{options:{icon:"close"}})})}),n("input",{type:"text",placeholder:"Find values",value:V,ref:f,onChange:R=>{X(R)}})]}),!A&&y("div",{className:"EnumFacetFilter__checkAll",children:[n(Ye,{className:"EnumFacetFilter__checkbox",onChange:()=>{a()},checked:b,label:"All",isSelectAll:!0},"select_all"),n("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var R;g(""),C(!0),(R=f.current)==null||R.focus()},children:n("span",{className:"EnumFacetFilter__searchicon",children:n(W,{options:{icon:"search"}})})})]})]}),y("div",{children:[x.length>0&&Jt(x,u||D,S).map((R,P)=>n(Zt,{id:jt(R.value),index:P,label:Pe(R,h,F,k),count:R.count,isDropdown:D,initialIsSelected:R.isSelected,onChange:Y=>{T[R.value]=Y,clearTimeout(N),N=setTimeout(()=>{r(T),E(!1)},I)}},`checkLabel${P}`)),!D&&y(Q,{children:[!u&&x.length>S&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!0),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:y("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",x.length,")"]})})}),u&&x.length>S&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!1),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:n("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),x.length<=0&&n("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),ee=()=>E(!v);return D?s==="SelectBox"?y(q,{className:"EnumFacetFilter EnumFacetFilterSelect",show:v,onToggle:ee,children:[y(q.Toggle,{className:"secondary-caret",variant:"gray-select",children:[b&&"All",!b&&e.filter(R=>R.isSelected).length===1&&e.filter(R=>R.isSelected)[0].value,!b&&e.filter(R=>R.isSelected).length>1&&"Multiple Values Selected"]}),n(q.Menu,{children:K})]}):y(q,{className:"EnumFacetFilter",show:v,onToggle:ee,children:[n(me,{tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),n(q.Menu,{children:K})]}):y(Q,{children:[n(j,{isCollapsed:i,label:t.name,onClick:R=>p(R)}),n(De,{className:"EnumFacetFilter",in:!i,children:K})]})};function Zt({id:e,index:t,label:a,count:r,isDropdown:o,initialIsSelected:s,onChange:l}){const[u,d]=m.exports.useState(s);return Ae.useEffect(()=>{d(s)},[s]),y("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{o&&(d(!u),l(!u))},children:[n(Ye,{className:"EnumFacetFilter__checkbox",onClick:i=>i.stopPropagation(),onChange:i=>{d(i),l(i)},checked:u,label:a},`${e}-${t}`),o&&y("span",{className:"EnumFacetFilter__count",children:["(",r,")"]}),!o&&n("div",{className:"EnumFacetFilter__count",children:r})]})}try{H.displayName="EnumFacetFilter",H.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:H.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const ie=({facet:e,isChecked:t,onClick:a})=>{const{getColumnDisplayName:r}=U();return y("button",{className:`Chip ${t?"Checked":""}`,onClick:a,children:[r(e.columnName),n(W,{options:{icon:t?"check":"add",size:"14px",padding:"left"}})]})};try{ie.displayName="FacetChip",ie.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"]={docgenInfo:ie.__docgenInfo,name:"FacetChip",path:"src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"})}catch{}const ce=e=>{const t="Min value should be less then max value",[a,r]=m.exports.useState(!1),[o,s]=m.exports.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:qe(e.initialValues.min).format("YYYY-MM-DD"),max:qe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),l=e.className?`range ${e.className}`:"range",u=({min:i,max:p},v="number")=>{if(i==null||p===null||p===void 0)return r(!1),!0;if(v==="number"){if(Number(i)>Number(p))return r(!0),!1}else if(Date.parse(i)>Date.parse(p))return r(!0),!1;return r(!1),!0},d=(i,p,v="number")=>{u(i,v)&&p(i)};return y("div",{className:l,style:{display:"flex",flexWrap:"wrap"},children:[y("div",{style:{marginRight:"10px"},children:[n("input",{"aria-label":"min",type:e.type,value:o.min,onChange:({target:i})=>s({min:i.value,max:o.max})},"range_min"),n("div",{children:"to"}),n("input",{"aria-label":"max",type:e.type,value:o.max,onChange:({target:i})=>s({min:o.min,max:i.value})},"range_max")]}),n("button",{className:"btn btn-link SRC-noPadding",onClick:()=>d(o,e.onChange,e.type),children:"Apply"}),a&&n("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{ce.displayName="Range",ce.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:ce.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}const ue=({facetResult:e,columnModel:t,onChange:a,collapsed:r=!1})=>{const[o,s]=m.exports.useState(r),l=[{label:ye,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:u,columnMax:d,selectedMin:i,selectedMax:p}=e;const v=!i&&!p;i=i||u,p=p||d;const E=t.columnType==="DOUBLE"?"number":"date",A=(c,S)=>S?"":c===Z?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",C=(c,S)=>{g(c),c!=="RANGE"&&S([c,c])},[V,g]=m.exports.useState(A(i,v));return y("div",{children:[n(j,{isCollapsed:o,label:t.name,onClick:c=>s(c)}),y(De,{in:!o,children:[n(Ft,{value:V,id:"rangeSelector",options:l,onChange:c=>C(c,a)}),V==="RANGE"&&(u===d?n("label",{children:d}):y(Q,{children:[t.columnType==="INTEGER"&&y(Et,{domain:[u,d],initialValues:{min:i,max:p},step:1,doUpdateOnApply:!0,onChange:c=>a([c.min,c.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&n(ce,{initialValues:{min:i,max:p},type:E,onChange:c=>a([c.min,c.max])},"Range")]}))]})]})};try{ue.displayName="RangeFacetFilter",ue.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:ue.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const He=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected).map(t=>t.value)}),Xt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Le=(e,t)=>{var s,l;const a=(l=(s=t==null?void 0:t.query)==null?void 0:s.selectedFacets)!=null?l:[],r=a.findIndex(u=>u.columnName===e.columnName),o=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return r>-1?o?a.splice(r,1):a[r]=e:a.push(e),a};function fe(e,t,a,r,o=!1){r?t.facetValues.forEach(u=>{u.value===r&&(u.isSelected=o)}):t.facetValues.forEach(u=>{u.isSelected=!1});const s=He(t),l=Le(s,e);a(l)}const we=(e,t,a,r)=>{const o=r&&Object.keys(r)||[];o.length&&t.facetValues.forEach(u=>{o.includes(u.value)&&(u.isSelected=r?!!r[u.value]:!1)});const s=He(t),l=Le(s,e);a(l)},en=(e,t,a,r)=>{t.columnMin=r[0],t.columnMax=r[1];const o=Xt(t),s=Le(o,e);a(s)};function Te(e){var g,x;const{facetsToFilter:t}=e,{data:a,isLoadingNewBundle:r,getLastQueryRequest:o,executeQueryRequest:s}=M(),l=(g=a==null?void 0:a.facets)==null?void 0:g.filter(c=>!Me(c));let u;t==null?u=(x=l==null?void 0:l.map(c=>c.columnName))!=null?x:[]:u=t;const[d,i]=Ae.useState([]),{topLevelControlsState:p}=U(),{showFacetFilter:v}=p;if(Ue(()=>{i(u.slice(0,3))},[a==null?void 0:a.facets]),!a)return n(Q,{});const E=a.selectColumns,A=o(),C=c=>{const S=o();S.query.selectedFacets=c,S.query.offset=0,s(S)},V=c=>{let S=[...d!=null?d:[""],c.columnName];d.includes(c.columnName)&&(S=S.filter(I=>I!=c.columnName)),i(S)};return y("div",{className:`FacetFilterControls ${v?Oe:Qe}`,children:[r&&n("div",{children:"Loading..."}),!r&&(l!=null?l:[]).filter(c=>d.includes(c.columnName)).map((c,S)=>{const I=E.find(f=>f.name===c.columnName);return y("div",{className:"FacetFilterControls__facet",children:[c.facetType==="enumeration"&&I&&n(H,{containerAs:"Collapsible",collapsed:!1,facetValues:c.facetValues,columnModel:I,onChange:f=>we(A,c,C,f),onClear:()=>fe(A,c,C)}),c.facetType==="range"&&I&&n(ue,{facetResult:c,columnModel:I,collapsed:!1,onChange:f=>en(A,c,C,f)})]},c.columnName)}),y("div",{children:[n("div",{className:"AvailableFacet",children:n("label",{className:"AvailableFacet__label",children:"Available Facets"})}),(l!=null?l:[]).filter(c=>u.includes(c.columnName)).map(c=>n(ie,{facet:c,onClick:()=>V(c),isChecked:d.includes(c.columnName)},c.columnName))]})]})}try{Te.displayName="FacetFilterControls",Te.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"]={docgenInfo:Te.__docgenInfo,name:"FacetFilterControls",path:"src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"})}catch{}const tn=xt(Tt),nn=19,an=30,rn={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},on=(e,t)=>{t=t||0;let a=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let r=0;r<t;r++)a.indexOf(".")!==-1&&(a=a.replace("0%","%"),a=a.replace(".%","%"));return a};function Ke(e,t){if(!e)return e;const a=e.trim();return a.length>t?a.substr(0,t-1)+"\u2026":e}async function sn(e,t,a,r,o){var C,V;const{colorPalette:s}=Rt(a,e.facetValues.length),l=async(g,x,c)=>{const S=new Map;S.set(Z,ye);const I=g.map(f=>f.value).filter(f=>f!==Z);if(x===L.ENTITYID||x===L.ENTITYID_LIST){const f=await Je(I,c);for(const T of f.results)S.set(T.id,T.name)}else if(x===L.USERID||x===L.USERID_LIST){const f=await Ze(I,c);for(const T of f.children)S.set(T.ownerId,T.userName)}return g.map(f=>({facet:f,label:u(f,!1,S),truncatedLabel:u(f,!0,S),count:f.count}))},u=(g,x,c)=>{var I;let S=(I=c.get(g.value))!=null?I:g.value;return x&&(S=Ke(S,nn)),S},d=await l(e.facetValues,t,o),i=d.map(g=>g.truncatedLabel),v=e.facetValues.some(g=>g.isSelected)?e.facetValues.map((g,x)=>g.isSelected?s[x]:s[x].replace("rgb(","rgba(").replace(")",", 0.25)")):s,E={values:r==="PIE"?e.facetValues.map(g=>g.count):void 0,labels:d.map(g=>g.label),text:i,x:r==="BAR"?e.facetValues.map(g=>{var x,c;return(c=(x=d.find(S=>S.facet===g))==null?void 0:x.label)!=null?c:g.value}):void 0,y:r==="BAR"?e.facetValues.map(g=>g.count):void 0,facetEnumerationValues:e.facetValues.map(g=>g.value),name:e.columnName,hovertemplate:r==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:r==="PIE"?"pie":"bar",pull:r==="PIE"?e.facetValues.map(g=>g.isSelected?.1:0):void 0,marker:{colors:r==="PIE"?v:void 0,color:r==="BAR"?v:void 0}};return{data:[E],labels:d,colors:r==="PIE"?(C=E.marker)==null?void 0:C.colors:(V=E.marker)==null?void 0:V.color}}const ln=(e,t,a)=>{if(e.points&&e.points[0]){const r=e.points[0],o=r.data.facetEnumerationValues[r.pointNumber],s=t.facetValues.find(l=>l.value===o);a(t,s,!s.isSelected)}};function cn(e,t,a){const o=e?e*(t==="BAR"?.8:.6):200;let s=t==="PIE"?o:o/3;return s>a&&(s=a),{width:`${o}px`,height:`${s}px`}}function de(e){const{labels:t,colors:a=[],isExpanded:r}=e;if(!t)return n(Q,{});const o=r?Math.min(t.length,9):Math.min(t.length,3);if(o===0)return n(Q,{});const s=t.reduce((l,u)=>l+u.count,0);return n("div",{className:`FacetNavPanel__body__legend${r?"--expanded":""}`,children:t.slice(0,o).map((l,u)=>{const i=`(${on(l.count/s,1)}) ${l.label}`,p=Ke(i,an);return n(me,{tooltipText:l.label,children:y("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[n("div",{style:{backgroundColor:a[u]}}),n("label",{children:p})]},`legendLabel_${u}`)},l.label)})})}const un=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",J=e=>{const{onHide:t,isModalView:a,applyChangesToFacetFilter:r,applyChangesToGraphSlice:o,index:s,facetToPlot:l,plotType:u,onSetPlotType:d}=e,{accessToken:i}=je(),{data:p,isLoadingNewBundle:v,getLastQueryRequest:E}=M(),{getColumnDisplayName:A}=U(),[C,V]=m.exports.useState(),[g,x]=m.exports.useState(!1),c=A(l.columnName),S=m.exports.useCallback(()=>{var f,T;return(T=(f=p==null?void 0:p.columnModels)==null?void 0:f.find(N=>N.name===l.columnName))==null?void 0:T.columnType},[p,l.columnName]);m.exports.useEffect(()=>{let f=!0;if(l)sn(l,S(),s,u,i).then(T=>{f&&V(T)});else return;return()=>{f=!1}},[l,p,s,u,i,S]);const I=()=>y("div",{onClick:f=>{f.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),y(q,{children:[n(q.Toggle,{className:"secondary-caret",variant:"gray-select",children:u==="PIE"?"Pie Chart":"Bar Chart"}),y(q.Menu,{className:"chart-tools",children:[n(q.Item,{as:"button",onClick:()=>d("BAR"),children:"Bar Chart"}),n(q.Item,{as:"button",onClick:()=>d("PIE"),children:"Pie Chart"})]})]})]});return!p&&v||!l?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:vt}):y(Q,{children:[y(ne,{animation:!1,show:g,onHide:()=>x(!1),backdrop:"static",children:[n(ne.Header,{closeButton:!0,children:n(ne.Title,{children:c!=null?c:""})}),y(ne.Body,{children:[n(J,{...e,isModalView:!0}),n("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:n($e,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>x(!1),children:"Apply Filters"})})]})]}),y("div",{role:"graphics-document",className:`FacetNavPanel${a?"--expanded":""}`,children:[!a&&y("div",{className:"FacetNavPanel__title",children:[!p&&v?n(G,{width:100}):n("span",{className:"FacetNavPanel__title__name",children:c}),y("div",{className:"FacetNavPanel__title__tools",children:[n(H,{facetValues:l.facetValues,columnModel:p==null?void 0:p.columnModels.find(f=>f.name===l.columnName),onChange:f=>{we(E(),l,r,f)},onClear:()=>{fe(E(),l,r)},containerAs:"Dropdown"}),n(me,{tooltipText:"Expand to large graph",callbackFn:()=>x(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),n(me,{tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),a&&y(Q,{children:[y("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),n(H,{facetValues:l.facetValues,columnModel:p==null?void 0:p.columnModels.find(f=>f.name===l.columnName),onChange:f=>{we(E(),l,r,f)},onClear:()=>{fe(E(),l,r)},containerAs:"Dropdown",dropdownType:"SelectBox"}),n(It,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:n(Vt,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),n(I,{})]}),y("div",{className:`FacetNavPanel__body${a?"--expanded":""}`,children:[n(Nt.SizeMe,{monitorHeight:!0,children:({size:f})=>{var T;return n("div",{className:un(a,u),children:n(tn,{layout:rn,data:(T=C==null?void 0:C.data)!=null?T:[],style:cn(f.width,u,a?300:150),config:{displayModeBar:!1},onClick:N=>ln(N,l,o)},`${l.columnName}-${u}-${f.width}`)})}}),n(de,{labels:C==null?void 0:C.labels,colors:C==null?void 0:C.colors,isExpanded:a})]})]})]})};try{de.displayName="FacetPlotLegend",de.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"]={docgenInfo:de.__docgenInfo,name:"FacetPlotLegend",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"})}catch{}try{J.displayName="FacetNavPanel",J.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"]={docgenInfo:J.__docgenInfo,name:"FacetNavPanel",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"})}catch{}function dn(e,t,a){const r=t.getColumnModel(e.columnName);return e.values.map(o=>{let s=o;(o==null?void 0:o.startsWith("%"))&&(o==null?void 0:o.endsWith("%"))&&(s=s.substring(1,s.length-1)),s=a.getDisplayValue(s,r.columnType);const l=`${e.columnName}: ${s}`;return{key:`queryFilter-${e.concreteType}-${e.columnName}-${o}`,innerText:l,tooltipText:l,onRemoveFilter:()=>{t.removeValueFromQueryFilter(e,o)}}})}function pn(e,t){return{key:`queryFilter-${e.concreteType}-${e.searchExpression}`,innerText:e.searchExpression,tooltipText:`Text matches: "${e.searchExpression}"`,onRemoveFilter:()=>{t.removeQueryFilter(e)}}}function mn(e,t,a){var r;return ve(e)||Ie(e)?e.columnName===((r=t.lockedColumn)==null?void 0:r.columnName)?[]:dn(e,t,a):St(e)?[pn(e,t)]:(console.log("Unknown query filter type",e.concreteType),[])}function fn(e,t,a){var l;if(e.columnName===((l=t.lockedColumn)==null?void 0:l.columnName))return[];const r=t.getColumnModel(e.columnName),{getColumnDisplayName:o,getDisplayValue:s}=a;if(Ve(e))return e.facetValues.map(u=>{const d=s(u,r.columnType);return{key:`facet-${e.concreteType}-${e.columnName}-${u}`,innerText:d,tooltipText:`${o(e.columnName)}: ${d}`,onRemoveFilter:()=>{t.removeValueFromSelectedFacet(e,u)}}});if(Qt(e)){const u=`${e.min} - ${e.max}`;return[{key:`facet-${e.concreteType}-${e.columnName}-${e.min}-${e.max}`,innerText:u,tooltipText:`${o(e.columnName)}: ${u}`,onRemoveFilter:()=>{t.removeSelectedFacet(e)}}]}else return console.log("Unknown facet type",e.concreteType),[]}function yn(){var u,d,i;const e=M(),t=U(),{getLastQueryRequest:a}=e,r=a(),o=((d=(u=r.query)==null?void 0:u.additionalFilters)!=null?d:[]).flatMap(p=>mn(p,e,t)),s=((i=r.query.selectedFacets)!=null?i:[]).flatMap(p=>fn(p,e,t)),l=[...o,...s];return n(Q,{children:l.map(p=>{const v=encodeURIComponent(p.key);return m.exports.createElement(wt,{...p,key:v})})})}function pe(e){const{style:t,frontText:a,endText:r="",hideIfUnfiltered:o=!1}=e,{data:s,isLoadingNewBundle:l,resetQuery:u,error:d,hasResettableFilters:i}=M(),{topLevelControlsState:p,unitDescription:v}=U(),E=s==null?void 0:s.queryCount,A=p==null?void 0:p.showFacetFilter,C=i;return d?n(Q,{}):n("div",{className:`TotalQueryResults ${A?Oe:Qe} ${i?"hasFilters":""}`,style:t,children:l?n(G,{width:100}):y(Q,{children:[(i||!o)&&y("div",{className:"TotalQueryResults__topbar",children:[y("span",{className:"SRC-boldText",children:[a," ",E==null?void 0:E.toLocaleString()," ",v," ",r]}),C&&y("a",{onClick:u,className:"TotalQueryResults__topbar__clearall",children:[n(W,{options:{icon:"deleteSweep"}}),"Clear all filters"]})]}),n("div",{className:"TotalQueryResults__selections",children:n(yn,{})})]})})}try{pe.displayName="TotalQueryResults",pe.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:null,description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:null,description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:pe.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}const Ne=2;function be(e,t){var r,o;return(o=(r=e==null?void 0:e.facets)==null?void 0:r.filter(s=>s.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(s.columnName)>-1)&&s.facetValues.length>0&&!Me(s)))!=null?o:[]}const Re=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:a,isLoadingNewBundle:r,executeQueryRequest:o,error:s,asyncJobStatus:l}=M(),{topLevelControlsState:u}=U(),[d,i]=m.exports.useState([]),[p,v]=m.exports.useState(!0),{showFacetVisualization:E,showFacetFilter:A}=u,C=a();m.exports.useEffect(()=>{const h=be(t,e);h.length!==0&&p&&(i(h.map((_,F)=>({name:_.columnName,isHidden:F>=Ne,plotType:"PIE"}))),v(!1))},[t,p,e]);const V=h=>{i(_=>_.map((F,O)=>h?{...F,isHidden:!1}:{...F,isHidden:O>=Ne}))},g=h=>{C.query.selectedFacets=h,C.query.offset=0,o(C)},x=h=>d.find(O=>O.name===h&&O.isHidden===!0)!==void 0,c=m.exports.useMemo(()=>d.find(h=>h.isHidden===!0)?"MORE":d.length<=Ne?"NONE":"LESS",[d]),S=h=>{T(h,"isHidden",!0)},I=(h,_)=>{T(h,"plotType",_)},f=h=>{var F;const _=(F=d.find(O=>O.name===h))==null?void 0:F.plotType;return _!=null?_:"PIE"},T=(h,_,F)=>{i(O=>O.map(k=>k.name===h?{...k,[_]:F}:k))},N=be(t,e),b=be(t,e).map((h,_)=>({columnName:h.columnName,colorIndex:_})),w=(C==null?void 0:C.query.selectedFacets)!==void 0&&C.query.selectedFacets.length>0||(C==null?void 0:C.query.additionalFilters)!==void 0&&(C==null?void 0:C.query.additionalFilters.length)>0;return s?n(Q,{}):!t&&r?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(l==null?void 0:l.progressMessage)&&y("div",{children:[n("span",{className:"spinner"}),l.progressMessage]})}):y(Q,{children:[n(pe,{frontText:"",endText:w?"filtered by":"",hideIfUnfiltered:!0}),N.length>0&&y("div",{className:`FacetNav ${E?"":"hidden"} ${A?Oe:Qe} ${c==="LESS"?"less":""}`,children:[n("div",{className:"FacetNav__row",role:"list",children:N.map(h=>{var _;return n("div",{className:"col-sm-12 col-md-4",style:{display:x(h.columnName)?"none":"block"},children:n(J,{index:(_=b.find(F=>F.columnName===h.columnName))==null?void 0:_.colorIndex,onHide:()=>S(h.columnName),plotType:f(h.columnName),onSetPlotType:F=>I(h.columnName,F),facetToPlot:h,applyChangesToFacetFilter:g,applyChangesToGraphSlice:(F,O,k)=>fe(C,F,g,O==null?void 0:O.value,k),isModalView:!1})},h.columnName)})}),c!=="NONE"&&n("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:n($e,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>V(c==="MORE"),style:{zIndex:500},children:c==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Re.displayName="FacetNav",Re.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"]={docgenInfo:Re.__docgenInfo,name:"FacetNav",path:"src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"})}catch{}export{H as E,Te as F,le as I,re as N,Oe as Q,G as S,pe as T,Qe as a,U as b,Bt as c,ae as d,Wn as e,we as f,fe as g,Ee as h,ge as i,Fe as j,xe as k,Re as l,Se as m,Gn as n,be as o,sn as p,cn as q,de as r,se as s,M as u};

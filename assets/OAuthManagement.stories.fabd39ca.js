import{f as Z}from"./DateFormatter.9d70d34e.js";import{h as J}from"./moment.53181859.js";import{W as me,cv as pe,w as k,bq as ne,cw as Ce,bi as ae,cx as fe,cy as ge,bh as l}from"./index.62d1f3d5.js";import{d as U}from"./ToastMessage.f82ed562.js";import{T}from"./Typography.bfdf676e.js";import{I as P}from"./IconSvg.3d20df6f.js";import{W as ye}from"./WarningModal.db1d2b8d.js";import{T as X}from"./Tooltip.6c95fe7b.js";import{a as o,j as e,F as Ae}from"./jsx-runtime.2e925369.js";import{M as b}from"./Modal.58357e58.js";import{R as N}from"./Row.3a6bf0e2.js";import{C as f}from"./toString.8ef640ae.js";import{H as ee}from"./HelpOutlineTwoTone.5e2fed5c.js";import{B as y}from"./Button.c582ea4c.js";import{T as Oe}from"./Table.9806fafe.js";import"./objectWithoutPropertiesLoose.090b3c10.js";import"./withStyles.8be28b48.js";import"./toConsumableArray.b3669986.js";import"./Alert.eafe86e9.js";import"./index.f252d424.js";import"./Transition.d42a873e.js";import"./index.06f4a415.js";import"./assert.9b6b5e7b.js";import"./iframe.20187c9d.js";import"./index.8cde812d.js";import"./getEndpoint.0de7fccf.js";import"./SvgIcon.31249d58.js";import"./FullWidthAlert.e7125a09.js";import"./createSvgIcon.d78a924b.js";import"./removeClass.27874bcb.js";import"./hasClass.56fd144a.js";import"./uniqueId.fa0dadf5.js";import"./makeStyles.9dfaa099.js";import"./InfoOutlined.22a371fd.js";import"./useTheme.8804f8cd.js";import"./useWaitForDOMRef.c89dbc64.js";import"./useWillUnmount.4a16e5cd.js";const H={all:i=>["oAuthClient",i]};function _e(i){const{accessToken:s}=k();return me(H.all(s),async d=>await pe(s,d.pageParam),{...i,getNextPageParam:d=>d.nextPageToken})}function Se(i){const s=ae(),{accessToken:d}=k();return ne(t=>Ce(t,d),{...i,onSuccess:async(t,m,u)=>{await s.invalidateQueries(H.all(d)),i!=null&&i.onSuccess&&await i.onSuccess(t,m,u)}})}function ve(i){const s=ae(),{accessToken:d}=k();return ne(m=>{const{client:u,action:C}=m;switch(C){case"UPDATE":return ge(u,d);case"CREATE":return fe(u,d);default:throw Error("Unknown action")}},{onSuccess:async(m,u,C)=>{await s.invalidateQueries(H.all(d)),i!=null&&i.onSuccess&&await i.onSuccess(m,u.client,C)}})}const te=window.React.useEffect,p=window.React.useState,x=({isShowingModal:i=!1,isEdit:s,onClose:d,client:t,setSelectedClient:m,setIsShowingConfirmModal:u,isShowingConfirmModal:C})=>{const{accessToken:L}=k(),[A,_]=p(""),[r,g]=p([{uri:""}]),[S,h]=p(),[F,D]=p(),[O,E]=p(),[V,q]=p(),[re,G]=p(!1),[oe,K]=p(!1),[ie,le]=p(),se="Are you absolutely sure?",de="Editing this detail will render your client invalid and will require you to resubmit verification. This action cannot be undone.",Q="Click Add URI to add more Redirect URIs";te(()=>{var n,a,c,R,M,z;_((n=t==null?void 0:t.client_name)!=null?n:""),g((a=t==null?void 0:t.redirect_uris.map(he=>({uri:he})))!=null?a:[{uri:""}]),h((c=t==null?void 0:t.policy_uri)!=null?c:""),D((R=t==null?void 0:t.client_uri)!=null?R:""),E((M=t==null?void 0:t.sector_identifier_uri)!=null?M:void 0),q((z=t==null?void 0:t.tos_uri)!=null?z:"")},[i]),te(()=>{const n=r==null?void 0:r.map(c=>c.uri),a=t==null?void 0:t.redirect_uris;t&&((n==null?void 0:n.length)!==(a==null?void 0:a.length)||!(n!=null&&n.every(c=>a==null?void 0:a.includes(c)))||O!=(t==null?void 0:t.sector_identifier_uri))?G(!0):G(!1)},[r,O]);const v=()=>{_(""),g([{uri:""}]),h(""),D(""),E(""),q(""),d()},Y=()=>{u(!1),K(!1),m(void 0)},{mutate:B}=ve({onSuccess:()=>{U("Successfully saved","success"),v()},onError:n=>{U(n.reason,"danger")}}),{mutate:ce}=Se({onSuccess:()=>{U("Successfully deleted","success"),d()}}),ue=()=>{var n;try{if(L){const a={client_id:t==null?void 0:t.client_id,client_name:A,redirect_uris:(n=r==null?void 0:r.map(c=>c.uri))!=null?n:[""],policy_uri:S,client_uri:F,sector_identifier_uri:O!=null?O:"",tos_uri:V,etag:t==null?void 0:t.etag};le(a),re===!0?(u(!0),v()):B(s?{action:"UPDATE",client:a}:{action:"CREATE",client:a})}}catch(a){console.log(a.reason)}},W=()=>{r&&g([...r,{uri:""}])},j=n=>{if(r){const a=[...r];a.splice(n,1),g(a)}},$=(n,a)=>{if(r){const{name:c,value:R}=n.target,M=[...r];M[a][c]=R,g(M)}};return o("div",{className:"bootstrap-4-backport",children:[o(b,{show:i,animation:!1,backdrop:"static",onHide:v,size:"lg",className:"OAuthDialog",children:[e(b.Header,{closeButton:!0,children:e(b.Title,{children:e(T,{variant:"headline1",children:s?"Client Details":"Create New OAuth Client"})})}),o(b.Body,{children:[e(T,{variant:"body1",children:"To protect you and your users, your consent screen and application will need to be verified by Sage Bionetworks. Before your consent screen and application are verified by Sage Bionetworks, you can still test your application with limitations."}),s&&o(T,{style:{marginTop:"16px"},variant:"label",children:["Client ID: ",t==null?void 0:t.client_id]}),o(N,{children:[e(f,{lg:6,md:6,sm:12,xs:12,children:o(l.Group,{className:"required",children:[e(l.Label,{htmlFor:"clientName",children:"Client Name"}),e(l.Control,{required:!0,onChange:n=>_(n.target.value),placeholder:"Client Name",type:"text",value:A,id:"clientName"})]})}),o(f,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{className:"required",htmlFor:"clientUri",children:"Client Homepage"}),e(l.Control,{onChange:n=>D(n.target.value),placeholder:"https://",type:"text",value:F,id:"clientUri"})]})]}),e(N,{children:!s&&o(Ae,{children:[e(f,{lg:6,md:6,sm:12,xs:12,children:o(l.Group,{className:"required",children:[e(l.Label,{htmlFor:"redirect-uri-0",children:"Redirect URI(s)"}),e(X,{title:Q,placement:"top",children:e(ee,{className:"HelpButton"})}),r==null?void 0:r.map((n,a)=>o("div",{children:[e(l.Control,{name:"uri",required:!0,id:`redirect-uri-${a}`,onChange:c=>$(c,a),value:n.uri,placeholder:"https://",type:"text"}),r.length>1&&e("button",{onClick:()=>j(a),children:e(P,{options:{icon:"delete",color:"#f44336"}})}),r.length-1===a&&e(y,{onClick:W,disabled:n.uri.length===0,children:"Add URI"})]},a))]})}),o(f,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Sector Identifier URI"}),e(l.Control,{onChange:n=>E(n.target.value),placeholder:"https://",type:"text"})]})]})}),o(N,{children:[o(f,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Link to Privacy Policy"}),e(l.Control,{onChange:n=>h(n.target.value),placeholder:"https://",type:"text",value:S})]}),o(f,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Links to Terms of Service"}),e(l.Control,{onChange:n=>q(n.target.value),placeholder:"https://",type:"text",value:V})]})]}),s&&o("div",{className:"danger",children:[e(T,{style:{marginTop:"8px"},color:"error",variant:"headline3",children:"DANGER ZONE"}),e(T,{variant:"smallText1",children:"Editing the following information will render your client invalid and will require you to create it again and resubmit verification if needed."}),o(N,{children:[o(f,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{htmlFor:"redirect-uri-0",children:"Redirect URI(s)"}),e(X,{title:Q,placement:"top",children:e(ee,{className:"HelpButton"})}),r==null?void 0:r.map((n,a)=>o("div",{children:[e(l.Control,{id:`redirect-uri-${a}`,required:!0,name:"uri",onChange:c=>$(c,a),value:n.uri,placeholder:"https://",type:"text"}),r.length>1&&e("button",{onClick:()=>j(a),children:e(P,{options:{icon:"delete",color:"#f44336"}})}),r.length-1===a&&e(y,{onClick:W,disabled:n.uri.length===0,children:"Add Uri"})]},a))]}),o(f,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Sector Identifier URI"}),e(l.Control,{onChange:n=>E(n.target.value),placeholder:"https://",type:"text",value:O})]})]}),o("button",{className:"delete-button",onClick:()=>{K(!0),u(!0),v()},children:[e(P,{options:{icon:"delete",color:"#f44336"}}),"DELETE CLIENT"]})]})]}),o(b.Footer,{children:[e(y,{variant:"default",onClick:v,children:"CANCEL"}),e(y,{variant:"primary",onClick:ue,children:"Save"})]})]}),e(ye,{show:C,title:se,modalBody:de,onCancel:Y,onConfirm:()=>{oe?ce(t==null?void 0:t.client_id):B({action:"UPDATE",client:ie}),Y()}})]})};try{x.displayName="CreateOAuthModal",x.__docgenInfo={description:"",displayName:"CreateOAuthModal",props:{isShowingModal:{defaultValue:{value:"false"},description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},isEdit:{defaultValue:null,description:"",name:"isEdit",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},setSelectedClient:{defaultValue:null,description:"",name:"setSelectedClient",required:!0,type:{name:"(client: OAuthClient | undefined) => void"}},setIsShowingConfirmModal:{defaultValue:null,description:"",name:"setIsShowingConfirmModal",required:!0,type:{name:"(a: boolean) => void"}},isShowingConfirmModal:{defaultValue:null,description:"",name:"isShowingConfirmModal",required:!0,type:{name:"boolean"}},client:{defaultValue:null,description:"",name:"client",required:!1,type:{name:"OAuthClient"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/oauth/CreateOAuthClient.tsx#CreateOAuthModal"]={docgenInfo:x.__docgenInfo,name:"CreateOAuthModal",path:"src/lib/containers/oauth/CreateOAuthClient.tsx#CreateOAuthModal"})}catch{}const I=window.React.useState,w=()=>{var S;const[i,s]=I(!1),[d,t]=I(!1),[m,u]=I(),[C,L]=I(!1),{data:A,hasNextPage:_,fetchNextPage:r}=_e(),g=(S=A==null?void 0:A.pages.flatMap(h=>h.results))!=null?S:[];return o("div",{className:"bootstrap-4-backport OAuthEditor",children:[e(y,{onClick:()=>{s(!0),t(!1)},children:"Create New Client"}),o(Oe,{striped:!0,children:[e("thead",{children:o("tr",{children:[e("th",{children:"Created"}),e("th",{children:"Modified"}),e("th",{children:"Client"}),e("th",{children:"Verified"}),e("th",{children:"App Secret"}),e("th",{children:"Actions"})]})}),e("tbody",{children:g.map(h=>o("tr",{children:[e("td",{children:Z(J(h.createdOn))}),e("td",{children:Z(J(h.modifiedOn))}),e("td",{children:h.client_name}),e("td",{children:h.verified?"Yes":"SUBMIT_VERIFICATION_PLACE_HOLDER"}),e("td",{children:"GENERATE_PLACEHOLDER"}),e("td",{children:e(y,{variant:"outline",onClick:()=>{u(h),t(!0),s(!0)},size:"sm",children:"EDIT"})})]},h.client_id))})]}),_&&e("div",{className:"text-center",children:e(y,{variant:"primary",onClick:()=>r(),children:"Load more"})}),(i||C)&&e(x,{onClose:()=>{s(!1)},isShowingModal:i,client:d?m:void 0,isEdit:d,setSelectedClient:u,setIsShowingConfirmModal:L,isShowingConfirmModal:C})]})};try{w.displayName="OAuthManagement",w.__docgenInfo={description:"",displayName:"OAuthManagement",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/oauth/OAuthManagement.tsx#OAuthManagement"]={docgenInfo:w.__docgenInfo,name:"OAuthManagement",path:"src/lib/containers/oauth/OAuthManagement.tsx#OAuthManagement"})}catch{}var dt={parameters:{storySource:{source:`import React from 'react'
import { ComponentStory, ComponentMeta } from '@storybook/react'

import { OAuthManagement } from './OAuthManagement'

export default {
  title: 'Synapse/OAuthManagement',
  component: OAuthManagement,
  argTypes: {},
} as ComponentMeta<typeof OAuthManagement>

const Template: ComponentStory<typeof OAuthManagement> = args => (
  <OAuthManagement {...args} />
)

export const OAuthManagementDemo = Template.bind({})
OAuthManagementDemo.args = {}
`,locationsMap:{"o-auth-management-demo":{startLoc:{col:57,line:12},endLoc:{col:1,line:14},startBody:{col:57,line:12},endBody:{col:1,line:14}}}}},title:"Synapse/OAuthManagement",component:w,argTypes:{}};const Me=i=>e(w,{...i}),Te=Me.bind({});Te.args={};const ct=["OAuthManagementDemo"];export{Te as OAuthManagementDemo,ct as __namedExportsOrder,dt as default};
//# sourceMappingURL=OAuthManagement.stories.fabd39ca.js.map

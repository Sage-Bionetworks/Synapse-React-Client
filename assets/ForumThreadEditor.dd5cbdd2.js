import{r as f,j as o,F as N,a as E}from"./jsx-runtime.1f7e2749.js";import{j as i,bX as P,U as S,bY as V,bZ as K,l as A,b_ as B,b$ as $,c0 as Y,c1 as j,c2 as W,c3 as G,c4 as H,c5 as z,c6 as X,c7 as Z,a4 as J}from"./index.f68a6cae.js";import{u as g}from"./useMutation.899c237a.js";import{u as D}from"./useInfiniteQuery.45f793da.js";import{I as O}from"./IconSvg.8bc0ae7f.js";import{a as ee}from"./CardContainerLogic.f2f93b1a.js";import{U as ae}from"./UserSearchBoxV2.895bee23.js";import{M as C}from"./Modal.f7648653.js";import{s as te}from"./startCase.5951b069.js";import{b as se}from"./isArray.4b374ec1.js";import{B as F}from"./Button.2ee39cf1.js";function Ce(e,a,s,t,n,r){const{accessToken:m}=i();return D(["reply",e,s,n,t,a],async d=>P(m,e,s,d.pageParam,t,a,n),{...r,getNextPageParam:(d,h)=>{if(d.results.length>0)return h.length*s}})}function be(e,a){const{accessToken:s}=i(),t=async()=>{const n=await $(e.messageKey,s);return(await fetch(n.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return A(["reply",e.threadId,e.id,e.messageKey],t,a)}function ne(e){const a=S(),{accessToken:s}=i();return g(t=>V(t,s),{...e,onSuccess:async(t,n,r)=>{await a.invalidateQueries(["reply",t.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(t,n,r)}})}function re(e){const a=S(),{accessToken:s}=i();return g(t=>K(t,s),{...e,onSuccess:async(t,n,r)=>{a.invalidateQueries(["reply",t.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(t,n,r)}})}function Re(e){const a=S(),{accessToken:s}=i();return g(t=>B(s,t.replyId),{...e,onSuccess:async(t,n,r)=>{await a.invalidateQueries(["reply",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(t,n,r)}})}function Ie(e){const{data:a,isLoading:s}=ce(e),{data:t,isLoading:n}=oe(a,{enabled:!!a}),{mutate:r}=le(),{mutate:m}=me(),d=f.exports.useCallback(()=>{a&&(a!=null&&a.isPinned?m(a):r(a))},[m,r,a]);return{threadData:a,threadBody:t,togglePin:d,isLoading:n||s}}function ce(e,a){const{accessToken:s}=i();return A(["thread",e,s],()=>Y(e,s),a)}function oe(e,a){const{accessToken:s}=i(),t=async()=>{const n=await Z(e.messageKey,s);return(await fetch(n.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return A(["thread",e==null?void 0:e.id,e==null?void 0:e.messageKey,s],t,a)}function ie(e){const a=S(),{accessToken:s}=i();return g(t=>j(s,t),{...e,onSuccess:async(t,n,r)=>{await a.invalidateQueries(["forumthread",t.forumId]),await a.invalidateQueries(["thread",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(t,n,r)}})}function ue(e){const a=S(),{accessToken:s}=i();return g(t=>W(s,t),{...e,onSuccess:async(t,n,r)=>{await a.invalidateQueries(["thread",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(t,n,r)}})}function de(e){const a=S(),{accessToken:s}=i();return g(t=>G(s,t),{...e,onSuccess:async(t,n,r)=>{await a.invalidateQueries(["forumthread",t.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(t,n,r)}})}function ve(e){const a=S(),{accessToken:s}=i();return g(t=>H(s,t.id),{...e,onSuccess:async(t,n,r)=>{await a.invalidateQueries(["forumthread",n.forumId]),await a.invalidateQueries(["thread",n.id]),e!=null&&e.onSuccess&&await e.onSuccess(t,n,r)}})}function le(e){const a=S(),{accessToken:s}=i();return g(t=>z(s,t.id),{...e,onSuccess:async(t,n,r)=>{await a.invalidateQueries(["thread",n.id]),await a.invalidateQueries(["forumthread",n.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(t,n,r)}})}function me(e){const a=S(),{accessToken:s}=i();return g(t=>X(s,t.id),{...e,onSuccess:async(t,n,r)=>{await a.invalidateQueries(["thread",n.id]),await a.invalidateQueries(["forumthread",n.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(t,n,r)}})}const fe=["title","bold","italic","strikethrough","code","latex","subscript","superscript","link","image"],Q={title:{openSyntax:"###",closeSyntax:""},bold:{openSyntax:"**",closeSyntax:"**"},italic:{openSyntax:"_",closeSyntax:"_"},strikethrough:{openSyntax:"--",closeSyntax:"--"},code:{openSyntax:"```",closeSyntax:"```"},latex:{openSyntax:"$$\\(",closeSyntax:"\\)$$"},subscript:{openSyntax:"~",closeSyntax:"~"},superscript:{openSyntax:"^",closeSyntax:"^"},link:{openSyntax:"[",closeSyntax:"](url)"},image:{openSyntax:"![",closeSyntax:"](image-url)"}},b=({show:e,onClose:a,handleUserTag:s})=>{const t=f.exports.useCallback((n,r)=>{n&&r&&s(r.userName),a()},[a,s]);return o(N,{children:E(C,{show:e,onHide:a,backdrop:"static",animation:!1,children:[o(C.Header,{closeButton:!0,children:o(C.Title,{children:"Find User or Team"})}),o(C.Body,{children:o(ae,{placeholder:"Search for a user or team name",onChange:t,typeFilter:J.USERS_ONLY})})]})})};try{b.displayName="UserMentionModal",b.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/markdown/UserMentionModal.tsx#UserMentionModal"]={docgenInfo:b.__docgenInfo,name:"UserMentionModal",path:"src/lib/containers/markdown/UserMentionModal.tsx#UserMentionModal"})}catch{}var U=(e=>(e.WRITE="WRITE",e.PREVIEW="PREVIEW",e))(U||{});const R=({placeholder:e,text:a,setText:s})=>{const[t,n]=f.exports.useState("WRITE"),[r,m]=f.exports.useState(0),[d,h]=f.exports.useState(!1),p=f.exports.useRef(null);f.exports.useEffect(()=>{const c=p.current;c&&c.setSelectionRange(r,r)},[p,r]),f.exports.useEffect(()=>{var c;(c=p.current)==null||c.focus()},[d]);const I=c=>{const u=[],l=p.current;if(l){const T=l==null?void 0:l.selectionStart,x=a.substring(0,T),k=a.substring(T,a.length);m(T+c.length+1),u.push(x,`@${c}`,k)}s(u.join(""))},v=c=>{c.key=="@"&&h(!0)},q=c=>{const u=p.current;if(u){const l=u.selectionStart,T=u.selectionEnd,x=a.substring(l,T),k=a.substring(0,l),M=a.substring(T,a.length),_=Q[c].openSyntax,y=Q[c].closeSyntax;switch(c){case"code":{const w=[];w.push(k,_,x,y,M),s(w.join(`\r
`)),u.focus(),m(l+_.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const w=`${k}${_}${x}${y}${M}`;u.focus(),m(l+_.length),s(w)}}}};return E("div",{className:"bootstrap-4-backport MarkdownEditor",children:[E("div",{className:"MarkdownEditorControls",children:[o("div",{className:"Tabs",children:Object.keys(U).map(c=>o("button",{className:"Tab",role:"tab","aria-selected":c===t,onClick:u=>{u.stopPropagation(),n(U[c])},children:c},c))}),t==="WRITE"&&E("div",{className:"MarkdownEditorControlsToolbar",children:[fe.map(c=>o("button",{onClick:()=>q(c),children:o(O,{icon:c,label:te(c)})},c)),o("button",{onClick:()=>h(!0),children:o(O,{icon:"tag",label:"Mention"})})]})]}),o("div",{children:t==="WRITE"?o("textarea",{onChange:c=>s(c.target.value),style:{width:"100%"},rows:6,value:a,ref:p,placeholder:e,onKeyDown:v}):a?o(ee,{markdown:a}):"Nothing to preview"}),o(b,{show:d,onClose:()=>h(!1),handleUserTag:I})]})};try{R.displayName="MarkdownEditor",R.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/markdown/MarkdownEditor.tsx#MarkdownEditor"]={docgenInfo:R.__docgenInfo,name:"MarkdownEditor",path:"src/lib/containers/markdown/MarkdownEditor.tsx#MarkdownEditor"})}catch{}const L=({initialText:e,initialTitle:a,id:s,onClose:t,isReply:n})=>{const[r,m]=f.exports.useState(a!=null?a:""),[d,h]=f.exports.useState(e!=null?e:""),{mutate:p,isLoading:I}=ie({onSuccess:()=>t()}),{mutate:v,isLoading:q}=ue({onSuccess:()=>t()}),{mutate:c,isLoading:u}=de({onSuccess:()=>t()}),{mutate:l,isLoading:T}=ne({onSuccess:()=>t()}),{mutate:x,isLoading:k}=re({onSuccess:()=>t()}),M=q||T||u||I||k,_=(y,w)=>{n?e?x({replyId:s,messageMarkdown:y}):l({threadId:s,messageMarkdown:y}):a?(p({title:w,threadId:s}),v({messageMarkdown:y,threadId:s})):c({forumId:s,title:w,messageMarkdown:y})};return E("div",{className:"bootstrap-4-backport",children:[!n&&o(se,{type:"text",placeholder:"Title",value:r,onChange:y=>m(y.target.value)}),o(R,{text:d,setText:h}),E("div",{style:{display:"flex",justifyContent:"flex-end"},children:[o(F,{onClick:t,variant:"light",children:"Cancel"}),o(F,{disabled:M,onClick:()=>_(d,r),variant:"primary",children:M?"Saving":"Save"})]})]})};try{L.displayName="ForumThreadEditor",L.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"]={docgenInfo:L.__docgenInfo,name:"ForumThreadEditor",path:"src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"})}catch{}export{L as F,Re as a,Ie as b,ve as c,Ce as d,be as u};

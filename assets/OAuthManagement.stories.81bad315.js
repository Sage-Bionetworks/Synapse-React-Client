import{f as Z}from"./DateFormatter.73b35599.js";import{h as J}from"./moment.53181859.js";import{T as me,cv as pe,w as q,bq as ne,cw as fe,bi as re,cx as ge,cy as Ce,bh as l}from"./index.9bc6faf6.js";import{d as P}from"./ToastMessage.f82ed562.js";import{T as v}from"./Typography.bfdf676e.js";import{I as H}from"./IconSvg.c485205d.js";import{W as ye}from"./WarningModal.db1d2b8d.js";import{T as X}from"./Tooltip.6c95fe7b.js";import{a,j as e,F as Ae}from"./jsx-runtime.2e925369.js";import{M as f}from"./Modal.58357e58.js";import{R as x}from"./Row.3a6bf0e2.js";import{C}from"./toString.8ef640ae.js";import{H as ee}from"./HelpOutlineTwoTone.5e2fed5c.js";import{B as y}from"./Button.c582ea4c.js";import{T as Se}from"./Table.9806fafe.js";import"./objectWithoutPropertiesLoose.090b3c10.js";import"./withStyles.8be28b48.js";import"./toConsumableArray.b3669986.js";import"./Alert.eafe86e9.js";import"./index.f252d424.js";import"./Transition.d42a873e.js";import"./index.06f4a415.js";import"./assert.b91d6825.js";import"./iframe.1841382a.js";import"./index.8cde812d.js";import"./getEndpoint.0de7fccf.js";import"./SvgIcon.31249d58.js";import"./FullWidthAlert.e7125a09.js";import"./createSvgIcon.d78a924b.js";import"./removeClass.27874bcb.js";import"./hasClass.56fd144a.js";import"./uniqueId.fa0dadf5.js";import"./makeStyles.9dfaa099.js";import"./InfoOutlined.22a371fd.js";import"./useTheme.8804f8cd.js";import"./useWaitForDOMRef.c89dbc64.js";import"./useWillUnmount.4a16e5cd.js";const V={all:o=>["oAuthClient",o]};function Oe(o){const{accessToken:s}=q();return me(V.all(s),async c=>await pe(s,c.pageParam),{...o,getNextPageParam:c=>c.nextPageToken})}function ve(o){const s=re(),{accessToken:c}=q();return ne(t=>fe(t,c),{...o,onSuccess:async(t,m,u)=>{await s.invalidateQueries(V.all(c)),o!=null&&o.onSuccess&&await o.onSuccess(t,m,u)}})}function _e(o){const s=re(),{accessToken:c}=q();return ne(m=>{const{client:u,action:g}=m;switch(g){case"UPDATE":return Ce(u,c);case"CREATE":return ge(u,c);default:throw Error("Unknown action")}},{onSuccess:async(m,u,g)=>{await s.invalidateQueries(V.all(c)),o!=null&&o.onSuccess&&await o.onSuccess(m,u.client,g)}})}const te=window.React.useEffect,p=window.React.useState,L=({isShowingModal:o=!1,isEdit:s,onClose:c,client:t,setSelectedClient:m,setIsShowingConfirmModal:u,isShowingConfirmModal:g})=>{const{accessToken:B}=q(),[R,S]=p(""),[i,A]=p([{uri:""}]),[I,_]=p(),[b,h]=p(),[O,k]=p(),[F,D]=p(),[ae,Y]=p(!1),[ie,G]=p(!1),[oe,le]=p(),se="Are you absolutely sure?",ce="Editing this detail will render your client invalid and will require you to resubmit verification. This action cannot be undone.",K="Click Add URI to add more Redirect URIs";te(()=>{var n,r,d,N,w,$;S((n=t==null?void 0:t.client_name)!=null?n:""),A((r=t==null?void 0:t.redirect_uris.map(he=>({uri:he})))!=null?r:[{uri:""}]),_((d=t==null?void 0:t.policy_uri)!=null?d:""),h((N=t==null?void 0:t.client_uri)!=null?N:""),k((w=t==null?void 0:t.sector_identifier_uri)!=null?w:void 0),D(($=t==null?void 0:t.tos_uri)!=null?$:"")},[o]),te(()=>{const n=i==null?void 0:i.map(d=>d.uri),r=t==null?void 0:t.redirect_uris;t&&((n==null?void 0:n.length)!==(r==null?void 0:r.length)||!(n!=null&&n.every(d=>r==null?void 0:r.includes(d)))||O!=(t==null?void 0:t.sector_identifier_uri))?Y(!0):Y(!1)},[i,O]);const T=()=>{S(""),A([{uri:""}]),_(""),h(""),k(""),D(""),c()},Q=()=>{u(!1),G(!1),m(void 0)},{mutate:U}=_e({onSuccess:()=>{P("Successfully saved","success"),T()},onError:n=>{P(n.reason,"danger")}}),{mutate:de}=ve({onSuccess:()=>{P("Successfully deleted","success"),c()}}),ue=()=>{var n;try{if(B){const r={client_id:t==null?void 0:t.client_id,client_name:R,redirect_uris:(n=i==null?void 0:i.map(d=>d.uri))!=null?n:[""],policy_uri:I,client_uri:b,sector_identifier_uri:O!=null?O:"",tos_uri:F,etag:t==null?void 0:t.etag};le(r),ae===!0?(u(!0),T()):U(s?{action:"UPDATE",client:r}:{action:"CREATE",client:r})}}catch(r){console.log(r.reason)}},j=()=>{i&&A([...i,{uri:""}])},z=n=>{if(i){const r=[...i];r.splice(n,1),A(r)}},W=(n,r)=>{if(i){const{name:d,value:N}=n.target,w=[...i];w[r][d]=N,A(w)}};return a("div",{className:"bootstrap-4-backport",children:[a(f,{show:o,animation:!1,backdrop:"static",onHide:T,size:"lg",className:"OAuthDialog",children:[e(f.Header,{closeButton:!0,children:e(f.Title,{children:e(v,{variant:"headline1",children:s?"Client Details":"Create New OAuth Client"})})}),a(f.Body,{children:[e(v,{variant:"body1",children:"To protect you and your users, your consent screen and application will need to be verified by Sage Bionetworks. Before your consent screen and application are verified by Sage Bionetworks, you can still test your application with limitations."}),s&&a(v,{style:{marginTop:"16px"},variant:"label",children:["Client ID: ",t==null?void 0:t.client_id]}),a(x,{children:[e(C,{lg:6,md:6,sm:12,xs:12,children:a(l.Group,{className:"required",children:[e(l.Label,{htmlFor:"clientName",children:"Client Name"}),e(l.Control,{required:!0,onChange:n=>S(n.target.value),placeholder:"Client Name",type:"text",value:R,id:"clientName"})]})}),a(C,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{className:"required",htmlFor:"clientUri",children:"Client Homepage"}),e(l.Control,{onChange:n=>h(n.target.value),placeholder:"https://",type:"text",value:b,id:"clientUri"})]})]}),e(x,{children:!s&&a(Ae,{children:[e(C,{lg:6,md:6,sm:12,xs:12,children:a(l.Group,{className:"required",children:[e(l.Label,{htmlFor:"redirect-uri-0",children:"Redirect URI(s)"}),e(X,{title:K,placement:"top",children:e(ee,{className:"HelpButton"})}),i==null?void 0:i.map((n,r)=>a("div",{children:[e(l.Control,{name:"uri",required:!0,id:`redirect-uri-${r}`,onChange:d=>W(d,r),value:n.uri,placeholder:"https://",type:"text"}),i.length>1&&e("button",{onClick:()=>z(r),children:e(H,{options:{icon:"delete",color:"#f44336"}})}),i.length-1===r&&e(y,{onClick:j,disabled:n.uri.length===0,children:"Add URI"})]},r))]})}),a(C,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Sector Identifier URI"}),e(l.Control,{onChange:n=>k(n.target.value),placeholder:"https://",type:"text"})]})]})}),a(x,{children:[a(C,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Link to Privacy Policy"}),e(l.Control,{onChange:n=>_(n.target.value),placeholder:"https://",type:"text",value:I})]}),a(C,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Links to Terms of Service"}),e(l.Control,{onChange:n=>D(n.target.value),placeholder:"https://",type:"text",value:F})]})]}),s&&a("div",{className:"danger",children:[e(v,{style:{marginTop:"8px"},color:"error",variant:"headline3",children:"DANGER ZONE"}),e(v,{variant:"smallText1",children:"Editing the following information will render your client invalid and will require you to create it again and resubmit verification if needed."}),a(x,{children:[a(C,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{htmlFor:"redirect-uri-0",children:"Redirect URI(s)"}),e(X,{title:K,placement:"top",children:e(ee,{className:"HelpButton"})}),i==null?void 0:i.map((n,r)=>a("div",{children:[e(l.Control,{id:`redirect-uri-${r}`,required:!0,name:"uri",onChange:d=>W(d,r),value:n.uri,placeholder:"https://",type:"text"}),i.length>1&&e("button",{onClick:()=>z(r),children:e(H,{options:{icon:"delete",color:"#f44336"}})}),i.length-1===r&&e(y,{onClick:j,disabled:n.uri.length===0,children:"Add Uri"})]},r))]}),a(C,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Sector Identifier URI"}),e(l.Control,{onChange:n=>k(n.target.value),placeholder:"https://",type:"text",value:O})]})]}),a("button",{className:"delete-button",onClick:()=>{G(!0),u(!0),T()},children:[e(H,{options:{icon:"delete",color:"#f44336"}}),"DELETE CLIENT"]})]})]}),a(f.Footer,{children:[e(y,{variant:"default",onClick:T,children:"CANCEL"}),e(y,{variant:"primary",onClick:ue,children:"Save"})]})]}),e(ye,{show:g,title:se,modalBody:ce,onCancel:Q,onConfirm:()=>{ie?de(t==null?void 0:t.client_id):U({action:"UPDATE",client:oe}),Q()}})]})};try{L.displayName="CreateOAuthModal",L.__docgenInfo={description:"",displayName:"CreateOAuthModal",props:{isShowingModal:{defaultValue:{value:"false"},description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},isEdit:{defaultValue:null,description:"",name:"isEdit",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},setSelectedClient:{defaultValue:null,description:"",name:"setSelectedClient",required:!0,type:{name:"(client: OAuthClient | undefined) => void"}},setIsShowingConfirmModal:{defaultValue:null,description:"",name:"setIsShowingConfirmModal",required:!0,type:{name:"(a: boolean) => void"}},isShowingConfirmModal:{defaultValue:null,description:"",name:"isShowingConfirmModal",required:!0,type:{name:"boolean"}},client:{defaultValue:null,description:"",name:"client",required:!1,type:{name:"OAuthClient"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/oauth/CreateOAuthClient.tsx#CreateOAuthModal"]={docgenInfo:L.__docgenInfo,name:"CreateOAuthModal",path:"src/lib/containers/oauth/CreateOAuthClient.tsx#CreateOAuthModal"})}catch{}const M=window.React.useState,E=()=>{var b;const[o,s]=M(!1),[c,t]=M(!1),[m,u]=M(),[g,B]=M(!1),[R,S]=M(!1),{data:i,hasNextPage:A,fetchNextPage:I}=Oe(),_=(b=i==null?void 0:i.pages.flatMap(h=>h.results))!=null?b:[];return a("div",{className:"bootstrap-4-backport OAuthEditor",children:[e(y,{onClick:()=>{s(!0),t(!1)},children:"Create New Client"}),a(Se,{striped:!0,children:[e("thead",{children:a("tr",{children:[e("th",{children:"Created"}),e("th",{children:"Modified"}),e("th",{children:"Client"}),e("th",{children:"Verified"}),e("th",{children:"App Secret"}),e("th",{children:"Actions"})]})}),e("tbody",{children:_.map(h=>a("tr",{children:[e("td",{children:Z(J(h.createdOn))}),e("td",{children:Z(J(h.modifiedOn))}),e("td",{children:h.client_name}),e("td",{children:h.verified?"Yes":e(y,{variant:"outline",size:"sm",onClick:()=>S(!0),children:"SUBMIT VERIFICATION"})}),e("td",{children:"GENERATE_PLACEHOLDER"}),e("td",{children:e(y,{variant:"outline",onClick:()=>{u(h),t(!0),s(!0)},size:"sm",children:"EDIT"})})]},h.client_id))})]}),A&&e("div",{className:"text-center",children:e(y,{variant:"primary",onClick:()=>I(),children:"Load more"})}),(o||g)&&e(L,{onClose:()=>{s(!1)},isShowingModal:o,client:c?m:void 0,isEdit:c,setSelectedClient:u,setIsShowingConfirmModal:B,isShowingConfirmModal:g}),a(f,{show:R,animation:!1,backdrop:"static",onHide:()=>S(!1),children:[e(f.Header,{closeButton:!0,children:e(f.Title,{children:e(v,{variant:"headline1",children:"Submit Verification"})})}),a(f.Body,{children:[a("p",{children:["In order to verify an OAuth client please submit a request to the"," ",e("a",{target:"_blank",rel:"noopener noreferrer",href:"https://sagebionetworks.jira.com/servicedesk/customer/portal/9",children:"Synapse Service Desk."})]}),e("b",{children:"Please list the following items in your request:"}),a("ul",{children:[e("li",{children:"Your name"}),a("li",{children:["The ID of the client to be verified ",e("br",{}),e("i",{children:"(You can find this within Actions)"})]}),e("li",{children:"A description of your application"})]})]})]})]})};try{E.displayName="OAuthManagement",E.__docgenInfo={description:"",displayName:"OAuthManagement",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/oauth/OAuthManagement.tsx#OAuthManagement"]={docgenInfo:E.__docgenInfo,name:"OAuthManagement",path:"src/lib/containers/oauth/OAuthManagement.tsx#OAuthManagement"})}catch{}var ct={parameters:{storySource:{source:`import React from 'react'
import { ComponentStory, ComponentMeta } from '@storybook/react'

import { OAuthManagement } from './OAuthManagement'

export default {
  title: 'Synapse/OAuthManagement',
  component: OAuthManagement,
  argTypes: {},
} as ComponentMeta<typeof OAuthManagement>

const Template: ComponentStory<typeof OAuthManagement> = args => (
  <OAuthManagement {...args} />
)

export const OAuthManagementDemo = Template.bind({})
OAuthManagementDemo.args = {}
`,locationsMap:{"o-auth-management-demo":{startLoc:{col:57,line:12},endLoc:{col:1,line:14},startBody:{col:57,line:12},endBody:{col:1,line:14}}}}},title:"Synapse/OAuthManagement",component:E,argTypes:{}};const be=o=>e(E,{...o}),Te=be.bind({});Te.args={};const dt=["OAuthManagementDemo"];export{Te as OAuthManagementDemo,dt as __namedExportsOrder,ct as default};
//# sourceMappingURL=OAuthManagement.stories.81bad315.js.map

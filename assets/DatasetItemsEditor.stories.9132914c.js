import{p as y,F as Ce,A as De,B as _e,a as be,D as ve,b as we,c as Re,C as Ne,M as Oe,d as Ae,P as Ve,e as ke}from"./EntityFinder.591b221e.js";import{S as Me}from"./SkeletonTable.f01c9124.js";import{h as Z,E as N,m as J,e as P,c as Be}from"./EntityTypeUtils.ab6e74ec.js";import{p as Pe,dv as Le,dw as qe}from"./index.98634fa6.js";import"./assert.0b9eb46f.js";import{T as H}from"./Typography.bfdf676e.js";import{E as $e}from"./EntityFinderModal.71b5fd05.js";import{I as Fe}from"./IconSvg.3d20df6f.js";import{B as xe}from"./LoadingScreen.56f18e4f.js";import{W as Ke}from"./WarningModal.db1d2b8d.js";import{d as w}from"./ToastMessage.f82ed562.js";import{C as ze}from"./Checkbox.60e96e17.js";import{a as I,j as i,F as G}from"./jsx-runtime.2e925369.js";import{i as Ye}from"./isEqual.07b43c96.js";import{S as He}from"./Skeleton.8dd0668e.js";import{B as C}from"./Button.c582ea4c.js";import"./iframe.0518598e.js";import"./objectWithoutPropertiesLoose.090b3c10.js";import"./toConsumableArray.b3669986.js";import"./index.06f4a415.js";import"./withStyles.8be28b48.js";import"./react-sizeme.3917158c.js";import"./Arrow.c6e8b887.js";import"./sqlFunctions.b49ac766.js";import"./use-deep-compare-effect.esm.9d3fc03b.js";import"./useGetEntityChildren.69adc136.js";import"./EntityChildren.50133102.js";import"./index.f252d424.js";import"./stateManager-845a3300.esm.2aae5abd.js";import"./classCallCheck.8304ed06.js";import"./inherits.98d6a15d.js";import"./HelpPopover.3fe30b23.js";import"./MarkdownPopover.9af8e54a.js";import"./usePopperMarginModifiers.31225551.js";import"./useWaitForDOMRef.c89dbc64.js";import"./Alert.eafe86e9.js";import"./Transition.d42a873e.js";import"./hasClass.56fd144a.js";import"./MarkdownSynapse.cf9432c1.js";import"./UserCard.cc01bcc0.js";import"./getEndpoint.0de7fccf.js";import"./IconCopy.b1eba79c.js";import"./Tooltip.6c95fe7b.js";import"./createSvgIcon.d78a924b.js";import"./SvgIcon.31249d58.js";import"./useTheme.8804f8cd.js";import"./makeStyles.9dfaa099.js";import"./Overlay.88992b99.js";import"./factory.ba6f720d.js";import"./SynapseVideo.9a88b3d6.js";import"./react-intersection-observer.m.66de6abb.js";import"./DateFormatter.cc8813cb.js";import"./moment.53181859.js";import"./useEntityBundle.e17d37d7.js";import"./EntityIcon.68f90cbd.js";import"./SynapseTableConstants.07ecdebd.js";import"./SchemaDrivenAnnotationEditor.23f7cfaa.js";import"./isEmpty.84087ce9.js";import"./toString.8ef640ae.js";import"./lodash.7955923d.js";import"./useListState.7f5a3e64.js";import"./FullWidthAlert.e7125a09.js";import"./Collapse.fe074047.js";import"./groupBy.730a2c78.js";import"./_baseMap.abafc50e.js";import"./_baseIsEqual.56a26f5d.js";import"./_cacheHas.bd1af3df.js";import"./_setToArray.a82100c8.js";import"./CalendarWithIconFormGroup.f781fc65.js";import"./index.5ef2ed87.js";import"./index.8cde812d.js";import"./uniqueId.fa0dadf5.js";import"./Modal.58357e58.js";import"./useWillUnmount.4a16e5cd.js";import"./removeClass.27874bcb.js";import"./EntityModal.17f3dc92.js";import"./ExternalFileHandleInterface.e99d240b.js";import"./LockTwoTone.32ff1570.js";import"./cloneDeep.33ace1f3.js";import"./Dropdown.c29f5884.js";import"./isRequiredForA11y.61bbc671.js";import"./Sort.16e06258.js";import"./EntityLink.275dd422.js";import"./useFavorites.a67c2aed.js";import"./times.05bd4cc5.js";import"./toInteger.973aa4d5.js";import"./TypeUtils.a2c41307.js";import"./InfoOutlined.22a371fd.js";const Ge=window.React.useState;function je(r){const[a,o]=Ge(new Set(r));function c(...E){const p=new Set(a);for(const A of E)p.add(A);o(p)}function O(E){const p=new Set(a);p.delete(E),o(p)}function u(){o(new Set)}return{set:a,add:c,remove:O,clear:u}}const j=window.React.useEffect,W=window.React.useMemo,D=window.React.useState;function We(r){return Z(r)?[N.FILE]:J(r)?[N.DATASET]:(console.error("Cannot determine selectable types for entity type: "+r.concreteType),[])}function R(r){const a=r?P(Be(r.concreteType)):"Collection";let o="Item",c="Current Version";return r&&Z(r)?(o=P(N.FILE),c="Draft"):r&&J(r)&&(o=P(N.DATASET)),{ADD_ITEMS:`Add ${y(o)}`,ADD_ITEMS_TO:`Add ${y(o)} + to ${a}`,REMOVE_ITEMS:`Remove ${y(o)}`,NO_ITEMS_IN_THIS_DATASET:`No ${y(o)} in this ${a}`,SAVE_TO_CONTINUE:`Save the ${a} to continue`,CREATE_VERSION_TO_FREEZE:`Create a Version of this ${a} to freeze it in its current state`,ENTITY_SAVED:`${a} Saved`,SAVE_CHANGES:`Save changes to ${c}`,ENTITY_FINDER_POPOVER:`Use the left pane to browse to find ${y(o)} to add to this ${a}. You can also use Search to find and select ${y(o)}.`,ENTITY_FINDER_PROMPT:`Find ${y(o)} to add to the ${a}.`,PRECONDITION_FAILED_MESSAGE:`Re-retrieve the ${a} to get the latest changes. Your current changes will be lost.`,PRECONDITION_FAILED_TITLE:`${a} updated since last fetched`,PRECONDITION_FAILED_ACTION:`Retrieve ${a}`}}const U=42,Ue=350;function _(r){var z;const{entityId:a,onSave:o,onClose:c}=r,[O,u]=D(!1),[E,p]=D(!1),[A,L]=D(!1),[n,Q]=D(),[S,X]=D(),b=e=>{L(!0),Q(e)},{data:l,refetch:ee}=Pe(a,void 0,{enabled:!n}),{ADD_ITEMS:V,ADD_ITEMS_TO:te,REMOVE_ITEMS:ne,NO_ITEMS_IN_THIS_DATASET:ie,SAVE_TO_CONTINUE:re,CREATE_VERSION_TO_FREEZE:ae,ENTITY_SAVED:oe,SAVE_CHANGES:se,PRECONDITION_FAILED_TITLE:de,PRECONDITION_FAILED_MESSAGE:le,PRECONDITION_FAILED_ACTION:me,ENTITY_FINDER_POPOVER:ce,ENTITY_FINDER_PROMPT:pe}=W(()=>R(l),[l]);j(()=>{!n&&l&&(l.items==null&&(l.items=[]),b(l),L(!1))},[l,n]);const{set:T,add:q,remove:ue,clear:k}=je(),$=!!(n&&n.items.length===T.size);j(()=>{if(S&&n&&!Ye(S,n)){const e=ye();w(re,"info",{title:e,primaryButtonConfig:{text:se,onClick:()=>B.mutate(n)}})}X(n)},[n]);const{data:M}=Le(a),v=(z=M==null?void 0:M.path[1])==null?void 0:z.id,B=qe({onSuccess:()=>{o?o():w(ae,"success",{title:oe})},onError:e=>{e.status===412?w(le,"warning",{title:de,primaryButtonConfig:{text:me,onClick:()=>{ee()}}}):w(e.reason,"danger",{title:"An Error Occurred"})}}),fe=n==null?void 0:n.items.map(e=>({...e,isSelected:T.has(e.entityId),setSelected:t=>t?q(e.entityId):ue(e.entityId)}));function F(e,t){let s=e.filter(f=>!t.find(m=>m.entityId===f.entityId));const d=[...s],{updatedItems:h,newItems:g}=t.reduce((f,m)=>{const Y=e.find(ge=>ge.entityId===m.entityId);return Y?m.versionNumber!==Y.versionNumber?f.updatedItems.push(m):s.push(m):f.newItems.push(m),f},{updatedItems:[],newItems:[]});return{unchangedItems:s,updatedItems:h,newItems:g,deletedItems:d}}function ye(){const{updatedItems:e,newItems:t,deletedItems:s}=F(S==null?void 0:S.items,n==null?void 0:n.items);let d="";return s.length>0?d+=`${s.length} Item${s.length===1?"":"s"} removed`:(d+=`${t.length} Item${t.length===1?"":"s"} added`,e.length>0&&(d+=` and ${e.length} Item${e.length===1?"":"s"} updated`)),d}function he(e){b(t=>{if(t){const s=e.map(m=>({entityId:m.targetId,versionNumber:m.targetVersionNumber})),{unchangedItems:d,updatedItems:h,newItems:g}=F(t.items,s),f=[...d,...h,...g];return{...t,items:f}}else return console.warn("Cannot add items to the Collection because it is undefined. The Collection may not have been fetched yet."),t}),k()}function Ie(){b(e=>({...e,items:e.items.filter(t=>!T.has(t.entityId))})),k()}function Ee(e,t){b(s=>({...s,items:s.items.map(d=>d.entityId===e?{entityId:e,versionNumber:t}:d)}))}const x=[{key:"errorState",width:30,cellRenderer:be},{key:"isSelected",width:40,dataKey:"isSelected",headerRenderer:n?i(e=>{const{datasetToUpdate:t,clearSelectedIds:s,addSelectedId:d}=e,h=$;return t?i("div",{"data-testid":"Select All",style:{cursor:"pointer"},onClick:()=>{h?s():d(...t.items.map(g=>g.entityId))},children:i(ze,{label:"",className:"SRC-pointer-events-none",checked:h,disabled:t.items.length===0,onChange:()=>{}})}):i(G,{})},{datasetToUpdate:n,selectedIds:T,clearSelectedIds:k,addSelectedId:q,allItemsAreSelected:$}):i(G,{}),cellRenderer:ve},{key:"name",width:350,dataKey:"entityId",title:"Name",resizable:!0,cellRenderer:we},{key:"status",width:80,dataKey:"entityId",resizable:!0,cellRenderer:Re},{key:"id",width:140,title:"ID",dataKey:"entityId",resizable:!0},{key:"version",width:150,title:"Version",dataKey:"entityId",cellRenderer:e=>i(ke,{...e,toggleSelection:t=>{Ee(t.entityId,t.versionNumber)}})},{key:"createdOn",width:200,title:"Created On",dataKey:"entityId",resizable:!0,cellRenderer:Ne},{key:"modifiedOn",width:200,title:"Modified On",dataKey:"entityId",resizable:!0,cellRenderer:Oe},{key:"modifiedBy",width:250,title:"Modified By",dataKey:"entityId",resizable:!0,cellRenderer:Ae},{key:"projectId",width:300,title:"Project",dataKey:"entityId",resizable:!0,cellRenderer:Ve}],K=x.reduce((e,t)=>e+t.width,0);function Se(){return I("div",{className:"NoItemsPlaceholder",children:[i(H,{variant:"headline3",children:ie}),I(C,{className:"AddItemsButton",variant:"sds-primary",onClick:()=>u(!0),children:[i(Fe,{options:{icon:"addCircleTwoTone"}}),i("span",{children:V})]})]})}const Te=W(()=>{if(l)return We(l)},[l]);return I("div",{className:"DatasetEditor bootstrap-4-backport",children:[i($e,{configuration:{projectId:v,selectMultiple:!0,initialScope:Ce.CURRENT_PROJECT,initialContainer:v!=null?v:null,selectableTypes:Te,mustSelectVersionNumber:!0},titlePopoverProps:{markdownText:ce,helpUrl:"https://help.synapse.org/docs/Datasets.2611281979.html"},promptCopy:pe,show:O,onClose:()=>{u(!1)},title:te,confirmButtonCopy:V,onConfirm:e=>{he(e),u(!1)},onCancel:()=>u(!1)}),i(Ke,{title:"Unsaved Changes",modalBody:"Any unsaved changes will be lost. Are you sure you want to close the editor?",confirmButtonText:"Close Editor",onConfirm:()=>{c&&(p(!1),c())},show:E,onConfirmCallbackArgs:[],onCancel:()=>p(!1)}),I("div",{className:"DatasetEditorTopBottomPanel",children:[i(xe,{show:B.isLoading}),i("div",{className:"ItemCount",children:n?I(H,{variant:"headline3",children:[n.items.length===0?"No":n.items.length.toLocaleString()," ","File",n.items.length!==1&&"s"]}):i(He,{variant:"rect",width:200})}),i(C,{variant:"sds-primary",disabled:n==null,onClick:()=>u(!0),children:V}),i(C,{disabled:T.size===0,variant:"outline",onClick:Ie,children:ne})]}),i("div",{className:"DatasetEditorTableContainer",children:n?n.items.length===0?i(Se,{}):i(De,{height:Ue,children:({height:e,width:t})=>i(_e,{classPrefix:"DatasetEditorTable",data:fe,height:e,width:t>K?t:K,rowHeight:U,overscanRowCount:5,columns:x,rowClassName:"DatasetEditorRow",rowProps:({rowData:s})=>({"aria-selected":s.isSelected}),headerCellProps:{role:"columnheader"}})}):i(Me,{className:"DatasetItemsEditorSkeleton",numRows:8,numCols:6,rowHeight:`${U}px`})}),I("div",{className:"DatasetEditorTopBottomPanel",children:[i(C,{variant:"outline",onClick:()=>{A?p(!0):c&&c()},children:"Cancel"}),i(C,{disabled:!n,variant:"sds-primary",onClick:()=>B.mutate(n),children:"Save"})]})]})}try{R.displayName="getCopy",R.__docgenInfo={description:"",displayName:"getCopy",props:{items:{defaultValue:null,description:"",name:"items",required:!1,type:{name:"EntityRef[]"}},concreteType:{defaultValue:null,description:"Indicates which implementation of Entity this object represents.",name:"concreteType",required:!0,type:{name:"enum",value:[{value:'"org.sagebionetworks.repo.model.table.EntityView"'},{value:'"org.sagebionetworks.repo.model.table.SubmissionView"'},{value:'"org.sagebionetworks.repo.model.table.Dataset"'},{value:'"org.sagebionetworks.repo.model.table.DatasetCollection"'}]}},columnIds:{defaultValue:null,description:"",name:"columnIds",required:!0,type:{name:"string[]"}},versionLabel:{defaultValue:null,description:"",name:"versionLabel",required:!1,type:{name:"string"}},versionComment:{defaultValue:null,description:"",name:"versionComment",required:!1,type:{name:"string"}},isLatestVersion:{defaultValue:null,description:"",name:"isLatestVersion",required:!1,type:{name:"boolean"}},name:{defaultValue:null,description:"The name of this entity?",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"The description of this entity.",name:"description",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"The unique immutable ID for this entity. A new ID will be generated for new Entities. Once issued, this ID is guaranteed to never change or be re-issued",name:"id",required:!1,type:{name:"string"}},etag:{defaultValue:null,description:"Synapse employs an Optimistic Concurrency Control (OCC) scheme to handle concurrent updates. Since the E-Tag changes every time an entity is updated it is used to detect when a client's current representation of an entity is out-of-date.",name:"etag",required:!1,type:{name:"string"}},createdOn:{defaultValue:null,description:"The date this entity was created.",name:"createdOn",required:!1,type:{name:"string"}},modifiedOn:{defaultValue:null,description:"The date this entity was last modified.",name:"modifiedOn",required:!1,type:{name:"string"}},createdBy:{defaultValue:null,description:"The ID of the user that created this entity.",name:"createdBy",required:!1,type:{name:"string"}},modifiedBy:{defaultValue:null,description:"The ID of the user that last modified this entity.",name:"modifiedBy",required:!1,type:{name:"string"}},parentId:{defaultValue:null,description:"The ID of the Entity that is the parent of this Entity.",name:"parentId",required:!1,type:{name:"string"}},attachments:{defaultValue:null,description:"@deprecated This field is deprecated and will be removed in future versions of Synapse",name:"attachments",required:!1,type:{name:"AttachmentData[]"}},annotations:{defaultValue:null,description:"@deprecated This field is deprecated and will be removed in future versions of Synapse",name:"annotations",required:!1,type:{name:"string"}},accessControlList:{defaultValue:null,description:"@deprecated This field is deprecated and will be removed in future versions of Synapse",name:"accessControlList",required:!1,type:{name:"string"}},entityType:{defaultValue:null,description:"@deprecated This field is deprecated and will be removed in future versions of Synapse",name:"entityType",required:!1,type:{name:"string"}},uri:{defaultValue:null,description:"@deprecated This field is deprecated and will be removed in future versions of Synapse",name:"uri",required:!1,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/table/datasets/DatasetItemsEditor.tsx#getCopy"]={docgenInfo:R.__docgenInfo,name:"getCopy",path:"src/lib/containers/table/datasets/DatasetItemsEditor.tsx#getCopy"})}catch{}try{_.displayName="DatasetItemsEditor",_.__docgenInfo={description:"",displayName:"DatasetItemsEditor",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!1,type:{name:"(() => void)"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/table/datasets/DatasetItemsEditor.tsx#DatasetItemsEditor"]={docgenInfo:_.__docgenInfo,name:"DatasetItemsEditor",path:"src/lib/containers/table/datasets/DatasetItemsEditor.tsx#DatasetItemsEditor"})}catch{}var Pn={parameters:{storySource:{source:`import React from 'react'
import { ComponentStory, ComponentMeta } from '@storybook/react'
import { DatasetItemsEditor } from './DatasetItemsEditor'

export default {
  title: 'Synapse/DatasetItemsEditor',
  component: DatasetItemsEditor,
} as ComponentMeta<typeof DatasetItemsEditor>

const Template: ComponentStory<typeof DatasetItemsEditor> = args => (
  <DatasetItemsEditor {...args} />
)

export const Demo = Template.bind({})
Demo.args = {
  entityId: 'syn26302617',
}
`,locationsMap:{demo:{startLoc:{col:60,line:10},endLoc:{col:1,line:12},startBody:{col:60,line:10},endBody:{col:1,line:12}}}}},title:"Synapse/DatasetItemsEditor",component:_};const Ze=r=>i(_,{...r}),Je=Ze.bind({});Je.args={entityId:"syn26302617"};const Ln=["Demo"];export{Je as Demo,Ln as __namedExportsOrder,Pn as default};
//# sourceMappingURL=DatasetItemsEditor.stories.9132914c.js.map

import{ap as ze,aq as $e,an as Ke,C as Ge,am as je,E as Je,N as ke,az as ee,aA as fe,h as Ze,ag as Xe,al as et,aB as tt,aC as nt}from"./index.a732538f.js";import{j as n,r as F,a as y,R as be,F as k}from"./jsx-runtime.77363692.js";import{b as at,i as rt,r as ot,c as Be}from"./queryUtils.914d9742.js";import{a as Pe,b as st,u as lt}from"./use-deep-compare-effect.esm.dcb0f3e4.js";import{u as it,E as te}from"./ElementWithTooltip.a6fc5c55.js";import{u as ct}from"./useEntity.e09d1558.js";import{a as ut,b as dt}from"./sqlFunctions.1d7d9843.js";import{c as W}from"./cloneDeep.6ce6697a.js";import{u as Ae}from"./useGetInfoFromIds.5d89fb73.js";import{C as D}from"./ColumnType.744125d2.js";import{I as G}from"./IconSvg.38b3ef2f.js";import{C as De}from"./Checkbox.b51365a3.js";import{D as U}from"./Dropdown.53c45092.js";import{R as pt}from"./RadioGroup.b9612945.js";import{h as Qe}from"./moment.a565bb48.js";import{R as mt}from"./RangeSlider.2d16df7a.js";import{c as ft,P as yt}from"./factory.3991fa84.js";import{r as ht}from"./react-sizeme.f0753498.js";import{S as _t}from"./Skeleton.5e1e1a25.js";import{g as Ct}from"./ColorGradient.16f0e0f2.js";import{l as St}from"./LoadingScreen.92385dfe.js";import{T as gt}from"./Tooltip.be22d41b.js";import{M as re}from"./Modal.83aa33c5.js";import{B as Ye}from"./Button.a1ee4a46.js";import{I as Ft}from"./InfoOutlined.f24d250d.js";import{i as Ie}from"./TypeUtils.a2c41307.js";import{C as Et}from"./Close.0cccf407.js";const j=e=>n(_t,{style:{...e.style,display:"inline-block"},...e});try{j.displayName="SkeletonInlineBlock",j.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:j.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const M=F.exports.createContext(void 0),oe=({children:e,queryContext:t})=>n(M.Provider,{value:t,children:e});function K(){const e=F.exports.useContext(M);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function En(){const e=F.exports.useContext(M);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function xn(){const e=F.exports.useContext(M);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const ye=M.Consumer;try{M.displayName="QueryContext",M.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:M.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{oe.displayName="QueryContextProvider",oe.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:oe.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{ye.displayName="QueryContextConsumer",ye.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:ye.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}function Ue(e,t){return`${e}${t}`}function xt(e,t){const r=window.location.search,a=`${e}=${t}`;return r?r.includes(`${e}=`)?window.location.search.slice(r.indexOf("?")+1).split("&").map(o=>o.split("=")[0]===e?`${a}`:o).join("&"):`${r.substr(1)}&${a}`:a}function Nt(e,t){if(!window.location.search)return;const r=Ue(e,t),i=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(s=>s.split("=")[0]===r).map(s=>s.split("=")[1])[0];return i?decodeURIComponent(i):void 0}function Tt(e,t,r){const a=t!==void 0?Ue(e,t):e,i=xt(a,r),s=window.location,o=`${s.protocol}//${s.hostname}${s.port?":"+s.port:""}${s.pathname}?${i}`;window.history.replaceState("object or string","Title",o)}function vt(e,t){const r=Nt(e,t);let a;if(r){const i=JSON.parse(r);i.sql&&(a={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:ze|$e|Ke|Ge,entityId:ut(i.sql),query:i})}return a}function Rt(e){var h,E;const{initQueryRequest:t,componentIndex:r=0,shouldDeepLink:a=!1,onQueryChange:i}=e,[s,o]=F.exports.useState(t);F.exports.useEffect(()=>{const l=vt("QueryWrapper",r);l&&o(l)},[r]);const c=F.exports.useCallback(()=>W(s),[s]);function C(){return W(t)}function m(l){let u;typeof l=="function"?u=l(c()):u=l;const v=W(u);if(o(v),v.query){const d=JSON.stringify(v.query);if(a){const w=encodeURIComponent(d);Tt("QueryWrapper",r,w)}i&&i(d)}}const{entityId:_,versionNumber:b}=dt(s.query.sql),T=(h=s.query.limit)!=null?h:je,I=Math.ceil((((E=s.query.offset)!=null?E:0)+Number(T))/T);function g(l){m(u=>(u.query.limit=l,u))}function V(l){m(u=>(u.query.offset=(l-1)*T,u))}return{entityId:_,versionNumber:b,getInitQueryRequest:C,getLastQueryRequest:c,setQuery:m,pageSize:T,currentPage:I,setPageSize:g,goToPage:V}}const we="isShowingFacetFilters",Oe="isHidingFacetFilters";function he(e){const{initQueryRequest:t,onQueryChange:r,onQueryResultBundleChange:a,lockedColumn:i,componentIndex:s,shouldDeepLink:o}=e,[c,C]=F.exports.useState(void 0),{entityId:m,versionNumber:_,getInitQueryRequest:b,getLastQueryRequest:T,setQuery:I,currentPage:g,pageSize:V,goToPage:h,setPageSize:E}=Rt({initQueryRequest:t,shouldDeepLink:o,componentIndex:s,onQueryChange:r}),l=F.exports.useMemo(()=>T(),[T]),{data:u,isLoading:v,error:d,isPreviousData:w}=at(l,{keepPreviousData:!0},C),q=u==null?void 0:u.responseBody,Y=v||w,{data:B}=ct(m,_);Pe(()=>{q&&a&&a(JSON.stringify(q))},[q,a]);const x=q?rt(q.facets,q.selectColumns):!0,O={data:F.exports.useMemo(()=>ot(q,i),[q,i]),currentPage:g,pageSize:V,setPageSize:E,isLoadingNewBundle:Y,getLastQueryRequest:T,getInitQueryRequest:b,error:d,entity:B,executeQueryRequest:I,isFacetsAvailable:x,asyncJobStatus:c,goToPage:h},{children:f}=e;return n(oe,{queryContext:O,children:n("div",{className:`SRC-wrapper ${Y?"SRC-logo-cursor":""} ${x?"has-facets":""}`,children:f})})}try{he.displayName="QueryWrapper",he.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:he.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}const z=F.exports.createContext(void 0),se=({children:e,queryVisualizationContext:t})=>n(z.Provider,{value:t,children:e});function H(){const e=F.exports.useContext(z);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const _e=z.Consumer;function Ce(e){var E,l;const{data:t,getLastQueryRequest:r,isFacetsAvailable:a,isLoadingNewBundle:i}=K(),{columnAliases:s={}}=e,[o,c]=F.exports.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(E=e.defaultShowFacetVisualization)!=null?E:!0,showSearchBar:(l=e.defaultShowSearchBar)!=null?l:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});F.exports.useEffect(()=>{a||c(u=>({...u,showFacetFilter:!1,showFacetVisualization:!1}))},[a]),F.exports.useEffect(()=>{i&&b([])},[i]);const[C,m]=F.exports.useState([]),[_,b]=F.exports.useState([]),T=r(),I=st(t==null?void 0:t.selectColumns);F.exports.useEffect(()=>{var u,v;m((v=I==null?void 0:I.slice(0,(u=e.visibleColumnCount)!=null?u:1/0).map(d=>d.name))!=null?v:[])},[I,T.query.sql,e.visibleColumnCount]);const g=F.exports.useCallback(u=>{const v=localStorage.getItem("force-display-original-column-names")==="true";return!u||v?u:s[u]?s[u]:it(u)},[s]),V={topLevelControlsState:o,setTopLevelControlsState:c,columnsToShowInTable:C,setColumnsToShowInTable:m,selectedRowIndices:_,setSelectedRowIndices:b,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:g},{children:h}=e;return n(se,{queryVisualizationContext:V,children:h})}try{Ce.displayName="QueryVisualizationWrapper",Ce.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:Ce.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{z.displayName="QueryVisualizationContext",z.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:z.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{se.displayName="QueryVisualizationContextProvider",se.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:se.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{_e.displayName="QueryVisualizationContextConsumer",_e.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:_e.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}const Se=()=>{const{error:e}=K();return n(Je,{error:e})};try{Se.displayName="QueryWrapperErrorBanner",Se.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"]={docgenInfo:Se.__docgenInfo,name:"QueryWrapperErrorBanner",path:"src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"})}catch{}var bt=(e=>(e.LIKE="LIKE",e))(bt||{}),It=(e=>(e.HAS="HAS",e.HAS_LIKE="HAS_LIKE",e))(It||{});const wt="org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",Ot="org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",Vt="org.sagebionetworks.repo.model.table.TextMatchesQueryFilter",Le=Ie(Vt),ge=Ie(wt),Fe=Ie(Ot),le=e=>{var t;return y("svg",{...e,className:`Icon-Plus ${(t=e.className)!=null?t:""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]})};try{le.displayName="IconPlus",le.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconPlus.tsx#IconPlus"]={docgenInfo:le.__docgenInfo,name:"IconPlus",path:"src/lib/assets/icons/IconPlus.tsx#IconPlus"})}catch{}const ie=e=>{var t;return y("svg",{...e,className:`Icon-Minus ${(t=e.className)!=null?t:""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]})};try{ie.displayName="IconMinus",ie.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconMinus.tsx#IconMinus"]={docgenInfo:ie.__docgenInfo,name:"IconMinus",path:"src/lib/assets/icons/IconMinus.tsx#IconMinus"})}catch{}const J=({label:e,isCollapsed:t,onClick:r})=>{const{getColumnDisplayName:a}=H();return y("div",{className:"FacetFilterHeader",children:[n("label",{className:"FacetFilterHeader__label",children:a(e)}),n("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>r(!t),children:t?n(le,{className:"icon-plus",title:"Expand Menu"}):n(ie,{className:"icon-minus",title:"Collapse Menu"})})]})};try{J.displayName="FacetFilterHeader",J.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:J.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}function At(e){return e.replace(/\s/g,"").toLowerCase()}function qe(e,t=[],r=[]){const{value:a}=e;let i=a;a===ee&&(i=fe);const s=t.find(c=>c.ownerId===a);s&&(i=s?s.userName:`unknown (${a})`);const o=r.find(c=>c.id===a);return o&&(i=o?o.name:`unknown (${a})`),`${i}`}function Qt(e,t,r){const a=[...e.sort((i,s)=>s.count-i.count)];return t||a.length<=r||a.slice(r).find(i=>i.isSelected)?a:a.splice(0,r)}const $=({facetValues:e,columnModel:t,onClear:r,onChange:a,containerAs:i="Collapsible",dropdownType:s="Icon",collapsed:o=!1})=>{const[c,C]=F.exports.useState(!1),[m,_]=F.exports.useState(o),[b,T]=F.exports.useState(!1),[I,g]=F.exports.useState(!1),[V,h]=F.exports.useState(""),[E,l]=F.exports.useState(e);lt(()=>{l(e)},[e]);const u=5,v=1500,d=be.createRef(),w={};let q;const Y=e.filter(S=>S.isSelected).length===0,B=(t==null?void 0:t.columnType)===D.USERID||(t==null?void 0:t.columnType)===D.USERID_LIST?e.map(S=>S.value):[],x=Ae({ids:B,type:"USER_PROFILE"}),A=(t==null?void 0:t.columnType)===D.ENTITYID||(t==null?void 0:t.columnType)===D.ENTITYID_LIST?e.map(S=>S.value):[],O=Ae({ids:A,type:"ENTITY_HEADER"}),f=S=>{const Q=S.target.value;if(h(Q),C(!0),!Q)e.forEach(L=>{L.isSelected=!1}),l(e);else{const L=e.filter(P=>qe(P,x,O).toLowerCase().indexOf(Q.trim().toLowerCase())>-1?P:null);l(L)}};if(!t)return n(k,{});const p=i==="Dropdown",N=y("div",{className:p?"EnumFacetFilter__dropdown_menu":"",children:[y("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[y("div",{className:I?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[n("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{l(e),g(!1),C(!1)},children:n("span",{className:"EnumFacetFilter__previous",children:n(G,{options:{icon:"arrowBack"}})})}),V.length>0&&n("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var S;h(""),(S=d.current)==null||S.focus()},children:n("span",{className:"EnumFacetFilter__reset",children:n(G,{options:{icon:"close"}})})}),n("input",{type:"text",placeholder:"Find values",value:V,ref:d,onChange:S=>{f(S)}})]}),!I&&y("div",{className:"EnumFacetFilter__checkAll",children:[n(De,{className:"EnumFacetFilter__checkbox",onChange:()=>{r()},checked:Y,label:"All",isSelectAll:!0},"select_all"),n("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var S;h(""),g(!0),(S=d.current)==null||S.focus()},children:n("span",{className:"EnumFacetFilter__searchicon",children:n(G,{options:{icon:"search"}})})})]})]}),y("div",{children:[E.length>0&&Qt(E,c||p,u).map((S,Q)=>n(Lt,{id:At(S.value),index:Q,label:qe(S,x,O),count:S.count,isDropdown:p,initialIsSelected:S.isSelected,onChange:L=>{w[S.value]=L,clearTimeout(q),q=setTimeout(()=>{a(w),T(!1)},v)}},`checkLabel${Q}`)),!p&&y(k,{children:[!c&&E.length>u&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>C(!0),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:y("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",E.length,")"]})})}),c&&E.length>u&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>C(!1),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:n("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),E.length<=0&&n("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),R=()=>T(!b);return p?s==="SelectBox"?y(U,{className:"EnumFacetFilter EnumFacetFilterSelect",show:b,onToggle:R,children:[y(U.Toggle,{className:"secondary-caret",variant:"gray-select",children:[Y&&"All",!Y&&e.filter(S=>S.isSelected).length===1&&e.filter(S=>S.isSelected)[0].value,!Y&&e.filter(S=>S.isSelected).length>1&&"Multiple Values Selected"]}),n(U.Menu,{children:N})]}):y(U,{className:"EnumFacetFilter",show:b,onToggle:R,children:[n(te,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),n(U.Menu,{children:N})]}):y(k,{children:[n(J,{isCollapsed:m,label:t.name,onClick:S=>_(S)}),n(ke,{className:"EnumFacetFilter",in:!m,children:N})]})};function Lt({id:e,index:t,label:r,count:a,isDropdown:i,initialIsSelected:s,onChange:o}){const[c,C]=F.exports.useState(s);return be.useEffect(()=>{C(s)},[s]),y("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{i&&(C(!c),o(!c))},children:[n(De,{className:"EnumFacetFilter__checkbox",onClick:m=>m.stopPropagation(),onChange:m=>{C(m),o(m)},checked:c,label:r},`${e}-${t}`),i&&y("span",{className:"EnumFacetFilter__count",children:["(",a,")"]}),!i&&n("div",{className:"EnumFacetFilter__count",children:a})]})}try{$.displayName="EnumFacetFilter",$.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:$.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const ce=({facet:e,isChecked:t,onClick:r})=>{const{getColumnDisplayName:a}=H();return y("button",{className:`Chip ${t?"Checked":""}`,onClick:r,children:[a(e.columnName),n(G,{options:{icon:t?"check":"add",size:"14px",padding:"left"}})]})};try{ce.displayName="FacetChip",ce.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"]={docgenInfo:ce.__docgenInfo,name:"FacetChip",path:"src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"})}catch{}const ue=e=>{const t="Min value should be less then max value",[r,a]=F.exports.useState(!1),[i,s]=F.exports.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Qe(e.initialValues.min).format("YYYY-MM-DD"),max:Qe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),o=e.className?`range ${e.className}`:"range",c=({min:m,max:_},b="number")=>{if(m==null||_===null||_===void 0)return a(!1),!0;if(b==="number"){if(Number(m)>Number(_))return a(!0),!1}else if(Date.parse(m)>Date.parse(_))return a(!0),!1;return a(!1),!0},C=(m,_,b="number")=>{c(m,b)&&_(m)};return y("div",{className:o,style:{display:"flex",flexWrap:"wrap"},children:[y("div",{style:{marginRight:"10px"},children:[n("input",{"aria-label":"min",type:e.type,value:i.min,onChange:({target:m})=>s({min:m.value,max:i.max})},"range_min"),n("div",{children:"to"}),n("input",{"aria-label":"max",type:e.type,value:i.max,onChange:({target:m})=>s({min:i.min,max:m.value})},"range_max")]}),n("button",{className:"btn btn-link SRC-noPadding",onClick:()=>C(i,e.onChange,e.type),children:"Apply"}),r&&n("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{ue.displayName="Range",ue.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:ue.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}var ve=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(ve||{});const de=({facetResult:e,columnModel:t,onChange:r,collapsed:a=!1})=>{const[i,s]=F.exports.useState(a),o=[{label:fe,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:c,columnMax:C,selectedMin:m,selectedMax:_}=e;const b=!m&&!_;m=m||c,_=_||C;const T=t.columnType==="DOUBLE"?"number":"date",I=(l,u)=>u?"":l===ee?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",g=(l,u)=>{h(l),l!=="RANGE"&&u([l,l])},[V,h]=F.exports.useState(I(m,b));return y("div",{children:[n(J,{isCollapsed:i,label:t.name,onClick:l=>s(l)}),y(ke,{in:!i,children:[n(pt,{value:V,id:"rangeSelector",options:o,onChange:l=>g(l,r)}),V==="RANGE"&&(c===C?n("label",{children:C}):y(k,{children:[t.columnType==="INTEGER"&&y(mt,{domain:[c,C],initialValues:{min:m,max:_},step:1,doUpdateOnApply:!0,onChange:l=>r([l.min,l.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&n(ue,{initialValues:{min:m,max:_},type:T,onChange:l=>r([l.min,l.max])},"Range")]}))]})]})};try{de.displayName="RangeFacetFilter",de.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:de.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const Me=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected===!0).map(t=>t.value)}),qt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Ve=(e,t)=>{var s,o;const r=(o=(s=t==null?void 0:t.query)==null?void 0:s.selectedFacets)!=null?o:[],a=r.findIndex(c=>c.columnName===e.columnName),i=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return a>-1?i?r.splice(a,1):r[a]=e:r.push(e),r};function ne(e,t,r,a,i=!1){a?t.facetValues.forEach(c=>{c.value===a&&(c.isSelected=i)}):t.facetValues.forEach(c=>{c.isSelected=!1});const s=Me(t),o=Ve(s,e);r(o)}const Re=(e,t,r,a)=>{const i=a&&Object.keys(a)||[];i.length&&t.facetValues.forEach(c=>{i.includes(c.value)&&(c.isSelected=a?!!a[c.value]:!1)});const s=Me(t),o=Ve(s,e);r(o)},We=(e,t,r,a)=>{t.columnMin=a[0],t.columnMax=a[1];const i=qt(t),s=Ve(i,e);r(s)};function Ee(e){var h,E;const{facetsToFilter:t}=e,{data:r,isLoadingNewBundle:a,getLastQueryRequest:i,executeQueryRequest:s}=K(),o=(h=r==null?void 0:r.facets)==null?void 0:h.filter(l=>!Be(l));let c;t==null?c=(E=o==null?void 0:o.map(l=>l.columnName))!=null?E:[]:c=t;const[C,m]=be.useState([]),{topLevelControlsState:_}=H(),{showFacetFilter:b}=_;if(Pe(()=>{m(c.slice(0,3))},[r==null?void 0:r.facets]),!r)return n(k,{});const T=r.selectColumns,I=i(),g=l=>{const u=i();u.query.selectedFacets=l,u.query.offset=0,s(u)},V=l=>{let u=[...C!=null?C:[""],l.columnName];C.includes(l.columnName)&&(u=u.filter(v=>v!=l.columnName)),m(u)};return y("div",{className:`FacetFilterControls ${b?we:Oe}`,children:[a&&n("div",{children:"Loading..."}),!a&&(o!=null?o:[]).filter(l=>C.includes(l.columnName)).map((l,u)=>{const v=T.find(d=>d.name===l.columnName);return y("div",{className:"FacetFilterControls__facet",children:[l.facetType==="enumeration"&&v&&n($,{containerAs:"Collapsible",collapsed:!1,facetValues:l.facetValues,columnModel:v,onChange:d=>Re(I,l,g,d),onClear:()=>ne(I,l,g)}),l.facetType==="range"&&v&&n(de,{facetResult:l,columnModel:v,collapsed:!1,onChange:d=>We(I,l,g,d)})]},l.columnName)}),y("div",{children:[n("div",{className:"AvailableFacet",children:n("label",{className:"AvailableFacet__label",children:"Available Facets"})}),(o!=null?o:[]).filter(l=>c.includes(l.columnName)).map(l=>n(ce,{facet:l,onClick:()=>V(l),isChecked:C.includes(l.columnName)},l.columnName))]})]})}try{Ee.displayName="FacetFilterControls",Ee.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"]={docgenInfo:Ee.__docgenInfo,name:"FacetFilterControls",path:"src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"})}catch{}const kt=ft(yt),Bt=19,Pt=30,Dt={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},Yt=(e,t)=>{t=t||0;let r=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let a=0;a<t;a++)r.indexOf(".")!==-1&&(r=r.replace("0%","%"),r=r.replace(".%","%"));return r};function He(e,t){if(!e)return e;const r=e.trim();return r.length>t?r.substr(0,t-1)+"\u2026":e}async function Ut(e,t,r,a,i){var g,V;const{colorPalette:s}=Ct(r,e.facetValues.length),o=async(h,E,l)=>{const u=new Map;u.set(ee,fe);const v=h.map(d=>d.value).filter(d=>d!==ee);if(E===D.ENTITYID||E===D.ENTITYID_LIST){const d=await Xe(v,l);for(const w of d.results)u.set(w.id,w.name)}else if(E===D.USERID||E===D.USERID_LIST){const d=await et(v,l);for(const w of d.children)u.set(w.ownerId,w.userName)}return h.map(d=>({facet:d,label:c(d,!1,u),truncatedLabel:c(d,!0,u),count:d.count}))},c=(h,E,l)=>{var v;let u=(v=l.get(h.value))!=null?v:h.value;return E&&(u=He(u,Bt)),u},C=await o(e.facetValues,t,i),m=C.map(h=>h.truncatedLabel),b=e.facetValues.some(h=>h.isSelected)?e.facetValues.map((h,E)=>h.isSelected?s[E]:s[E].replace("rgb(","rgba(").replace(")",", 0.25)")):s,T={values:a==="PIE"?e.facetValues.map(h=>h.count):void 0,labels:C.map(h=>h.label),text:m,x:a==="BAR"?e.facetValues.map(h=>{var E,l;return(l=(E=C.find(u=>u.facet===h))==null?void 0:E.label)!=null?l:h.value}):void 0,y:a==="BAR"?e.facetValues.map(h=>h.count):void 0,facetEnumerationValues:e.facetValues.map(h=>h.value),name:e.columnName,hovertemplate:a==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:a==="PIE"?"pie":"bar",pull:a==="PIE"?e.facetValues.map(h=>h.isSelected?.1:0):void 0,marker:{colors:a==="PIE"?b:void 0,color:a==="BAR"?b:void 0}};return{data:[T],labels:C,colors:a==="PIE"?(g=T.marker)==null?void 0:g.colors:(V=T.marker)==null?void 0:V.color}}const Mt=(e,t,r)=>{if(e.points&&e.points[0]){const a=e.points[0],i=a.data.facetEnumerationValues[a.pointNumber],s=t.facetValues.find(o=>o.value===i);r(t,s,!s.isSelected)}};function Wt(e,t,r){const i=e?e*(t==="BAR"?.8:.6):200;let s=t==="PIE"?i:i/3;return s>r&&(s=r),{width:`${i}px`,height:`${s}px`}}function pe(e){const{labels:t,colors:r=[],isExpanded:a}=e;if(!t)return n(k,{});const i=a?Math.min(t.length,9):Math.min(t.length,3);if(i===0)return n(k,{});const s=t.reduce((o,c)=>o+c.count,0);return n("div",{className:`FacetNavPanel__body__legend${a?"--expanded":""}`,children:t.slice(0,i).map((o,c)=>{const m=`(${Yt(o.count/s,1)}) ${o.label}`,_=He(m,Pt);return n(te,{idForToolTip:o.label,tooltipText:o.label,children:y("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[n("div",{style:{backgroundColor:r[c]}}),n("label",{children:_})]},`legendLabel_${c}`)},o.label)})})}const Ht=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",Z=e=>{const{onHide:t,isModalView:r,applyChangesToFacetFilter:a,applyChangesToGraphSlice:i,index:s,facetToPlot:o,plotType:c,onSetPlotType:C}=e,{accessToken:m}=Ze(),{data:_,isLoadingNewBundle:b,getLastQueryRequest:T}=K(),{getColumnDisplayName:I}=H(),[g,V]=F.exports.useState(),[h,E]=F.exports.useState(!1),l=I(o.columnName),u=F.exports.useCallback(()=>{var d,w;return(w=(d=_==null?void 0:_.columnModels)==null?void 0:d.find(q=>q.name===o.columnName))==null?void 0:w.columnType},[_,o.columnName]);F.exports.useEffect(()=>{let d=!0;if(o)Ut(o,u(),s,c,m).then(w=>{d&&V(w)});else return;return()=>{d=!1}},[o,_,s,c,m,u]);const v=()=>y("div",{onClick:d=>{d.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),y(U,{children:[n(U.Toggle,{className:"secondary-caret",variant:"gray-select",children:c==="PIE"?"Pie Chart":"Bar Chart"}),y(U.Menu,{className:"chart-tools",children:[n(U.Item,{as:"button",onClick:()=>C("BAR"),children:"Bar Chart"}),n(U.Item,{as:"button",onClick:()=>C("PIE"),children:"Pie Chart"})]})]})]});return!_&&b||!o?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:St}):y(k,{children:[y(re,{animation:!1,show:h,onHide:()=>E(!1),backdrop:"static",children:[n(re.Header,{closeButton:!0,children:n(re.Title,{children:l!=null?l:""})}),y(re.Body,{children:[n(Z,{...e,isModalView:!0}),n("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:n(Ye,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>E(!1),children:"Apply Filters"})})]})]}),y("div",{role:"graphics-document",className:`FacetNavPanel${r?"--expanded":""}`,children:[!r&&y("div",{className:"FacetNavPanel__title",children:[!_&&b?n(j,{width:100}):n("span",{className:"FacetNavPanel__title__name",children:l}),y("div",{className:"FacetNavPanel__title__tools",children:[n($,{facetValues:o.facetValues,columnModel:_==null?void 0:_.columnModels.find(d=>d.name===o.columnName),onChange:d=>{Re(T(),o,a,d)},onClear:()=>{ne(T(),o,a)},containerAs:"Dropdown"}),n(te,{idForToolTip:"expandGraph",tooltipText:"Expand to large graph",callbackFn:()=>E(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),n(te,{idForToolTip:"hideGraph",tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),r&&y(k,{children:[y("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),n($,{facetValues:o.facetValues,columnModel:_==null?void 0:_.columnModels.find(d=>d.name===o.columnName),onChange:d=>{Re(T(),o,a,d)},onClear:()=>{ne(T(),o,a)},containerAs:"Dropdown",dropdownType:"SelectBox"}),n(gt,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:n(Ft,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),n(v,{})]}),y("div",{className:`FacetNavPanel__body${r?"--expanded":""}`,children:[n(ht.SizeMe,{monitorHeight:!0,children:({size:d})=>{var w;return n("div",{className:Ht(r,c),children:n(kt,{layout:Dt,data:(w=g==null?void 0:g.data)!=null?w:[],style:Wt(d.width,c,r?300:150),config:{displayModeBar:!1},onClick:q=>Mt(q,o,i)},`${o.columnName}-${c}-${d.width}`)})}}),n(pe,{labels:g==null?void 0:g.labels,colors:g==null?void 0:g.colors,isExpanded:r})]})]})]})};try{pe.displayName="FacetPlotLegend",pe.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"]={docgenInfo:pe.__docgenInfo,name:"FacetPlotLegend",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"})}catch{}try{Z.displayName="FacetNavPanel",Z.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"]={docgenInfo:Z.__docgenInfo,name:"FacetNavPanel",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"})}catch{}const zt=()=>{try{return JSON.parse(sessionStorage.getItem(tt)||"")}catch{return[]}},$t=()=>{try{return JSON.parse(sessionStorage.getItem(nt)||"")}catch{return[]}},X=e=>{const{getColumnDisplayName:t}=H();let r,a="";if("facetWithSelection"in e){const{facetWithSelection:s}=e;s.facet.facetType==="enumeration"?r=s.displayValue===ee?fe:s.displayValue:r=`${s.facet.selectedMin} 
        - ${s.facet.selectedMax}`,a=`${t(s.facet.columnName)}: ${r}`}else if("filter"in e){const{filter:s}=e;let o=s.value;(o==null?void 0:o.startsWith("%"))&&(o==null?void 0:o.endsWith("%"))&&(o=o.substring(1,o.length-1)),r=o,a=`Text matches: "${o}"`,s.columnName&&(r=`"${o}" in ${t(s==null?void 0:s.columnName)}`,a=`${t(s==null?void 0:s.columnName)}: ${o}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const i=encodeURIComponent(a);return n(te,{idForToolTip:`selectionCriteria_${i}`,tooltipText:a,callbackFn:()=>{},children:y("div",{className:"SelectionCriteriaPill",children:[n("span",{children:r}),n("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:n(Et,{})})]},`SelectionCriteriaPill ${i}`)})};try{X.displayName="SelectionCriteriaPill",X.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:X.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const me=({style:e,frontText:t,endText:r="",hideIfUnfiltered:a=!1})=>{var O;const{data:i,isLoadingNewBundle:s,getLastQueryRequest:o,executeQueryRequest:c,getInitQueryRequest:C,error:m}=K(),{topLevelControlsState:_,unitDescription:b}=H(),T=i==null?void 0:i.queryCount,[I,g]=F.exports.useState([]),V=f=>{const p=W(o());p.query.selectedFacets=f,p.query.offset=0,c(p)},h=f=>f.filter(R=>R.facetType==="enumeration").filter(R=>R.facetValues.filter(S=>S.isSelected===!0).length>0),E=f=>f.filter(R=>R.facetType==="range").filter(R=>R.selectedMax||R.selectedMin),l=(f,p)=>{var R;const N=f.find(S=>S.id===p);return(R=N==null?void 0:N.name)!=null?R:p},u=(f,p)=>{const N=f.find(R=>R.ownerId===p);return(N==null?void 0:N.userName)||p},v=F.exports.useCallback((f,p)=>{const N=zt(),R=$t(),S=[];return f.forEach(Q=>{const L=p.find(P=>P.name===Q.columnName);Q.facetValues.forEach(P=>{if(P.isSelected){let ae=P.value;(L==null?void 0:L.columnType)===D.ENTITYID||(L==null?void 0:L.columnType)===D.ENTITYID_LIST?ae=l(N,P.value):((L==null?void 0:L.columnType)===D.USERID||(L==null?void 0:L.columnType)===D.USERID_LIST)&&(ae=u(R,P.value)),S.push({facet:Q,displayValue:ae,selectedValue:P})}})}),S},[]);F.exports.useEffect(()=>{if(i){const f=E(i.facets),p=h(i.facets),N=f.map(S=>({facet:S})),R=v(p,i.columnModels);g([...N,...R])}},[i,v]);const d=f=>{const{facet:p,selectedValue:N}=f;p.facetType==="enumeration"?ne(o(),p,V,N==null?void 0:N.value,!1):We(o(),p,V,[ve.ANY,ve.ANY])},w=(f,p)=>{var R;const N=W(o());!N.query.additionalFilters||(N.query.additionalFilters=(R=N.query.additionalFilters)==null?void 0:R.reduce(function(S,Q){if(ge(Q)||Fe(Q)){const L={columnName:Q.columnName,values:Q.columnName===f?Q.values.filter(P=>P!==p):Q.values,operator:ge(Q)?Q.operator:void 0,function:Fe(Q)?Q.function:void 0,concreteType:Q.concreteType};L.values.length>0&&S.push(L)}else S.push(Q);return S},[]),c(N))},q=f=>{const p=W(o());!p.query.additionalFilters||(p.query.additionalFilters=p.query.additionalFilters.filter(N=>!(Le(N)&&N.searchExpression===f.searchExpression)),c(p))},Y=()=>{const f=W(C());f.query.additionalFilters=[],c(f)},B=(O=o().query.additionalFilters)==null?void 0:O.reduce((f,p)=>{if(Le(p))f.push({key:`fulltextsearch-${p.searchExpression}`,filter:{value:p.searchExpression},onRemove:()=>q(p)});else if(ge(p)||Fe(p)){const{columnName:N}=p;p.values.forEach(R=>{f.push({key:`columnsearch-${R}`,filter:{columnName:N,value:R},onRemove:()=>w(p.columnName,R)})})}else console.warn("Encountered unexpected QueryFilter: ",p);return f},[]),x=_==null?void 0:_.showFacetFilter,A=I.length>0||B&&B.length>0;return m?n(k,{}):n("div",{className:`TotalQueryResults ${x?we:Oe} ${A?"hasFilters":""}`,style:e,children:s?n(j,{width:100}):y(k,{children:[(A||!a)&&y("div",{className:"TotalQueryResults__topbar",children:[y("span",{className:"SRC-boldText",children:[t," ",T==null?void 0:T.toLocaleString()," ",b," ",r]}),(I.length>0||B&&B.length>2)&&y("a",{onClick:Y,className:"TotalQueryResults__topbar__clearall",children:[n(G,{options:{icon:"deleteSweep"}}),"Clear all filters"]})]}),y("div",{className:"TotalQueryResults__selections",children:[B&&B.map(f=>F.exports.createElement(X,{...f,key:f.key})),I.map((f,p)=>{var N,R,S;return n(X,{facetWithSelection:f,onRemove:()=>d(f)},`facets-${(S=(R=(N=f.selectedValue)==null?void 0:N.value)!=null?R:f.displayValue)!=null?S:p}`)})]})]})})};try{me.displayName="TotalQueryResults",me.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:{value:"false"},description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:me.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}const xe=2;function Ne(e,t){var a,i;return(i=(a=e==null?void 0:e.facets)==null?void 0:a.filter(s=>s.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(s.columnName)>-1)&&s.facetValues.length>0&&!Be(s)))!=null?i:[]}const Te=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:r,isLoadingNewBundle:a,executeQueryRequest:i,error:s,asyncJobStatus:o}=K(),{topLevelControlsState:c}=H(),[C,m]=F.exports.useState([]),[_,b]=F.exports.useState(!0),{showFacetVisualization:T,showFacetFilter:I}=c,g=r();F.exports.useEffect(()=>{const x=Ne(t,e);x.length!==0&&_&&(m(x.map((A,O)=>({name:A.columnName,isHidden:O>=xe,plotType:"PIE"}))),b(!1))},[t,_,e]);const V=x=>{m(A=>A.map((O,f)=>x?{...O,isHidden:!1}:{...O,isHidden:f>=xe}))},h=x=>{g.query.selectedFacets=x,g.query.offset=0,i(g)},E=x=>C.find(f=>f.name===x&&f.isHidden===!0)!==void 0,l=F.exports.useMemo(()=>C.find(x=>x.isHidden===!0)?"MORE":C.length<=xe?"NONE":"LESS",[C]),u=x=>{w(x,"isHidden",!0)},v=(x,A)=>{w(x,"plotType",A)},d=x=>{var O;const A=(O=C.find(f=>f.name===x))==null?void 0:O.plotType;return A!=null?A:"PIE"},w=(x,A,O)=>{m(f=>f.map(p=>p.name===x?{...p,[A]:O}:p))},q=Ne(t,e),Y=Ne(t,e).map((x,A)=>({columnName:x.columnName,colorIndex:A})),B=(g==null?void 0:g.query.selectedFacets)!==void 0&&g.query.selectedFacets.length>0||(g==null?void 0:g.query.additionalFilters)!==void 0&&(g==null?void 0:g.query.additionalFilters.length)>0;return s?n(k,{}):!t&&a?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(o==null?void 0:o.progressMessage)&&y("div",{children:[n("span",{className:"spinner"}),o.progressMessage]})}):y(k,{children:[n(me,{frontText:"",endText:B?"filtered by":"",hideIfUnfiltered:!0}),q.length>0&&y("div",{className:`FacetNav ${T?"":"hidden"} ${I?we:Oe} ${l==="LESS"?"less":""}`,children:[n("div",{className:"FacetNav__row",role:"list",children:q.map(x=>{var A;return n("div",{className:"col-sm-12 col-md-4",style:{display:E(x.columnName)?"none":"block"},children:n(Z,{index:(A=Y.find(O=>O.columnName===x.columnName))==null?void 0:A.colorIndex,onHide:()=>u(x.columnName),plotType:d(x.columnName),onSetPlotType:O=>v(x.columnName,O),facetToPlot:x,applyChangesToFacetFilter:h,applyChangesToGraphSlice:(O,f,p)=>ne(g,O,h,f==null?void 0:f.value,p),isModalView:!1})},x.columnName)})}),l!=="NONE"&&n("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:n(Ye,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>V(l==="MORE"),style:{zIndex:500},children:l==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Te.displayName="FacetNav",Te.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"]={docgenInfo:Te.__docgenInfo,name:"FacetNav",path:"src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"})}catch{}export{It as C,$ as E,Ee as F,ie as I,we as Q,j as S,me as T,Oe as a,H as b,Rt as c,oe as d,Fe as e,bt as f,En as g,Re as h,ge as i,ne as j,Ce as k,ye as l,_e as m,Se as n,Te as o,he as p,xn as q,Ne as r,Ut as s,Wt as t,K as u,pe as v,le as w};

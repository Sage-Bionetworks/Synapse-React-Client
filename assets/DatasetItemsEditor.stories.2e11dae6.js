import{F as Q,A as X,B as ee,a as te,D as oe,b as re,c as ie,C as ne,M as ae,d as se,P as de,e as le}from"./EntityFinder.df5145aa.js";import{S as me}from"./SkeletonTable.cb05e4ee.js";import{r as N}from"./FullWidthAlert.50041932.js";import{o as ce,dr as pe,ds as ue}from"./index.df53d30d.js";import{E as fe}from"./EntityTypeUtils.33d60d86.js";import"./assert.38bfb438.js";import{T as M}from"./Typography.bfdf676e.js";import{E as he}from"./EntityFinderModal.7c01c438.js";import{I as ye}from"./IconSvg.3d20df6f.js";import{B as Ie}from"./LoadingScreen.e3fe6e43.js";import{W as Se}from"./WarningModal.c0522703.js";import{d as C}from"./ToastMessage.0defc330.js";import{C as Ee}from"./Checkbox.7f748159.js";import{a as h,j as o,F as P}from"./jsx-runtime.2e925369.js";import{S as Ce}from"./Skeleton.8dd0668e.js";import{B as D}from"./Button.c582ea4c.js";import"./iframe.4f1b3046.js";import"./objectWithoutPropertiesLoose.090b3c10.js";import"./toConsumableArray.b3669986.js";import"./index.06f4a415.js";import"./withStyles.8be28b48.js";import"./react-sizeme.352aa7dc.js";import"./Arrow.c6e8b887.js";import"./sqlFunctions.b49ac766.js";import"./use-deep-compare-effect.esm.9d3fc03b.js";import"./useGetEntityChildren.fa339687.js";import"./EntityChildren.50133102.js";import"./index.f252d424.js";import"./stateManager-845a3300.esm.2aae5abd.js";import"./classCallCheck.8304ed06.js";import"./inherits.98d6a15d.js";import"./HelpPopover.6e37ab69.js";import"./MarkdownPopover.4acbc597.js";import"./usePopperMarginModifiers.7a874fe8.js";import"./useWaitForDOMRef.0721218f.js";import"./isObject.f3be1931.js";import"./Transition.d42a873e.js";import"./hasClass.56fd144a.js";import"./MarkdownSynapse.5d37ac57.js";import"./UserCard.35b69d71.js";import"./getEndpoint.0de7fccf.js";import"./IconCopy.b1eba79c.js";import"./Tooltip.6c95fe7b.js";import"./createSvgIcon.d78a924b.js";import"./SvgIcon.31249d58.js";import"./useTheme.8804f8cd.js";import"./makeStyles.9dfaa099.js";import"./Overlay.ac713ce0.js";import"./factory.d280c1a2.js";import"./SynapseVideo.7d478323.js";import"./react-intersection-observer.m.66de6abb.js";import"./DateFormatter.60097950.js";import"./moment.53181859.js";import"./useEntityBundle.a0b893cc.js";import"./EntityIcon.9f0054b6.js";import"./SynapseTableConstants.07ecdebd.js";import"./SchemaDrivenAnnotationEditor.476489a9.js";import"./isEmpty.7d335ee7.js";import"./toString.f9b9a371.js";import"./useListState.7f5a3e64.js";import"./Collapse.fe074047.js";import"./groupBy.25c97993.js";import"./_baseMap.b3bd3746.js";import"./_baseIsEqual.47420285.js";import"./_cacheHas.25231a74.js";import"./_setToArray.a82100c8.js";import"./CalendarWithIconFormGroup.140757ce.js";import"./index.5ef2ed87.js";import"./index.8cde812d.js";import"./Modal.ea36991f.js";import"./useWillUnmount.4a16e5cd.js";import"./removeClass.27874bcb.js";import"./EntityModal.ce698082.js";import"./ExternalFileHandleInterface.605e36b3.js";import"./LockTwoTone.32ff1570.js";import"./cloneDeep.f4d84eee.js";import"./Dropdown.83bddc70.js";import"./isRequiredForA11y.61bbc671.js";import"./Sort.2dc3a76a.js";import"./EntityLink.8ca5f637.js";import"./useFavorites.00f33db8.js";import"./times.32925d9f.js";import"./toInteger.1984412c.js";import"./toNumber.71be2bd9.js";import"./debounce.bb67b392.js";import"./TypeUtils.a2c41307.js";import"./InfoOutlined.22a371fd.js";import"./uniqueId.50daefd4.js";const De=window.React.useState;function ge(m){const[c,p]=De(new Set(m));function u(...y){const n=new Set(c);for(const T of y)n.add(T);p(n)}function v(y){const n=new Set(c);n.delete(y),p(n)}function d(){p(new Set)}return{set:c,add:u,remove:v,clear:d}}const be=window.React.useEffect,w=window.React.useState,R="Add Files",we="Remove Files",Re="No files in this Dataset",z="Save the Dataset to continue.",ve="Create a Version of this Dataset to freeze it in its current state",Te="Dataset Saved",K=42,_e=350;function g(m){var V;const{entityId:c,onSave:p,onClose:u}=m,[v,d]=w(!1),[y,n]=w(!1),[T,A]=w(!1),[r,H]=w(),b=e=>{A(!0),H(e)},{data:I,refetch:j}=ce(c,void 0,{enabled:!r});be(()=>{!r&&I&&(I.items==null&&(I.items=[]),b(I),A(!1))},[I,r]);const{set:l,add:F,remove:$,clear:_}=ge(),O=!!(r&&r.items.length===l.size),{data:k}=pe(c),W=(V=k==null?void 0:k.path[1])==null?void 0:V.id,B=ue({onSuccess:()=>{p?p():C(ve,"success",{title:Te})},onError:e=>{e.status===412?C("Re-retrieve the dataset to get the latest changes. Your current changes will be lost.","warning",{title:"Dataset Updated since Last Fetched",primaryButtonConfig:{text:"Retrieve Dataset",onClick:()=>{j()}}}):C(e.reason,"danger",{title:"An Error Occurred"})}}),G=r==null?void 0:r.items.map(e=>({...e,isSelected:l.has(e.entityId),setSelected:t=>t?F(e.entityId):$(e.entityId)}));function U(e){b(t=>{if(t){const s=t.items.filter(i=>!e.find(E=>E.targetId===i.entityId)),a=e.filter(i=>t.items.find(E=>E.entityId===i.targetId)),f=e.filter(i=>!t.items.find(E=>E.entityId===i.targetId));let S=`${f.length} Item${f.length===1?"":"s"} added`;a.length>0?S+=` and ${a.length} Item${a.length===1?"":"s"} updated`:S+=" to Dataset",C(z,"info",{title:S});const Z=[...s,...a.map(i=>({entityId:i.targetId,versionNumber:i.targetVersionNumber})),...f.map(i=>({entityId:i.targetId,versionNumber:i.targetVersionNumber}))];return{...t,items:Z}}else return console.warn("Cannot add items to the Dataset because it is undefined. The Dataset may not have been fetched yet."),t}),_()}function Y(){b(e=>({...e,items:e.items.filter(t=>!l.has(t.entityId))})),C(z,"info",{title:`${l.size} Item${l.size===1?"":"s"} removed from the Dataset`}),_()}function q(e,t){b(s=>({...s,items:s.items.map(a=>a.entityId===e?{entityId:e,versionNumber:t}:a)}))}const x=[{key:"errorState",width:30,cellRenderer:te},{key:"isSelected",width:40,dataKey:"isSelected",headerRenderer:r?o(e=>{const{datasetToUpdate:t,clearSelectedIds:s,addSelectedId:a}=e,f=O;return t?o("div",{"data-testid":"Select All",style:{cursor:"pointer"},onClick:()=>{f?s():a(...t.items.map(S=>S.entityId))},children:o(Ee,{label:"",className:"SRC-pointer-events-none",checked:f,disabled:t.items.length===0,onChange:()=>{}})}):o(P,{})},{datasetToUpdate:r,selectedIds:l,clearSelectedIds:_,addSelectedId:F,allItemsAreSelected:O}):o(P,{}),cellRenderer:oe},{key:"name",width:350,dataKey:"entityId",title:"Name",resizable:!0,cellRenderer:re},{key:"status",width:80,dataKey:"entityId",resizable:!0,cellRenderer:ie},{key:"id",width:140,title:"ID",dataKey:"entityId",resizable:!0},{key:"version",width:150,title:"Version",dataKey:"entityId",cellRenderer:e=>o(le,{...e,toggleSelection:t=>{q(t.entityId,t.versionNumber)}})},{key:"createdOn",width:200,title:"Created On",dataKey:"entityId",resizable:!0,cellRenderer:ne},{key:"modifiedOn",width:200,title:"Modified On",dataKey:"entityId",resizable:!0,cellRenderer:ae},{key:"modifiedBy",width:250,title:"Modified By",dataKey:"entityId",resizable:!0,cellRenderer:se},{key:"projectId",width:300,title:"Project",dataKey:"entityId",resizable:!0,cellRenderer:de}],L=x.reduce((e,t)=>e+t.width,0);function J(){return h("div",{className:"NoItemsPlaceholder",children:[o(M,{variant:"headline3",children:Re}),h(D,{className:"AddItemsButton",variant:"sds-primary",onClick:()=>d(!0),children:[o(ye,{options:{icon:"addCircleTwoTone"}}),o("span",{children:R})]})]})}return h("div",{className:"DatasetEditor bootstrap-4-backport",children:[o(he,{configuration:{projectId:W,selectMultiple:!0,initialScope:Q.ALL_PROJECTS,initialContainer:null,selectableTypes:[fe.FILE],mustSelectVersionNumber:!0},titlePopoverProps:{markdownText:"Use the left pane to browse Projects and Folders to find Files to add to this Dataset. Files in a Dataset can be added from multiple folders. You can also use Search to find and select Files.",helpUrl:"https://help.synapse.org/docs/Datasets.2611281979.html"},promptCopy:"Find Files located across one or more Folders to add to the Dataset.",show:v,onClose:()=>{d(!1)},title:R+" to Dataset",confirmButtonCopy:R,onConfirm:e=>{U(e),d(!1)},onCancel:()=>d(!1)}),o(Se,{title:"Unsaved Changes",modalBody:"Any unsaved changes will be lost. Are you sure you want to close the editor?",confirmButtonText:"Close Editor",onConfirm:()=>{u&&(n(!1),u())},show:y,onConfirmCallbackArgs:[],onCancel:()=>n(!1)}),h("div",{className:"DatasetEditorTopBottomPanel",children:[o(Ie,{show:B.isLoading}),o("div",{className:"ItemCount",children:r?h(M,{variant:"headline3",children:[r.items.length===0?"No":r.items.length.toLocaleString()," ","File",r.items.length!==1&&"s"]}):o(Ce,{variant:"rect",width:200})}),o(D,{variant:"sds-primary",disabled:r==null,onClick:()=>d(!0),children:R}),o(D,{disabled:l.size===0,variant:"outline",onClick:Y,children:we})]}),o("div",{className:"DatasetEditorTableContainer",children:r?r.items.length===0?o(J,{}):o(X,{height:_e,onResize:N,children:({height:e,width:t})=>o(ee,{classPrefix:"DatasetEditorTable",data:G,height:e,width:t>L?t:L,rowHeight:K,overscanRowCount:5,columns:x,rowClassName:"DatasetEditorRow",rowProps:({rowData:s})=>({"aria-selected":s.isSelected}),headerCellProps:{role:"columnheader"},onRowsRendered:N,onScroll:N})}):o(me,{className:"DatasetItemsEditorSkeleton",numRows:8,numCols:6,rowHeight:`${K}px`})}),h("div",{className:"DatasetEditorTopBottomPanel",children:[o(D,{variant:"outline",onClick:()=>{T?n(!0):u&&u()},children:"Cancel"}),o(D,{disabled:!r,variant:"sds-primary",onClick:()=>B.mutate(r),children:"Save"})]})]})}try{g.displayName="DatasetItemsEditor",g.__docgenInfo={description:"",displayName:"DatasetItemsEditor",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!1,type:{name:"(() => void)"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/table/datasets/DatasetItemsEditor.tsx#DatasetItemsEditor"]={docgenInfo:g.__docgenInfo,name:"DatasetItemsEditor",path:"src/lib/containers/table/datasets/DatasetItemsEditor.tsx#DatasetItemsEditor"})}catch{}var ho={parameters:{storySource:{source:`import React from 'react'
import { ComponentStory, ComponentMeta } from '@storybook/react'
import { DatasetItemsEditor } from './DatasetItemsEditor'

export default {
  title: 'Synapse/DatasetItemsEditor',
  component: DatasetItemsEditor,
} as ComponentMeta<typeof DatasetItemsEditor>

const Template: ComponentStory<typeof DatasetItemsEditor> = args => (
  <DatasetItemsEditor {...args} />
)

export const Demo = Template.bind({})
Demo.args = {
  entityId: 'syn26302617',
}
`,locationsMap:{demo:{startLoc:{col:60,line:10},endLoc:{col:1,line:12},startBody:{col:60,line:10},endBody:{col:1,line:12}}}}},title:"Synapse/DatasetItemsEditor",component:g};const ke=m=>o(g,{...m}),Ne=ke.bind({});Ne.args={entityId:"syn26302617"};const yo=["Demo"];export{Ne as Demo,yo as __namedExportsOrder,ho as default};
//# sourceMappingURL=DatasetItemsEditor.stories.2e11dae6.js.map

import{j as s,a as S,F as Y}from"./jsx-runtime.00d70968.js";import{S as De}from"./Skeleton.c897a2bf.js";import{x as Ye,y as We,s as Pe,t as ze,q as $e,B as Ke,z as He,o as Me,A as Ge,V as ye,C as fe}from"./index.a10c4deb.js";import{C as V}from"./ColumnType.744125d2.js";import"./assert.488d80ba.js";import{i as he}from"./TypeUtils.a2c41307.js";import{a as Je,u as Ne,b as je}from"./use-deep-compare-effect.esm.76673280.js";import{a as Xe,p as Ze}from"./sqlFunctions.59c64146.js";import{i as et,r as tt,a as nt}from"./queryUtils.5580f44f.js";import{c as D}from"./cloneDeep.1192ea57.js";import{u as G,E as we}from"./ElementWithTooltip.bfecb0fa.js";import{C as at,a as be}from"./Collapse.a100796c.js";import{u as Ee}from"./useGetInfoFromIds.0f434cfa.js";import{I as ne}from"./IconSvg.e3afc045.js";import{C as Ie}from"./Checkbox.96de280e.js";import{I as rt,a as it}from"./IconMinus.3805e4f5.js";import{D as K}from"./Dropdown.13d94a98.js";import{R as st}from"./RadioGroup.7c46be31.js";import{h as Fe}from"./moment.a565bb48.js";import{R as ot}from"./RangeSlider.df5d4da8.js";import{B as lt}from"./Button.fda23eee.js";const ct=window.React.createContext,_e=window.React.useContext,A=ct(void 0),J=({children:e,queryContext:t})=>s(A.Provider,{value:t,children:e});function Ce(){const e=_e(A);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function nn(){const e=_e(A);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function an(){const e=_e(A);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const ae=A.Consumer;try{A.displayName="QueryContext",A.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:A.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{J.displayName="QueryContextProvider",J.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:J.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{ae.displayName="QueryContextConsumer",ae.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:ae.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}const j=e=>s(De,{style:{...e.style,display:"inline-block"},...e});try{j.displayName="SkeletonInlineBlock",j.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:j.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const ut=()=>{try{return JSON.parse(sessionStorage.getItem(Ye)||"")}catch{return[]}},dt=()=>{try{return JSON.parse(sessionStorage.getItem(We)||"")}catch{return[]}};var pt=(e=>(e.LIKE="LIKE",e))(pt||{}),mt=(e=>(e.HAS="HAS",e.HAS_LIKE="HAS_LIKE",e))(mt||{});const yt="org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",ft="org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",ht="org.sagebionetworks.repo.model.table.TextMatchesQueryFilter",Re=he(ht),re=he(yt),ie=he(ft),_t=window.React.createContext,Ct=window.React.useContext,se=window.React.useEffect,oe=window.React.useState,W=_t(void 0),X=({children:e,queryVisualizationContext:t})=>s(W.Provider,{value:t,children:e});function qe(){const e=Ct(W);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const le=W.Consumer;function ce(e){var v,Q;const{data:t,getLastQueryRequest:i,isFacetsAvailable:r,isLoadingNewBundle:n}=Ce(),[a,c]=oe({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(v=e.defaultShowFacetVisualization)!=null?v:!0,showSearchBar:(Q=e.defaultShowSearchBar)!=null?Q:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});se(()=>{r||c(w=>({...w,showFacetFilter:!1,showFacetVisualization:!1}))},[r]),se(()=>{n&&C([])},[n]);const[m,E]=oe([]),[d,C]=oe([]),R=i(),f=Je(t==null?void 0:t.selectColumns);se(()=>{var w,b;E((b=f==null?void 0:f.slice(0,(w=e.visibleColumnCount)!=null?w:1/0).map(_=>_.name))!=null?b:[])},[f,R.query.sql,e.visibleColumnCount]);const x={topLevelControlsState:a,setTopLevelControlsState:c,columnsToShowInTable:m,setColumnsToShowInTable:E,selectedRowIndices:d,setSelectedRowIndices:C,facetAliases:e.facetAliases,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn},{children:F}=e;return s(X,{queryVisualizationContext:x,children:F})}try{ce.displayName="QueryVisualizationWrapper",ce.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:ce.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{W.displayName="QueryVisualizationContext",W.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:W.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{X.displayName="QueryVisualizationContextProvider",X.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:X.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{le.displayName="QueryVisualizationContextConsumer",le.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:le.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}function Oe(e,t){return`${e}${t}`}function St(e,t){const i=window.location.search,r=`${e}=${t}`;return i?i.includes(`${e}=`)?window.location.search.slice(i.indexOf("?")+1).split("&").map(c=>c.split("=")[0]===e?`${r}`:c).join("&"):`${i.substr(1)}&${r}`:r}function gt(e,t){if(!window.location.search)return;const i=Oe(e,t),n=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(a=>a.split("=")[0]===i).map(a=>a.split("=")[1])[0];return n?decodeURIComponent(n):void 0}function Et(e,t,i){const r=t!==void 0?Oe(e,t):e,n=St(r,i),a=window.location,c=`${a.protocol}//${a.hostname}${a.port?":"+a.port:""}${a.pathname}?${n}`;window.history.replaceState("object or string","Title",c)}function Ft(e,t){const i=gt(e,t);let r;if(i){const n=JSON.parse(i);n.sql&&(r={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:Pe|ze|$e|Ke,entityId:Xe(n.sql),query:n})}return r}const Rt=window.React,Tt=window.React.useEffect,xt=window.React.useMemo,Te=window.React.useState,Ve="isShowingFacetFilters",Ae="isHidingFacetFilters";function ue(e){var y,T,o;const{initQueryRequest:t,onQueryChange:i,onQueryResultBundleChange:r,lockedColumn:n}=e,[a,c]=Te(t),[m,E]=Te(void 0),{data:d,isLoading:C,error:R,isPreviousData:f,remove:x}=He(a,{keepPreviousData:!0},E),F=d==null?void 0:d.responseBody,v=C||f,{entityId:Q,versionNumber:w}=Ze(a.query.sql),{data:b}=Me(Q,w),_=(y=a.query.limit)!=null?y:Ge,I=Math.ceil((((T=a.query.offset)!=null?T:0)+Number(_))/_),P=h=>{const g=N();g.query.limit=h,O(g)},L=h=>{const g=N();g.query.offset=(h-1)*_,O(g)};Ne(()=>{i&&i(JSON.stringify(a.query))},[i,a.query]),je(()=>{F&&r&&r(JSON.stringify(F))},[F,r]);const k=(o=e.componentIndex)!=null?o:0,U=F?et(F.facets,F.selectColumns):!0;Tt(()=>{const h=Ft("QueryWrapper",k);h&&c(h)},[]);const N=Rt.useCallback(()=>D(a),[a]);function z(){return D(e.initQueryRequest)}function O(h){const g=D(h);if(c(g),g.query){const q=JSON.stringify(g.query),ge=encodeURIComponent(q);e.shouldDeepLink&&(e.onQueryChange?e.onQueryChange(q):Et("QueryWrapper",k,ge))}x()}const u={data:xt(()=>tt(F,n),[F,n]),currentPage:I,pageSize:_,setPageSize:P,isLoadingNewBundle:v,getLastQueryRequest:N,getInitQueryRequest:z,error:R,entity:b,executeQueryRequest:O,isFacetsAvailable:U,asyncJobStatus:m,goToPage:L},{children:l}=e;return s(J,{queryContext:u,children:s("div",{className:`SRC-wrapper ${v?"SRC-logo-cursor":""} ${U?"has-facets":""}`,children:l})})}try{ue.displayName="QueryWrapper",ue.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:ue.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}const H=e=>{let t,i="";if("facetWithSelection"in e){const{facetWithSelection:n}=e;n.facet.facetType==="enumeration"?t=n.displayValue===ye?fe:n.displayValue:t=`${n.facet.selectedMin} 
        - ${n.facet.selectedMax}`,i=`${G(n.facet.columnName)}: ${t}`}else if("filter"in e){const{filter:n}=e;let a=n.value;(a==null?void 0:a.startsWith("%"))&&(a==null?void 0:a.endsWith("%"))&&(a=a.substring(1,a.length-1)),t=a,i=`Text matches: "${a}"`,n.columnName&&(t=`"${a}" in ${G(n==null?void 0:n.columnName)}`,i=`${G(n==null?void 0:n.columnName)}: ${a}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const r=encodeURIComponent(i);return s(we,{idForToolTip:`selectionCriteria_${r}`,tooltipText:i,callbackFn:()=>{},children:S("label",{className:"SelectionCriteriaPill",children:[s("span",{children:t}),s("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:s(at,{})})]},`SelectionCriteriaPill ${r}`)})};try{H.displayName="SelectionCriteriaPill",H.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:H.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const M=({label:e,isCollapsed:t,onClick:i,facetAliases:r})=>S("div",{className:"FacetFilterHeader",children:[s("label",{className:"FacetFilterHeader__label",children:G(e,r)}),s("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>i(!t),children:t?s(rt,{className:"icon-plus",title:"Expand Menu"}):s(it,{className:"icon-minus",title:"Collapse Menu"})})]});try{M.displayName="FacetFilterHeader",M.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"Function"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!0,type:{name:"{} | undefined"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:M.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}const Le=window.React,B=window.React.useState;function Qt(e){return e.replace(/\s/g,"").toLowerCase()}function xe(e,t=[],i=[]){const{value:r}=e;let n=r;r===ye&&(n=fe);const a=t.find(m=>m.ownerId===r);a&&(n=a?a.userName:`unknown (${r})`);const c=i.find(m=>m.id===r);return c&&(n=c?c.name:`unknown (${r})`),`${n}`}function vt(e,t,i){const r=[...e.sort((n,a)=>a.count-n.count)];return t||r.length<=i||r.slice(i).find(n=>n.isSelected)?r:r.splice(0,i)}const Z=({facetValues:e,columnModel:t,onClear:i,onChange:r,facetAliases:n,containerAs:a="Collapsible",dropdownType:c="Icon",collapsed:m=!1})=>{const[E,d]=B(!1),[C,R]=B(m),[f,x]=B(!1),[F,v]=B(!1),[Q,w]=B(""),[b,_]=B(e);Ne(()=>{_(e)},[e]);const I=5,P=1500,L=Le.createRef(),k={};let U;const N=e.filter(o=>o.isSelected).length===0,z=(t==null?void 0:t.columnType)===V.USERID||(t==null?void 0:t.columnType)===V.USERID_LIST?e.map(o=>o.value):[],O=Ee({ids:z,type:"USER_PROFILE"}),$=(t==null?void 0:t.columnType)===V.ENTITYID||(t==null?void 0:t.columnType)===V.ENTITYID_LIST?e.map(o=>o.value):[],u=Ee({ids:$,type:"ENTITY_HEADER"}),l=o=>{const h=o.target.value;if(w(h),d(!0),!h)e.forEach(g=>{g.isSelected=!1}),_(e);else{const g=e.filter(q=>xe(q,O,u).toLowerCase().indexOf(h.trim().toLowerCase())>-1?q:null);_(g)}};if(!t)return s(Y,{});const p=a==="Dropdown",y=S("div",{className:p?"EnumFacetFilter__dropdown_menu":"",children:[S("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[S("div",{className:F?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[s("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{_(e),v(!1),d(!1)},children:s("span",{className:"EnumFacetFilter__previous",children:s(ne,{options:{icon:"arrowBack"}})})}),Q.length>0&&s("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var o;w(""),(o=L.current)==null||o.focus()},children:s("span",{className:"EnumFacetFilter__reset",children:s(ne,{options:{icon:"close"}})})}),s("input",{type:"text",placeholder:"Find values",value:Q,ref:L,onChange:o=>{l(o)}})]}),!F&&S("div",{className:"EnumFacetFilter__checkAll",children:[s(Ie,{className:"EnumFacetFilter__checkbox",onChange:()=>{i()},checked:N,label:"All",isSelectAll:!0},"select_all"),s("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var o;w(""),v(!0),(o=L.current)==null||o.focus()},children:s("span",{className:"EnumFacetFilter__searchicon",children:s(ne,{options:{icon:"search"}})})})]})]}),S("div",{children:[b.length>0&&vt(b,E||p,I).map((o,h)=>s(Nt,{id:Qt(o.value),index:h,label:xe(o,O,u),count:o.count,isDropdown:p,initialIsSelected:o.isSelected,onChange:g=>{k[o.value]=g,clearTimeout(U),U=setTimeout(()=>{r(k),x(!1)},P)}},`checkLabel${h}`)),!p&&S(Y,{children:[!E&&b.length>I&&s("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!0),children:s("div",{className:"EnumFacetFilter__checkboxContainer",children:S("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",b.length,")"]})})}),E&&b.length>I&&s("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!1),children:s("div",{className:"EnumFacetFilter__checkboxContainer",children:s("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),b.length<=0&&s("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),T=()=>x(!f);return p?c==="SelectBox"?S(K,{className:"EnumFacetFilter EnumFacetFilterSelect",show:f,onToggle:T,children:[S(K.Toggle,{className:"secondary-caret",variant:"gray-select",children:[N&&"All",!N&&e.filter(o=>o.isSelected).length===1&&e.filter(o=>o.isSelected)[0].value,!N&&e.filter(o=>o.isSelected).length>1&&"Multiple Values Selected"]}),s(K.Menu,{children:y})]}):S(K,{className:"EnumFacetFilter",show:f,onToggle:T,children:[s(we,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),s(K.Menu,{children:y})]}):S(Y,{children:[s(M,{facetAliases:n,isCollapsed:C,label:t.name,onClick:o=>R(o)}),s(be,{className:"EnumFacetFilter",in:!C,children:y})]})};function Nt({id:e,index:t,label:i,count:r,isDropdown:n,initialIsSelected:a,onChange:c}){const[m,E]=B(a);return Le.useEffect(()=>{E(a)},[a]),S("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{n&&(E(!m),c(!m))},children:[s(Ie,{className:"EnumFacetFilter__checkbox",onClick:d=>d.stopPropagation(),onChange:d=>{E(d),c(d)},checked:m,label:i},`${e}-${t}`),n&&S("span",{className:"EnumFacetFilter__count",children:["(",r,")"]}),!n&&s("div",{className:"EnumFacetFilter__count",children:r})]})}try{Z.displayName="EnumFacetFilter",Z.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:Z.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const Qe=window.React.useState,ee=e=>{const t="Min value should be less then max value",[i,r]=Qe(!1),[n,a]=Qe(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Fe(e.initialValues.min).format("YYYY-MM-DD"),max:Fe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),c=e.className?`range ${e.className}`:"range",m=({min:d,max:C},R="number")=>{if(d==null||C===null||C===void 0)return r(!1),!0;if(R==="number"){if(Number(d)>Number(C))return r(!0),!1}else if(Date.parse(d)>Date.parse(C))return r(!0),!1;return r(!1),!0},E=(d,C,R="number")=>{m(d,R)&&C(d)};return S("div",{className:c,style:{display:"flex",flexWrap:"wrap"},children:[S("div",{style:{marginRight:"10px"},children:[s("input",{"aria-label":"min",type:e.type,value:n.min,onChange:({target:d})=>a({min:d.value,max:n.max})},"range_min"),s("div",{children:"to"}),s("input",{"aria-label":"max",type:e.type,value:n.max,onChange:({target:d})=>a({min:n.min,max:d.value})},"range_max")]}),s("button",{className:"btn btn-link SRC-noPadding",onClick:()=>E(n,e.onChange,e.type),children:"Apply"}),i&&s("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{ee.displayName="Range",ee.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:ee.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}const ve=window.React.useState;var me=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(me||{});const te=({facetResult:e,columnModel:t,onChange:i,facetAliases:r,collapsed:n=!1})=>{const[a,c]=ve(n),m=[{label:fe,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:E,columnMax:d,selectedMin:C,selectedMax:R}=e;const f=!C&&!R;C=C||E,R=R||d;const x=t.columnType==="DOUBLE"?"number":"date",F=(_,I)=>I?"":_===ye?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",v=(_,I)=>{w(_),_!=="RANGE"&&I([_,_])},[Q,w]=ve(F(C,f));return S("div",{children:[s(M,{isCollapsed:a,label:t.name,onClick:_=>c(_),facetAliases:r}),S(be,{in:!a,children:[s(st,{value:Q,id:"rangeSelector",options:m,onChange:_=>v(_,i)}),Q==="RANGE"&&(E===d?s("label",{children:d}):S(Y,{children:[t.columnType==="INTEGER"&&S(ot,{domain:[E,d],initialValues:{min:C,max:R},step:1,doUpdateOnApply:!0,onChange:_=>i([_.min,_.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&s(ee,{initialValues:{min:C,max:R},type:x,onChange:_=>i([_.min,_.max])},"Range")]}))]})]})};try{te.displayName="RangeFacetFilter",te.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:te.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const ke=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected===!0).map(t=>t.value)}),wt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Se=(e,t)=>{var a,c;const i=(c=(a=t==null?void 0:t.query)==null?void 0:a.selectedFacets)!=null?c:[],r=i.findIndex(m=>m.columnName===e.columnName),n=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return r>-1?n?i.splice(r,1):i[r]=e:i.push(e),i};function Ue(e,t,i,r,n=!1){r?t.facetValues.forEach(m=>{m.value===r&&(m.isSelected=n)}):t.facetValues.forEach(m=>{m.isSelected=!1});const a=ke(t),c=Se(a,e);i(c)}const bt=(e,t,i,r)=>{const n=r&&Object.keys(r)||[];n.length&&t.facetValues.forEach(m=>{n.includes(m.value)&&(m.isSelected=r?!!r[m.value]:!1)});const a=ke(t),c=Se(a,e);i(c)},Be=(e,t,i,r)=>{t.columnMin=r[0],t.columnMax=r[1];const n=wt(t),a=Se(n,e);i(a)},de=({facetsToFilter:e})=>{const{data:t,isLoadingNewBundle:i,getLastQueryRequest:r,executeQueryRequest:n}=Ce(),{facetAliases:a,topLevelControlsState:c}=qe();if(!t)return s(Y,{});const{showFacetFilter:m}=c,E=t.selectColumns;let d=t.facets;e&&(d=d.filter(f=>e.includes(f.columnName)));const C=r(),R=f=>{const x=r();x.query.selectedFacets=f,x.query.offset=0,n(x)};return S("div",{className:`QueryFilter ${m?Ve:Ae}`,children:[i&&s("div",{children:"Loading..."}),!i&&d.map((f,x)=>{const F=E.find(Q=>Q.name===f.columnName),v=x>2;if(!nt(f))return S("div",{className:"QueryFilter__facet",children:[f.facetType==="enumeration"&&F&&s(Z,{containerAs:"Collapsible",collapsed:v,facetValues:f.facetValues,columnModel:F,facetAliases:a,onChange:Q=>bt(C,f,R,Q),onClear:()=>Ue(C,f,R)}),f.facetType==="range"&&F&&s(te,{facetResult:f,columnModel:F,facetAliases:a,collapsed:v,onChange:Q=>Be(C,f,R,Q)})]},f.columnName)})]})};try{de.displayName="QueryFilter",de.__docgenInfo={description:"",displayName:"QueryFilter",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"]={docgenInfo:de.__docgenInfo,name:"QueryFilter",path:"src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"})}catch{}const It=window.React.useCallback,qt=window.React.useEffect,Ot=window.React.useState,Vt=window.React.createElement,pe=({style:e,frontText:t,endText:i="",hideIfUnfiltered:r=!1})=>{var $;const{data:n,isLoadingNewBundle:a,getLastQueryRequest:c,executeQueryRequest:m,getInitQueryRequest:E,error:d}=Ce(),{topLevelControlsState:C,unitDescription:R}=qe(),f=n==null?void 0:n.queryCount,[x,F]=Ot([]),v=u=>{const l=D(c());l.query.selectedFacets=u,l.query.offset=0,m(l)},Q=u=>u.filter(y=>y.facetType==="enumeration").filter(y=>y.facetValues.filter(T=>T.isSelected===!0).length>0),w=u=>u.filter(y=>y.facetType==="range").filter(y=>y.selectedMax||y.selectedMin),b=(u,l)=>{var y;const p=u.find(T=>T.id===l);return(y=p==null?void 0:p.name)!=null?y:l},_=(u,l)=>{const p=u.find(y=>y.ownerId===l);return(p==null?void 0:p.userName)||l},I=It((u,l)=>{const p=ut(),y=dt(),T=[];return u.forEach(o=>{const h=l.find(g=>g.name===o.columnName);o.facetValues.forEach(g=>{if(g.isSelected){let q=g.value;(h==null?void 0:h.columnType)===V.ENTITYID||(h==null?void 0:h.columnType)===V.ENTITYID_LIST?q=b(p,g.value):((h==null?void 0:h.columnType)===V.USERID||(h==null?void 0:h.columnType)===V.USERID_LIST)&&(q=_(y,g.value)),T.push({facet:o,displayValue:q,selectedValue:g})}})}),T},[]);qt(()=>{if(n){const u=w(n.facets),l=Q(n.facets),p=u.map(T=>({facet:T})),y=I(l,n.columnModels);F([...p,...y])}},[n,I]);const P=u=>{const{facet:l,selectedValue:p}=u;l.facetType==="enumeration"?Ue(c(),l,v,p==null?void 0:p.value,!1):Be(c(),l,v,[me.ANY,me.ANY])},L=(u,l)=>{var y;const p=D(c());!p.query.additionalFilters||(p.query.additionalFilters=(y=p.query.additionalFilters)==null?void 0:y.reduce(function(T,o){if(re(o)||ie(o)){const h={columnName:o.columnName,values:o.columnName===u?o.values.filter(g=>g!==l):o.values,operator:re(o)?o.operator:void 0,function:ie(o)?o.function:void 0,concreteType:o.concreteType};h.values.length>0&&T.push(h)}else T.push(o);return T},[]),m(p))},k=u=>{const l=D(c());!l.query.additionalFilters||(l.query.additionalFilters=l.query.additionalFilters.filter(p=>!(Re(p)&&p.searchExpression===u.searchExpression)),m(l))},U=()=>{const u=D(E());u.query.additionalFilters=[],m(u)},N=($=c().query.additionalFilters)==null?void 0:$.reduce((u,l)=>{if(Re(l))u.push({key:`fulltextsearch-${l.searchExpression}`,filter:{value:l.searchExpression},onRemove:()=>k(l)});else if(re(l)||ie(l)){const{columnName:p}=l;l.values.forEach(y=>{u.push({key:`columnsearch-${y}`,filter:{columnName:p,value:y},onRemove:()=>L(l.columnName,y)})})}else console.warn("Encountered unexpected QueryFilter: ",l);return u},[]),z=C==null?void 0:C.showFacetFilter,O=x.length>0||N&&N.length>0;return d?s(Y,{}):s("div",{className:`TotalQueryResults ${z?Ve:Ae}`,style:e,children:a?s(j,{width:100}):S(Y,{children:[(O||!r)&&S("span",{className:"SRC-boldText SRC-centerContent",children:[t," ",f==null?void 0:f.toLocaleString()," ",R," ",i]}),S("div",{className:"TotalQueryResults__selections",children:[N&&N.map(u=>Vt(H,{...u,key:u.key})),x.map((u,l)=>{var p,y,T;return s(H,{facetWithSelection:u,onRemove:()=>P(u)},`facets-${(T=(y=(p=u.selectedValue)==null?void 0:p.value)!=null?y:u.displayValue)!=null?T:l}`)}),(x.length>2||N&&N.length>2)&&s(lt,{onClick:U,variant:"light",className:"TotalQueryResults__clearall",children:"Clear All"})]})]})})};try{pe.displayName="TotalQueryResults",pe.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:{value:"false"},description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:pe.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}export{mt as C,Z as E,J as Q,j as S,pe as T,Et as a,Ce as b,ce as c,ae as d,qe as e,ue as f,Ft as g,bt as h,Ue as i,Ve as j,Ae as k,le as l,de as m,re as n,ie as o,pt as p,nn as q,an as u};

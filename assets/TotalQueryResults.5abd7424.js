import{j as s,a as S,F as D}from"./jsx-runtime.00d70968.js";import{S as Ue}from"./Skeleton.c897a2bf.js";import{x as Be,y as De,s as Ye,t as Pe,q as We,B as ze,z as $e,A as Ke,o as He,V as ye,C as fe}from"./index.463f1f6b.js";import{C as V}from"./ColumnType.744125d2.js";import"./assert.543e7698.js";import{i as he}from"./TypeUtils.a2c41307.js";import{u as Me,a as Ge,b as Je}from"./use-deep-compare-effect.esm.357a0ad8.js";import{i as je,r as Xe,a as Ze}from"./queryUtils.60a75644.js";import{p as et,a as tt}from"./sqlFunctions.b49ac766.js";import{c as B}from"./cloneDeep.8587870c.js";import{u as G,E as ve}from"./ElementWithTooltip.60ddd30b.js";import{C as nt,a as Ne}from"./Collapse.a100796c.js";import{u as ge}from"./useGetInfoFromIds.d52980b9.js";import{I as ne}from"./IconSvg.e3afc045.js";import{C as be}from"./Checkbox.96de280e.js";import{I as at,a as rt}from"./IconMinus.3805e4f5.js";import{D as K}from"./Dropdown.13d94a98.js";import{R as it}from"./RadioGroup.7c46be31.js";import{h as Ee}from"./moment.a565bb48.js";import{R as st}from"./RangeSlider.df5d4da8.js";import{B as ot}from"./Button.fda23eee.js";const lt=window.React.createContext,_e=window.React.useContext,A=lt(void 0),J=({children:e,queryContext:t})=>s(A.Provider,{value:t,children:e});function Se(){const e=_e(A);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function rn(){const e=_e(A);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function sn(){const e=_e(A);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const ae=A.Consumer;try{A.displayName="QueryContext",A.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:A.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{J.displayName="QueryContextProvider",J.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:J.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{ae.displayName="QueryContextConsumer",ae.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:ae.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}const j=e=>s(Ue,{style:{...e.style,display:"inline-block"},...e});try{j.displayName="SkeletonInlineBlock",j.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:j.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const ct=()=>{try{return JSON.parse(sessionStorage.getItem(Be)||"")}catch{return[]}},ut=()=>{try{return JSON.parse(sessionStorage.getItem(De)||"")}catch{return[]}};var dt=(e=>(e.LIKE="LIKE",e))(dt||{}),pt=(e=>(e.HAS="HAS",e.HAS_LIKE="HAS_LIKE",e))(pt||{});const mt="org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",yt="org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",ft="org.sagebionetworks.repo.model.table.TextMatchesQueryFilter",Fe=he(ft),re=he(mt),ie=he(yt),ht=window.React.createContext,_t=window.React.useContext,se=window.React.useEffect,oe=window.React.useState,z=ht(void 0),X=({children:e,queryVisualizationContext:t})=>s(z.Provider,{value:t,children:e});function we(){const e=_t(z);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const le=z.Consumer;function ce(e){var v,R;const{data:t,getLastQueryRequest:i,isFacetsAvailable:a,isLoadingNewBundle:n}=Se(),[r,l]=oe({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(v=e.defaultShowFacetVisualization)!=null?v:!0,showSearchBar:(R=e.defaultShowSearchBar)!=null?R:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});se(()=>{a||l(N=>({...N,showFacetFilter:!1,showFacetVisualization:!1}))},[a]),se(()=>{n&&h([])},[n]);const[d,g]=oe([]),[u,h]=oe([]),E=i(),y=Me(t==null?void 0:t.selectColumns);se(()=>{var N,C;g((C=y==null?void 0:y.slice(0,(N=e.visibleColumnCount)!=null?N:1/0).map(p=>p.name))!=null?C:[])},[y,E.query.sql,e.visibleColumnCount]);const T={topLevelControlsState:r,setTopLevelControlsState:l,columnsToShowInTable:d,setColumnsToShowInTable:g,selectedRowIndices:u,setSelectedRowIndices:h,facetAliases:e.facetAliases,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn},{children:Q}=e;return s(X,{queryVisualizationContext:T,children:Q})}try{ce.displayName="QueryVisualizationWrapper",ce.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:ce.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{z.displayName="QueryVisualizationContext",z.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:z.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{X.displayName="QueryVisualizationContextProvider",X.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:X.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{le.displayName="QueryVisualizationContextConsumer",le.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:le.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}function Ie(e,t){return`${e}${t}`}function St(e,t){const i=window.location.search,a=`${e}=${t}`;return i?i.includes(`${e}=`)?window.location.search.slice(i.indexOf("?")+1).split("&").map(l=>l.split("=")[0]===e?`${a}`:l).join("&"):`${i.substr(1)}&${a}`:a}function Ct(e,t){if(!window.location.search)return;const i=Ie(e,t),n=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(r=>r.split("=")[0]===i).map(r=>r.split("=")[1])[0];return n?decodeURIComponent(n):void 0}function gt(e,t,i){const a=t!==void 0?Ie(e,t):e,n=St(a,i),r=window.location,l=`${r.protocol}//${r.hostname}${r.port?":"+r.port:""}${r.pathname}?${n}`;window.history.replaceState("object or string","Title",l)}function Et(e,t){const i=Ct(e,t);let a;if(i){const n=JSON.parse(i);n.sql&&(a={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:Ye|Pe|We|ze,entityId:et(n.sql),query:n})}return a}const Ft=window.React.useCallback,Rt=window.React.useEffect,Tt=window.React.useState;function xt(e){var R,N;const{initQueryRequest:t,componentIndex:i=0,shouldDeepLink:a=!1,onQueryChange:n}=e,[r,l]=Tt(t);Rt(()=>{const C=Et("QueryWrapper",i);C&&l(C)},[i]);const d=Ft(()=>B(r),[r]);function g(){return B(t)}function u(C){let p;typeof C=="function"?p=C(d()):p=C;const b=B(p);if(l(b),b.query){if(a){const L=JSON.stringify(b.query),q=encodeURIComponent(L);gt("QueryWrapper",i,q)}n&&n(JSON.stringify(b))}}const{entityId:h,versionNumber:E}=tt(r.query.sql),y=(R=r.query.limit)!=null?R:$e,T=Math.ceil((((N=r.query.offset)!=null?N:0)+Number(y))/y);function Q(C){u(p=>(p.query.limit=C,p))}function v(C){u(p=>(p.query.offset=(C-1)*y,p))}return{entityId:h,versionNumber:E,getInitQueryRequest:g,getLastQueryRequest:d,setQuery:u,pageSize:y,currentPage:T,setPageSize:Q,goToPage:v}}const Re=window.React.useMemo,Qt=window.React.useState,Oe="isShowingFacetFilters",qe="isHidingFacetFilters";function ue(e){const{initQueryRequest:t,onQueryChange:i,onQueryResultBundleChange:a,lockedColumn:n,componentIndex:r,shouldDeepLink:l}=e,[d,g]=Qt(void 0),{entityId:u,versionNumber:h,getInitQueryRequest:E,getLastQueryRequest:y,setQuery:T,currentPage:Q,pageSize:v,goToPage:R,setPageSize:N}=xt({initQueryRequest:t,shouldDeepLink:l,componentIndex:r,onQueryChange:i}),C=Re(()=>y(),[y]),{data:p,isLoading:b,error:L,isPreviousData:q}=Ke(C,{keepPreviousData:!0},g),I=p==null?void 0:p.responseBody,k=b||q,{data:O}=He(u,h);Ge(()=>{I&&a&&a(JSON.stringify(I))},[I,a]);const Y=I?je(I.facets,I.selectColumns):!0,P={data:Re(()=>Xe(I,n),[I,n]),currentPage:Q,pageSize:v,setPageSize:N,isLoadingNewBundle:k,getLastQueryRequest:y,getInitQueryRequest:E,error:L,entity:O,executeQueryRequest:T,isFacetsAvailable:Y,asyncJobStatus:d,goToPage:R},{children:m}=e;return s(J,{queryContext:P,children:s("div",{className:`SRC-wrapper ${k?"SRC-logo-cursor":""} ${Y?"has-facets":""}`,children:m})})}try{ue.displayName="QueryWrapper",ue.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:ue.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}const H=e=>{let t,i="";if("facetWithSelection"in e){const{facetWithSelection:n}=e;n.facet.facetType==="enumeration"?t=n.displayValue===ye?fe:n.displayValue:t=`${n.facet.selectedMin} 
        - ${n.facet.selectedMax}`,i=`${G(n.facet.columnName)}: ${t}`}else if("filter"in e){const{filter:n}=e;let r=n.value;(r==null?void 0:r.startsWith("%"))&&(r==null?void 0:r.endsWith("%"))&&(r=r.substring(1,r.length-1)),t=r,i=`Text matches: "${r}"`,n.columnName&&(t=`"${r}" in ${G(n==null?void 0:n.columnName)}`,i=`${G(n==null?void 0:n.columnName)}: ${r}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const a=encodeURIComponent(i);return s(ve,{idForToolTip:`selectionCriteria_${a}`,tooltipText:i,callbackFn:()=>{},children:S("label",{className:"SelectionCriteriaPill",children:[s("span",{children:t}),s("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:s(nt,{})})]},`SelectionCriteriaPill ${a}`)})};try{H.displayName="SelectionCriteriaPill",H.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:H.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const M=({label:e,isCollapsed:t,onClick:i,facetAliases:a})=>S("div",{className:"FacetFilterHeader",children:[s("label",{className:"FacetFilterHeader__label",children:G(e,a)}),s("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>i(!t),children:t?s(at,{className:"icon-plus",title:"Expand Menu"}):s(rt,{className:"icon-minus",title:"Collapse Menu"})})]});try{M.displayName="FacetFilterHeader",M.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"Function"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!0,type:{name:"{} | undefined"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:M.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}const Ve=window.React,U=window.React.useState;function vt(e){return e.replace(/\s/g,"").toLowerCase()}function Te(e,t=[],i=[]){const{value:a}=e;let n=a;a===ye&&(n=fe);const r=t.find(d=>d.ownerId===a);r&&(n=r?r.userName:`unknown (${a})`);const l=i.find(d=>d.id===a);return l&&(n=l?l.name:`unknown (${a})`),`${n}`}function Nt(e,t,i){const a=[...e.sort((n,r)=>r.count-n.count)];return t||a.length<=i||a.slice(i).find(n=>n.isSelected)?a:a.splice(0,i)}const Z=({facetValues:e,columnModel:t,onClear:i,onChange:a,facetAliases:n,containerAs:r="Collapsible",dropdownType:l="Icon",collapsed:d=!1})=>{const[g,u]=U(!1),[h,E]=U(d),[y,T]=U(!1),[Q,v]=U(!1),[R,N]=U(""),[C,p]=U(e);Je(()=>{p(e)},[e]);const b=5,L=1500,q=Ve.createRef(),I={};let k;const O=e.filter(o=>o.isSelected).length===0,Y=(t==null?void 0:t.columnType)===V.USERID||(t==null?void 0:t.columnType)===V.USERID_LIST?e.map(o=>o.value):[],$=ge({ids:Y,type:"USER_PROFILE"}),P=(t==null?void 0:t.columnType)===V.ENTITYID||(t==null?void 0:t.columnType)===V.ENTITYID_LIST?e.map(o=>o.value):[],m=ge({ids:P,type:"ENTITY_HEADER"}),c=o=>{const F=o.target.value;if(N(F),u(!0),!F)e.forEach(w=>{w.isSelected=!1}),p(e);else{const w=e.filter(W=>Te(W,$,m).toLowerCase().indexOf(F.trim().toLowerCase())>-1?W:null);p(w)}};if(!t)return s(D,{});const f=r==="Dropdown",_=S("div",{className:f?"EnumFacetFilter__dropdown_menu":"",children:[S("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[S("div",{className:Q?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[s("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{p(e),v(!1),u(!1)},children:s("span",{className:"EnumFacetFilter__previous",children:s(ne,{options:{icon:"arrowBack"}})})}),R.length>0&&s("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var o;N(""),(o=q.current)==null||o.focus()},children:s("span",{className:"EnumFacetFilter__reset",children:s(ne,{options:{icon:"close"}})})}),s("input",{type:"text",placeholder:"Find values",value:R,ref:q,onChange:o=>{c(o)}})]}),!Q&&S("div",{className:"EnumFacetFilter__checkAll",children:[s(be,{className:"EnumFacetFilter__checkbox",onChange:()=>{i()},checked:O,label:"All",isSelectAll:!0},"select_all"),s("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var o;N(""),v(!0),(o=q.current)==null||o.focus()},children:s("span",{className:"EnumFacetFilter__searchicon",children:s(ne,{options:{icon:"search"}})})})]})]}),S("div",{children:[C.length>0&&Nt(C,g||f,b).map((o,F)=>s(bt,{id:vt(o.value),index:F,label:Te(o,$,m),count:o.count,isDropdown:f,initialIsSelected:o.isSelected,onChange:w=>{I[o.value]=w,clearTimeout(k),k=setTimeout(()=>{a(I),T(!1)},L)}},`checkLabel${F}`)),!f&&S(D,{children:[!g&&C.length>b&&s("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>u(!0),children:s("div",{className:"EnumFacetFilter__checkboxContainer",children:S("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",C.length,")"]})})}),g&&C.length>b&&s("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>u(!1),children:s("div",{className:"EnumFacetFilter__checkboxContainer",children:s("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),C.length<=0&&s("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),x=()=>T(!y);return f?l==="SelectBox"?S(K,{className:"EnumFacetFilter EnumFacetFilterSelect",show:y,onToggle:x,children:[S(K.Toggle,{className:"secondary-caret",variant:"gray-select",children:[O&&"All",!O&&e.filter(o=>o.isSelected).length===1&&e.filter(o=>o.isSelected)[0].value,!O&&e.filter(o=>o.isSelected).length>1&&"Multiple Values Selected"]}),s(K.Menu,{children:_})]}):S(K,{className:"EnumFacetFilter",show:y,onToggle:x,children:[s(ve,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),s(K.Menu,{children:_})]}):S(D,{children:[s(M,{facetAliases:n,isCollapsed:h,label:t.name,onClick:o=>E(o)}),s(Ne,{className:"EnumFacetFilter",in:!h,children:_})]})};function bt({id:e,index:t,label:i,count:a,isDropdown:n,initialIsSelected:r,onChange:l}){const[d,g]=U(r);return Ve.useEffect(()=>{g(r)},[r]),S("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{n&&(g(!d),l(!d))},children:[s(be,{className:"EnumFacetFilter__checkbox",onClick:u=>u.stopPropagation(),onChange:u=>{g(u),l(u)},checked:d,label:i},`${e}-${t}`),n&&S("span",{className:"EnumFacetFilter__count",children:["(",a,")"]}),!n&&s("div",{className:"EnumFacetFilter__count",children:a})]})}try{Z.displayName="EnumFacetFilter",Z.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:Z.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const xe=window.React.useState,ee=e=>{const t="Min value should be less then max value",[i,a]=xe(!1),[n,r]=xe(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Ee(e.initialValues.min).format("YYYY-MM-DD"),max:Ee(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),l=e.className?`range ${e.className}`:"range",d=({min:u,max:h},E="number")=>{if(u==null||h===null||h===void 0)return a(!1),!0;if(E==="number"){if(Number(u)>Number(h))return a(!0),!1}else if(Date.parse(u)>Date.parse(h))return a(!0),!1;return a(!1),!0},g=(u,h,E="number")=>{d(u,E)&&h(u)};return S("div",{className:l,style:{display:"flex",flexWrap:"wrap"},children:[S("div",{style:{marginRight:"10px"},children:[s("input",{"aria-label":"min",type:e.type,value:n.min,onChange:({target:u})=>r({min:u.value,max:n.max})},"range_min"),s("div",{children:"to"}),s("input",{"aria-label":"max",type:e.type,value:n.max,onChange:({target:u})=>r({min:n.min,max:u.value})},"range_max")]}),s("button",{className:"btn btn-link SRC-noPadding",onClick:()=>g(n,e.onChange,e.type),children:"Apply"}),i&&s("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{ee.displayName="Range",ee.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:ee.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}const Qe=window.React.useState;var me=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(me||{});const te=({facetResult:e,columnModel:t,onChange:i,facetAliases:a,collapsed:n=!1})=>{const[r,l]=Qe(n),d=[{label:fe,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:g,columnMax:u,selectedMin:h,selectedMax:E}=e;const y=!h&&!E;h=h||g,E=E||u;const T=t.columnType==="DOUBLE"?"number":"date",Q=(p,b)=>b?"":p===ye?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",v=(p,b)=>{N(p),p!=="RANGE"&&b([p,p])},[R,N]=Qe(Q(h,y));return S("div",{children:[s(M,{isCollapsed:r,label:t.name,onClick:p=>l(p),facetAliases:a}),S(Ne,{in:!r,children:[s(it,{value:R,id:"rangeSelector",options:d,onChange:p=>v(p,i)}),R==="RANGE"&&(g===u?s("label",{children:u}):S(D,{children:[t.columnType==="INTEGER"&&S(st,{domain:[g,u],initialValues:{min:h,max:E},step:1,doUpdateOnApply:!0,onChange:p=>i([p.min,p.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&s(ee,{initialValues:{min:h,max:E},type:T,onChange:p=>i([p.min,p.max])},"Range")]}))]})]})};try{te.displayName="RangeFacetFilter",te.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},facetAliases:{defaultValue:null,description:"",name:"facetAliases",required:!1,type:{name:"Record<string, string>"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:te.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const Ae=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected===!0).map(t=>t.value)}),wt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Ce=(e,t)=>{var r,l;const i=(l=(r=t==null?void 0:t.query)==null?void 0:r.selectedFacets)!=null?l:[],a=i.findIndex(d=>d.columnName===e.columnName),n=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return a>-1?n?i.splice(a,1):i[a]=e:i.push(e),i};function Le(e,t,i,a,n=!1){a?t.facetValues.forEach(d=>{d.value===a&&(d.isSelected=n)}):t.facetValues.forEach(d=>{d.isSelected=!1});const r=Ae(t),l=Ce(r,e);i(l)}const It=(e,t,i,a)=>{const n=a&&Object.keys(a)||[];n.length&&t.facetValues.forEach(d=>{n.includes(d.value)&&(d.isSelected=a?!!a[d.value]:!1)});const r=Ae(t),l=Ce(r,e);i(l)},ke=(e,t,i,a)=>{t.columnMin=a[0],t.columnMax=a[1];const n=wt(t),r=Ce(n,e);i(r)},de=({facetsToFilter:e})=>{const{data:t,isLoadingNewBundle:i,getLastQueryRequest:a,executeQueryRequest:n}=Se(),{facetAliases:r,topLevelControlsState:l}=we();if(!t)return s(D,{});const{showFacetFilter:d}=l,g=t.selectColumns;let u=t.facets;e&&(u=u.filter(y=>e.includes(y.columnName)));const h=a(),E=y=>{const T=a();T.query.selectedFacets=y,T.query.offset=0,n(T)};return S("div",{className:`QueryFilter ${d?Oe:qe}`,children:[i&&s("div",{children:"Loading..."}),!i&&u.map((y,T)=>{const Q=g.find(R=>R.name===y.columnName),v=T>2;if(!Ze(y))return S("div",{className:"QueryFilter__facet",children:[y.facetType==="enumeration"&&Q&&s(Z,{containerAs:"Collapsible",collapsed:v,facetValues:y.facetValues,columnModel:Q,facetAliases:r,onChange:R=>It(h,y,E,R),onClear:()=>Le(h,y,E)}),y.facetType==="range"&&Q&&s(te,{facetResult:y,columnModel:Q,facetAliases:r,collapsed:v,onChange:R=>ke(h,y,E,R)})]},y.columnName)})]})};try{de.displayName="QueryFilter",de.__docgenInfo={description:"",displayName:"QueryFilter",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"]={docgenInfo:de.__docgenInfo,name:"QueryFilter",path:"src/lib/containers/widgets/query-filter/QueryFilter.tsx#QueryFilter"})}catch{}const Ot=window.React.useCallback,qt=window.React.useEffect,Vt=window.React.useState,At=window.React.createElement,pe=({style:e,frontText:t,endText:i="",hideIfUnfiltered:a=!1})=>{var P;const{data:n,isLoadingNewBundle:r,getLastQueryRequest:l,executeQueryRequest:d,getInitQueryRequest:g,error:u}=Se(),{topLevelControlsState:h,unitDescription:E}=we(),y=n==null?void 0:n.queryCount,[T,Q]=Vt([]),v=m=>{const c=B(l());c.query.selectedFacets=m,c.query.offset=0,d(c)},R=m=>m.filter(_=>_.facetType==="enumeration").filter(_=>_.facetValues.filter(x=>x.isSelected===!0).length>0),N=m=>m.filter(_=>_.facetType==="range").filter(_=>_.selectedMax||_.selectedMin),C=(m,c)=>{var _;const f=m.find(x=>x.id===c);return(_=f==null?void 0:f.name)!=null?_:c},p=(m,c)=>{const f=m.find(_=>_.ownerId===c);return(f==null?void 0:f.userName)||c},b=Ot((m,c)=>{const f=ct(),_=ut(),x=[];return m.forEach(o=>{const F=c.find(w=>w.name===o.columnName);o.facetValues.forEach(w=>{if(w.isSelected){let W=w.value;(F==null?void 0:F.columnType)===V.ENTITYID||(F==null?void 0:F.columnType)===V.ENTITYID_LIST?W=C(f,w.value):((F==null?void 0:F.columnType)===V.USERID||(F==null?void 0:F.columnType)===V.USERID_LIST)&&(W=p(_,w.value)),x.push({facet:o,displayValue:W,selectedValue:w})}})}),x},[]);qt(()=>{if(n){const m=N(n.facets),c=R(n.facets),f=m.map(x=>({facet:x})),_=b(c,n.columnModels);Q([...f,..._])}},[n,b]);const L=m=>{const{facet:c,selectedValue:f}=m;c.facetType==="enumeration"?Le(l(),c,v,f==null?void 0:f.value,!1):ke(l(),c,v,[me.ANY,me.ANY])},q=(m,c)=>{var _;const f=B(l());!f.query.additionalFilters||(f.query.additionalFilters=(_=f.query.additionalFilters)==null?void 0:_.reduce(function(x,o){if(re(o)||ie(o)){const F={columnName:o.columnName,values:o.columnName===m?o.values.filter(w=>w!==c):o.values,operator:re(o)?o.operator:void 0,function:ie(o)?o.function:void 0,concreteType:o.concreteType};F.values.length>0&&x.push(F)}else x.push(o);return x},[]),d(f))},I=m=>{const c=B(l());!c.query.additionalFilters||(c.query.additionalFilters=c.query.additionalFilters.filter(f=>!(Fe(f)&&f.searchExpression===m.searchExpression)),d(c))},k=()=>{const m=B(g());m.query.additionalFilters=[],d(m)},O=(P=l().query.additionalFilters)==null?void 0:P.reduce((m,c)=>{if(Fe(c))m.push({key:`fulltextsearch-${c.searchExpression}`,filter:{value:c.searchExpression},onRemove:()=>I(c)});else if(re(c)||ie(c)){const{columnName:f}=c;c.values.forEach(_=>{m.push({key:`columnsearch-${_}`,filter:{columnName:f,value:_},onRemove:()=>q(c.columnName,_)})})}else console.warn("Encountered unexpected QueryFilter: ",c);return m},[]),Y=h==null?void 0:h.showFacetFilter,$=T.length>0||O&&O.length>0;return u?s(D,{}):s("div",{className:`TotalQueryResults ${Y?Oe:qe}`,style:e,children:r?s(j,{width:100}):S(D,{children:[($||!a)&&S("span",{className:"SRC-boldText SRC-centerContent",children:[t," ",y==null?void 0:y.toLocaleString()," ",E," ",i]}),S("div",{className:"TotalQueryResults__selections",children:[O&&O.map(m=>At(H,{...m,key:m.key})),T.map((m,c)=>{var f,_,x;return s(H,{facetWithSelection:m,onRemove:()=>L(m)},`facets-${(x=(_=(f=m.selectedValue)==null?void 0:f.value)!=null?_:m.displayValue)!=null?x:c}`)}),(T.length>2||O&&O.length>2)&&s(ot,{onClick:k,variant:"light",className:"TotalQueryResults__clearall",children:"Clear All"})]})]})})};try{pe.displayName="TotalQueryResults",pe.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:{value:"false"},description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:pe.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}export{pt as C,Z as E,J as Q,j as S,pe as T,xt as a,Se as b,ce as c,ae as d,we as e,ue as f,It as g,Le as h,Oe as i,qe as j,le as k,de as l,re as m,ie as n,dt as o,rn as p,sn as u};

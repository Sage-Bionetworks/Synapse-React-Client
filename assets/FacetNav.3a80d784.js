import{a3 as Be,aA as Ge,au as De,a4 as je,a6 as Je,aF as Ze,aL as Xe}from"./index.5da0c2fe.js";import{j as n,r as m,a as f,F as Q,R as Ae}from"./jsx-runtime.b9dbe3f2.js";import{i as et,r as tt,h as nt,a as Ue}from"./queryUtils.5d78ee18.js";import{a as Me,b as at,u as rt}from"./use-deep-compare-effect.esm.29b168ec.js";import{s as st}from"./NoSearchResults.cf2c2af3.js";import{N as ot}from"./NoData.f256ee32.js";import{u as lt}from"./unCamelCase.07e38083.js";import{C as L}from"./ColumnType.0fc7f115.js";import{o as it,p as ct,n as ut,i as dt,j as pt,v as mt,V as Z,H as ye,x as ft,y as yt,w as ht}from"./SynapseConstants.aef18750.js";import{u as _t}from"./useEntity.bc266fa3.js";import{b as Ct}from"./useGetQueryResultBundle.c6cba393.js";import{p as gt,a as St}from"./sqlFunctions.32cb4e2b.js";import{i as ve,a as Ie,c as Ft}from"./QueryFilter.89fbadd0.js";import{c as _e}from"./cloneDeep.18f0269c.js";import{i as te}from"./isEqual.e5ecbe9a.js";import{E as me}from"./ElementWithTooltip.974896e1.js";import{u as Ce}from"./useGetInfoFromIds.df5d54b4.js";import{I as W,a as Et}from"./IconSvg.e161b9ac.js";import{C as Ye}from"./Checkbox.b6409fc8.js";import{D as q}from"./Dropdown.d53923ab.js";import{R as xt}from"./RadioGroup.798ea8f4.js";import{d as qe}from"./dayjs.min.299ad3a1.js";import{R as Tt}from"./RangeSlider.7b6de83e.js";import{c as Nt,P as bt}from"./factory.6a31a56b.js";import{r as Rt}from"./react-sizeme.61f4b5d1.js";import{S as vt}from"./Skeleton.e124e8e4.js";import{g as It}from"./ColorGradient.16f0e0f2.js";import{l as wt}from"./LoadingScreen.a4b87421.js";import{M as ne}from"./Modal.d5b47340.js";import{B as $e}from"./Button.5e8fef04.js";import{a as Vt}from"./Tooltip.48a3285f.js";import{S as At}from"./SelectionCriteriaPill.8cea27a1.js";const Ot="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",Qt="org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",we=Be(Ot),Lt=Be(Qt),G=e=>n(vt,{style:{...e.style,display:"inline-block"},...e});try{G.displayName="SkeletonInlineBlock",G.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:{value:"'pulse'"},description:"The animation.\nIf `false` the animation effect is disabled.",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},children:{defaultValue:null,description:"Optional children to infer width and height from.",name:"children",required:!1,type:{name:"ReactNode"}},classes:{defaultValue:null,description:"Override or extend the styles applied to the component.",name:"classes",required:!1,type:{name:"(Partial<SkeletonClasses> & Partial<ClassNameMap<never>>)"}},height:{defaultValue:null,description:`Height of the skeleton.
Useful when you don't want to adapt the skeleton to a text element but for instance a card.`,name:"height",required:!1,type:{name:"string | number"}},sx:{defaultValue:null,description:"The system prop that allows defining system overrides as well as additional CSS styles.",name:"sx",required:!1,type:{name:"SxProps<Theme>"}},variant:{defaultValue:{value:"'text'"},description:"The type of content that will be rendered.",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"rectangular"'},{value:'"rounded"'},{value:'"circular"'}]}},width:{defaultValue:null,description:`Width of the skeleton.
Useful when the skeleton is inside an inline element with no width of its own.`,name:"width",required:!1,type:{name:"string | number"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLSpanElement | null) => void) | RefObject<HTMLSpanElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:G.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const B=m.exports.createContext(void 0),ae=({children:e,queryContext:t})=>n(B.Provider,{value:t,children:e});function U(){const e=m.exports.useContext(B);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function Gn(){const e=m.exports.useContext(B);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function jn(){const e=m.exports.useContext(B);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const ge=B.Consumer;try{B.displayName="QueryContext",B.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:B.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{ae.displayName="QueryContextProvider",ae.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:ae.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{ge.displayName="QueryContextConsumer",ge.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:ge.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}function He(e,t){return`${e}${t}`}function kt(e,t){const a=window.location.search,r=`${e}=${t}`;return a?a.includes(`${e}=`)?window.location.search.slice(a.indexOf("?")+1).split("&").map(l=>l.split("=")[0]===e?`${r}`:l).join("&"):`${a.substr(1)}&${r}`:r}function qt(e,t){if(!window.location.search)return;const a=He(e,t),s=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(o=>o.split("=")[0]===a).map(o=>o.split("=")[1])[0];return s?decodeURIComponent(s):void 0}function Pt(e,t,a){const r=t!==void 0?He(e,t):e,s=kt(r,a),o=window.location,l=`${o.protocol}//${o.hostname}${o.port?":"+o.port:""}${o.pathname}?${s}`;window.history.replaceState("object or string","Title",l)}function Bt(e,t){const a=qt(e,t);let r;if(a){const s=JSON.parse(a);s.sql&&(r={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:it|ct|ut|dt|pt,entityId:gt(s.sql),query:s})}return r}function Dt(e){var S,R;const{initQueryRequest:t,componentIndex:a=0,shouldDeepLink:r=!1,onQueryChange:s}=e,[o,l]=m.exports.useState(t);m.exports.useEffect(()=>{const v=Bt("QueryWrapper",a);v&&l(v)},[a]);const u=m.exports.useCallback(()=>_e(o),[o]),d=m.exports.useCallback(()=>_e(t),[t]),c=m.exports.useCallback(v=>{let N;typeof v=="function"?N=v(u()):N=v;const V=_e(N);if(l(V),V.query){const h=JSON.stringify(V.query);if(r){const _=encodeURIComponent(h);Pt("QueryWrapper",a,_)}s&&s(h)}},[a,u,s,r]),{entityId:p,versionNumber:I}=m.exports.useMemo(()=>St(o.query.sql),[o.query.sql]),x=(S=o.query.limit)!=null?S:mt,A=Math.ceil((((R=o.query.offset)!=null?R:0)+Number(x))/x),E=m.exports.useCallback(v=>{c(N=>(N.query.limit=v,N))},[c]),w=m.exports.useCallback(v=>{c(N=>(N.query.offset=(v-1)*x,N))},[x,c]),y=m.exports.useCallback(()=>{c(t)},[t,c]),T=m.exports.useCallback(v=>{c(N=>{var V;return N.query.selectedFacets=((V=N.query.selectedFacets)!=null?V:[]).filter(h=>!te(h,v)),N})},[c]),i=m.exports.useCallback((v,N)=>{c(V=>{var h;return V.query.selectedFacets=((h=V.query.selectedFacets)!=null?h:[]).map(_=>(we(_)&&te(_,v)&&(_.facetValues=_.facetValues.filter(F=>F!==N)),_)).filter(_=>we(_)?Array.isArray(_.facetValues)&&_.facetValues.length>0:!0),V})},[c]),g=m.exports.useCallback(v=>{c(N=>{var V;return N.query.additionalFilters=((V=N.query.additionalFilters)!=null?V:[]).filter(h=>!te(h,v)),N})},[c]),C=m.exports.useCallback((v,N)=>{c(V=>{var h;return V.query.additionalFilters=((h=V.query.additionalFilters)!=null?h:[]).map(_=>((ve(_)||Ie(_))&&te(_,v)&&(_.values=_.values.filter(F=>F!==N)),_)).filter(_=>ve(_)||Ie(_)?Array.isArray(_.values)&&_.values.length>0:!0),V})},[c]);return{entityId:p,versionNumber:I,getInitQueryRequest:d,getLastQueryRequest:u,setQuery:c,pageSize:x,currentPage:A,setPageSize:E,goToPage:w,resetQuery:y,removeSelectedFacet:T,removeValueFromSelectedFacet:i,removeQueryFilter:g,removeValueFromQueryFilter:C}}const Oe="isShowingFacetFilters",Qe="isHidingFacetFilters";function Se(e){const{initQueryRequest:t,onQueryChange:a,onQueryResultBundleChange:r,lockedColumn:s,componentIndex:o,shouldDeepLink:l}=e,[u,d]=m.exports.useState(void 0),{entityId:c,versionNumber:p,getInitQueryRequest:I,getLastQueryRequest:x,setQuery:A,currentPage:E,pageSize:w,goToPage:y,setPageSize:T,resetQuery:i,removeSelectedFacet:g,removeValueFromSelectedFacet:C,removeQueryFilter:S,removeValueFromQueryFilter:R}=Dt({initQueryRequest:t,shouldDeepLink:l,componentIndex:o,onQueryChange:a}),v=m.exports.useMemo(()=>x(),[x]),{data:N,isLoading:V,error:h,isPreviousData:_}=Ct(v,{keepPreviousData:!0},d),F=N==null?void 0:N.responseBody,O=V||_,{data:k}=_t(c,p);Me(()=>{F&&r&&r(JSON.stringify(F))},[F,r]);const X=F?et(F.facets,F.selectColumns):!0,D=m.exports.useMemo(()=>tt(F,s),[F,s]),K=m.exports.useMemo(()=>{const $=x();return nt($.query,s)},[x,s]),ee=m.exports.useCallback($=>{var he,ke;return(ke=(he=F==null?void 0:F.columnModels)==null?void 0:he.find(We=>We.name===$))!=null?ke:null},[F==null?void 0:F.columnModels]),b={data:D,currentPage:E,pageSize:w,setPageSize:T,isLoadingNewBundle:O,getLastQueryRequest:x,getInitQueryRequest:I,error:h,entity:k,executeQueryRequest:A,isFacetsAvailable:X,asyncJobStatus:u,goToPage:y,hasResettableFilters:K,removeSelectedFacet:g,removeValueFromSelectedFacet:C,resetQuery:i,removeQueryFilter:S,removeValueFromQueryFilter:R,lockedColumn:s,getColumnModel:ee},{children:P}=e;return n(ae,{queryContext:b,children:n("div",{className:`SRC-wrapper ${O?"SRC-logo-cursor":""} ${X?"has-facets":""}`,children:P})})}try{Se.displayName="QueryWrapper",Se.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:Se.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}function Ut(){return f(Q,{children:[n("p",{className:"SRC-no-results-title",children:"There is currently no content here."}),n("p",{className:"SRC-no-results-description",children:"Information is always being updated, so check back later to see if content has been added."})]})}var re=(e=>(e.INTERACTIVE="INTERACTIVE",e.STATIC="STATIC",e))(re||{});function Mt(){return f("div",{className:"text-center",children:[st,n("h4",{children:"No Matching Results"}),n("p",{children:"Try checking the spelling or removing filters."})]})}function Yt(){return f("div",{className:"text-center SRCBorderedPanel SRCBorderedPanel--padded2x",children:[ot,n("div",{style:{marginTop:"20px",fontStyle:"italic"},children:"This table is currently empty"})]})}const $t=()=>{try{return JSON.parse(sessionStorage.getItem(ft)||"")}catch{return[]}},Ht=()=>{try{return JSON.parse(sessionStorage.getItem(yt)||"")}catch{return[]}},zt=()=>{try{return JSON.parse(sessionStorage.getItem(ht)||"")}catch{return[]}},Kt=e=>{var a;const t=$t().find(r=>r.id===e);return(a=t==null?void 0:t.name)!=null?a:e},Wt=e=>{const t=zt().find(a=>a.id===e);return(t==null?void 0:t.name)||e},Gt=e=>{const t=Ht().find(a=>a.ownerId===e);return(t==null?void 0:t.userName)||e},jt=(e,t)=>{if(e===Z)return ye;switch(t){case L.ENTITYID:case L.ENTITYID_LIST:return Kt(e);case L.USERID:case L.USERID_LIST:return Gt(e);case L.EVALUATIONID:return Wt(e);default:return e}},H=m.exports.createContext(void 0),se=({children:e,queryVisualizationContext:t})=>n(H.Provider,{value:t,children:e});function M(){const e=m.exports.useContext(H);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const Fe=H.Consumer;function Ee(e){var C,S;const{noContentPlaceholderType:t=re.INTERACTIVE}=e,{data:a,getLastQueryRequest:r,isFacetsAvailable:s,isLoadingNewBundle:o,hasResettableFilters:l}=U(),{columnAliases:u={}}=e,[d,c]=m.exports.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(C=e.defaultShowFacetVisualization)!=null?C:!0,showSearchBar:(S=e.defaultShowSearchBar)!=null?S:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});m.exports.useEffect(()=>{s||c(R=>({...R,showFacetFilter:!1,showFacetVisualization:!1}))},[s]),m.exports.useEffect(()=>{o&&A([])},[o]);const[p,I]=m.exports.useState([]),[x,A]=m.exports.useState([]),E=r(),w=at(a==null?void 0:a.selectColumns);m.exports.useEffect(()=>{var R,v;I((v=w==null?void 0:w.slice(0,(R=e.visibleColumnCount)!=null?R:1/0).map(N=>N.name))!=null?v:[])},[w,E.query.sql,e.visibleColumnCount]);const y=m.exports.useCallback(R=>{const v=localStorage.getItem("force-display-original-column-names")==="true";return!R||v?R:u[R]?u[R]:lt(R)},[u]),T=m.exports.useCallback(()=>{switch(t){case re.INTERACTIVE:return l?n(Mt,{}):n(Yt,{});case re.STATIC:default:return n(Ut,{})}},[t,l]),i={topLevelControlsState:d,setTopLevelControlsState:c,columnsToShowInTable:p,setColumnsToShowInTable:I,selectedRowIndices:x,setSelectedRowIndices:A,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:y,getDisplayValue:jt,NoContentPlaceholder:T},{children:g}=e;return n(se,{queryVisualizationContext:i,children:g})}try{Ee.displayName="QueryVisualizationWrapper",Ee.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}},noContentPlaceholderType:{defaultValue:null,description:"Default is INTERACTIVE",name:"noContentPlaceholderType",required:!1,type:{name:"enum",value:[{value:'"INTERACTIVE"'},{value:'"STATIC"'}]}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:Ee.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{H.displayName="QueryVisualizationContext",H.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:H.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{se.displayName="QueryVisualizationContextProvider",se.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:se.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{Fe.displayName="QueryVisualizationContextConsumer",Fe.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:Fe.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}const xe=()=>{const{error:e}=U();return n(Ge,{error:e})};try{xe.displayName="QueryWrapperErrorBanner",xe.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"]={docgenInfo:xe.__docgenInfo,name:"QueryWrapperErrorBanner",path:"src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"})}catch{}const oe=e=>{var t;return f("svg",{...e,className:`Icon-Plus ${(t=e.className)!=null?t:""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]})};try{oe.displayName="IconPlus",oe.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconPlus.tsx#IconPlus"]={docgenInfo:oe.__docgenInfo,name:"IconPlus",path:"src/lib/assets/icons/IconPlus.tsx#IconPlus"})}catch{}const le=e=>{var t;return f("svg",{...e,className:`Icon-Minus ${(t=e.className)!=null?t:""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]})};try{le.displayName="IconMinus",le.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconMinus.tsx#IconMinus"]={docgenInfo:le.__docgenInfo,name:"IconMinus",path:"src/lib/assets/icons/IconMinus.tsx#IconMinus"})}catch{}const j=({label:e,isCollapsed:t,onClick:a})=>{const{getColumnDisplayName:r}=M();return f("div",{className:"FacetFilterHeader",children:[n("label",{className:"FacetFilterHeader__label",children:r(e)}),n("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>a(!t),children:t?n(oe,{className:"icon-plus",title:"Expand Menu"}):n(le,{className:"icon-minus",title:"Collapse Menu"})})]})};try{j.displayName="FacetFilterHeader",j.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:j.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}function Jt(e){return e.replace(/\s/g,"").toLowerCase()}function Pe(e,t=[],a=[],r=[]){const{value:s}=e;let o=s;s===Z&&(o=ye);const l=t.find(c=>c.ownerId===s);l&&(o=l?l.userName:`unknown (${s})`);const u=a.find(c=>c.id===s);u&&(o=u?u.name:`unknown (${s})`);const d=r.find(c=>c.id===s);return d!=null&&d.name&&(o=d.name),`${o}`}function Zt(e,t,a){const r=[...e.sort((s,o)=>o.count-s.count)];return t||r.length<=a||r.slice(a).find(s=>s.isSelected)?r:r.splice(0,a)}const z=({facetValues:e,columnModel:t,onClear:a,onChange:r,containerAs:s="Collapsible",dropdownType:o="Icon",collapsed:l=!1})=>{const[u,d]=m.exports.useState(!1),[c,p]=m.exports.useState(l),[I,x]=m.exports.useState(!1),[A,E]=m.exports.useState(!1),[w,y]=m.exports.useState(""),[T,i]=m.exports.useState(e);rt(()=>{i(e)},[e]);const g=5,C=1500,S=Ae.createRef(),R={};let v;const N=e.filter(b=>b.isSelected).length===0,V=(t==null?void 0:t.columnType)===L.USERID||(t==null?void 0:t.columnType)===L.USERID_LIST?e.map(b=>b.value):[],h=Ce({ids:V,type:"USER_PROFILE"}),_=(t==null?void 0:t.columnType)===L.ENTITYID||(t==null?void 0:t.columnType)===L.ENTITYID_LIST?e.map(b=>b.value):[],F=Ce({ids:_,type:"ENTITY_HEADER"}),O=(t==null?void 0:t.columnType)===L.EVALUATIONID?e.map(b=>b.value):[],k=Ce({ids:O,type:"EVALUATION_QUEUE"}),X=b=>{const P=b.target.value;if(y(P),d(!0),!P)e.forEach(Y=>{Y.isSelected=!1}),i(e);else{const Y=e.filter($=>Pe($,h,F,k).toLowerCase().indexOf(P.trim().toLowerCase())>-1?$:null);i(Y)}};if(!t)return n(Q,{});const D=s==="Dropdown",K=f("div",{className:D?"EnumFacetFilter__dropdown_menu":"",children:[f("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[f("div",{className:A?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[n("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{i(e),E(!1),d(!1)},children:n("span",{className:"EnumFacetFilter__previous",children:n(W,{icon:"arrowBack"})})}),w.length>0&&n("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var b;y(""),(b=S.current)==null||b.focus()},children:n("span",{className:"EnumFacetFilter__reset",children:n(W,{icon:"close"})})}),n("input",{type:"text",placeholder:"Find values",value:w,ref:S,onChange:b=>{X(b)}})]}),!A&&f("div",{className:"EnumFacetFilter__checkAll",children:[n(Ye,{className:"EnumFacetFilter__checkbox",onChange:()=>{a()},checked:N,label:"All",isSelectAll:!0},"select_all"),n("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var b;y(""),E(!0),(b=S.current)==null||b.focus()},children:n("span",{className:"EnumFacetFilter__searchicon",children:n(W,{icon:"search"})})})]})]}),f("div",{children:[T.length>0&&Zt(T,u||D,g).map((b,P)=>n(Xt,{id:Jt(b.value),index:P,label:Pe(b,h,F,k),count:b.count,isDropdown:D,initialIsSelected:b.isSelected,onChange:Y=>{R[b.value]=Y,clearTimeout(v),v=setTimeout(()=>{r(R),x(!1)},C)}},`checkLabel${P}`)),!D&&f(Q,{children:[!u&&T.length>g&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!0),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:f("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",T.length,")"]})})}),u&&T.length>g&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!1),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:n("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),T.length<=0&&n("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),ee=()=>x(!I);return D?o==="SelectBox"?f(q,{className:"EnumFacetFilter EnumFacetFilterSelect",show:I,onToggle:ee,children:[f(q.Toggle,{className:"secondary-caret",variant:"gray-select",children:[N&&"All",!N&&e.filter(b=>b.isSelected).length===1&&e.filter(b=>b.isSelected)[0].value,!N&&e.filter(b=>b.isSelected).length>1&&"Multiple Values Selected"]}),n(q.Menu,{children:K})]}):f(q,{className:"EnumFacetFilter",show:I,onToggle:ee,children:[n(me,{tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),n(q.Menu,{children:K})]}):f(Q,{children:[n(j,{isCollapsed:c,label:t.name,onClick:b=>p(b)}),n(De,{className:"EnumFacetFilter",in:!c,children:K})]})};function Xt({id:e,index:t,label:a,count:r,isDropdown:s,initialIsSelected:o,onChange:l}){const[u,d]=m.exports.useState(o);return Ae.useEffect(()=>{d(o)},[o]),f("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{s&&(d(!u),l(!u))},children:[n(Ye,{className:"EnumFacetFilter__checkbox",onClick:c=>c.stopPropagation(),onChange:c=>{d(c),l(c)},checked:u,label:a},`${e}-${t}`),s&&f("span",{className:"EnumFacetFilter__count",children:["(",r,")"]}),!s&&n("div",{className:"EnumFacetFilter__count",children:r})]})}try{z.displayName="EnumFacetFilter",z.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:z.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const ie=({facet:e,isChecked:t,onClick:a})=>{const{getColumnDisplayName:r}=M();return f("button",{className:`Chip ${t?"Checked":""}`,onClick:a,children:[r(e.columnName),n(W,{icon:t?"check":"add",sx:{width:"14px",paddingLeft:"0.2rem"}})]})};try{ie.displayName="FacetChip",ie.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"]={docgenInfo:ie.__docgenInfo,name:"FacetChip",path:"src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"})}catch{}const ce=e=>{const t="Min value should be less then max value",[a,r]=m.exports.useState(!1),[s,o]=m.exports.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:qe(e.initialValues.min).format("YYYY-MM-DD"),max:qe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),l=e.className?`range ${e.className}`:"range",u=({min:c,max:p},I="number")=>{if(c==null||p===null||p===void 0)return r(!1),!0;if(I==="number"){if(Number(c)>Number(p))return r(!0),!1}else if(Date.parse(c)>Date.parse(p))return r(!0),!1;return r(!1),!0},d=(c,p,I="number")=>{u(c,I)&&p(c)};return f("div",{className:l,style:{display:"flex",flexWrap:"wrap"},children:[f("div",{style:{marginRight:"10px"},children:[n("input",{"aria-label":"min",type:e.type,value:s.min,onChange:({target:c})=>o({min:c.value,max:s.max})},"range_min"),n("div",{children:"to"}),n("input",{"aria-label":"max",type:e.type,value:s.max,onChange:({target:c})=>o({min:s.min,max:c.value})},"range_max")]}),n("button",{className:"btn btn-link SRC-noPadding",onClick:()=>d(s,e.onChange,e.type),children:"Apply"}),a&&n("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{ce.displayName="Range",ce.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:ce.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}const ue=({facetResult:e,columnModel:t,onChange:a,collapsed:r=!1})=>{const[s,o]=m.exports.useState(r),l=[{label:ye,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:u,columnMax:d,selectedMin:c,selectedMax:p}=e;const I=!c&&!p;c=c||u,p=p||d;const x=t.columnType==="DOUBLE"?"number":"date",A=(i,g)=>g?"":i===Z?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",E=(i,g)=>{y(i),i!=="RANGE"&&g([i,i])},[w,y]=m.exports.useState(A(c,I));return f("div",{children:[n(j,{isCollapsed:s,label:t.name,onClick:i=>o(i)}),f(De,{in:!s,children:[n(xt,{value:w,id:"rangeSelector",options:l,onChange:i=>E(i,a)}),w==="RANGE"&&(u===d?n("label",{children:d}):f(Q,{children:[t.columnType==="INTEGER"&&f(Tt,{domain:[u,d],initialValues:{min:c,max:p},step:1,doUpdateOnApply:!0,onChange:i=>a([i.min,i.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&n(ce,{initialValues:{min:c,max:p},type:x,onChange:i=>a([i.min,i.max])},"Range")]}))]})]})};try{ue.displayName="RangeFacetFilter",ue.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:ue.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const ze=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected).map(t=>t.value)}),en=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Le=(e,t)=>{var o,l;const a=(l=(o=t==null?void 0:t.query)==null?void 0:o.selectedFacets)!=null?l:[],r=a.findIndex(u=>u.columnName===e.columnName),s=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return r>-1?s?a.splice(r,1):a[r]=e:a.push(e),a};function fe(e,t,a,r,s=!1){r?t.facetValues.forEach(u=>{u.value===r&&(u.isSelected=s)}):t.facetValues.forEach(u=>{u.isSelected=!1});const o=ze(t),l=Le(o,e);a(l)}const Ve=(e,t,a,r)=>{const s=r&&Object.keys(r)||[];s.length&&t.facetValues.forEach(u=>{s.includes(u.value)&&(u.isSelected=r?!!r[u.value]:!1)});const o=ze(t),l=Le(o,e);a(l)},tn=(e,t,a,r)=>{t.columnMin=r[0],t.columnMax=r[1];const s=en(t),o=Le(s,e);a(o)};function Te(e){var y,T;const{facetsToFilter:t}=e,{data:a,isLoadingNewBundle:r,getLastQueryRequest:s,executeQueryRequest:o}=U(),l=(y=a==null?void 0:a.facets)==null?void 0:y.filter(i=>!Ue(i));let u;t==null?u=(T=l==null?void 0:l.map(i=>i.columnName))!=null?T:[]:u=t;const[d,c]=Ae.useState([]),{topLevelControlsState:p}=M(),{showFacetFilter:I}=p;if(Me(()=>{c(u.slice(0,3))},[a==null?void 0:a.facets]),!a)return n(Q,{});const x=a.selectColumns,A=s(),E=i=>{const g=s();g.query.selectedFacets=i,g.query.offset=0,o(g)},w=i=>{let g=[...d!=null?d:[""],i.columnName];d.includes(i.columnName)&&(g=g.filter(C=>C!=i.columnName)),c(g)};return f("div",{className:`FacetFilterControls ${I?Oe:Qe}`,children:[r&&n("div",{children:"Loading..."}),!r&&(l!=null?l:[]).filter(i=>d.includes(i.columnName)).map((i,g)=>{const C=x.find(S=>S.name===i.columnName);return f("div",{className:"FacetFilterControls__facet",children:[i.facetType==="enumeration"&&C&&n(z,{containerAs:"Collapsible",collapsed:!1,facetValues:i.facetValues,columnModel:C,onChange:S=>Ve(A,i,E,S),onClear:()=>fe(A,i,E)}),i.facetType==="range"&&C&&n(ue,{facetResult:i,columnModel:C,collapsed:!1,onChange:S=>tn(A,i,E,S)})]},i.columnName)}),f("div",{children:[n("div",{className:"AvailableFacet",children:n("label",{className:"AvailableFacet__label",children:"Available Facets"})}),(l!=null?l:[]).filter(i=>u.includes(i.columnName)).map(i=>n(ie,{facet:i,onClick:()=>w(i),isChecked:d.includes(i.columnName)},i.columnName))]})]})}try{Te.displayName="FacetFilterControls",Te.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"]={docgenInfo:Te.__docgenInfo,name:"FacetFilterControls",path:"src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"})}catch{}const nn=Nt(bt),an=19,rn=30,sn={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},on=(e,t)=>{t=t||0;let a=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let r=0;r<t;r++)a.indexOf(".")!==-1&&(a=a.replace("0%","%"),a=a.replace(".%","%"));return a};function Ke(e,t){if(!e)return e;const a=e.trim();return a.length>t?a.substr(0,t-1)+"\u2026":e}async function ln(e,t,a,r,s){var E,w;const{colorPalette:o}=It(a,e.facetValues.length),l=async(y,T,i)=>{const g=new Map;g.set(Z,ye);const C=y.map(S=>S.value).filter(S=>S!==Z);if(T===L.ENTITYID||T===L.ENTITYID_LIST){const S=await Ze(C,i);for(const R of S.results)g.set(R.id,R.name)}else if(T===L.USERID||T===L.USERID_LIST){const S=await Xe(C,i);for(const R of S.children)g.set(R.ownerId,R.userName)}return y.map(S=>({facet:S,label:u(S,!1,g),truncatedLabel:u(S,!0,g),count:S.count}))},u=(y,T,i)=>{var C;let g=(C=i.get(y.value))!=null?C:y.value;return T&&(g=Ke(g,an)),g},d=await l(e.facetValues,t,s),c=d.map(y=>y.truncatedLabel),I=e.facetValues.some(y=>y.isSelected)?e.facetValues.map((y,T)=>y.isSelected?o[T]:o[T].replace("rgb(","rgba(").replace(")",", 0.25)")):o,x={values:r==="PIE"?e.facetValues.map(y=>y.count):void 0,labels:d.map(y=>y.label),text:c,x:r==="BAR"?e.facetValues.map(y=>{var T,i;return(i=(T=d.find(g=>g.facet===y))==null?void 0:T.label)!=null?i:y.value}):void 0,y:r==="BAR"?e.facetValues.map(y=>y.count):void 0,facetEnumerationValues:e.facetValues.map(y=>y.value),name:e.columnName,hovertemplate:r==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:r==="PIE"?"pie":"bar",pull:r==="PIE"?e.facetValues.map(y=>y.isSelected?.1:0):void 0,marker:{colors:r==="PIE"?I:void 0,color:r==="BAR"?I:void 0}};return{data:[x],labels:d,colors:r==="PIE"?(E=x.marker)==null?void 0:E.colors:(w=x.marker)==null?void 0:w.color}}const cn=(e,t,a)=>{if(e.points&&e.points[0]){const r=e.points[0],s=r.data.facetEnumerationValues[r.pointNumber],o=t.facetValues.find(l=>l.value===s);a(t,o,!o.isSelected)}};function un(e,t,a){const s=e?e*(t==="BAR"?.8:.6):200;let o=t==="PIE"?s:s/3;return o>a&&(o=a),{width:`${s}px`,height:`${o}px`}}function de(e){const{labels:t,colors:a=[],isExpanded:r}=e;if(!t)return n(Q,{});const s=r?Math.min(t.length,9):Math.min(t.length,3);if(s===0)return n(Q,{});const o=t.reduce((l,u)=>l+u.count,0);return n("div",{className:`FacetNavPanel__body__legend${r?"--expanded":""}`,children:t.slice(0,s).map((l,u)=>{const c=`(${on(l.count/o,1)}) ${l.label}`,p=Ke(c,rn);return n(me,{tooltipText:l.label,children:f("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[n("div",{style:{backgroundColor:a[u]}}),n("label",{children:p})]},`legendLabel_${u}`)},l.label)})})}const dn=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",J=e=>{const{onHide:t,isModalView:a,applyChangesToFacetFilter:r,applyChangesToGraphSlice:s,index:o,facetToPlot:l,plotType:u,onSetPlotType:d}=e,{accessToken:c}=je(),{data:p,isLoadingNewBundle:I,getLastQueryRequest:x}=U(),{getColumnDisplayName:A}=M(),[E,w]=m.exports.useState(!1),y=A(l.columnName),T=m.exports.useCallback(()=>{var C,S;return(S=(C=p==null?void 0:p.columnModels)==null?void 0:C.find(R=>R.name===l.columnName))==null?void 0:S.columnType},[p,l.columnName]),{data:i}=Je(["extractPlotDataArray",l,T(),o,u,c],()=>ln(l,T(),o,u,c),{enabled:!!l}),g=()=>f("div",{onClick:C=>{C.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),f(q,{children:[n(q.Toggle,{className:"secondary-caret",variant:"gray-select",children:u==="PIE"?"Pie Chart":"Bar Chart"}),f(q.Menu,{className:"chart-tools",children:[n(q.Item,{as:"button",onClick:()=>d("BAR"),children:"Bar Chart"}),n(q.Item,{as:"button",onClick:()=>d("PIE"),children:"Pie Chart"})]})]})]});return!p&&I||!l?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:wt}):f(Q,{children:[f(ne,{animation:!1,show:E,onHide:()=>w(!1),backdrop:"static",children:[n(ne.Header,{closeButton:!0,children:n(ne.Title,{children:y!=null?y:""})}),f(ne.Body,{children:[n(J,{...e,isModalView:!0}),n("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:n($e,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>w(!1),children:"Apply Filters"})})]})]}),f("div",{role:"graphics-document",className:`FacetNavPanel${a?"--expanded":""}`,children:[!a&&f("div",{className:"FacetNavPanel__title",children:[!p&&I?n(G,{width:100}):n("span",{className:"FacetNavPanel__title__name",children:y}),f("div",{className:"FacetNavPanel__title__tools",children:[n(z,{facetValues:l.facetValues,columnModel:p==null?void 0:p.columnModels.find(C=>C.name===l.columnName),onChange:C=>{Ve(x(),l,r,C)},onClear:()=>{fe(x(),l,r)},containerAs:"Dropdown"}),n(me,{tooltipText:"Expand to large graph",callbackFn:()=>w(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),n(me,{tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),a&&f(Q,{children:[f("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),n(z,{facetValues:l.facetValues,columnModel:p==null?void 0:p.columnModels.find(C=>C.name===l.columnName),onChange:C=>{Ve(x(),l,r,C)},onClear:()=>{fe(x(),l,r)},containerAs:"Dropdown",dropdownType:"SelectBox"}),n(Vt,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:n(Et,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),n(g,{})]}),f("div",{className:`FacetNavPanel__body${a?"--expanded":""}`,role:"graphics-object",children:[n(Rt.SizeMe,{monitorHeight:!0,children:({size:C})=>{var S;return n("div",{className:dn(a,u),children:n(nn,{layout:sn,data:(S=i==null?void 0:i.data)!=null?S:[],style:un(C.width,u,a?300:150),config:{displayModeBar:!1},onClick:R=>cn(R,l,s)},`${l.columnName}-${u}-${C.width}`)})}}),n(de,{labels:i==null?void 0:i.labels,colors:i==null?void 0:i.colors,isExpanded:a})]})]})]})};try{de.displayName="FacetPlotLegend",de.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"]={docgenInfo:de.__docgenInfo,name:"FacetPlotLegend",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"})}catch{}try{J.displayName="FacetNavPanel",J.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"]={docgenInfo:J.__docgenInfo,name:"FacetNavPanel",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"})}catch{}function pn(e,t,a){const r=t.getColumnModel(e.columnName);return e.values.map(s=>{let o=s;(s==null?void 0:s.startsWith("%"))&&(s==null?void 0:s.endsWith("%"))&&(o=o.substring(1,o.length-1)),o=a.getDisplayValue(o,r.columnType);const l=`${e.columnName}: ${o}`;return{key:`queryFilter-${e.concreteType}-${e.columnName}-${s}`,innerText:l,tooltipText:l,onRemoveFilter:()=>{t.removeValueFromQueryFilter(e,s)}}})}function mn(e,t){return{key:`queryFilter-${e.concreteType}-${e.searchExpression}`,innerText:e.searchExpression,tooltipText:`Text matches: "${e.searchExpression}"`,onRemoveFilter:()=>{t.removeQueryFilter(e)}}}function fn(e,t,a){var r;return ve(e)||Ie(e)?e.columnName===((r=t.lockedColumn)==null?void 0:r.columnName)?[]:pn(e,t,a):Ft(e)?[mn(e,t)]:(console.log("Unknown query filter type",e.concreteType),[])}function yn(e,t,a){var l;if(e.columnName===((l=t.lockedColumn)==null?void 0:l.columnName))return[];const r=t.getColumnModel(e.columnName),{getColumnDisplayName:s,getDisplayValue:o}=a;if(we(e))return e.facetValues.map(u=>{const d=o(u,r.columnType);return{key:`facet-${e.concreteType}-${e.columnName}-${u}`,innerText:d,tooltipText:`${s(e.columnName)}: ${d}`,onRemoveFilter:()=>{t.removeValueFromSelectedFacet(e,u)}}});if(Lt(e)){const u=`${e.min} - ${e.max}`;return[{key:`facet-${e.concreteType}-${e.columnName}-${e.min}-${e.max}`,innerText:u,tooltipText:`${s(e.columnName)}: ${u}`,onRemoveFilter:()=>{t.removeSelectedFacet(e)}}]}else return console.log("Unknown facet type",e.concreteType),[]}function hn(){var u,d,c;const e=U(),t=M(),{getLastQueryRequest:a}=e,r=a(),s=((d=(u=r.query)==null?void 0:u.additionalFilters)!=null?d:[]).flatMap(p=>fn(p,e,t)),o=((c=r.query.selectedFacets)!=null?c:[]).flatMap(p=>yn(p,e,t)),l=[...s,...o];return n(Q,{children:l.map(p=>{const I=encodeURIComponent(p.key);return m.exports.createElement(At,{...p,key:I})})})}function pe(e){const{style:t,frontText:a,endText:r="",hideIfUnfiltered:s=!1}=e,{data:o,isLoadingNewBundle:l,resetQuery:u,error:d,hasResettableFilters:c}=U(),{topLevelControlsState:p,unitDescription:I}=M(),x=o==null?void 0:o.queryCount,A=p==null?void 0:p.showFacetFilter,E=c;return d?n(Q,{}):n("div",{className:`TotalQueryResults ${A?Oe:Qe} ${c?"hasFilters":""}`,style:t,children:l?n(G,{width:100}):f(Q,{children:[(c||!s)&&f("div",{className:"TotalQueryResults__topbar",children:[f("span",{className:"SRC-boldText",children:[a," ",x==null?void 0:x.toLocaleString()," ",I," ",r]}),E&&f("a",{onClick:u,className:"TotalQueryResults__topbar__clearall",children:[n(W,{icon:"deleteSweep"}),"Clear all filters"]})]}),n("div",{className:"TotalQueryResults__selections",children:n(hn,{})})]})})}try{pe.displayName="TotalQueryResults",pe.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:null,description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:null,description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:pe.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}const Ne=2;function be(e,t){var r,s;return(s=(r=e==null?void 0:e.facets)==null?void 0:r.filter(o=>o.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(o.columnName)>-1)&&o.facetValues.length>0&&!Ue(o)))!=null?s:[]}const Re=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:a,isLoadingNewBundle:r,executeQueryRequest:s,error:o,asyncJobStatus:l}=U(),{topLevelControlsState:u}=M(),[d,c]=m.exports.useState([]),[p,I]=m.exports.useState(!0),{showFacetVisualization:x,showFacetFilter:A}=u,E=a();m.exports.useEffect(()=>{const h=be(t,e);h.length!==0&&p&&(c(h.map((_,F)=>({name:_.columnName,isHidden:F>=Ne,plotType:"PIE"}))),I(!1))},[t,p,e]);const w=h=>{c(_=>_.map((F,O)=>h?{...F,isHidden:!1}:{...F,isHidden:O>=Ne}))},y=h=>{E.query.selectedFacets=h,E.query.offset=0,s(E)},T=h=>d.find(O=>O.name===h&&O.isHidden===!0)!==void 0,i=m.exports.useMemo(()=>d.find(h=>h.isHidden===!0)?"MORE":d.length<=Ne?"NONE":"LESS",[d]),g=h=>{R(h,"isHidden",!0)},C=(h,_)=>{R(h,"plotType",_)},S=h=>{var F;const _=(F=d.find(O=>O.name===h))==null?void 0:F.plotType;return _!=null?_:"PIE"},R=(h,_,F)=>{c(O=>O.map(k=>k.name===h?{...k,[_]:F}:k))},v=be(t,e),N=be(t,e).map((h,_)=>({columnName:h.columnName,colorIndex:_})),V=(E==null?void 0:E.query.selectedFacets)!==void 0&&E.query.selectedFacets.length>0||(E==null?void 0:E.query.additionalFilters)!==void 0&&(E==null?void 0:E.query.additionalFilters.length)>0;return o?n(Q,{}):!t&&r?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(l==null?void 0:l.progressMessage)&&f("div",{children:[n("span",{className:"spinner"}),l.progressMessage]})}):f(Q,{children:[n(pe,{frontText:"",endText:V?"filtered by":"",hideIfUnfiltered:!0}),v.length>0&&f("div",{className:`FacetNav ${x?"":"hidden"} ${A?Oe:Qe} ${i==="LESS"?"less":""}`,children:[n("div",{className:"FacetNav__row",role:"list",children:v.map(h=>{var _;return n("div",{className:"col-sm-12 col-md-4",style:{display:T(h.columnName)?"none":"block"},children:n(J,{index:(_=N.find(F=>F.columnName===h.columnName))==null?void 0:_.colorIndex,onHide:()=>g(h.columnName),plotType:S(h.columnName),onSetPlotType:F=>C(h.columnName,F),facetToPlot:h,applyChangesToFacetFilter:y,applyChangesToGraphSlice:(F,O,k)=>fe(E,F,y,O==null?void 0:O.value,k),isModalView:!1})},h.columnName)})}),i!=="NONE"&&n("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:n($e,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>w(i==="MORE"),style:{zIndex:500},children:i==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Re.displayName="FacetNav",Re.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"]={docgenInfo:Re.__docgenInfo,name:"FacetNav",path:"src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"})}catch{}export{z as E,Te as F,le as I,re as N,Oe as Q,G as S,pe as T,Qe as a,M as b,Dt as c,ae as d,Ee as e,ge as f,jn as g,Gn as h,Ve as i,fe as j,Fe as k,xe as l,Re as m,Se as n,be as o,ln as p,un as q,de as r,oe as s,U as u};

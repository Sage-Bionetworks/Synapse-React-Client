import{r as S,j as c,F as V,a as w}from"./jsx-runtime.e755df9d.js";import{j as u,l as q,bT as P,bU as $,bV as K,bW as Q,U as T,bX as W,bY as Y,bZ as j,b_ as G,b$ as H,c0 as X,c1 as Z,c2 as z,a4 as J}from"./index.f37f3b8f.js";import{u as _}from"./useMutation.65911f81.js";import{u as N}from"./useInfiniteQuery.c9dc13c8.js";import{g as D}from"./DiscussionSearchResult.6dc5d1f4.js";import{I as A}from"./IconSvg.0451ffde.js";import{a as ee}from"./CardContainerLogic.fbcd19ea.js";import{U as ne}from"./UserSearchBoxV2.3f126cdc.js";import{M as b}from"./Modal.48855f51.js";import{s as se}from"./startCase.fccd1932.js";import{b as te}from"./isArray.32035835.js";import{B}from"./Button.ce5d2622.js";function Ee(e,s){const{accessToken:t}=u();return q(["moderators",e],()=>P(t,e),s)}function be(e,s,t,n,a,r){const{accessToken:g}=u();return N(["forumthread",e,"infinite",s,a,t,n],async i=>$(g,e,i.pageParam,s,t,n,a),{...r,getNextPageParam:(i,m)=>{if(i.results.length>0)return m.length*s}})}function Ce(e){const{data:s,isLoading:t}=ae(e),{data:n,isLoading:a}=re(s,{enabled:!!s});return{threadData:s,threadBody:n,isLoading:a||t}}function ae(e,s){const{accessToken:t}=u();return q(["thread",e,t],()=>K(e,t),s)}function re(e,s){var a;const{accessToken:t}=u(),n=Q((a=e==null?void 0:e.messageKey)!=null?a:"",t);return q(["thread",e==null?void 0:e.id,e==null?void 0:e.messageKey,t],async()=>D((await n).messageUrl),s)}function oe(e){const s=T(),{accessToken:t}=u();return _(n=>W(t,n),{...e,onSuccess:async(n,a,r)=>{await s.invalidateQueries(["thread",a.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(n,a,r)}})}function ce(e){const s=T(),{accessToken:t}=u();return _(n=>Y(t,n),{...e,onSuccess:async(n,a,r)=>{await s.invalidateQueries(["thread",a.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(n,a,r)}})}function ie(e){const s=T(),{accessToken:t}=u();return _(n=>j(t,n),{...e,onSuccess:async(n,a,r)=>{await s.invalidateQueries(["forumthread",n.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(n,a,r)}})}function Re(e){const s=T(),{accessToken:t}=u();return _(n=>G(t,n),{...e,onSuccess:async(n,a,r)=>{await s.invalidateQueries(["thread",a]),e!=null&&e.onSuccess&&await e.onSuccess(n,a,r)}})}function Ie(e,s,t,n,a,r){const{accessToken:g}=u();return N(["thread",e,"infinite",t,a,n,s],async i=>H(g,e,t,i.pageParam,n,s,a),{...r,getNextPageParam:(i,m)=>{if(i.results.length>0)return m.length*t}})}function de(e){const s=T(),{accessToken:t}=u();return _(n=>X(n,t),{...e,onSuccess:async(n,a,r)=>{await s.invalidateQueries(["thread",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(n,a,r)}})}function ue(e){const s=T(),{accessToken:t}=u();return _(n=>Z(n,t),{...e,onSuccess:async(n,a,r)=>{await s.invalidateQueries(["thread",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(n,a,r)}})}function ve(e){const s=T(),{accessToken:t}=u();return _(n=>z(t,n.replyId),{...e,onSuccess:async(n,a,r)=>{await s.invalidateQueries(["thread",a.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(n,a,r)}})}const le=["title","bold","italic","strikethrough","code","latex","subscript","superscript","link","image"],F={title:{openSyntax:"###",closeSyntax:""},bold:{openSyntax:"**",closeSyntax:"**"},italic:{openSyntax:"_",closeSyntax:"_"},strikethrough:{openSyntax:"--",closeSyntax:"--"},code:{openSyntax:"```",closeSyntax:"```"},latex:{openSyntax:"$$\\(",closeSyntax:"\\)$$"},subscript:{openSyntax:"~",closeSyntax:"~"},superscript:{openSyntax:"^",closeSyntax:"^"},link:{openSyntax:"[",closeSyntax:"](url)"},image:{openSyntax:"![",closeSyntax:"](image-url)"}},C=({show:e,onClose:s,handleUserTag:t})=>{const n=S.exports.useCallback((a,r)=>{a&&r&&t(r.userName),s()},[s,t]);return c(V,{children:w(b,{show:e,onHide:s,backdrop:"static",animation:!1,children:[c(b.Header,{closeButton:!0,children:c(b.Title,{children:"Find User or Team"})}),c(b.Body,{children:c(ne,{placeholder:"Search for a user or team name",onChange:n,typeFilter:J.USERS_ONLY})})]})})};try{C.displayName="UserMentionModal",C.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/markdown/UserMentionModal.tsx#UserMentionModal"]={docgenInfo:C.__docgenInfo,name:"UserMentionModal",path:"src/lib/containers/markdown/UserMentionModal.tsx#UserMentionModal"})}catch{}var O=(e=>(e.WRITE="WRITE",e.PREVIEW="PREVIEW",e))(O||{});const R=({placeholder:e,text:s,setText:t})=>{const[n,a]=S.exports.useState("WRITE"),[r,g]=S.exports.useState(0),[i,m]=S.exports.useState(!1),p=S.exports.useRef(null);S.exports.useEffect(()=>{const o=p.current;o&&o.setSelectionRange(r,r)},[p,r]),S.exports.useEffect(()=>{var o;(o=p.current)==null||o.focus()},[i]);const I=o=>{const d=[],l=p.current;if(l){const y=l==null?void 0:l.selectionStart,k=s.substring(0,y),x=s.substring(y,s.length);g(y+o.length+1),d.push(k,`@${o}`,x)}t(d.join(""))},v=o=>{o.key=="@"&&m(!0)},L=o=>{const d=p.current;if(d){const l=d.selectionStart,y=d.selectionEnd,k=s.substring(l,y),x=s.substring(0,l),E=s.substring(y,s.length),M=F[o].openSyntax,f=F[o].closeSyntax;switch(o){case"code":{const h=[];h.push(x,M,k,f,E),t(h.join(`\r
`)),d.focus(),g(l+M.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const h=`${x}${M}${k}${f}${E}`;d.focus(),g(l+M.length),t(h)}}}};return w("div",{className:"bootstrap-4-backport MarkdownEditor",children:[w("div",{className:"MarkdownEditorControls",children:[c("div",{className:"Tabs",children:Object.keys(O).map(o=>c("button",{className:"Tab",role:"tab","aria-selected":o===n,onClick:d=>{d.stopPropagation(),a(O[o])},children:o},o))}),n==="WRITE"&&w("div",{className:"MarkdownEditorControlsToolbar",children:[le.map(o=>c("button",{onClick:()=>L(o),children:c(A,{icon:o,label:se(o)})},o)),c("button",{onClick:()=>m(!0),children:c(A,{icon:"tag",label:"Mention"})})]})]}),c("div",{children:n==="WRITE"?c("textarea",{onChange:o=>t(o.target.value),style:{width:"100%"},rows:6,value:s,ref:p,placeholder:e,onKeyDown:v}):s?c(ee,{markdown:s}):"Nothing to preview"}),c(C,{show:i,onClose:()=>m(!1),handleUserTag:I})]})};try{R.displayName="MarkdownEditor",R.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/markdown/MarkdownEditor.tsx#MarkdownEditor"]={docgenInfo:R.__docgenInfo,name:"MarkdownEditor",path:"src/lib/containers/markdown/MarkdownEditor.tsx#MarkdownEditor"})}catch{}const U=({initialText:e,initialTitle:s,id:t,onClose:n,isReply:a})=>{const[r,g]=S.exports.useState(s!=null?s:""),[i,m]=S.exports.useState(e!=null?e:""),{mutate:p,isLoading:I}=oe({onSuccess:()=>n()}),{mutate:v,isLoading:L}=ce({onSuccess:()=>n()}),{mutate:o,isLoading:d}=ie({onSuccess:()=>n()}),{mutate:l,isLoading:y}=de({onSuccess:()=>n()}),{mutate:k,isLoading:x}=ue({onSuccess:()=>n()}),E=L||y||d||I||x,M=(f,h)=>{a?e?k({replyId:t,messageMarkdown:f}):l({threadId:t,messageMarkdown:f}):s?(p({title:h,threadId:t}),v({messageMarkdown:f,threadId:t})):o({forumId:t,title:h,messageMarkdown:f})};return w("div",{className:"bootstrap-4-backport",children:[!a&&c(te,{type:"text",placeholder:"Title",value:r,onChange:f=>g(f.target.value)}),c(R,{text:i,setText:m}),w("div",{style:{display:"flex",justifyContent:"flex-end"},children:[c(B,{onClick:n,variant:"light",children:"Cancel"}),c(B,{disabled:E,onClick:()=>M(i,r),variant:"primary",children:E?"Saving":"Save"})]})]})};try{U.displayName="ForumThreadEditor",U.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"]={docgenInfo:U.__docgenInfo,name:"ForumThreadEditor",path:"src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"})}catch{}export{U as F,ve as a,Ce as b,Re as c,Ie as d,be as e,Ee as u};

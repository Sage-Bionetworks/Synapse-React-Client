import{r as y,a as _,j as g}from"./jsx-runtime.02fcd003.js";import{j as c,l as f,bT as q,bU as O,bV as F,bW as P,U as d,bX as N,bY as Q,bZ as x,b_ as D,b$ as G,c0 as V,c1 as J,c2 as Y,c3 as K,c4 as H,c5 as W}from"./index.91a9706e.js";import{u as o}from"./useMutation.9d704823.js";import{u as I}from"./useInfiniteQuery.fc6fd964.js";import{g as X}from"./DiscussionSearchResult.0c06400f.js";import{M as Z}from"./MarkdownEditor.a92f0337.js";import{B as E}from"./Button.bd4bae0e.js";import{D as $}from"./EntityChildren.50133102.js";function he(e,n){const{accessToken:a}=c();return f(["moderators",e],()=>q(a,e),n)}function Ce(e,n,a,s,r,t){const{accessToken:i}=c();return I(["forumthread",e,"infinite",n,r,a,s],async u=>O(i,e,u.pageParam,n,a,s,r),{...t,getNextPageParam:(u,l)=>{if(u.results.length>0)return l.length*n}})}function _e(e){const{data:n,isLoading:a}=z(e),{data:s,isLoading:r}=j(n,{enabled:!!n});return{threadData:n,threadBody:s,isLoading:r||a}}function z(e,n){const{accessToken:a}=c();return f(["thread",e,a],()=>F(e,a),n)}function j(e,n){var r;const{accessToken:a}=c(),s=P((r=e==null?void 0:e.messageKey)!=null?r:"",a);return f(["thread",e==null?void 0:e.id,e==null?void 0:e.messageKey,a],async()=>X((await s).messageUrl),n)}function ee(e){const n=d(),{accessToken:a}=c();return o(s=>x(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",r.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function se(e){const n=d(),{accessToken:a}=c();return o(s=>D(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",r.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function ae(e){const n=d(),{accessToken:a}=c();return o(s=>G(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["forumthread",s.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function Ee(e){const n=d(),{accessToken:a}=c();return o(s=>N(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",r]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function Ie(e,n,a,s,r,t){const{accessToken:i}=c();return I(["thread",e,"infinite",a,r,s,n],async u=>Q(i,e,a,u.pageParam,s,n,r),{...t,getNextPageParam:(u,l)=>{if(u.results.length>0)return l.length*a}})}function ne(e){const n=d(),{accessToken:a}=c();return o(s=>V(s,a),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",s.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function re(e){const n=d(),{accessToken:a}=c();return o(s=>J(s,a),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",s.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function Le(e){const n=d(),{accessToken:a}=c();return o(s=>Y(a,s.replyId),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries(["thread",r.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}var te=(e=>(e.FORUM="FORUM",e.THREAD="THREAD",e.DATA_ACCESS_SUBMISSION="DATA_ACCESS_SUBMISSION",e.DATA_ACCESS_SUBMISSION_STATUS="DATA_ACCESS_SUBMISSION_STATUS",e))(te||{}),L=(e=>(e.SUBSCRIPTION_ID="SUBSCRIPTION_ID",e.SUBSCRIBER_ID="SUBSCRIBER_ID",e.OBJECT_ID="OBJECT_ID",e.OBJECT_TYPE="OBJECT_TYPE",e.CREATED_ON="CREATED_ON",e))(L||{});const T=({initialText:e,initialTitle:n,id:a,onClose:s,isReply:r})=>{const[t,i]=y.exports.useState(n!=null?n:""),[u,l]=y.exports.useState(e!=null?e:""),{mutate:m,isLoading:R}=ee({onSuccess:()=>s()}),{mutate:k,isLoading:w}=se({onSuccess:()=>s()}),{mutate:A,isLoading:b}=ae({onSuccess:()=>s()}),{mutate:p,isLoading:B}=ne({onSuccess:()=>s()}),{mutate:M,isLoading:v}=re({onSuccess:()=>s()}),h=w||B||b||R||v,U=(S,C)=>{r?e?M({replyId:a,messageMarkdown:S}):p({threadId:a,messageMarkdown:S}):n?(m({title:C,threadId:a}),k({messageMarkdown:S,threadId:a})):A({forumId:a,title:C,messageMarkdown:S})};return _("div",{className:"bootstrap-4-backport",children:[!r&&g("input",{placeholder:"Title",type:"text",style:{width:"100%",padding:"4px"},value:t,onChange:S=>i(S.target.value)}),g(Z,{text:u,setText:l}),_("div",{style:{display:"flex",justifyContent:"flex-end"},children:[g(E,{onClick:s,variant:"light",children:"Cancel"}),g(E,{disabled:h,onClick:()=>U(u,t),variant:"primary",children:h?"Saving":"Save"})]})]})};try{T.displayName="ForumThreadEditor",T.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"]={docgenInfo:T.__docgenInfo,name:"ForumThreadEditor",path:"src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"})}catch{}function ce(e,n,a){const{accessToken:s}=c();return f([s,"subscription",e,n],async()=>{const t={objectType:n,idList:[e],sortByType:L.OBJECT_ID,sortDirection:$.ASC};return(await W(s,t)).results[0]},a)}function ue(e){const n=d(),{accessToken:a}=c();return o(s=>K(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries([a,"subscription"]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}function ie(e){const n=d(),{accessToken:a}=c();return o(s=>H(a,s),{...e,onSuccess:async(s,r,t)=>{await n.invalidateQueries([a,"subscription"]),e!=null&&e.onSuccess&&await e.onSuccess(s,r,t)}})}const Re=(e,n)=>{const{data:a,isLoading:s}=ce(e,n),{mutate:r,isLoading:t}=ue(),{mutate:i,isLoading:u}=ie(),l=s||t||u,m=y.exports.useCallback(()=>{a?i(a.subscriptionId):r({objectId:e,objectType:n})},[i,e,n,r,a]);return{isLoading:l,subscription:a,toggleSubscribed:m}};export{T as F,te as S,Le as a,_e as b,Re as c,Ee as d,Ie as e,Ce as f,he as u};

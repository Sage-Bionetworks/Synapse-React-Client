import{ap as Ke,aq as Ge,an as je,C as Je,am as Ze,E as Xe,N as Pe,az as ae,aA as _e,h as et,ag as tt,al as nt,aB as at,aC as rt,aD as st}from"./index.1b5679ea.js";import{j as n,r as F,a as m,F as B,R as Ae}from"./jsx-runtime.eafcb716.js";import{e as ot,i as lt,r as it,h as ct,f as De,g as Le,b as Ce,c as Se}from"./queryUtils.dade1562.js";import{a as Ue,b as ut,u as dt}from"./use-deep-compare-effect.esm.32d4302a.js";import{s as pt}from"./NoSearchResults.c9c55f7c.js";import{N as mt}from"./NoData.6637f170.js";import{u as ft,E as re}from"./ElementWithTooltip.fe39892b.js";import{u as yt}from"./useEntity.bf1c9bc1.js";import{a as ht,b as _t}from"./sqlFunctions.1d7d9843.js";import{c as H}from"./cloneDeep.e13ce5b9.js";import{u as ge}from"./useGetInfoFromIds.dcdb7bde.js";import{C as k}from"./ColumnType.744125d2.js";import{I as Z}from"./IconSvg.625594e1.js";import{C as Ye}from"./Checkbox.6d5555ef.js";import{D as M}from"./Dropdown.7162bc12.js";import{R as Ct}from"./RadioGroup.e5def0a0.js";import{h as ke}from"./moment.a565bb48.js";import{R as St}from"./RangeSlider.f407560b.js";import{c as gt,P as Ft}from"./factory.a50674f0.js";import{r as Et}from"./react-sizeme.dd262d7d.js";import{S as xt}from"./Skeleton.7d351d4d.js";import{g as Nt}from"./ColorGradient.16f0e0f2.js";import{l as Tt}from"./LoadingScreen.c34152cb.js";import{T as vt}from"./Tooltip.96a18513.js";import{M as oe}from"./Modal.b6a2ef3c.js";import{B as Me}from"./Button.2a9ceb49.js";import{I as Rt}from"./InfoOutlined.f91cf818.js";import{C as bt}from"./Close.0b1926a3.js";const X=e=>n(xt,{style:{...e.style,display:"inline-block"},...e});try{X.displayName="SkeletonInlineBlock",X.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:X.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const W=F.exports.createContext(void 0),le=({children:e,queryContext:t})=>n(W.Provider,{value:t,children:e});function J(){const e=F.exports.useContext(W);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function bn(){const e=F.exports.useContext(W);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function In(){const e=F.exports.useContext(W);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const Fe=W.Consumer;try{W.displayName="QueryContext",W.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:W.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{le.displayName="QueryContextProvider",le.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:le.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{Fe.displayName="QueryContextConsumer",Fe.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:Fe.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}function We(e,t){return`${e}${t}`}function It(e,t){const a=window.location.search,s=`${e}=${t}`;return a?a.includes(`${e}=`)?window.location.search.slice(a.indexOf("?")+1).split("&").map(r=>r.split("=")[0]===e?`${s}`:r).join("&"):`${a.substr(1)}&${s}`:s}function wt(e,t){if(!window.location.search)return;const a=We(e,t),l=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(o=>o.split("=")[0]===a).map(o=>o.split("=")[1])[0];return l?decodeURIComponent(l):void 0}function Ot(e,t,a){const s=t!==void 0?We(e,t):e,l=It(s,a),o=window.location,r=`${o.protocol}//${o.hostname}${o.port?":"+o.port:""}${o.pathname}?${l}`;window.history.replaceState("object or string","Title",r)}function At(e,t){const a=wt(e,t);let s;if(a){const l=JSON.parse(a);l.sql&&(s={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:Ke|Ge|je|Je,entityId:ht(l.sql),query:l})}return s}function Vt(e){var y,N;const{initQueryRequest:t,componentIndex:a=0,shouldDeepLink:s=!1,onQueryChange:l}=e,[o,r]=F.exports.useState(t);F.exports.useEffect(()=>{const i=At("QueryWrapper",a);i&&r(i)},[a]);const c=F.exports.useCallback(()=>H(o),[o]);function f(){return H(t)}function u(i){let p;typeof i=="function"?p=i(c()):p=i;const b=H(p);if(r(b),b.query){const d=JSON.stringify(b.query);if(s){const T=encodeURIComponent(d);Ot("QueryWrapper",a,T)}l&&l(d)}}const{entityId:C,versionNumber:I}=_t(o.query.sql),v=(y=o.query.limit)!=null?y:Ze,A=Math.ceil((((N=o.query.offset)!=null?N:0)+Number(v))/v);function g(i){u(p=>(p.query.limit=i,p))}function w(i){u(p=>(p.query.offset=(i-1)*v,p))}return{entityId:C,versionNumber:I,getInitQueryRequest:f,getLastQueryRequest:c,setQuery:u,pageSize:v,currentPage:A,setPageSize:g,goToPage:w}}const Ve="isShowingFacetFilters",Qe="isHidingFacetFilters";function Ee(e){const{initQueryRequest:t,onQueryChange:a,onQueryResultBundleChange:s,lockedColumn:l,componentIndex:o,shouldDeepLink:r}=e,[c,f]=F.exports.useState(void 0),{entityId:u,versionNumber:C,getInitQueryRequest:I,getLastQueryRequest:v,setQuery:A,currentPage:g,pageSize:w,goToPage:y,setPageSize:N}=Vt({initQueryRequest:t,shouldDeepLink:r,componentIndex:o,onQueryChange:a}),i=F.exports.useMemo(()=>v(),[v]),{data:p,isLoading:b,error:d,isPreviousData:T}=ot(i,{keepPreviousData:!0},f),O=p==null?void 0:p.responseBody,P=b||T,{data:z}=yt(u,C);Ue(()=>{O&&s&&s(JSON.stringify(O))},[O,s]);const x=O?lt(O.facets,O.selectColumns):!0,Q=F.exports.useMemo(()=>it(O,l),[O,l]),V=F.exports.useMemo(()=>{const E=v();return ct(E.query,l)},[v,l]),q={data:Q,currentPage:g,pageSize:w,setPageSize:N,isLoadingNewBundle:P,getLastQueryRequest:v,getInitQueryRequest:I,error:d,entity:z,executeQueryRequest:A,isFacetsAvailable:x,asyncJobStatus:c,goToPage:y,hasResettableFilters:V},{children:h}=e;return n(le,{queryContext:q,children:n("div",{className:`SRC-wrapper ${P?"SRC-logo-cursor":""} ${x?"has-facets":""}`,children:h})})}try{Ee.displayName="QueryWrapper",Ee.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:Ee.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}function Qt(){return m(B,{children:[n("p",{className:"SRC-no-results-title",children:"There is currently no content here."}),n("p",{className:"SRC-no-results-description",children:"Information is always being updated, so check back later to see if content has been added."})]})}var ie=(e=>(e.INTERACTIVE="INTERACTIVE",e.STATIC="STATIC",e))(ie||{});function qt(){return m("div",{className:"text-center",children:[pt,n("h4",{children:"No Matching Results"}),n("p",{children:"Try checking the spelling or removing filters."})]})}function Lt(){return m("div",{className:"text-center SRCBorderedPanel SRCBorderedPanel--padded2x",children:[mt,n("div",{style:{marginTop:"20px",fontStyle:"italic"},children:"This table is currently empty"})]})}const G=F.exports.createContext(void 0),ce=({children:e,queryVisualizationContext:t})=>n(G.Provider,{value:t,children:e});function $(){const e=F.exports.useContext(G);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const xe=G.Consumer;function Ne(e){var b,d;const{noContentPlaceholderType:t=ie.INTERACTIVE}=e,{data:a,getLastQueryRequest:s,isFacetsAvailable:l,isLoadingNewBundle:o,hasResettableFilters:r}=J(),{columnAliases:c={}}=e,[f,u]=F.exports.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(b=e.defaultShowFacetVisualization)!=null?b:!0,showSearchBar:(d=e.defaultShowSearchBar)!=null?d:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});F.exports.useEffect(()=>{l||u(T=>({...T,showFacetFilter:!1,showFacetVisualization:!1}))},[l]),F.exports.useEffect(()=>{o&&A([])},[o]);const[C,I]=F.exports.useState([]),[v,A]=F.exports.useState([]),g=s(),w=ut(a==null?void 0:a.selectColumns);F.exports.useEffect(()=>{var T,O;I((O=w==null?void 0:w.slice(0,(T=e.visibleColumnCount)!=null?T:1/0).map(P=>P.name))!=null?O:[])},[w,g.query.sql,e.visibleColumnCount]);const y=F.exports.useCallback(T=>{const O=localStorage.getItem("force-display-original-column-names")==="true";return!T||O?T:c[T]?c[T]:ft(T)},[c]),N=F.exports.useCallback(()=>{switch(t){case ie.INTERACTIVE:return r?n(qt,{}):n(Lt,{});case ie.STATIC:default:return n(Qt,{})}},[t,r]),i={topLevelControlsState:f,setTopLevelControlsState:u,columnsToShowInTable:C,setColumnsToShowInTable:I,selectedRowIndices:v,setSelectedRowIndices:A,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:y,NoContentPlaceholder:N},{children:p}=e;return n(ce,{queryVisualizationContext:i,children:p})}try{Ne.displayName="QueryVisualizationWrapper",Ne.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}},noContentPlaceholderType:{defaultValue:null,description:"Default is INTERACTIVE",name:"noContentPlaceholderType",required:!1,type:{name:"enum",value:[{value:'"INTERACTIVE"'},{value:'"STATIC"'}]}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:Ne.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{G.displayName="QueryVisualizationContext",G.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:G.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{ce.displayName="QueryVisualizationContextProvider",ce.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:ce.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{xe.displayName="QueryVisualizationContextConsumer",xe.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:xe.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}const Te=()=>{const{error:e}=J();return n(Xe,{error:e})};try{Te.displayName="QueryWrapperErrorBanner",Te.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"]={docgenInfo:Te.__docgenInfo,name:"QueryWrapperErrorBanner",path:"src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"})}catch{}const ue=e=>{var t;return m("svg",{...e,className:`Icon-Plus ${(t=e.className)!=null?t:""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]})};try{ue.displayName="IconPlus",ue.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconPlus.tsx#IconPlus"]={docgenInfo:ue.__docgenInfo,name:"IconPlus",path:"src/lib/assets/icons/IconPlus.tsx#IconPlus"})}catch{}const de=e=>{var t;return m("svg",{...e,className:`Icon-Minus ${(t=e.className)!=null?t:""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]})};try{de.displayName="IconMinus",de.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconMinus.tsx#IconMinus"]={docgenInfo:de.__docgenInfo,name:"IconMinus",path:"src/lib/assets/icons/IconMinus.tsx#IconMinus"})}catch{}const ee=({label:e,isCollapsed:t,onClick:a})=>{const{getColumnDisplayName:s}=$();return m("div",{className:"FacetFilterHeader",children:[n("label",{className:"FacetFilterHeader__label",children:s(e)}),n("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>a(!t),children:t?n(ue,{className:"icon-plus",title:"Expand Menu"}):n(de,{className:"icon-minus",title:"Collapse Menu"})})]})};try{ee.displayName="FacetFilterHeader",ee.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:ee.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}function kt(e){return e.replace(/\s/g,"").toLowerCase()}function Be(e,t=[],a=[],s=[]){const{value:l}=e;let o=l;l===ae&&(o=_e);const r=t.find(u=>u.ownerId===l);r&&(o=r?r.userName:`unknown (${l})`);const c=a.find(u=>u.id===l);c&&(o=c?c.name:`unknown (${l})`);const f=s.find(u=>u.id===l);return f!=null&&f.name&&(o=f.name),`${o}`}function Bt(e,t,a){const s=[...e.sort((l,o)=>o.count-l.count)];return t||s.length<=a||s.slice(a).find(l=>l.isSelected)?s:s.splice(0,a)}const j=({facetValues:e,columnModel:t,onClear:a,onChange:s,containerAs:l="Collapsible",dropdownType:o="Icon",collapsed:r=!1})=>{const[c,f]=F.exports.useState(!1),[u,C]=F.exports.useState(r),[I,v]=F.exports.useState(!1),[A,g]=F.exports.useState(!1),[w,y]=F.exports.useState(""),[N,i]=F.exports.useState(e);dt(()=>{i(e)},[e]);const p=5,b=1500,d=Ae.createRef(),T={};let O;const P=e.filter(_=>_.isSelected).length===0,z=(t==null?void 0:t.columnType)===k.USERID||(t==null?void 0:t.columnType)===k.USERID_LIST?e.map(_=>_.value):[],x=ge({ids:z,type:"USER_PROFILE"}),Q=(t==null?void 0:t.columnType)===k.ENTITYID||(t==null?void 0:t.columnType)===k.ENTITYID_LIST?e.map(_=>_.value):[],V=ge({ids:Q,type:"ENTITY_HEADER"}),q=(t==null?void 0:t.columnType)===k.EVALUATIONID?e.map(_=>_.value):[],h=ge({ids:q,type:"EVALUATION_QUEUE"}),S=_=>{const D=_.target.value;if(y(D),f(!0),!D)e.forEach(Y=>{Y.isSelected=!1}),i(e);else{const Y=e.filter(U=>Be(U,x,V,h).toLowerCase().indexOf(D.trim().toLowerCase())>-1?U:null);i(Y)}};if(!t)return n(B,{});const E=l==="Dropdown",R=m("div",{className:E?"EnumFacetFilter__dropdown_menu":"",children:[m("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[m("div",{className:A?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[n("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{i(e),g(!1),f(!1)},children:n("span",{className:"EnumFacetFilter__previous",children:n(Z,{options:{icon:"arrowBack"}})})}),w.length>0&&n("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var _;y(""),(_=d.current)==null||_.focus()},children:n("span",{className:"EnumFacetFilter__reset",children:n(Z,{options:{icon:"close"}})})}),n("input",{type:"text",placeholder:"Find values",value:w,ref:d,onChange:_=>{S(_)}})]}),!A&&m("div",{className:"EnumFacetFilter__checkAll",children:[n(Ye,{className:"EnumFacetFilter__checkbox",onChange:()=>{a()},checked:P,label:"All",isSelectAll:!0},"select_all"),n("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var _;y(""),g(!0),(_=d.current)==null||_.focus()},children:n("span",{className:"EnumFacetFilter__searchicon",children:n(Z,{options:{icon:"search"}})})})]})]}),m("div",{children:[N.length>0&&Bt(N,c||E,p).map((_,D)=>n(Pt,{id:kt(_.value),index:D,label:Be(_,x,V,h),count:_.count,isDropdown:E,initialIsSelected:_.isSelected,onChange:Y=>{T[_.value]=Y,clearTimeout(O),O=setTimeout(()=>{s(T),v(!1)},b)}},`checkLabel${D}`)),!E&&m(B,{children:[!c&&N.length>p&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>f(!0),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:m("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",N.length,")"]})})}),c&&N.length>p&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>f(!1),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:n("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),N.length<=0&&n("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),L=()=>v(!I);return E?o==="SelectBox"?m(M,{className:"EnumFacetFilter EnumFacetFilterSelect",show:I,onToggle:L,children:[m(M.Toggle,{className:"secondary-caret",variant:"gray-select",children:[P&&"All",!P&&e.filter(_=>_.isSelected).length===1&&e.filter(_=>_.isSelected)[0].value,!P&&e.filter(_=>_.isSelected).length>1&&"Multiple Values Selected"]}),n(M.Menu,{children:R})]}):m(M,{className:"EnumFacetFilter",show:I,onToggle:L,children:[n(re,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),n(M.Menu,{children:R})]}):m(B,{children:[n(ee,{isCollapsed:u,label:t.name,onClick:_=>C(_)}),n(Pe,{className:"EnumFacetFilter",in:!u,children:R})]})};function Pt({id:e,index:t,label:a,count:s,isDropdown:l,initialIsSelected:o,onChange:r}){const[c,f]=F.exports.useState(o);return Ae.useEffect(()=>{f(o)},[o]),m("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{l&&(f(!c),r(!c))},children:[n(Ye,{className:"EnumFacetFilter__checkbox",onClick:u=>u.stopPropagation(),onChange:u=>{f(u),r(u)},checked:c,label:a},`${e}-${t}`),l&&m("span",{className:"EnumFacetFilter__count",children:["(",s,")"]}),!l&&n("div",{className:"EnumFacetFilter__count",children:s})]})}try{j.displayName="EnumFacetFilter",j.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:j.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const pe=({facet:e,isChecked:t,onClick:a})=>{const{getColumnDisplayName:s}=$();return m("button",{className:`Chip ${t?"Checked":""}`,onClick:a,children:[s(e.columnName),n(Z,{options:{icon:t?"check":"add",size:"14px",padding:"left"}})]})};try{pe.displayName="FacetChip",pe.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"]={docgenInfo:pe.__docgenInfo,name:"FacetChip",path:"src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"})}catch{}const me=e=>{const t="Min value should be less then max value",[a,s]=F.exports.useState(!1),[l,o]=F.exports.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:ke(e.initialValues.min).format("YYYY-MM-DD"),max:ke(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),r=e.className?`range ${e.className}`:"range",c=({min:u,max:C},I="number")=>{if(u==null||C===null||C===void 0)return s(!1),!0;if(I==="number"){if(Number(u)>Number(C))return s(!0),!1}else if(Date.parse(u)>Date.parse(C))return s(!0),!1;return s(!1),!0},f=(u,C,I="number")=>{c(u,I)&&C(u)};return m("div",{className:r,style:{display:"flex",flexWrap:"wrap"},children:[m("div",{style:{marginRight:"10px"},children:[n("input",{"aria-label":"min",type:e.type,value:l.min,onChange:({target:u})=>o({min:u.value,max:l.max})},"range_min"),n("div",{children:"to"}),n("input",{"aria-label":"max",type:e.type,value:l.max,onChange:({target:u})=>o({min:l.min,max:u.value})},"range_max")]}),n("button",{className:"btn btn-link SRC-noPadding",onClick:()=>f(l,e.onChange,e.type),children:"Apply"}),a&&n("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{me.displayName="Range",me.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:me.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}var we=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(we||{});const fe=({facetResult:e,columnModel:t,onChange:a,collapsed:s=!1})=>{const[l,o]=F.exports.useState(s),r=[{label:_e,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:c,columnMax:f,selectedMin:u,selectedMax:C}=e;const I=!u&&!C;u=u||c,C=C||f;const v=t.columnType==="DOUBLE"?"number":"date",A=(i,p)=>p?"":i===ae?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",g=(i,p)=>{y(i),i!=="RANGE"&&p([i,i])},[w,y]=F.exports.useState(A(u,I));return m("div",{children:[n(ee,{isCollapsed:l,label:t.name,onClick:i=>o(i)}),m(Pe,{in:!l,children:[n(Ct,{value:w,id:"rangeSelector",options:r,onChange:i=>g(i,a)}),w==="RANGE"&&(c===f?n("label",{children:f}):m(B,{children:[t.columnType==="INTEGER"&&m(St,{domain:[c,f],initialValues:{min:u,max:C},step:1,doUpdateOnApply:!0,onChange:i=>a([i.min,i.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&n(me,{initialValues:{min:u,max:C},type:v,onChange:i=>a([i.min,i.max])},"Range")]}))]})]})};try{fe.displayName="RangeFacetFilter",fe.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:fe.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const ze=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected).map(t=>t.value)}),Dt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},qe=(e,t)=>{var o,r;const a=(r=(o=t==null?void 0:t.query)==null?void 0:o.selectedFacets)!=null?r:[],s=a.findIndex(c=>c.columnName===e.columnName),l=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return s>-1?l?a.splice(s,1):a[s]=e:a.push(e),a};function se(e,t,a,s,l=!1){s?t.facetValues.forEach(c=>{c.value===s&&(c.isSelected=l)}):t.facetValues.forEach(c=>{c.isSelected=!1});const o=ze(t),r=qe(o,e);a(r)}const Oe=(e,t,a,s)=>{const l=s&&Object.keys(s)||[];l.length&&t.facetValues.forEach(c=>{l.includes(c.value)&&(c.isSelected=s?!!s[c.value]:!1)});const o=ze(t),r=qe(o,e);a(r)},He=(e,t,a,s)=>{t.columnMin=s[0],t.columnMax=s[1];const l=Dt(t),o=qe(l,e);a(o)};function ve(e){var y,N;const{facetsToFilter:t}=e,{data:a,isLoadingNewBundle:s,getLastQueryRequest:l,executeQueryRequest:o}=J(),r=(y=a==null?void 0:a.facets)==null?void 0:y.filter(i=>!De(i));let c;t==null?c=(N=r==null?void 0:r.map(i=>i.columnName))!=null?N:[]:c=t;const[f,u]=Ae.useState([]),{topLevelControlsState:C}=$(),{showFacetFilter:I}=C;if(Ue(()=>{u(c.slice(0,3))},[a==null?void 0:a.facets]),!a)return n(B,{});const v=a.selectColumns,A=l(),g=i=>{const p=l();p.query.selectedFacets=i,p.query.offset=0,o(p)},w=i=>{let p=[...f!=null?f:[""],i.columnName];f.includes(i.columnName)&&(p=p.filter(b=>b!=i.columnName)),u(p)};return m("div",{className:`FacetFilterControls ${I?Ve:Qe}`,children:[s&&n("div",{children:"Loading..."}),!s&&(r!=null?r:[]).filter(i=>f.includes(i.columnName)).map((i,p)=>{const b=v.find(d=>d.name===i.columnName);return m("div",{className:"FacetFilterControls__facet",children:[i.facetType==="enumeration"&&b&&n(j,{containerAs:"Collapsible",collapsed:!1,facetValues:i.facetValues,columnModel:b,onChange:d=>Oe(A,i,g,d),onClear:()=>se(A,i,g)}),i.facetType==="range"&&b&&n(fe,{facetResult:i,columnModel:b,collapsed:!1,onChange:d=>He(A,i,g,d)})]},i.columnName)}),m("div",{children:[n("div",{className:"AvailableFacet",children:n("label",{className:"AvailableFacet__label",children:"Available Facets"})}),(r!=null?r:[]).filter(i=>c.includes(i.columnName)).map(i=>n(pe,{facet:i,onClick:()=>w(i),isChecked:f.includes(i.columnName)},i.columnName))]})]})}try{ve.displayName="FacetFilterControls",ve.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"]={docgenInfo:ve.__docgenInfo,name:"FacetFilterControls",path:"src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"})}catch{}const Ut=gt(Ft),Yt=19,Mt=30,Wt={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},zt=(e,t)=>{t=t||0;let a=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let s=0;s<t;s++)a.indexOf(".")!==-1&&(a=a.replace("0%","%"),a=a.replace(".%","%"));return a};function $e(e,t){if(!e)return e;const a=e.trim();return a.length>t?a.substr(0,t-1)+"\u2026":e}async function Ht(e,t,a,s,l){var g,w;const{colorPalette:o}=Nt(a,e.facetValues.length),r=async(y,N,i)=>{const p=new Map;p.set(ae,_e);const b=y.map(d=>d.value).filter(d=>d!==ae);if(N===k.ENTITYID||N===k.ENTITYID_LIST){const d=await tt(b,i);for(const T of d.results)p.set(T.id,T.name)}else if(N===k.USERID||N===k.USERID_LIST){const d=await nt(b,i);for(const T of d.children)p.set(T.ownerId,T.userName)}return y.map(d=>({facet:d,label:c(d,!1,p),truncatedLabel:c(d,!0,p),count:d.count}))},c=(y,N,i)=>{var b;let p=(b=i.get(y.value))!=null?b:y.value;return N&&(p=$e(p,Yt)),p},f=await r(e.facetValues,t,l),u=f.map(y=>y.truncatedLabel),I=e.facetValues.some(y=>y.isSelected)?e.facetValues.map((y,N)=>y.isSelected?o[N]:o[N].replace("rgb(","rgba(").replace(")",", 0.25)")):o,v={values:s==="PIE"?e.facetValues.map(y=>y.count):void 0,labels:f.map(y=>y.label),text:u,x:s==="BAR"?e.facetValues.map(y=>{var N,i;return(i=(N=f.find(p=>p.facet===y))==null?void 0:N.label)!=null?i:y.value}):void 0,y:s==="BAR"?e.facetValues.map(y=>y.count):void 0,facetEnumerationValues:e.facetValues.map(y=>y.value),name:e.columnName,hovertemplate:s==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:s==="PIE"?"pie":"bar",pull:s==="PIE"?e.facetValues.map(y=>y.isSelected?.1:0):void 0,marker:{colors:s==="PIE"?I:void 0,color:s==="BAR"?I:void 0}};return{data:[v],labels:f,colors:s==="PIE"?(g=v.marker)==null?void 0:g.colors:(w=v.marker)==null?void 0:w.color}}const $t=(e,t,a)=>{if(e.points&&e.points[0]){const s=e.points[0],l=s.data.facetEnumerationValues[s.pointNumber],o=t.facetValues.find(r=>r.value===l);a(t,o,!o.isSelected)}};function Kt(e,t,a){const l=e?e*(t==="BAR"?.8:.6):200;let o=t==="PIE"?l:l/3;return o>a&&(o=a),{width:`${l}px`,height:`${o}px`}}function ye(e){const{labels:t,colors:a=[],isExpanded:s}=e;if(!t)return n(B,{});const l=s?Math.min(t.length,9):Math.min(t.length,3);if(l===0)return n(B,{});const o=t.reduce((r,c)=>r+c.count,0);return n("div",{className:`FacetNavPanel__body__legend${s?"--expanded":""}`,children:t.slice(0,l).map((r,c)=>{const u=`(${zt(r.count/o,1)}) ${r.label}`,C=$e(u,Mt);return n(re,{idForToolTip:r.label,tooltipText:r.label,children:m("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[n("div",{style:{backgroundColor:a[c]}}),n("label",{children:C})]},`legendLabel_${c}`)},r.label)})})}const Gt=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",te=e=>{const{onHide:t,isModalView:a,applyChangesToFacetFilter:s,applyChangesToGraphSlice:l,index:o,facetToPlot:r,plotType:c,onSetPlotType:f}=e,{accessToken:u}=et(),{data:C,isLoadingNewBundle:I,getLastQueryRequest:v}=J(),{getColumnDisplayName:A}=$(),[g,w]=F.exports.useState(),[y,N]=F.exports.useState(!1),i=A(r.columnName),p=F.exports.useCallback(()=>{var d,T;return(T=(d=C==null?void 0:C.columnModels)==null?void 0:d.find(O=>O.name===r.columnName))==null?void 0:T.columnType},[C,r.columnName]);F.exports.useEffect(()=>{let d=!0;if(r)Ht(r,p(),o,c,u).then(T=>{d&&w(T)});else return;return()=>{d=!1}},[r,C,o,c,u,p]);const b=()=>m("div",{onClick:d=>{d.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),m(M,{children:[n(M.Toggle,{className:"secondary-caret",variant:"gray-select",children:c==="PIE"?"Pie Chart":"Bar Chart"}),m(M.Menu,{className:"chart-tools",children:[n(M.Item,{as:"button",onClick:()=>f("BAR"),children:"Bar Chart"}),n(M.Item,{as:"button",onClick:()=>f("PIE"),children:"Pie Chart"})]})]})]});return!C&&I||!r?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:Tt}):m(B,{children:[m(oe,{animation:!1,show:y,onHide:()=>N(!1),backdrop:"static",children:[n(oe.Header,{closeButton:!0,children:n(oe.Title,{children:i!=null?i:""})}),m(oe.Body,{children:[n(te,{...e,isModalView:!0}),n("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:n(Me,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>N(!1),children:"Apply Filters"})})]})]}),m("div",{role:"graphics-document",className:`FacetNavPanel${a?"--expanded":""}`,children:[!a&&m("div",{className:"FacetNavPanel__title",children:[!C&&I?n(X,{width:100}):n("span",{className:"FacetNavPanel__title__name",children:i}),m("div",{className:"FacetNavPanel__title__tools",children:[n(j,{facetValues:r.facetValues,columnModel:C==null?void 0:C.columnModels.find(d=>d.name===r.columnName),onChange:d=>{Oe(v(),r,s,d)},onClear:()=>{se(v(),r,s)},containerAs:"Dropdown"}),n(re,{idForToolTip:"expandGraph",tooltipText:"Expand to large graph",callbackFn:()=>N(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),n(re,{idForToolTip:"hideGraph",tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),a&&m(B,{children:[m("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),n(j,{facetValues:r.facetValues,columnModel:C==null?void 0:C.columnModels.find(d=>d.name===r.columnName),onChange:d=>{Oe(v(),r,s,d)},onClear:()=>{se(v(),r,s)},containerAs:"Dropdown",dropdownType:"SelectBox"}),n(vt,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:n(Rt,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),n(b,{})]}),m("div",{className:`FacetNavPanel__body${a?"--expanded":""}`,children:[n(Et.SizeMe,{monitorHeight:!0,children:({size:d})=>{var T;return n("div",{className:Gt(a,c),children:n(Ut,{layout:Wt,data:(T=g==null?void 0:g.data)!=null?T:[],style:Kt(d.width,c,a?300:150),config:{displayModeBar:!1},onClick:O=>$t(O,r,l)},`${r.columnName}-${c}-${d.width}`)})}}),n(ye,{labels:g==null?void 0:g.labels,colors:g==null?void 0:g.colors,isExpanded:a})]})]})]})};try{ye.displayName="FacetPlotLegend",ye.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"]={docgenInfo:ye.__docgenInfo,name:"FacetPlotLegend",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"})}catch{}try{te.displayName="FacetNavPanel",te.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"]={docgenInfo:te.__docgenInfo,name:"FacetNavPanel",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"})}catch{}const jt=()=>{try{return JSON.parse(sessionStorage.getItem(at)||"")}catch{return[]}},Jt=()=>{try{return JSON.parse(sessionStorage.getItem(rt)||"")}catch{return[]}},Zt=()=>{try{return JSON.parse(sessionStorage.getItem(st)||"")}catch{return[]}},ne=e=>{const{getColumnDisplayName:t}=$();let a,s="";if("facetWithSelection"in e){const{facetWithSelection:o}=e;o.facet.facetType==="enumeration"?a=o.displayValue===ae?_e:o.displayValue:a=`${o.facet.selectedMin} 
        - ${o.facet.selectedMax}`,s=`${t(o.facet.columnName)}: ${a}`}else if("filter"in e){const{filter:o}=e;let r=o.value;(r==null?void 0:r.startsWith("%"))&&(r==null?void 0:r.endsWith("%"))&&(r=r.substring(1,r.length-1)),a=r,s=`Text matches: "${r}"`,o.columnName&&(a=`"${r}" in ${t(o==null?void 0:o.columnName)}`,s=`${t(o==null?void 0:o.columnName)}: ${r}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const l=encodeURIComponent(s);return n(re,{idForToolTip:`selectionCriteria_${l}`,tooltipText:s,callbackFn:()=>{},children:m("div",{className:"SelectionCriteriaPill",children:[n("span",{children:a}),n("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:n(bt,{})})]},`SelectionCriteriaPill ${l}`)})};try{ne.displayName="SelectionCriteriaPill",ne.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:ne.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const he=({style:e,frontText:t,endText:a="",hideIfUnfiltered:s=!1})=>{var q;const{data:l,isLoadingNewBundle:o,getLastQueryRequest:r,executeQueryRequest:c,getInitQueryRequest:f,error:u}=J(),{topLevelControlsState:C,unitDescription:I}=$(),v=l==null?void 0:l.queryCount,[A,g]=F.exports.useState([]),w=h=>{const S=H(r());S.query.selectedFacets=h,S.query.offset=0,c(S)},y=h=>h.filter(R=>R.facetType==="enumeration").filter(R=>R.facetValues.filter(L=>L.isSelected===!0).length>0),N=h=>h.filter(R=>R.facetType==="range").filter(R=>R.selectedMax||R.selectedMin),i=(h,S)=>{var R;const E=h.find(L=>L.id===S);return(R=E==null?void 0:E.name)!=null?R:S},p=(h,S)=>{const E=h.find(R=>R.id===S);return(E==null?void 0:E.name)||S},b=(h,S)=>{const E=h.find(R=>R.ownerId===S);return(E==null?void 0:E.userName)||S},d=F.exports.useCallback((h,S)=>{const E=jt(),R=Jt(),L=Zt(),_=[];return h.forEach(D=>{const Y=S.find(U=>U.name===D.columnName);D.facetValues.forEach(U=>{if(U.isSelected){let K=U.value;switch(Y==null?void 0:Y.columnType){case k.ENTITYID:case k.ENTITYID_LIST:K=i(E,U.value);break;case k.USERID:case k.USERID_LIST:K=b(R,U.value);break;case k.EVALUATIONID:K=p(L,U.value);break;default:K=U.value;break}_.push({facet:D,displayValue:K,selectedValue:U})}})}),_},[]);F.exports.useEffect(()=>{if(l){const h=N(l.facets),S=y(l.facets),E=h.map(L=>({facet:L})),R=d(S,l.columnModels);g([...E,...R])}},[l,d]);const T=h=>{const{facet:S,selectedValue:E}=h;S.facetType==="enumeration"?se(r(),S,w,E==null?void 0:E.value,!1):He(r(),S,w,[we.ANY,we.ANY])},O=(h,S)=>{var R;const E=H(r());!E.query.additionalFilters||(E.query.additionalFilters=(R=E.query.additionalFilters)==null?void 0:R.reduce(function(L,_){if(Ce(_)||Se(_)){const D={columnName:_.columnName,values:_.columnName===h?_.values.filter(Y=>Y!==S):_.values,operator:Ce(_)?_.operator:void 0,function:Se(_)?_.function:void 0,concreteType:_.concreteType};D.values.length>0&&L.push(D)}else L.push(_);return L},[]),c(E))},P=h=>{const S=H(r());!S.query.additionalFilters||(S.query.additionalFilters=S.query.additionalFilters.filter(E=>!(Le(E)&&E.searchExpression===h.searchExpression)),c(S))},z=()=>{const h=H(f());h.query.additionalFilters=[],c(h)},x=(q=r().query.additionalFilters)==null?void 0:q.reduce((h,S)=>{if(Le(S))h.push({key:`fulltextsearch-${S.searchExpression}`,filter:{value:S.searchExpression},onRemove:()=>P(S)});else if(Ce(S)||Se(S)){const{columnName:E}=S;S.values.forEach(R=>{h.push({key:`columnsearch-${R}`,filter:{columnName:E,value:R},onRemove:()=>O(S.columnName,R)})})}else console.warn("Encountered unexpected QueryFilter: ",S);return h},[]),Q=C==null?void 0:C.showFacetFilter,V=A.length>0||x&&x.length>0;return u?n(B,{}):n("div",{className:`TotalQueryResults ${Q?Ve:Qe} ${V?"hasFilters":""}`,style:e,children:o?n(X,{width:100}):m(B,{children:[(V||!s)&&m("div",{className:"TotalQueryResults__topbar",children:[m("span",{className:"SRC-boldText",children:[t," ",v==null?void 0:v.toLocaleString()," ",I," ",a]}),(A.length>0||x&&x.length>2)&&m("a",{onClick:z,className:"TotalQueryResults__topbar__clearall",children:[n(Z,{options:{icon:"deleteSweep"}}),"Clear all filters"]})]}),m("div",{className:"TotalQueryResults__selections",children:[x&&x.map(h=>F.exports.createElement(ne,{...h,key:h.key})),A.map((h,S)=>{var E,R,L;return n(ne,{facetWithSelection:h,onRemove:()=>T(h)},`facets-${(L=(R=(E=h.selectedValue)==null?void 0:E.value)!=null?R:h.displayValue)!=null?L:S}`)})]})]})})};try{he.displayName="TotalQueryResults",he.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:{value:"false"},description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:he.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}const Re=2;function be(e,t){var s,l;return(l=(s=e==null?void 0:e.facets)==null?void 0:s.filter(o=>o.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(o.columnName)>-1)&&o.facetValues.length>0&&!De(o)))!=null?l:[]}const Ie=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:a,isLoadingNewBundle:s,executeQueryRequest:l,error:o,asyncJobStatus:r}=J(),{topLevelControlsState:c}=$(),[f,u]=F.exports.useState([]),[C,I]=F.exports.useState(!0),{showFacetVisualization:v,showFacetFilter:A}=c,g=a();F.exports.useEffect(()=>{const x=be(t,e);x.length!==0&&C&&(u(x.map((Q,V)=>({name:Q.columnName,isHidden:V>=Re,plotType:"PIE"}))),I(!1))},[t,C,e]);const w=x=>{u(Q=>Q.map((V,q)=>x?{...V,isHidden:!1}:{...V,isHidden:q>=Re}))},y=x=>{g.query.selectedFacets=x,g.query.offset=0,l(g)},N=x=>f.find(q=>q.name===x&&q.isHidden===!0)!==void 0,i=F.exports.useMemo(()=>f.find(x=>x.isHidden===!0)?"MORE":f.length<=Re?"NONE":"LESS",[f]),p=x=>{T(x,"isHidden",!0)},b=(x,Q)=>{T(x,"plotType",Q)},d=x=>{var V;const Q=(V=f.find(q=>q.name===x))==null?void 0:V.plotType;return Q!=null?Q:"PIE"},T=(x,Q,V)=>{u(q=>q.map(h=>h.name===x?{...h,[Q]:V}:h))},O=be(t,e),P=be(t,e).map((x,Q)=>({columnName:x.columnName,colorIndex:Q})),z=(g==null?void 0:g.query.selectedFacets)!==void 0&&g.query.selectedFacets.length>0||(g==null?void 0:g.query.additionalFilters)!==void 0&&(g==null?void 0:g.query.additionalFilters.length)>0;return o?n(B,{}):!t&&s?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(r==null?void 0:r.progressMessage)&&m("div",{children:[n("span",{className:"spinner"}),r.progressMessage]})}):m(B,{children:[n(he,{frontText:"",endText:z?"filtered by":"",hideIfUnfiltered:!0}),O.length>0&&m("div",{className:`FacetNav ${v?"":"hidden"} ${A?Ve:Qe} ${i==="LESS"?"less":""}`,children:[n("div",{className:"FacetNav__row",role:"list",children:O.map(x=>{var Q;return n("div",{className:"col-sm-12 col-md-4",style:{display:N(x.columnName)?"none":"block"},children:n(te,{index:(Q=P.find(V=>V.columnName===x.columnName))==null?void 0:Q.colorIndex,onHide:()=>p(x.columnName),plotType:d(x.columnName),onSetPlotType:V=>b(x.columnName,V),facetToPlot:x,applyChangesToFacetFilter:y,applyChangesToGraphSlice:(V,q,h)=>se(g,V,y,q==null?void 0:q.value,h),isModalView:!1})},x.columnName)})}),i!=="NONE"&&n("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:n(Me,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>w(i==="MORE"),style:{zIndex:500},children:i==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Ie.displayName="FacetNav",Ie.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"]={docgenInfo:Ie.__docgenInfo,name:"FacetNav",path:"src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"})}catch{}export{j as E,ve as F,de as I,ie as N,Ve as Q,X as S,he as T,Qe as a,$ as b,Vt as c,le as d,bn as e,Oe as f,se as g,Ne as h,Fe as i,xe as j,Te as k,Ie as l,Ee as m,In as n,be as o,Ht as p,Kt as q,ye as r,ue as s,J as u};

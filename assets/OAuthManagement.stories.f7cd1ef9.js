import{r as l,a as n,j as e,F as fe}from"./jsx-runtime.05444945.js";import{f as ae}from"./DateFormatter.d42d6702.js";import{h as oe}from"./moment.a565bb48.js";import{h as w,cY as ge,M as z,cZ as Ce,c_ as ye,c$ as Se,Y as c,d0 as ve}from"./index.a37d8dd7.js";import{u as $}from"./useMutation.44e72348.js";import{u as be}from"./useInfiniteQuery.f58a924e.js";import{d as _}from"./ToastMessage.1a804d30.js";import{T as F}from"./Typography.9965ffbe.js";import{H as ie,I as j}from"./IconSvg.abab09ee.js";import{W as le}from"./WarningModal.50db9ae9.js";import{T as se}from"./Tooltip.e02d1bf4.js";import{M as m}from"./Modal.45a88cca.js";import{R as P}from"./Row.c2594da8.js";import{C as S}from"./isArray.fbf85b3b.js";import{B as C}from"./Button.0b1296fc.js";import{A as Ae}from"./Alert.1016cb8e.js";import{C as Oe}from"./CopyToClipboardInput.e979d595.js";import{T as _e}from"./Table.1b07c258.js";import"./iframe.ff4ba921.js";import"./index.849f5f8d.js";import"./withStyles.2a0b3149.js";import"./objectWithoutPropertiesLoose.5e7699d1.js";import"./toConsumableArray.c4898ee4.js";import"./getEndpoint.bb7ded34.js";import"./SvgIcon.44b5863d.js";import"./index.57d09176.js";import"./FullWidthAlert.27fd0db2.js";import"./createSvgIcon.49bfc951.js";import"./Transition.4ed8243e.js";import"./removeClass.27874bcb.js";import"./hasClass.56fd144a.js";import"./uniqueId.24a4cbf4.js";import"./isSymbol.bfa8ae0b.js";import"./makeStyles.29b4f0d4.js";import"./InfoOutlined.f00577f5.js";import"./slicedToArray.e72f11da.js";import"./useTheme.48f15230.js";import"./useWaitForDOMRef.c50253c8.js";import"./useWillUnmount.8489e947.js";import"./index.35ce73ec.js";import"./IconCopy.1dead822.js";const G={all:o=>["oAuthClient",o]};function we(o){const{accessToken:d}=w();return be(G.all(d),async s=>await ge(d,s.pageParam),{...o,getNextPageParam:s=>s.nextPageToken})}function Te(o){const d=z(),{accessToken:s}=w();return $(t=>Ce(t,s),{...o,onSuccess:async(t,p,f)=>{await d.invalidateQueries(G.all(s)),o!=null&&o.onSuccess&&await o.onSuccess(t,p,f)}})}function xe(o){const d=z(),{accessToken:s}=w();return $(t=>ye(t,s),{...o,onSuccess:async(t,p,f)=>{await d.invalidateQueries(G.all(s)),o!=null&&o.onSuccess&&await o.onSuccess(t,p,f)}})}function Me(o){const d=z(),{accessToken:s}=w();return $(t=>Se(t,s),{...o,onSuccess:async(t,p,f)=>{await d.invalidateQueries(G.all(s)),o!=null&&o.onSuccess&&await o.onSuccess(t,p,f)}})}const Y=({isShowingModal:o=!1,isEdit:d,onClose:s,client:t,setIsShowingConfirmModal:p,isShowingConfirmModal:f,setIsShowingModal:b})=>{const{accessToken:Q}=w(),[R,T]=l.exports.useState(""),[i,v]=l.exports.useState([{uri:""}]),[x,A]=l.exports.useState(),[M,I]=l.exports.useState(),[g,y]=l.exports.useState(),[B,k]=l.exports.useState(),[W,L]=l.exports.useState(!1),[K,q]=l.exports.useState(!1),[D,u]=l.exports.useState(),[H,O]=l.exports.useState(),ce="Are you absolutely sure?",de="Editing this detail will render your client invalid and will require you to resubmit verification. This action cannot be undone.",Z="Click Add URI to add more Redirect URIs";l.exports.useEffect(()=>{var r,a,h,V,N,ne;T((r=t==null?void 0:t.client_name)!=null?r:""),v((a=t==null?void 0:t.redirect_uris.map(pe=>({uri:pe})))!=null?a:[{uri:""}]),A((h=t==null?void 0:t.policy_uri)!=null?h:""),I((V=t==null?void 0:t.client_uri)!=null?V:""),y((N=t==null?void 0:t.sector_identifier_uri)!=null?N:void 0),k((ne=t==null?void 0:t.tos_uri)!=null?ne:"")},[o]),l.exports.useEffect(()=>{const r=i==null?void 0:i.map(h=>h.uri),a=t==null?void 0:t.redirect_uris;t&&((r==null?void 0:r.length)!==(a==null?void 0:a.length)||!(r!=null&&r.every(h=>a==null?void 0:a.includes(h)))||g!=(t==null?void 0:t.sector_identifier_uri))?L(!0):L(!1)},[i,g]);const U=()=>{T(""),v([{uri:""}]),A(""),I(""),y(""),k(""),s()},J=()=>{p(!1),q(!1)},{mutate:ue}=Me({onSuccess:()=>{_("Successfully created","success"),O(void 0)},onError:r=>{O(r)}}),{mutate:X}=xe({onSuccess:()=>{_("Successfully saved","success"),O(void 0)},onError:r=>{O(r),b(!0)}}),{mutate:he}=Te({onSuccess:()=>{_("Successfully deleted","success"),s()},onError:r=>{_(r.reason,"danger")}}),me=async()=>{var r;try{if(Q){const a={client_id:t==null?void 0:t.client_id,client_name:R,redirect_uris:(r=i==null?void 0:i.map(h=>h.uri))!=null?r:[""],policy_uri:x,client_uri:M,sector_identifier_uri:g!=null?g:"",tos_uri:B,etag:t==null?void 0:t.etag};u(a),W===!0?p(!0):d?await X(a):await ue(a)}U()}catch(a){_(a.reason,"danger")}},ee=()=>{i&&v([...i,{uri:""}])},te=r=>{if(i){const a=[...i];a.splice(r,1),v(a)}},re=(r,a)=>{if(i){const{name:h,value:V}=r.target,N=[...i];N[a][h]=V,v(N)}};return n("div",{className:"bootstrap-4-backport",children:[n(m,{show:o,animation:!1,backdrop:"static",onHide:()=>{U(),O(void 0)},size:"lg",className:"OAuthDialog bootstrap-4-backport",children:[e(m.Header,{closeButton:!0,children:e(m.Title,{children:d?"Client Details":"Create New OAuth Client"})}),n(m.Body,{children:[e(F,{variant:"body1",children:"To protect you and your users, your consent screen and application will need to be verified by Sage Bionetworks. Before your consent screen and application are verified by Sage Bionetworks, you can still test your application with limitations."}),d&&n(F,{style:{marginTop:"16px"},variant:"label",children:["Client ID: ",t==null?void 0:t.client_id]}),n(P,{children:[e(S,{lg:6,md:6,sm:12,xs:12,children:n(c.Group,{className:"required",children:[e(c.Label,{htmlFor:"clientName",children:"Client Name"}),e(c.Control,{required:!0,onChange:r=>T(r.target.value),placeholder:"Client Name",type:"text",value:R,id:"clientName"})]})}),n(S,{lg:6,md:6,sm:12,xs:12,children:[e(c.Label,{className:"required",htmlFor:"clientUri",children:"Client Homepage"}),e(c.Control,{onChange:r=>I(r.target.value),placeholder:"https://",type:"text",value:M,id:"clientUri"})]})]}),e(P,{children:!d&&n(fe,{children:[e(S,{lg:6,md:6,sm:12,xs:12,children:n(c.Group,{className:"required",children:[e(c.Label,{htmlFor:"redirect-uri-0",children:"Redirect URI(s)"}),e(se,{title:Z,placement:"top",children:e(ie,{className:"HelpButton"})}),i==null?void 0:i.map((r,a)=>n("div",{children:[e(c.Control,{name:"uri",required:!0,id:`redirect-uri-${a}`,onChange:h=>re(h,a),value:r.uri,placeholder:"https://",type:"text"}),i.length>1&&e("button",{onClick:()=>te(a),children:e(j,{options:{icon:"delete",color:"#f44336"}})}),i.length-1===a&&e(C,{onClick:ee,disabled:r.uri.length===0,children:"Add URI"})]},a))]})}),n(S,{lg:6,md:6,sm:12,xs:12,children:[e(c.Label,{children:"Sector Identifier URI"}),e(c.Control,{onChange:r=>y(r.target.value),placeholder:"https://",type:"text"})]})]})}),n(P,{children:[n(S,{lg:6,md:6,sm:12,xs:12,children:[e(c.Label,{children:"Link to Privacy Policy"}),e(c.Control,{onChange:r=>A(r.target.value),placeholder:"https://",type:"text",value:x})]}),n(S,{lg:6,md:6,sm:12,xs:12,children:[e(c.Label,{children:"Links to Terms of Service"}),e(c.Control,{onChange:r=>k(r.target.value),placeholder:"https://",type:"text",value:B})]})]}),d&&n("div",{className:"danger",children:[e(F,{style:{marginTop:"8px"},color:"error",variant:"headline3",children:"DANGER ZONE"}),e(F,{variant:"smallText1",children:"Editing the following information will render your client invalid and will require you to create it again and resubmit verification if needed."}),n(P,{children:[n(S,{lg:6,md:6,sm:12,xs:12,children:[e(c.Label,{htmlFor:"redirect-uri-0",children:"Redirect URI(s)"}),e(se,{title:Z,placement:"top",children:e(ie,{className:"HelpButton"})}),i==null?void 0:i.map((r,a)=>n("div",{children:[e(c.Control,{id:`redirect-uri-${a}`,required:!0,name:"uri",onChange:h=>re(h,a),value:r.uri,placeholder:"https://",type:"text"}),i.length>1&&e("button",{onClick:()=>te(a),children:e(j,{options:{icon:"delete",color:"#f44336"}})}),i.length-1===a&&e(C,{onClick:ee,disabled:r.uri.length===0,children:"Add Uri"})]},a))]}),n(S,{lg:6,md:6,sm:12,xs:12,children:[e(c.Label,{children:"Sector Identifier URI"}),e(c.Control,{onChange:r=>y(r.target.value),placeholder:"https://",type:"text",value:g})]})]}),n("button",{className:"delete-button",onClick:()=>{q(!0),p(!0),U()},children:[e(j,{options:{icon:"delete",color:"#f44336"}}),"DELETE CLIENT"]})]})]}),H&&e(Ae,{variant:"danger",children:H==null?void 0:H.reason}),n(m.Footer,{children:[e(C,{variant:"default",onClick:()=>{U(),O(void 0)},children:"CANCEL"}),e(C,{variant:"primary",onClick:me,children:"Save"})]})]}),e(le,{show:f,title:ce,modalBody:de,onCancel:J,onConfirm:()=>{K?he(t==null?void 0:t.client_id):X(D),J()},confirmButtonVariant:"danger",confirmButtonText:"Yes, Continue"})]})};try{Y.displayName="CreateOAuthModal",Y.__docgenInfo={description:"",displayName:"CreateOAuthModal",props:{isShowingModal:{defaultValue:{value:"false"},description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},isEdit:{defaultValue:null,description:"",name:"isEdit",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},setIsShowingConfirmModal:{defaultValue:null,description:"",name:"setIsShowingConfirmModal",required:!0,type:{name:"(a: boolean) => void"}},isShowingConfirmModal:{defaultValue:null,description:"",name:"isShowingConfirmModal",required:!0,type:{name:"boolean"}},client:{defaultValue:null,description:"",name:"client",required:!1,type:{name:"OAuthClient"}},setIsShowingModal:{defaultValue:null,description:"",name:"setIsShowingModal",required:!0,type:{name:"(a: boolean) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/oauth/CreateOAuthClient.tsx#CreateOAuthModal"]={docgenInfo:Y.__docgenInfo,name:"CreateOAuthModal",path:"src/lib/containers/oauth/CreateOAuthClient.tsx#CreateOAuthModal"})}catch{}const E=()=>{var D;const{accessToken:o}=w(),[d,s]=l.exports.useState(!1),[t,p]=l.exports.useState(!1),[f,b]=l.exports.useState(),[Q,R]=l.exports.useState(!1),[T,i]=l.exports.useState(!1),[v,x]=l.exports.useState(!1),[A,M]=l.exports.useState(),[I,g]=l.exports.useState(!1),{data:y,hasNextPage:B,fetchNextPage:k}=we(),W=(D=y==null?void 0:y.pages.flatMap(u=>u.results))!=null?D:[],L="Are you absolutely sure?",K="If you have an existing secret, generating a new secret will make your application invalid after generation. This action cannot be undone.",q=async()=>{i(!1);try{const u=await ve(o,f==null?void 0:f.client_id);b(void 0),x(!0),M(u.client_secret)}catch(u){_(u.reason,"danger")}};return n("div",{className:"bootstrap-4-backport OAuthEditor",children:[e(C,{onClick:()=>{s(!0),p(!1)},style:{float:"right"},children:"Create New Client"}),n(_e,{striped:!0,children:[e("thead",{children:n("tr",{children:[e("th",{children:"Created"}),e("th",{children:"Modified"}),e("th",{children:"ID"}),e("th",{children:"Client"}),e("th",{children:"Verified"}),e("th",{children:"App Secret"}),e("th",{children:"Actions"})]})}),e("tbody",{children:W.map(u=>n("tr",{children:[e("td",{children:ae(oe(u.createdOn))}),e("td",{children:ae(oe(u.modifiedOn))}),e("td",{children:u.client_id}),e("td",{children:u.client_name}),e("td",{children:u.verified?"Yes":e(C,{variant:"outline",size:"sm",onClick:()=>g(!0),children:"SUBMIT VERIFICATION"})}),e("td",{children:e(C,{variant:"outline",onClick:()=>{b(u),i(!0)},size:"sm",children:"GENERATE SECRET"})}),e("td",{children:e(C,{variant:"outline",onClick:()=>{b(u),p(!0),s(!0)},size:"sm",children:"EDIT"})})]},u.client_id))})]}),B&&e("div",{className:"text-center",children:e(C,{variant:"primary",onClick:()=>k(),children:"Load more"})}),e(Y,{onClose:()=>{s(!1)},isShowingModal:d,client:t?f:void 0,isEdit:t,setIsShowingConfirmModal:R,isShowingConfirmModal:Q,setIsShowingModal:s}),n(m,{show:I,animation:!1,backdrop:"static",className:"bootstrap-4-backport",onHide:()=>g(!1),children:[e(m.Header,{closeButton:!0,children:e(m.Title,{children:"Submit Verification"})}),n(m.Body,{children:[n("p",{children:["In order to verify an OAuth client please submit a request to the"," ",e("a",{target:"_blank",rel:"noopener noreferrer",href:"https://sagebionetworks.jira.com/servicedesk/customer/portal/9",children:"Synapse Service Desk."})]}),e("b",{children:"Please list the following items in your request:"}),n("ul",{children:[e("li",{children:"Your name"}),n("li",{children:["The ID of the client to be verified ",e("br",{})]}),e("li",{children:"A description of your application"})]})]}),e(m.Footer,{})]}),e(le,{show:T,className:"bootstrap-4-backport",title:L,modalBody:K,onCancel:()=>{i(!1),b(void 0)},onConfirm:q,confirmButtonVariant:"danger",confirmButtonText:"Yes, Continue"}),A&&n(m,{show:v,animation:!1,backdrop:"static",className:"bootstrap-4-backport",onHide:()=>{x(!1),M(void 0)},children:[e(m.Header,{closeButton:!0,children:e(m.Title,{children:"App Secret"})}),n(m.Body,{children:[n("p",{children:[e("b",{children:"This secret will not be able to be retrieved again."})," If needed, in order to generate a new secret select Generate from the Client List."]}),e(Oe,{value:A,inputWidth:"350px"})]})]})]})};try{E.displayName="OAuthManagement",E.__docgenInfo={description:"",displayName:"OAuthManagement",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/oauth/OAuthManagement.tsx#OAuthManagement"]={docgenInfo:E.__docgenInfo,name:"OAuthManagement",path:"src/lib/containers/oauth/OAuthManagement.tsx#OAuthManagement"})}catch{}const yt={parameters:{storySource:{source:`import React from 'react'
import { ComponentStory, ComponentMeta } from '@storybook/react'

import { OAuthManagement } from './OAuthManagement'

export default {
  title: 'Synapse/OAuthManagement',
  component: OAuthManagement,
  argTypes: {},
} as ComponentMeta<typeof OAuthManagement>

const Template: ComponentStory<typeof OAuthManagement> = args => (
  <OAuthManagement {...args} />
)

export const OAuthManagementDemo = Template.bind({})
OAuthManagementDemo.args = {}
`,locationsMap:{"o-auth-management-demo":{startLoc:{col:57,line:12},endLoc:{col:1,line:14},startBody:{col:57,line:12},endBody:{col:1,line:14}}}}},title:"Synapse/OAuthManagement",component:E,argTypes:{}},Ie=o=>e(E,{...o}),ke=Ie.bind({});ke.args={};const St=["OAuthManagementDemo"];export{ke as OAuthManagementDemo,St as __namedExportsOrder,yt as default};

import{h as i,bS as B,k as C,bT as R,bU as L,bV as k,R as d,bW as O,bX as U,bY as v,bZ as w,b_ as M,b$ as F}from"./index.95357afa.js";import{u as l}from"./useMutation.75197862.js";import{D as q}from"./EntityChildren.50133102.js";import{r as T,a as h,j as m}from"./jsx-runtime.41b63a18.js";import{u as p}from"./useInfiniteQuery.afb80f09.js";import{g as N}from"./DiscussionSearchResult.9974aa74.js";import{M as x}from"./MarkdownEditor.9ee45263.js";import{B as E}from"./Button.d66b1296.js";function re(e,r,s,n,t,a){const{accessToken:c}=i();return p(["forumthread","infinite",e,r,t,s,n],async u=>B(c,e,u.pageParam,r,s,n,t),{...a,getNextPageParam:(u,o)=>{if(u.results.length>0)return o.length*r}})}function te(e){const{data:r,isLoading:s}=P(e),{data:n,isLoading:t}=Q(r,{enabled:!!r});return{threadData:r,threadBody:n,isLoading:t||s}}function P(e,r){const{accessToken:s}=i();return C(["thread",e,s],()=>R(e,s),r)}function Q(e,r){var t;const{accessToken:s}=i(),n=L((t=e==null?void 0:e.messageKey)!=null?t:"",s);return C(["thread",e==null?void 0:e.id,e==null?void 0:e.messageKey,s],async()=>N((await n).messageUrl),r)}function D(e){const r=d(),{accessToken:s}=i();return l(n=>O(s,n),{...e,onSuccess:async(n,t,a)=>{await r.invalidateQueries(["thread",t.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(n,t,a)}})}function G(e){const r=d(),{accessToken:s}=i();return l(n=>U(s,n),{...e,onSuccess:async(n,t,a)=>{await r.invalidateQueries(["thread",t.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(n,t,a)}})}function J(e){const r=d(),{accessToken:s}=i();return l(n=>v(s,n),{...e,onSuccess:async(n,t,a)=>{await r.invalidateQueries(["forumthread"]),e!=null&&e.onSuccess&&await e.onSuccess(n,t,a)}})}function ae(e,r,s,n,t,a){const{accessToken:c}=i();return p(["forumthread","infinite",e,s,t,n,r],async u=>k(c,e,s,u.pageParam,n,r,t),{...a,getNextPageParam:(u,o)=>{if(u.results.length>0)return o.length*s}})}var V=(e=>(e.FORUM="FORUM",e.THREAD="THREAD",e.DATA_ACCESS_SUBMISSION="DATA_ACCESS_SUBMISSION",e.DATA_ACCESS_SUBMISSION_STATUS="DATA_ACCESS_SUBMISSION_STATUS",e))(V||{}),I=(e=>(e.SUBSCRIPTION_ID="SUBSCRIPTION_ID",e.SUBSCRIBER_ID="SUBSCRIBER_ID",e.OBJECT_ID="OBJECT_ID",e.OBJECT_TYPE="OBJECT_TYPE",e.CREATED_ON="CREATED_ON",e))(I||{});function Y(e,r,s){const{accessToken:n}=i();return C([n,"subscription",e,r],async()=>{const a={objectType:r,idList:[e],sortByType:I.OBJECT_ID,sortDirection:q.ASC};return(await F(n,a)).results[0]},s)}function K(e){const r=d(),{accessToken:s}=i();return l(n=>w(s,n),{...e,onSuccess:async(n,t,a)=>{await r.invalidateQueries([s,"subscription"]),e!=null&&e.onSuccess&&await e.onSuccess(n,t,a)}})}function H(e){const r=d(),{accessToken:s}=i();return l(n=>M(s,n),{...e,onSuccess:async(n,t,a)=>{await r.invalidateQueries([s,"subscription"]),e!=null&&e.onSuccess&&await e.onSuccess(n,t,a)}})}const ue=(e,r)=>{const{data:s,isLoading:n}=Y(e,r),{mutate:t,isLoading:a}=K(),{mutate:c,isLoading:u}=H(),o=n||a||u,g=T.exports.useCallback(()=>{s?c(s.subscriptionId):t({objectId:e,objectType:r})},[c,e,r,t,s]);return{isLoading:o,subscription:s,toggleSubscribed:g}},f=({initialText:e,initialTitle:r,id:s,onClose:n})=>{const[t,a]=T.exports.useState(r!=null?r:""),[c,u]=T.exports.useState(e!=null?e:""),{mutate:o}=D(),{mutate:g}=G(),{mutate:y}=J(),A=(S,_)=>{r?(o({title:_,threadId:s}),g({messageMarkdown:S,threadId:s})):y({forumId:s,title:_,messageMarkdown:S})},b=()=>{A(c,t),n()};return h("div",{className:"bootstrap-4-backport",children:[m("input",{placeholder:"Title",type:"text",style:{width:"100%",padding:"4px"},value:t,onChange:S=>a(S.target.value)}),m(x,{text:c,setText:u}),h("div",{style:{float:"right"},children:[m(E,{onClick:n,variant:"light",children:"Cancel"}),m(E,{onClick:()=>b(),variant:"primary",children:"Save"})]})]})};try{f.displayName="ForumThreadEditor",f.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"]={docgenInfo:f.__docgenInfo,name:"ForumThreadEditor",path:"src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"})}catch{}export{f as F,V as S,ue as a,ae as b,re as c,te as u};

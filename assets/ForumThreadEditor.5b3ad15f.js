import{r as y,j as o,F as N,a as M}from"./jsx-runtime.31268528.js";import{V as i,ci as P,ao as S,cj as V,ck as K,X as U,cl as $,cm as B,cn as j,co as W,cp as G,cq as Y,cr as H,cs as z,ct as X,cu as J,cv as Z,aA as D}from"./index.22d2125e.js";import{u as g}from"./useMutation.9a2bc2f1.js";import{u as ee}from"./useInfiniteQuery.c6eed216.js";import{I as O}from"./IconSvg.1a319e23.js";import{a as ae}from"./CardContainerLogic.a44526c0.js";import{U as te}from"./UserSearchBoxV2.73f03814.js";import{M as R}from"./Modal.befa9583.js";import{s as se}from"./startCase.d7fe3e9e.js";import{b as ne}from"./isArray.e45ce668.js";import{B as F}from"./Button.3eb9449f.js";function Re(e,t,s,a,n,r){const{accessToken:m}=i();return ee(["reply",e,s,n,a,t],async d=>P(m,e,s,d.pageParam,a,t,n),{...r,getNextPageParam:(d,p)=>{const l=p.flatMap(C=>C.results).length;if(d.totalNumberOfResults>l)return l}})}function be(e,t){const{accessToken:s}=i(),a=async()=>{const n=await B(e.messageKey,s);return(await fetch(n.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return U(["reply",e.threadId,e.id,e.messageKey],a,t)}function re(e){const t=S(),{accessToken:s}=i();return g(a=>V(a,s),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["reply",a.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function ce(e){const t=S(),{accessToken:s}=i();return g(a=>K(a,s),{...e,onSuccess:async(a,n,r)=>{t.invalidateQueries(["reply",a.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function Ie(e){const t=S(),{accessToken:s}=i();return g(a=>$(s,a.replyId),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["reply",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function ve(e){const{data:t,isLoading:s}=oe(e),{data:a,isLoading:n}=ie(t,{enabled:!!t}),{mutate:r}=fe(),{mutate:m}=me(),d=y.exports.useCallback(()=>{t&&(t!=null&&t.isPinned?m(t):r(t))},[m,r,t]);return{threadData:t,threadBody:a,togglePin:d,isLoading:n||s}}function oe(e,t){const{accessToken:s}=i();return U(["thread",e,s],()=>j(e,s),t)}function ie(e,t){const{accessToken:s}=i(),a=async()=>{const n=await Z(e.messageKey,s);return(await fetch(n.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return U(["thread",e==null?void 0:e.id,e==null?void 0:e.messageKey,s],a,t)}function ue(e){const t=S(),{accessToken:s}=i();return g(a=>W(s,a),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",a.forumId]),await t.invalidateQueries(["thread",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function de(e){const t=S(),{accessToken:s}=i();return g(a=>G(s,a),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["thread",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function le(e){const t=S(),{accessToken:s}=i();return g(a=>Y(s,a),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",a.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function qe(e){const t=S(),{accessToken:s}=i();return g(a=>H(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",n.forumId]),await t.invalidateQueries(["thread",n.id]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function Le(e){const t=S(),{accessToken:s}=i();return g(a=>z(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",n.forumId]),await t.invalidateQueries(["thread",n.id]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function fe(e){const t=S(),{accessToken:s}=i();return g(a=>X(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["thread",n.id]),await t.invalidateQueries(["forumthread",n.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function me(e){const t=S(),{accessToken:s}=i();return g(a=>J(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["thread",n.id]),await t.invalidateQueries(["forumthread",n.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}const ye=["title","bold","italic","strikethrough","code","latex","subscript","superscript","link","image"],Q={title:{openSyntax:"###",closeSyntax:""},bold:{openSyntax:"**",closeSyntax:"**"},italic:{openSyntax:"_",closeSyntax:"_"},strikethrough:{openSyntax:"--",closeSyntax:"--"},code:{openSyntax:"```",closeSyntax:"```"},latex:{openSyntax:"$$\\(",closeSyntax:"\\)$$"},subscript:{openSyntax:"~",closeSyntax:"~"},superscript:{openSyntax:"^",closeSyntax:"^"},link:{openSyntax:"[",closeSyntax:"](url)"},image:{openSyntax:"![",closeSyntax:"](image-url)"}},b=({show:e,onClose:t,handleUserTag:s})=>{const a=y.exports.useCallback((n,r)=>{n&&r&&s(r.userName),t()},[t,s]);return o(N,{children:M(R,{show:e,onHide:t,backdrop:"static",animation:!1,children:[o(R.Header,{closeButton:!0,children:o(R.Title,{children:"Find User or Team"})}),o(R.Body,{children:o(te,{placeholder:"Search for a user or team name",onChange:a,typeFilter:D.ALL})})]})})};try{b.displayName="UserMentionModal",b.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/markdown/UserMentionModal.tsx#UserMentionModal"]={docgenInfo:b.__docgenInfo,name:"UserMentionModal",path:"src/lib/containers/markdown/UserMentionModal.tsx#UserMentionModal"})}catch{}var A=(e=>(e.WRITE="WRITE",e.PREVIEW="PREVIEW",e))(A||{});const I=({placeholder:e,text:t,setText:s})=>{const[a,n]=y.exports.useState("WRITE"),[r,m]=y.exports.useState(0),[d,p]=y.exports.useState(!1),l=y.exports.useRef(null);y.exports.useEffect(()=>{const c=l.current;c&&c.setSelectionRange(r,r)},[l,r]),y.exports.useEffect(()=>{var c;(c=l.current)==null||c.focus()},[d]);const C=c=>{const u=[],f=l.current;if(f){const T=f==null?void 0:f.selectionStart,k=t.substring(0,T),x=t.substring(T,t.length);m(T+c.length+1),u.push(k,`@${c.replace(/\s/g,"")}`,x)}s(u.join(""))},v=c=>{c.key=="@"&&p(!0)},q=c=>{const u=l.current;if(u){const f=u.selectionStart,T=u.selectionEnd,k=t.substring(f,T),x=t.substring(0,f),E=t.substring(T,t.length),_=Q[c].openSyntax,h=Q[c].closeSyntax;switch(c){case"code":{const w=[];w.push(x,_,k,h,E),s(w.join(`\r
`)),u.focus(),m(f+_.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const w=`${x}${_}${k}${h}${E}`;u.focus(),m(f+_.length),s(w)}}}};return M("div",{className:"bootstrap-4-backport MarkdownEditor",children:[M("div",{className:"MarkdownEditorControls",children:[o("div",{className:"Tabs",children:Object.keys(A).map(c=>o("button",{className:"Tab",role:"tab","aria-selected":c===a,onClick:u=>{u.stopPropagation(),n(A[c])},children:c},c))}),a==="WRITE"&&M("div",{className:"MarkdownEditorControlsToolbar",children:[ye.map(c=>o("button",{onClick:()=>q(c),children:o(O,{icon:c,label:se(c)})},c)),o("button",{onClick:()=>p(!0),children:o(O,{icon:"tag",label:"Mention"})})]})]}),o("div",{children:a==="WRITE"?o("textarea",{onChange:c=>s(c.target.value),style:{width:"100%"},rows:6,value:t,ref:l,placeholder:e,onKeyDown:v}):t?o(ae,{markdown:t}):"Nothing to preview"}),o(b,{show:d,onClose:()=>p(!1),handleUserTag:C})]})};try{I.displayName="MarkdownEditor",I.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/markdown/MarkdownEditor.tsx#MarkdownEditor"]={docgenInfo:I.__docgenInfo,name:"MarkdownEditor",path:"src/lib/containers/markdown/MarkdownEditor.tsx#MarkdownEditor"})}catch{}const L=({initialText:e,initialTitle:t,id:s,onClose:a,isReply:n})=>{const[r,m]=y.exports.useState(t!=null?t:""),[d,p]=y.exports.useState(e!=null?e:""),{mutate:l,isLoading:C}=ue({onSuccess:()=>a()}),{mutate:v,isLoading:q}=de({onSuccess:()=>a()}),{mutate:c,isLoading:u}=le({onSuccess:()=>a()}),{mutate:f,isLoading:T}=re({onSuccess:()=>a()}),{mutate:k,isLoading:x}=ce({onSuccess:()=>a()}),E=q||T||u||C||x,_=(h,w)=>{n?e?k({replyId:s,messageMarkdown:h}):f({threadId:s,messageMarkdown:h}):t?(l({title:w,threadId:s}),v({messageMarkdown:h,threadId:s})):c({forumId:s,title:w,messageMarkdown:h})};return M("div",{className:"bootstrap-4-backport",children:[!n&&o(ne,{type:"text",placeholder:"Title",value:r,onChange:h=>m(h.target.value)}),o(I,{text:d,setText:p}),M("div",{style:{display:"flex",justifyContent:"flex-end"},children:[o(F,{onClick:a,variant:"light",children:"Cancel"}),o(F,{disabled:E,onClick:()=>_(d,r),variant:"primary",children:E?"Saving":"Save"})]})]})};try{L.displayName="ForumThreadEditor",L.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"]={docgenInfo:L.__docgenInfo,name:"ForumThreadEditor",path:"src/lib/containers/discussion_forum/ForumThreadEditor.tsx#ForumThreadEditor"})}catch{}export{L as F,Ie as a,ve as b,qe as c,Le as d,Re as e,be as u};

import{W as G,cw as $,w as R,b4 as Q,cx as I,bh as X,E as D,cy as J,b5 as Z}from"./index.0ee6b688.js";import{l as q}from"./LoadingScreen.56f18e4f.js";import{h as E}from"./moment.53181859.js";import{T as ee}from"./Tooltip.6c95fe7b.js";import{I as O}from"./IconSvg.3d20df6f.js";import{W as oe}from"./WarningModal.db1d2b8d.js";import{a as n,j as e,F as w}from"./jsx-runtime.2e925369.js";import{B as y}from"./Button.c582ea4c.js";import{I as ne}from"./IconCopy.b1eba79c.js";import{T as ae}from"./ToastMessage.f82ed562.js";import{b as V,c as B}from"./toString.8ef640ae.js";import{C as v}from"./Checkbox.60e96e17.js";import{M as S,a as se}from"./Modal.58357e58.js";import"./objectWithoutPropertiesLoose.090b3c10.js";import"./withStyles.8be28b48.js";import"./toConsumableArray.b3669986.js";import"./Alert.eafe86e9.js";import"./index.f252d424.js";import"./Transition.d42a873e.js";import"./index.06f4a415.js";import"./assert.0d607308.js";import"./iframe.565b71a4.js";import"./index.8cde812d.js";import"./getEndpoint.0de7fccf.js";import"./SvgIcon.31249d58.js";import"./Typography.bfdf676e.js";import"./makeStyles.9dfaa099.js";import"./useTheme.8804f8cd.js";import"./createSvgIcon.d78a924b.js";import"./InfoOutlined.22a371fd.js";import"./FullWidthAlert.e7125a09.js";import"./removeClass.27874bcb.js";import"./hasClass.56fd144a.js";import"./uniqueId.fa0dadf5.js";import"./useWaitForDOMRef.c89dbc64.js";import"./useWillUnmount.4a16e5cd.js";function te(o){const{accessToken:i}=R();return G(["getPersonalAccessTokens"],async t=>await $(i,t.pageParam),{...o,getNextPageParam:t=>t.nextPageToken})}const m={openid:{displayName:"OpenID",description:"Access to your Synapse identity and certain user information"},view:{displayName:"View",description:"Permission to view the content which you can view"},modify:{displayName:"Modify",description:"Permission to modify the content which you can modify (create, change, delete)"},download:{displayName:"Download",description:"Permission to download the content which you can download"},authorize:{displayName:"Authorize",description:"Permission to authorize others to access the resources you control"},offline_access:{displayName:"Offline Access",description:"Permission to access the resources authorized here when you are not logged in, until you explicitly revoke access"}},re=window.React.useState,A=({accessToken:o,onDelete:i})=>{const{accessToken:t}=R(),[c,r]=re(!1),s=Q(),l=o.state==="EXPIRED";return n("div",{className:"cardContainer PersonalAccessTokenCard"+(l?" bg-warning":""),children:[e(oe,{title:"Confirm Deletion",modalBody:n(w,{children:[e("p",{children:"If you delete this token, any applications using it will stop working. This action cannot be undone."}),e("p",{className:"SRC-boldText",children:"Are you sure you want to delete this token?"})]}),confirmButtonText:"Delete Token",onCancel:()=>r(!1),onConfirm:a=>{I(a,t).then(()=>{i(),r(!1)}).catch(u=>{s(u)})},confirmButtonVariant:"danger",show:c,onConfirmCallbackArgs:[o.id,t]}),n("div",{className:"SRC-cardContent",children:[n("div",{className:"SRC-eqHeightRow SRC-userCardName",children:[e("span",{className:"SRC-blackText",children:o.name}),l&&e(ee,{title:"This token has expired. It no longer works and can only be deleted.",enterNextDelay:100,children:e("span",{"aria-hidden":"true",children:e(O,{options:{icon:"warning"}})})})]}),n("div",{className:"SRC-eqHeightRow",children:[e("span",{children:"Permissions: "}),o.scopes.map(a=>e("span",{className:"PersonalAccessTokenCard__ScopeName SRC-primary-text-color SRC-primary-color-hover SRC-hand-cursor SRC-inlineFlex","data-tip":m[a].description,children:m[a].displayName},a))]}),n("div",{className:"SRC-eqHeightRow",children:[n("span",{children:["Last used ",E(o.lastUsed).fromNow()]}),e("span",{className:"SRC-deemphasized-text",children:" | "}),n("span",{children:["Created ",E(o.createdOn).fromNow()]})]})]}),e("div",{className:"PersonalAccessTokenCard__DeleteButton",children:e(y,{variant:"default","aria-label":"delete",onClick:()=>{l?I(o.id,t).then(()=>{i()}).catch(a=>{s(a)}):r(!0)},children:e(O,{options:{icon:"delete"},"aria-hidden":"true"})})})]})};try{A.displayName="AccessTokenCard",A.__docgenInfo={description:"",displayName:"AccessTokenCard",props:{accessToken:{defaultValue:null,description:"Record referring to an access token, not a token itself",name:"accessToken",required:!0,type:{name:"AccessTokenRecord"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"(...args: any[]) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/personal_access_token/AccessTokenCard.tsx#AccessTokenCard"]={docgenInfo:A.__docgenInfo,name:"AccessTokenCard",path:"src/lib/containers/personal_access_token/AccessTokenCard.tsx#AccessTokenCard"})}catch{}const L=window.React,N=({value:o,inputWidth:i})=>{const[t,c]=L.useState(!1),r=L.createRef(),s=(l,a)=>u=>{u.preventDefault(),navigator.clipboard.writeText(a).then(()=>{c(!0),setTimeout(()=>{c(!1)},4e3)})};return n(w,{children:[e(ae,{text:"Successfully copied to clipboard",show:t,autohide:!0}),n("div",{className:"SRC-copyToClipboardInputContainer SRC-marginBottomTop",ref:r,children:[e(V,{className:"SRC-copyToClipboardInput",type:"text",style:{width:i},value:o,readOnly:!0,onClick:s(r,o)}),e(y,{className:"SRC-copyToClipboardButton",onClick:s(r,o),children:e(ne,{})})]})]})};try{N.displayName="CopyToClipboardInput",N.__docgenInfo={description:`Component that holds a large string in a readonly <input> to be copied to the user's clipboard when clicked.
This component should only be used when the value to copy is not very long AND the full length of the string
does not necessarily need to be seen by the user. This component was adapted from the email address copy to
clipboard functionality in UserCardMedium. For smaller/inline strings, look at UserCardMedium functionality
for displaying the value in a <p> tag instead of a readonly <input> tag.`,displayName:"CopyToClipboardInput",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},inputWidth:{defaultValue:null,description:"",name:"inputWidth",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/CopyToClipboardInput.tsx#CopyToClipboardInput"]={docgenInfo:N.__docgenInfo,name:"CopyToClipboardInput",path:"src/lib/containers/CopyToClipboardInput.tsx#CopyToClipboardInput"})}catch{}const d=window.React,ce="You must provide a token name and at least one permission.",b=({onClose:o,onCreate:i})=>{const{accessToken:t}=R(),[c,r]=d.useState(""),[s,l]=d.useState(!0),[a,u]=d.useState(!1),[C,f]=d.useState(!1),[_,T]=d.useState(!1),[h,F]=d.useState(!1),[Y,H]=d.useState(""),[K,x]=d.useState(""),[W,M]=d.useState(!1),z=k=>{r(k.target.value)},U=(k,p)=>!!k&&p.some(P=>P),j=async k=>{if(k.preventDefault(),U(c,[s,a,C]))try{const p={scope:[],name:c};s&&p.scope.push("view"),a&&p.scope.push("download"),C&&p.scope.push("modify"),T(!0);const P=await J(p,t);T(!1),H(P.token),F(!0),i()}catch(p){T(!1),x(p.reason),M(!0)}else x(ce),M(!0)};return e(S,{className:"bootstrap-4-backport AccessTokenModal",animation:!1,show:!0,onHide:o,backdrop:"static",children:n(X,{children:[e(S.Header,{closeButton:!0,children:e(S.Title,{children:"Create New Personal Access Token"})}),e(se,{children:_?q:h?n(w,{children:[e("span",{className:"SRC-boldText",children:"This token will not be able to be retrieved again."})," ",e("span",{children:"If needed, generate a new personal access token, and delete this one."}),e("div",{className:"AccessTokenModal__CopyToClipboardContainer",children:e(N,{value:Y,inputWidth:"350px"})}),e("p",{children:"This token grants access to your account functions and should be treated like a password."})]}):n("div",{className:"SRC-marginFive",children:[n("div",{className:"SRC-marginBottomTen",children:[e(B,{className:"SRC-boldText",children:"Token Name"}),e(V,{autoFocus:!0,className:"AccessTokenModal__TokenNameInput",value:c,onChange:z,type:"text",placeholder:"e.g. Synapse command line access on my laptop"})]}),n("div",{className:"SRC-marginBottomTop",children:[e(B,{className:"SRC-boldText",children:"Token Permissions"}),e(v,{label:m.view.displayName,checked:s,onChange:()=>l(!s),children:n("div",{className:"AccessTokenModal__ScopeDescription",children:[m.view.description,". Required to use Synapse programmatic clients."]})}),e(v,{label:m.download.displayName,checked:a,onChange:()=>u(!a),children:e("div",{className:"AccessTokenModal__ScopeDescription",children:m.download.description})}),e(v,{label:m.modify.displayName,checked:C,onChange:()=>f(!C),children:e("div",{className:"AccessTokenModal__ScopeDescription",children:m.modify.description})})]}),e("div",{className:"SRC-center-text",children:W&&e(D,{error:K})})]})}),e(S.Footer,{children:h?e(y,{variant:"outline",onClick:o,children:"Close"}):n(w,{children:[e(y,{variant:"outline",onClick:o,children:"Cancel"}),e(y,{type:"submit",variant:"sds-primary",onClick:j,children:"Create Token"})]})})]})})};try{b.displayName="CreateAccessTokenModal",b.__docgenInfo={description:"",displayName:"CreateAccessTokenModal",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"(...args: any[]) => void"}},onCreate:{defaultValue:null,description:"",name:"onCreate",required:!0,type:{name:"(...args: any[]) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/personal_access_token/CreateAccessTokenModal.tsx#CreateAccessTokenModal"]={docgenInfo:b.__docgenInfo,name:"CreateAccessTokenModal",path:"src/lib/containers/personal_access_token/CreateAccessTokenModal.tsx#CreateAccessTokenModal"})}catch{}const ie=window.React.useState,g=({title:o,body:i})=>{var T;const[t,c]=ie(!1),{data:r,isLoading:s,error:l,refetch:a,fetchNextPage:u,hasNextPage:C}=te(),f=()=>{a()},_=(T=r==null?void 0:r.pages.flatMap(h=>h.results))!=null?T:[];return n("div",{className:"PersonalAccessTokenPage bootstrap-4-backport",children:[n("div",{className:"PersonalAccessTokenPage__Header",children:[n("div",{className:"PersonalAccessTokenPage__Header__CopyText",children:[e("h1",{children:o}),i]}),e("div",{className:"PersonalAccessTokenPage__Header__CreateButton",children:e(y,{variant:"sds-primary",onClick:()=>c(!0),children:"Create New Token"})})]}),n(Z,{children:[t&&e(b,{onClose:()=>c(!1),onCreate:f}),n("div",{children:[!s&&_.length===0&&e("div",{className:"PersonalAccessTokenPage__NoTokensMessage SRC-text-title",children:"You currently have no personal access tokens."}),n("div",{className:"PersonalAccessTokenPage__CardList",children:[_.map(h=>e(A,{accessToken:h,onDelete:f},h.id)),s&&q,!s&&C&&!l&&e("div",{className:"PersonalAccessTokenPage__CardList__LoadMore",children:e(y,{className:"PersonalAccessTokenPage__CardList__LoadMore__Button",variant:"sds-primary",onClick:()=>{u()},children:"Load More"})})]}),l&&e(D,{error:l})]})]})]})};try{g.displayName="AccessTokenPage",g.__docgenInfo={description:"",displayName:"AccessTokenPage",props:{title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},body:{defaultValue:null,description:"",name:"body",required:!0,type:{name:"string | Element"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/personal_access_token/AccessTokenPage.tsx#AccessTokenPage"]={docgenInfo:g.__docgenInfo,name:"AccessTokenPage",path:"src/lib/containers/personal_access_token/AccessTokenPage.tsx#AccessTokenPage"})}catch{}var je={parameters:{storySource:{source:`import React from 'react'
import { ComponentStory, ComponentMeta } from '@storybook/react'
import { AccessTokenPage } from './AccessTokenPage'

export default {
  title: 'Synapse/AccessTokenPage',
  component: AccessTokenPage,
} as ComponentMeta<typeof AccessTokenPage>

const Template: ComponentStory<typeof AccessTokenPage> = args => (
  <AccessTokenPage {...args} />
)

export const Demo = Template.bind({})
Demo.args = {
  title: 'Personal Access Tokens',
  body: 'Create and manage tokens that can be used to access your Synapse account programmatically.',
}
`,locationsMap:{demo:{startLoc:{col:57,line:10},endLoc:{col:1,line:12},startBody:{col:57,line:10},endBody:{col:1,line:12}}}}},title:"Synapse/AccessTokenPage",component:g};const le=o=>e(g,{...o}),de=le.bind({});de.args={title:"Personal Access Tokens",body:"Create and manage tokens that can be used to access your Synapse account programmatically."};const Ge=["Demo"];export{de as Demo,Ge as __namedExportsOrder,je as default};
//# sourceMappingURL=AccessTokenPage.stories.e7237be1.js.map

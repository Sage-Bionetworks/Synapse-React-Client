import{ap as $e,aq as Ge,an as je,C as Je,am as Ze,E as Xe,N as Pe,az as ae,aA as he,h as et,ag as tt,al as nt,aB as at,aC as rt,aD as ot}from"./index.bff2d9c7.js";import{j as n,r as F,a as f,R as Oe,F as P}from"./jsx-runtime.6fc4771b.js";import{b as st,i as lt,r as it,c as Ue}from"./queryUtils.605b96f7.js";import{a as De,b as ct,u as ut}from"./use-deep-compare-effect.esm.d30c5f7a.js";import{u as dt,E as re}from"./ElementWithTooltip.ba595cfe.js";import{u as pt}from"./useEntity.0ae96d4e.js";import{a as mt,b as ft}from"./sqlFunctions.1d7d9843.js";import{c as z}from"./cloneDeep.b82cfeee.js";import{u as _e}from"./useGetInfoFromIds.168522a5.js";import{C as k}from"./ColumnType.744125d2.js";import{I as Z}from"./IconSvg.313db458.js";import{C as Ye}from"./Checkbox.ba277f34.js";import{D as M}from"./Dropdown.6a6195b2.js";import{R as yt}from"./RadioGroup.889d2308.js";import{h as qe}from"./moment.a565bb48.js";import{R as ht}from"./RangeSlider.0c68c141.js";import{c as _t,P as Ct}from"./factory.a1bbb36b.js";import{r as St}from"./react-sizeme.96d952de.js";import{S as gt}from"./Skeleton.2663a88c.js";import{g as Ft}from"./ColorGradient.16f0e0f2.js";import{l as Et}from"./LoadingScreen.6a46d727.js";import{T as xt}from"./Tooltip.45d64ebd.js";import{M as se}from"./Modal.8264473e.js";import{B as Me}from"./Button.297619c8.js";import{I as Nt}from"./InfoOutlined.67f7ed8e.js";import{i as Ae}from"./TypeUtils.a2c41307.js";import{C as Tt}from"./Close.2729933c.js";const X=e=>n(gt,{style:{...e.style,display:"inline-block"},...e});try{X.displayName="SkeletonInlineBlock",X.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:null,description:"",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string | number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"circle"'},{value:'"rect"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLDivElement | null) => void) | RefObject<HTMLDivElement> | null"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"]={docgenInfo:X.__docgenInfo,name:"SkeletonInlineBlock",path:"src/lib/assets/skeletons/SkeletonInlineBlock.tsx#SkeletonInlineBlock"})}catch{}const W=F.exports.createContext(void 0),le=({children:e,queryContext:t})=>n(W.Provider,{value:t,children:e});function J(){const e=F.exports.useContext(W);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function vn(){const e=F.exports.useContext(W);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function Rn(){const e=F.exports.useContext(W);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const Ce=W.Consumer;try{W.displayName="QueryContext",W.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContext"]={docgenInfo:W.__docgenInfo,name:"QueryContext",path:"src/lib/containers/QueryContext.tsx#QueryContext"})}catch{}try{le.displayName="QueryContextProvider",le.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextProvider"]={docgenInfo:le.__docgenInfo,name:"QueryContextProvider",path:"src/lib/containers/QueryContext.tsx#QueryContextProvider"})}catch{}try{Ce.displayName="QueryContextConsumer",Ce.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryContext.tsx#QueryContextConsumer"]={docgenInfo:Ce.__docgenInfo,name:"QueryContextConsumer",path:"src/lib/containers/QueryContext.tsx#QueryContextConsumer"})}catch{}function We(e,t){return`${e}${t}`}function vt(e,t){const a=window.location.search,o=`${e}=${t}`;return a?a.includes(`${e}=`)?window.location.search.slice(a.indexOf("?")+1).split("&").map(r=>r.split("=")[0]===e?`${o}`:r).join("&"):`${a.substr(1)}&${o}`:o}function Rt(e,t){if(!window.location.search)return;const a=We(e,t),l=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(s=>s.split("=")[0]===a).map(s=>s.split("=")[1])[0];return l?decodeURIComponent(l):void 0}function bt(e,t,a){const o=t!==void 0?We(e,t):e,l=vt(o,a),s=window.location,r=`${s.protocol}//${s.hostname}${s.port?":"+s.port:""}${s.pathname}?${l}`;window.history.replaceState("object or string","Title",r)}function It(e,t){const a=Rt(e,t);let o;if(a){const l=JSON.parse(a);l.sql&&(o={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:$e|Ge|je|Je,entityId:mt(l.sql),query:l})}return o}function wt(e){var y,N;const{initQueryRequest:t,componentIndex:a=0,shouldDeepLink:o=!1,onQueryChange:l}=e,[s,r]=F.exports.useState(t);F.exports.useEffect(()=>{const i=It("QueryWrapper",a);i&&r(i)},[a]);const c=F.exports.useCallback(()=>z(s),[s]);function m(){return z(t)}function d(i){let u;typeof i=="function"?u=i(c()):u=i;const R=z(u);if(r(R),R.query){const p=JSON.stringify(R.query);if(o){const w=encodeURIComponent(p);bt("QueryWrapper",a,w)}l&&l(p)}}const{entityId:_,versionNumber:b}=ft(s.query.sql),v=(y=s.query.limit)!=null?y:Ze,I=Math.ceil((((N=s.query.offset)!=null?N:0)+Number(v))/v);function S(i){d(u=>(u.query.limit=i,u))}function A(i){d(u=>(u.query.offset=(i-1)*v,u))}return{entityId:_,versionNumber:b,getInitQueryRequest:m,getLastQueryRequest:c,setQuery:d,pageSize:v,currentPage:I,setPageSize:S,goToPage:A}}const Ve="isShowingFacetFilters",Qe="isHidingFacetFilters";function Se(e){const{initQueryRequest:t,onQueryChange:a,onQueryResultBundleChange:o,lockedColumn:l,componentIndex:s,shouldDeepLink:r}=e,[c,m]=F.exports.useState(void 0),{entityId:d,versionNumber:_,getInitQueryRequest:b,getLastQueryRequest:v,setQuery:I,currentPage:S,pageSize:A,goToPage:y,setPageSize:N}=wt({initQueryRequest:t,shouldDeepLink:r,componentIndex:s,onQueryChange:a}),i=F.exports.useMemo(()=>v(),[v]),{data:u,isLoading:R,error:p,isPreviousData:w}=st(i,{keepPreviousData:!0},m),Q=u==null?void 0:u.responseBody,D=R||w,{data:H}=pt(d,_);De(()=>{Q&&o&&o(JSON.stringify(Q))},[Q,o]);const E=Q?lt(Q.facets,Q.selectColumns):!0,O={data:F.exports.useMemo(()=>it(Q,l),[Q,l]),currentPage:S,pageSize:A,setPageSize:N,isLoadingNewBundle:D,getLastQueryRequest:v,getInitQueryRequest:b,error:p,entity:H,executeQueryRequest:I,isFacetsAvailable:E,asyncJobStatus:c,goToPage:y},{children:L}=e;return n(le,{queryContext:O,children:n("div",{className:`SRC-wrapper ${D?"SRC-logo-cursor":""} ${E?"has-facets":""}`,children:L})})}try{Se.displayName="QueryWrapper",Se.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapper.tsx#QueryWrapper"]={docgenInfo:Se.__docgenInfo,name:"QueryWrapper",path:"src/lib/containers/QueryWrapper.tsx#QueryWrapper"})}catch{}const G=F.exports.createContext(void 0),ie=({children:e,queryVisualizationContext:t})=>n(G.Provider,{value:t,children:e});function K(){const e=F.exports.useContext(G);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const ge=G.Consumer;function Fe(e){var N,i;const{data:t,getLastQueryRequest:a,isFacetsAvailable:o,isLoadingNewBundle:l}=J(),{columnAliases:s={}}=e,[r,c]=F.exports.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:(N=e.defaultShowFacetVisualization)!=null?N:!0,showSearchBar:(i=e.defaultShowSearchBar)!=null?i:!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});F.exports.useEffect(()=>{o||c(u=>({...u,showFacetFilter:!1,showFacetVisualization:!1}))},[o]),F.exports.useEffect(()=>{l&&b([])},[l]);const[m,d]=F.exports.useState([]),[_,b]=F.exports.useState([]),v=a(),I=ct(t==null?void 0:t.selectColumns);F.exports.useEffect(()=>{var u,R;d((R=I==null?void 0:I.slice(0,(u=e.visibleColumnCount)!=null?u:1/0).map(p=>p.name))!=null?R:[])},[I,v.query.sql,e.visibleColumnCount]);const S=F.exports.useCallback(u=>{const R=localStorage.getItem("force-display-original-column-names")==="true";return!u||R?u:s[u]?s[u]:dt(u)},[s]),A={topLevelControlsState:r,setTopLevelControlsState:c,columnsToShowInTable:m,setColumnsToShowInTable:d,selectedRowIndices:_,setSelectedRowIndices:b,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:S},{children:y}=e;return n(ie,{queryVisualizationContext:A,children:y})}try{Fe.displayName="QueryVisualizationWrapper",Fe.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"]={docgenInfo:Fe.__docgenInfo,name:"QueryVisualizationWrapper",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationWrapper"})}catch{}try{G.displayName="QueryVisualizationContext",G.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"]={docgenInfo:G.__docgenInfo,name:"QueryVisualizationContext",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContext"})}catch{}try{ie.displayName="QueryVisualizationContextProvider",ie.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"]={docgenInfo:ie.__docgenInfo,name:"QueryVisualizationContextProvider",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextProvider"})}catch{}try{ge.displayName="QueryVisualizationContextConsumer",ge.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"]={docgenInfo:ge.__docgenInfo,name:"QueryVisualizationContextConsumer",path:"src/lib/containers/QueryVisualizationWrapper.tsx#QueryVisualizationContextConsumer"})}catch{}const Ee=()=>{const{error:e}=J();return n(Xe,{error:e})};try{Ee.displayName="QueryWrapperErrorBanner",Ee.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"]={docgenInfo:Ee.__docgenInfo,name:"QueryWrapperErrorBanner",path:"src/lib/containers/QueryWrapperErrorBanner.tsx#QueryWrapperErrorBanner"})}catch{}var Ot=(e=>(e.LIKE="LIKE",e))(Ot||{}),At=(e=>(e.HAS="HAS",e.HAS_LIKE="HAS_LIKE",e))(At||{});const Vt="org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",Qt="org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",Lt="org.sagebionetworks.repo.model.table.TextMatchesQueryFilter",ke=Ae(Lt),xe=Ae(Vt),Ne=Ae(Qt),ce=e=>{var t;return f("svg",{...e,className:`Icon-Plus ${(t=e.className)!=null?t:""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]})};try{ce.displayName="IconPlus",ce.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconPlus.tsx#IconPlus"]={docgenInfo:ce.__docgenInfo,name:"IconPlus",path:"src/lib/assets/icons/IconPlus.tsx#IconPlus"})}catch{}const ue=e=>{var t;return f("svg",{...e,className:`Icon-Minus ${(t=e.className)!=null?t:""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]})};try{ue.displayName="IconMinus",ue.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/assets/icons/IconMinus.tsx#IconMinus"]={docgenInfo:ue.__docgenInfo,name:"IconMinus",path:"src/lib/assets/icons/IconMinus.tsx#IconMinus"})}catch{}const ee=({label:e,isCollapsed:t,onClick:a})=>{const{getColumnDisplayName:o}=K();return f("div",{className:"FacetFilterHeader",children:[n("label",{className:"FacetFilterHeader__label",children:o(e)}),n("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>a(!t),children:t?n(ce,{className:"icon-plus",title:"Expand Menu"}):n(ue,{className:"icon-minus",title:"Collapse Menu"})})]})};try{ee.displayName="FacetFilterHeader",ee.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"]={docgenInfo:ee.__docgenInfo,name:"FacetFilterHeader",path:"src/lib/containers/widgets/query-filter/FacetFilterHeader.tsx#FacetFilterHeader"})}catch{}function qt(e){return e.replace(/\s/g,"").toLowerCase()}function Be(e,t=[],a=[],o=[]){const{value:l}=e;let s=l;l===ae&&(s=he);const r=t.find(d=>d.ownerId===l);r&&(s=r?r.userName:`unknown (${l})`);const c=a.find(d=>d.id===l);c&&(s=c?c.name:`unknown (${l})`);const m=o.find(d=>d.id===l);return m!=null&&m.name&&(s=m.name),`${s}`}function kt(e,t,a){const o=[...e.sort((l,s)=>s.count-l.count)];return t||o.length<=a||o.slice(a).find(l=>l.isSelected)?o:o.splice(0,a)}const j=({facetValues:e,columnModel:t,onClear:a,onChange:o,containerAs:l="Collapsible",dropdownType:s="Icon",collapsed:r=!1})=>{const[c,m]=F.exports.useState(!1),[d,_]=F.exports.useState(r),[b,v]=F.exports.useState(!1),[I,S]=F.exports.useState(!1),[A,y]=F.exports.useState(""),[N,i]=F.exports.useState(e);ut(()=>{i(e)},[e]);const u=5,R=1500,p=Oe.createRef(),w={};let Q;const D=e.filter(h=>h.isSelected).length===0,H=(t==null?void 0:t.columnType)===k.USERID||(t==null?void 0:t.columnType)===k.USERID_LIST?e.map(h=>h.value):[],E=_e({ids:H,type:"USER_PROFILE"}),V=(t==null?void 0:t.columnType)===k.ENTITYID||(t==null?void 0:t.columnType)===k.ENTITYID_LIST?e.map(h=>h.value):[],O=_e({ids:V,type:"ENTITY_HEADER"}),L=(t==null?void 0:t.columnType)===k.EVALUATIONID?e.map(h=>h.value):[],C=_e({ids:L,type:"EVALUATION_QUEUE"}),g=h=>{const B=h.target.value;if(y(B),m(!0),!B)e.forEach(Y=>{Y.isSelected=!1}),i(e);else{const Y=e.filter(U=>Be(U,E,O,C).toLowerCase().indexOf(B.trim().toLowerCase())>-1?U:null);i(Y)}};if(!t)return n(P,{});const x=l==="Dropdown",T=f("div",{className:x?"EnumFacetFilter__dropdown_menu":"",children:[f("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[f("div",{className:I?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[n("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{i(e),S(!1),m(!1)},children:n("span",{className:"EnumFacetFilter__previous",children:n(Z,{options:{icon:"arrowBack"}})})}),A.length>0&&n("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var h;y(""),(h=p.current)==null||h.focus()},children:n("span",{className:"EnumFacetFilter__reset",children:n(Z,{options:{icon:"close"}})})}),n("input",{type:"text",placeholder:"Find values",value:A,ref:p,onChange:h=>{g(h)}})]}),!I&&f("div",{className:"EnumFacetFilter__checkAll",children:[n(Ye,{className:"EnumFacetFilter__checkbox",onChange:()=>{a()},checked:D,label:"All",isSelectAll:!0},"select_all"),n("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var h;y(""),S(!0),(h=p.current)==null||h.focus()},children:n("span",{className:"EnumFacetFilter__searchicon",children:n(Z,{options:{icon:"search"}})})})]})]}),f("div",{children:[N.length>0&&kt(N,c||x,u).map((h,B)=>n(Bt,{id:qt(h.value),index:B,label:Be(h,E,O,C),count:h.count,isDropdown:x,initialIsSelected:h.isSelected,onChange:Y=>{w[h.value]=Y,clearTimeout(Q),Q=setTimeout(()=>{o(w),v(!1)},R)}},`checkLabel${B}`)),!x&&f(P,{children:[!c&&N.length>u&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>m(!0),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:f("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",N.length,")"]})})}),c&&N.length>u&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>m(!1),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:n("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),N.length<=0&&n("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),q=()=>v(!b);return x?s==="SelectBox"?f(M,{className:"EnumFacetFilter EnumFacetFilterSelect",show:b,onToggle:q,children:[f(M.Toggle,{className:"secondary-caret",variant:"gray-select",children:[D&&"All",!D&&e.filter(h=>h.isSelected).length===1&&e.filter(h=>h.isSelected)[0].value,!D&&e.filter(h=>h.isSelected).length>1&&"Multiple Values Selected"]}),n(M.Menu,{children:T})]}):f(M,{className:"EnumFacetFilter",show:b,onToggle:q,children:[n(re,{idForToolTip:"facetFilterTooltip",tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),n(M.Menu,{children:T})]}):f(P,{children:[n(ee,{isCollapsed:d,label:t.name,onClick:h=>_(h)}),n(Pe,{className:"EnumFacetFilter",in:!d,children:T})]})};function Bt({id:e,index:t,label:a,count:o,isDropdown:l,initialIsSelected:s,onChange:r}){const[c,m]=F.exports.useState(s);return Oe.useEffect(()=>{m(s)},[s]),f("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{l&&(m(!c),r(!c))},children:[n(Ye,{className:"EnumFacetFilter__checkbox",onClick:d=>d.stopPropagation(),onChange:d=>{m(d),r(d)},checked:c,label:a},`${e}-${t}`),l&&f("span",{className:"EnumFacetFilter__count",children:["(",o,")"]}),!l&&n("div",{className:"EnumFacetFilter__count",children:o})]})}try{j.displayName="EnumFacetFilter",j.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"]={docgenInfo:j.__docgenInfo,name:"EnumFacetFilter",path:"src/lib/containers/widgets/query-filter/EnumFacetFilter.tsx#EnumFacetFilter"})}catch{}const de=({facet:e,isChecked:t,onClick:a})=>{const{getColumnDisplayName:o}=K();return f("button",{className:`Chip ${t?"Checked":""}`,onClick:a,children:[o(e.columnName),n(Z,{options:{icon:t?"check":"add",size:"14px",padding:"left"}})]})};try{de.displayName="FacetChip",de.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"]={docgenInfo:de.__docgenInfo,name:"FacetChip",path:"src/lib/containers/widgets/query-filter/FacetChip.tsx#FacetChip"})}catch{}const pe=e=>{const t="Min value should be less then max value",[a,o]=F.exports.useState(!1),[l,s]=F.exports.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:qe(e.initialValues.min).format("YYYY-MM-DD"),max:qe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),r=e.className?`range ${e.className}`:"range",c=({min:d,max:_},b="number")=>{if(d==null||_===null||_===void 0)return o(!1),!0;if(b==="number"){if(Number(d)>Number(_))return o(!0),!1}else if(Date.parse(d)>Date.parse(_))return o(!0),!1;return o(!1),!0},m=(d,_,b="number")=>{c(d,b)&&_(d)};return f("div",{className:r,style:{display:"flex",flexWrap:"wrap"},children:[f("div",{style:{marginRight:"10px"},children:[n("input",{"aria-label":"min",type:e.type,value:l.min,onChange:({target:d})=>s({min:d.value,max:l.max})},"range_min"),n("div",{children:"to"}),n("input",{"aria-label":"max",type:e.type,value:l.max,onChange:({target:d})=>s({min:l.min,max:d.value})},"range_max")]}),n("button",{className:"btn btn-link SRC-noPadding",onClick:()=>m(l,e.onChange,e.type),children:"Apply"}),a&&n("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{pe.displayName="Range",pe.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/Range.tsx#Range"]={docgenInfo:pe.__docgenInfo,name:"Range",path:"src/lib/containers/widgets/Range.tsx#Range"})}catch{}var Ie=(e=>(e.NOT_SET="org.sagebionetworks.UNDEFINED_NULL_NOTSET",e.RANGE="RANGE",e.ANY="",e))(Ie||{});const me=({facetResult:e,columnModel:t,onChange:a,collapsed:o=!1})=>{const[l,s]=F.exports.useState(o),r=[{label:he,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:c,columnMax:m,selectedMin:d,selectedMax:_}=e;const b=!d&&!_;d=d||c,_=_||m;const v=t.columnType==="DOUBLE"?"number":"date",I=(i,u)=>u?"":i===ae?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",S=(i,u)=>{y(i),i!=="RANGE"&&u([i,i])},[A,y]=F.exports.useState(I(d,b));return f("div",{children:[n(ee,{isCollapsed:l,label:t.name,onClick:i=>s(i)}),f(Pe,{in:!l,children:[n(yt,{value:A,id:"rangeSelector",options:r,onChange:i=>S(i,a)}),A==="RANGE"&&(c===m?n("label",{children:m}):f(P,{children:[t.columnType==="INTEGER"&&f(ht,{domain:[c,m],initialValues:{min:d,max:_},step:1,doUpdateOnApply:!0,onChange:i=>a([i.min,i.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&n(pe,{initialValues:{min:d,max:_},type:v,onChange:i=>a([i.min,i.max])},"Range")]}))]})]})};try{me.displayName="RangeFacetFilter",me.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"]={docgenInfo:me.__docgenInfo,name:"RangeFacetFilter",path:"src/lib/containers/widgets/query-filter/RangeFacetFilter.tsx#RangeFacetFilter"})}catch{}const He=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected===!0).map(t=>t.value)}),Pt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Le=(e,t)=>{var s,r;const a=(r=(s=t==null?void 0:t.query)==null?void 0:s.selectedFacets)!=null?r:[],o=a.findIndex(c=>c.columnName===e.columnName),l=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return o>-1?l?a.splice(o,1):a[o]=e:a.push(e),a};function oe(e,t,a,o,l=!1){o?t.facetValues.forEach(c=>{c.value===o&&(c.isSelected=l)}):t.facetValues.forEach(c=>{c.isSelected=!1});const s=He(t),r=Le(s,e);a(r)}const we=(e,t,a,o)=>{const l=o&&Object.keys(o)||[];l.length&&t.facetValues.forEach(c=>{l.includes(c.value)&&(c.isSelected=o?!!o[c.value]:!1)});const s=He(t),r=Le(s,e);a(r)},ze=(e,t,a,o)=>{t.columnMin=o[0],t.columnMax=o[1];const l=Pt(t),s=Le(l,e);a(s)};function Te(e){var y,N;const{facetsToFilter:t}=e,{data:a,isLoadingNewBundle:o,getLastQueryRequest:l,executeQueryRequest:s}=J(),r=(y=a==null?void 0:a.facets)==null?void 0:y.filter(i=>!Ue(i));let c;t==null?c=(N=r==null?void 0:r.map(i=>i.columnName))!=null?N:[]:c=t;const[m,d]=Oe.useState([]),{topLevelControlsState:_}=K(),{showFacetFilter:b}=_;if(De(()=>{d(c.slice(0,3))},[a==null?void 0:a.facets]),!a)return n(P,{});const v=a.selectColumns,I=l(),S=i=>{const u=l();u.query.selectedFacets=i,u.query.offset=0,s(u)},A=i=>{let u=[...m!=null?m:[""],i.columnName];m.includes(i.columnName)&&(u=u.filter(R=>R!=i.columnName)),d(u)};return f("div",{className:`FacetFilterControls ${b?Ve:Qe}`,children:[o&&n("div",{children:"Loading..."}),!o&&(r!=null?r:[]).filter(i=>m.includes(i.columnName)).map((i,u)=>{const R=v.find(p=>p.name===i.columnName);return f("div",{className:"FacetFilterControls__facet",children:[i.facetType==="enumeration"&&R&&n(j,{containerAs:"Collapsible",collapsed:!1,facetValues:i.facetValues,columnModel:R,onChange:p=>we(I,i,S,p),onClear:()=>oe(I,i,S)}),i.facetType==="range"&&R&&n(me,{facetResult:i,columnModel:R,collapsed:!1,onChange:p=>ze(I,i,S,p)})]},i.columnName)}),f("div",{children:[n("div",{className:"AvailableFacet",children:n("label",{className:"AvailableFacet__label",children:"Available Facets"})}),(r!=null?r:[]).filter(i=>c.includes(i.columnName)).map(i=>n(de,{facet:i,onClick:()=>A(i),isChecked:m.includes(i.columnName)},i.columnName))]})]})}try{Te.displayName="FacetFilterControls",Te.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"]={docgenInfo:Te.__docgenInfo,name:"FacetFilterControls",path:"src/lib/containers/widgets/query-filter/FacetFilterControls.tsx#FacetFilterControls"})}catch{}const Ut=_t(Ct),Dt=19,Yt=30,Mt={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},Wt=(e,t)=>{t=t||0;let a=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let o=0;o<t;o++)a.indexOf(".")!==-1&&(a=a.replace("0%","%"),a=a.replace(".%","%"));return a};function Ke(e,t){if(!e)return e;const a=e.trim();return a.length>t?a.substr(0,t-1)+"\u2026":e}async function Ht(e,t,a,o,l){var S,A;const{colorPalette:s}=Ft(a,e.facetValues.length),r=async(y,N,i)=>{const u=new Map;u.set(ae,he);const R=y.map(p=>p.value).filter(p=>p!==ae);if(N===k.ENTITYID||N===k.ENTITYID_LIST){const p=await tt(R,i);for(const w of p.results)u.set(w.id,w.name)}else if(N===k.USERID||N===k.USERID_LIST){const p=await nt(R,i);for(const w of p.children)u.set(w.ownerId,w.userName)}return y.map(p=>({facet:p,label:c(p,!1,u),truncatedLabel:c(p,!0,u),count:p.count}))},c=(y,N,i)=>{var R;let u=(R=i.get(y.value))!=null?R:y.value;return N&&(u=Ke(u,Dt)),u},m=await r(e.facetValues,t,l),d=m.map(y=>y.truncatedLabel),b=e.facetValues.some(y=>y.isSelected)?e.facetValues.map((y,N)=>y.isSelected?s[N]:s[N].replace("rgb(","rgba(").replace(")",", 0.25)")):s,v={values:o==="PIE"?e.facetValues.map(y=>y.count):void 0,labels:m.map(y=>y.label),text:d,x:o==="BAR"?e.facetValues.map(y=>{var N,i;return(i=(N=m.find(u=>u.facet===y))==null?void 0:N.label)!=null?i:y.value}):void 0,y:o==="BAR"?e.facetValues.map(y=>y.count):void 0,facetEnumerationValues:e.facetValues.map(y=>y.value),name:e.columnName,hovertemplate:o==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:o==="PIE"?"pie":"bar",pull:o==="PIE"?e.facetValues.map(y=>y.isSelected?.1:0):void 0,marker:{colors:o==="PIE"?b:void 0,color:o==="BAR"?b:void 0}};return{data:[v],labels:m,colors:o==="PIE"?(S=v.marker)==null?void 0:S.colors:(A=v.marker)==null?void 0:A.color}}const zt=(e,t,a)=>{if(e.points&&e.points[0]){const o=e.points[0],l=o.data.facetEnumerationValues[o.pointNumber],s=t.facetValues.find(r=>r.value===l);a(t,s,!s.isSelected)}};function Kt(e,t,a){const l=e?e*(t==="BAR"?.8:.6):200;let s=t==="PIE"?l:l/3;return s>a&&(s=a),{width:`${l}px`,height:`${s}px`}}function fe(e){const{labels:t,colors:a=[],isExpanded:o}=e;if(!t)return n(P,{});const l=o?Math.min(t.length,9):Math.min(t.length,3);if(l===0)return n(P,{});const s=t.reduce((r,c)=>r+c.count,0);return n("div",{className:`FacetNavPanel__body__legend${o?"--expanded":""}`,children:t.slice(0,l).map((r,c)=>{const d=`(${Wt(r.count/s,1)}) ${r.label}`,_=Ke(d,Yt);return n(re,{idForToolTip:r.label,tooltipText:r.label,children:f("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[n("div",{style:{backgroundColor:a[c]}}),n("label",{children:_})]},`legendLabel_${c}`)},r.label)})})}const $t=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",te=e=>{const{onHide:t,isModalView:a,applyChangesToFacetFilter:o,applyChangesToGraphSlice:l,index:s,facetToPlot:r,plotType:c,onSetPlotType:m}=e,{accessToken:d}=et(),{data:_,isLoadingNewBundle:b,getLastQueryRequest:v}=J(),{getColumnDisplayName:I}=K(),[S,A]=F.exports.useState(),[y,N]=F.exports.useState(!1),i=I(r.columnName),u=F.exports.useCallback(()=>{var p,w;return(w=(p=_==null?void 0:_.columnModels)==null?void 0:p.find(Q=>Q.name===r.columnName))==null?void 0:w.columnType},[_,r.columnName]);F.exports.useEffect(()=>{let p=!0;if(r)Ht(r,u(),s,c,d).then(w=>{p&&A(w)});else return;return()=>{p=!1}},[r,_,s,c,d,u]);const R=()=>f("div",{onClick:p=>{p.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),f(M,{children:[n(M.Toggle,{className:"secondary-caret",variant:"gray-select",children:c==="PIE"?"Pie Chart":"Bar Chart"}),f(M.Menu,{className:"chart-tools",children:[n(M.Item,{as:"button",onClick:()=>m("BAR"),children:"Bar Chart"}),n(M.Item,{as:"button",onClick:()=>m("PIE"),children:"Pie Chart"})]})]})]});return!_&&b||!r?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:Et}):f(P,{children:[f(se,{animation:!1,show:y,onHide:()=>N(!1),backdrop:"static",children:[n(se.Header,{closeButton:!0,children:n(se.Title,{children:i!=null?i:""})}),f(se.Body,{children:[n(te,{...e,isModalView:!0}),n("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:n(Me,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>N(!1),children:"Apply Filters"})})]})]}),f("div",{role:"graphics-document",className:`FacetNavPanel${a?"--expanded":""}`,children:[!a&&f("div",{className:"FacetNavPanel__title",children:[!_&&b?n(X,{width:100}):n("span",{className:"FacetNavPanel__title__name",children:i}),f("div",{className:"FacetNavPanel__title__tools",children:[n(j,{facetValues:r.facetValues,columnModel:_==null?void 0:_.columnModels.find(p=>p.name===r.columnName),onChange:p=>{we(v(),r,o,p)},onClear:()=>{oe(v(),r,o)},containerAs:"Dropdown"}),n(re,{idForToolTip:"expandGraph",tooltipText:"Expand to large graph",callbackFn:()=>N(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),n(re,{idForToolTip:"hideGraph",tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),a&&f(P,{children:[f("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),n(j,{facetValues:r.facetValues,columnModel:_==null?void 0:_.columnModels.find(p=>p.name===r.columnName),onChange:p=>{we(v(),r,o,p)},onClear:()=>{oe(v(),r,o)},containerAs:"Dropdown",dropdownType:"SelectBox"}),n(xt,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:n(Nt,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),n(R,{})]}),f("div",{className:`FacetNavPanel__body${a?"--expanded":""}`,children:[n(St.SizeMe,{monitorHeight:!0,children:({size:p})=>{var w;return n("div",{className:$t(a,c),children:n(Ut,{layout:Mt,data:(w=S==null?void 0:S.data)!=null?w:[],style:Kt(p.width,c,a?300:150),config:{displayModeBar:!1},onClick:Q=>zt(Q,r,l)},`${r.columnName}-${c}-${p.width}`)})}}),n(fe,{labels:S==null?void 0:S.labels,colors:S==null?void 0:S.colors,isExpanded:a})]})]})]})};try{fe.displayName="FacetPlotLegend",fe.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"]={docgenInfo:fe.__docgenInfo,name:"FacetPlotLegend",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetPlotLegend"})}catch{}try{te.displayName="FacetNavPanel",te.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"]={docgenInfo:te.__docgenInfo,name:"FacetNavPanel",path:"src/lib/containers/widgets/facet-nav/FacetNavPanel.tsx#FacetNavPanel"})}catch{}const Gt=()=>{try{return JSON.parse(sessionStorage.getItem(at)||"")}catch{return[]}},jt=()=>{try{return JSON.parse(sessionStorage.getItem(rt)||"")}catch{return[]}},Jt=()=>{try{return JSON.parse(sessionStorage.getItem(ot)||"")}catch{return[]}},ne=e=>{const{getColumnDisplayName:t}=K();let a,o="";if("facetWithSelection"in e){const{facetWithSelection:s}=e;s.facet.facetType==="enumeration"?a=s.displayValue===ae?he:s.displayValue:a=`${s.facet.selectedMin} 
        - ${s.facet.selectedMax}`,o=`${t(s.facet.columnName)}: ${a}`}else if("filter"in e){const{filter:s}=e;let r=s.value;(r==null?void 0:r.startsWith("%"))&&(r==null?void 0:r.endsWith("%"))&&(r=r.substring(1,r.length-1)),a=r,o=`Text matches: "${r}"`,s.columnName&&(a=`"${r}" in ${t(s==null?void 0:s.columnName)}`,o=`${t(s==null?void 0:s.columnName)}: ${r}`)}else console.warn("Expected either facetWithSelection or filter in SelectionCriteriaPill but got neither");const l=encodeURIComponent(o);return n(re,{idForToolTip:`selectionCriteria_${l}`,tooltipText:o,callbackFn:()=>{},children:f("div",{className:"SelectionCriteriaPill",children:[n("span",{children:a}),n("button",{onClick:()=>e.onRemove(),className:"SelectionCriteriaPill__btnRemove",title:"deselect",children:n(Tt,{})})]},`SelectionCriteriaPill ${l}`)})};try{ne.displayName="SelectionCriteriaPill",ne.__docgenInfo={description:"",displayName:"SelectionCriteriaPill",props:{facetWithSelection:{defaultValue:null,description:"",name:"facetWithSelection",required:!0,type:{name:"FacetWithSelection"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"{ columnName?: string | undefined; value: string; }"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"]={docgenInfo:ne.__docgenInfo,name:"SelectionCriteriaPill",path:"src/lib/containers/widgets/facet-nav/SelectionCriteriaPill.tsx#SelectionCriteriaPill"})}catch{}const ye=({style:e,frontText:t,endText:a="",hideIfUnfiltered:o=!1})=>{var L;const{data:l,isLoadingNewBundle:s,getLastQueryRequest:r,executeQueryRequest:c,getInitQueryRequest:m,error:d}=J(),{topLevelControlsState:_,unitDescription:b}=K(),v=l==null?void 0:l.queryCount,[I,S]=F.exports.useState([]),A=C=>{const g=z(r());g.query.selectedFacets=C,g.query.offset=0,c(g)},y=C=>C.filter(T=>T.facetType==="enumeration").filter(T=>T.facetValues.filter(q=>q.isSelected===!0).length>0),N=C=>C.filter(T=>T.facetType==="range").filter(T=>T.selectedMax||T.selectedMin),i=(C,g)=>{var T;const x=C.find(q=>q.id===g);return(T=x==null?void 0:x.name)!=null?T:g},u=(C,g)=>{const x=C.find(T=>T.id===g);return(x==null?void 0:x.name)||g},R=(C,g)=>{const x=C.find(T=>T.ownerId===g);return(x==null?void 0:x.userName)||g},p=F.exports.useCallback((C,g)=>{const x=Gt(),T=jt(),q=Jt(),h=[];return C.forEach(B=>{const Y=g.find(U=>U.name===B.columnName);B.facetValues.forEach(U=>{if(U.isSelected){let $=U.value;switch(Y==null?void 0:Y.columnType){case k.ENTITYID:case k.ENTITYID_LIST:$=i(x,U.value);break;case k.USERID:case k.USERID_LIST:$=R(T,U.value);break;case k.EVALUATIONID:$=u(q,U.value);break;default:$=U.value;break}h.push({facet:B,displayValue:$,selectedValue:U})}})}),h},[]);F.exports.useEffect(()=>{if(l){const C=N(l.facets),g=y(l.facets),x=C.map(q=>({facet:q})),T=p(g,l.columnModels);S([...x,...T])}},[l,p]);const w=C=>{const{facet:g,selectedValue:x}=C;g.facetType==="enumeration"?oe(r(),g,A,x==null?void 0:x.value,!1):ze(r(),g,A,[Ie.ANY,Ie.ANY])},Q=(C,g)=>{var T;const x=z(r());!x.query.additionalFilters||(x.query.additionalFilters=(T=x.query.additionalFilters)==null?void 0:T.reduce(function(q,h){if(xe(h)||Ne(h)){const B={columnName:h.columnName,values:h.columnName===C?h.values.filter(Y=>Y!==g):h.values,operator:xe(h)?h.operator:void 0,function:Ne(h)?h.function:void 0,concreteType:h.concreteType};B.values.length>0&&q.push(B)}else q.push(h);return q},[]),c(x))},D=C=>{const g=z(r());!g.query.additionalFilters||(g.query.additionalFilters=g.query.additionalFilters.filter(x=>!(ke(x)&&x.searchExpression===C.searchExpression)),c(g))},H=()=>{const C=z(m());C.query.additionalFilters=[],c(C)},E=(L=r().query.additionalFilters)==null?void 0:L.reduce((C,g)=>{if(ke(g))C.push({key:`fulltextsearch-${g.searchExpression}`,filter:{value:g.searchExpression},onRemove:()=>D(g)});else if(xe(g)||Ne(g)){const{columnName:x}=g;g.values.forEach(T=>{C.push({key:`columnsearch-${T}`,filter:{columnName:x,value:T},onRemove:()=>Q(g.columnName,T)})})}else console.warn("Encountered unexpected QueryFilter: ",g);return C},[]),V=_==null?void 0:_.showFacetFilter,O=I.length>0||E&&E.length>0;return d?n(P,{}):n("div",{className:`TotalQueryResults ${V?Ve:Qe} ${O?"hasFilters":""}`,style:e,children:s?n(X,{width:100}):f(P,{children:[(O||!o)&&f("div",{className:"TotalQueryResults__topbar",children:[f("span",{className:"SRC-boldText",children:[t," ",v==null?void 0:v.toLocaleString()," ",b," ",a]}),(I.length>0||E&&E.length>2)&&f("a",{onClick:H,className:"TotalQueryResults__topbar__clearall",children:[n(Z,{options:{icon:"deleteSweep"}}),"Clear all filters"]})]}),f("div",{className:"TotalQueryResults__selections",children:[E&&E.map(C=>F.exports.createElement(ne,{...C,key:C.key})),I.map((C,g)=>{var x,T,q;return n(ne,{facetWithSelection:C,onRemove:()=>w(C)},`facets-${(q=(T=(x=C.selectedValue)==null?void 0:x.value)!=null?T:C.displayValue)!=null?q:g}`)})]})]})})};try{ye.displayName="TotalQueryResults",ye.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:{value:""},description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:{value:"false"},description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"]={docgenInfo:ye.__docgenInfo,name:"TotalQueryResults",path:"src/lib/containers/TotalQueryResults.tsx#TotalQueryResults"})}catch{}const ve=2;function Re(e,t){var o,l;return(l=(o=e==null?void 0:e.facets)==null?void 0:o.filter(s=>s.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(s.columnName)>-1)&&s.facetValues.length>0&&!Ue(s)))!=null?l:[]}const be=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:a,isLoadingNewBundle:o,executeQueryRequest:l,error:s,asyncJobStatus:r}=J(),{topLevelControlsState:c}=K(),[m,d]=F.exports.useState([]),[_,b]=F.exports.useState(!0),{showFacetVisualization:v,showFacetFilter:I}=c,S=a();F.exports.useEffect(()=>{const E=Re(t,e);E.length!==0&&_&&(d(E.map((V,O)=>({name:V.columnName,isHidden:O>=ve,plotType:"PIE"}))),b(!1))},[t,_,e]);const A=E=>{d(V=>V.map((O,L)=>E?{...O,isHidden:!1}:{...O,isHidden:L>=ve}))},y=E=>{S.query.selectedFacets=E,S.query.offset=0,l(S)},N=E=>m.find(L=>L.name===E&&L.isHidden===!0)!==void 0,i=F.exports.useMemo(()=>m.find(E=>E.isHidden===!0)?"MORE":m.length<=ve?"NONE":"LESS",[m]),u=E=>{w(E,"isHidden",!0)},R=(E,V)=>{w(E,"plotType",V)},p=E=>{var O;const V=(O=m.find(L=>L.name===E))==null?void 0:O.plotType;return V!=null?V:"PIE"},w=(E,V,O)=>{d(L=>L.map(C=>C.name===E?{...C,[V]:O}:C))},Q=Re(t,e),D=Re(t,e).map((E,V)=>({columnName:E.columnName,colorIndex:V})),H=(S==null?void 0:S.query.selectedFacets)!==void 0&&S.query.selectedFacets.length>0||(S==null?void 0:S.query.additionalFilters)!==void 0&&(S==null?void 0:S.query.additionalFilters.length)>0;return s?n(P,{}):!t&&o?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(r==null?void 0:r.progressMessage)&&f("div",{children:[n("span",{className:"spinner"}),r.progressMessage]})}):f(P,{children:[n(ye,{frontText:"",endText:H?"filtered by":"",hideIfUnfiltered:!0}),Q.length>0&&f("div",{className:`FacetNav ${v?"":"hidden"} ${I?Ve:Qe} ${i==="LESS"?"less":""}`,children:[n("div",{className:"FacetNav__row",role:"list",children:Q.map(E=>{var V;return n("div",{className:"col-sm-12 col-md-4",style:{display:N(E.columnName)?"none":"block"},children:n(te,{index:(V=D.find(O=>O.columnName===E.columnName))==null?void 0:V.colorIndex,onHide:()=>u(E.columnName),plotType:p(E.columnName),onSetPlotType:O=>R(E.columnName,O),facetToPlot:E,applyChangesToFacetFilter:y,applyChangesToGraphSlice:(O,L,C)=>oe(S,O,y,L==null?void 0:L.value,C),isModalView:!1})},E.columnName)})}),i!=="NONE"&&n("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:n(Me,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>A(i==="MORE"),style:{zIndex:500},children:i==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{be.displayName="FacetNav",be.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"]={docgenInfo:be.__docgenInfo,name:"FacetNav",path:"src/lib/containers/widgets/facet-nav/FacetNav.tsx#FacetNav"})}catch{}export{At as C,j as E,Te as F,ue as I,Ve as Q,X as S,ye as T,Qe as a,K as b,wt as c,le as d,Ne as e,Ot as f,vn as g,we as h,xe as i,oe as j,Fe as k,Ce as l,ge as m,Ee as n,be as o,Se as p,Rn as q,Re as r,Ht as s,Kt as t,J as u,fe as v,ce as w};

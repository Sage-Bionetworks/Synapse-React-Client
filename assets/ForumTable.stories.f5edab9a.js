import{h as M}from"./moment.a565bb48.js";import{r as S,a as s,j as e,F as D}from"./jsx-runtime.f6e67d69.js";import{S as C}from"./Sort.75e7166e.js";import{h as F,cC as P,cD as i,v as x,br as w,cE as V,cF as k,cG as Y}from"./index.399b1ebb.js";import{P as H}from"./getEndpoint.bb7ded34.js";import{u as J}from"./useInfiniteQuery.409ad78a.js";import{D as a}from"./EntityChildren.50133102.js";import{I as j}from"./IconSvg.76f9c9ad.js";import{d as q}from"./ToastMessage.ef3fd930.js";import{U as N}from"./UserCard.c2f5359e.js";import{B as R}from"./Button.bb6df31f.js";import{T as z}from"./Table.568c987a.js";import"./iframe.0155d3d5.js";import"./index.5aa44f42.js";import"./Alert.161bc8be.js";import"./index.57d09176.js";import"./Transition.45107636.js";import"./index.35ce73ec.js";import"./isArray.bbc3389f.js";import"./withStyles.e9153c6c.js";import"./SvgIcon.b9f91416.js";import"./Tooltip.e69703f2.js";import"./createSvgIcon.1bc5e790.js";import"./useTheme.b5d1a103.js";import"./makeStyles.b3ebb6fc.js";import"./InfoOutlined.6b0ecc0d.js";import"./FullWidthAlert.a36cfcd9.js";import"./Typography.8482fe8d.js";import"./removeClass.27874bcb.js";import"./hasClass.56fd144a.js";import"./uniqueId.b369d35f.js";import"./isSymbol.817739da.js";import"./IconCopy.bae338e3.js";import"./SkeletonTable.7ca00999.js";import"./times.8c0d57e8.js";import"./toInteger.6ecd4cc2.js";import"./Skeleton.e925cd71.js";import"./Overlay.2be5ac15.js";import"./useWaitForDOMRef.132cafe6.js";import"./usePopperMarginModifiers.9f59499b.js";function G(r,c,p,n,o,_){const{accessToken:d}=F();return J(["forumthread","infinite",r,c,o,p,n],async m=>P(d,r,m.pageParam,c,p,n,o),{..._,getNextPageParam:(m,l)=>{if(m.results.length>0)return l.length*c}})}var f=(r=>(r.FORUM="FORUM",r.THREAD="THREAD",r.DATA_ACCESS_SUBMISSION="DATA_ACCESS_SUBMISSION",r.DATA_ACCESS_SUBMISSION_STATUS="DATA_ACCESS_SUBMISSION_STATUS",r))(f||{}),O=(r=>(r.SUBSCRIPTION_ID="SUBSCRIPTION_ID",r.SUBSCRIBER_ID="SUBSCRIBER_ID",r.OBJECT_ID="OBJECT_ID",r.OBJECT_TYPE="OBJECT_TYPE",r.CREATED_ON="CREATED_ON",r))(O||{});async function W(r,c){const p={objectType:f.FORUM,idList:[c],sortByType:O.OBJECT_ID,sortDirection:a.ASC},n=await V(r,p);if(n.totalNumberOfResults>0)return n.results[0]}const T=({forumId:r,limit:c,filter:p})=>{var A;const{accessToken:n}=F(),[o,_]=S.exports.useState(i.PINNED_AND_LAST_ACTIVITY),[d,m]=S.exports.useState(),[l,h]=S.exports.useState(!1),[y,b]=S.exports.useState(!1);S.exports.useEffect(()=>{W(n,r).then(t=>m(t))},[n,r]);const{data:I,hasNextPage:U,fetchNextPage:v}=G(r,c,o,l,p),L=(A=I==null?void 0:I.pages.flatMap(t=>t.results))!=null?A:[],g=(t,u)=>`${H.PORTAL}#!Synapse:${u}/discussion/threadId=${t}`,B=async()=>{try{if(b(!0),d)await k(n,d.subscriptionId),m(void 0);else{const t={objectId:r,objectType:f.FORUM},u=await Y(n,t);m(u)}}catch(t){q(t.reason,"danger")}finally{b(!1)}},E=t=>{o==t?(_(t),h(!l)):(_(t),h(!1))};return s("div",{className:"ForumTable bootstrap-4-backport",children:[e("div",{className:"ForumTable__top-level-control",children:e(R,{variant:d?"outline-primary":"primary",onClick:()=>B(),disabled:y,children:d?"Unfollow":"Follow"})}),s(z,{children:[e("thead",{children:s("tr",{children:[e("th",{children:s("span",{className:"SRC-split",children:[e("span",{children:"Topic"}),e(C,{role:"button","aria-label":"Sort by Topic",active:o===i.THREAD_TITLE,direction:o==="THREAD_TITLE"?l===!1?a.DESC:a.ASC:a.DESC,onClick:()=>E(i.THREAD_TITLE)})]})}),e("th",{children:"Author"}),e("th",{children:"Active Users"}),e("th",{children:s("span",{className:"SRC-split",children:[e("span",{children:"Replies"}),e(C,{role:"button","aria-label":"Sort by Replies",active:o===i.NUMBER_OF_REPLIES,direction:o==="NUMBER_OF_REPLIES"?l===!1?a.DESC:a.ASC:a.DESC,onClick:()=>E(i.NUMBER_OF_REPLIES)})]})}),e("th",{children:s("span",{className:"SRC-split",children:[e("span",{children:"Views"}),e(C,{role:"button","aria-label":"Sort by Views",active:o===i.NUMBER_OF_VIEWS,direction:o==="NUMBER_OF_VIEWS"?l===!1?a.DESC:a.ASC:a.DESC,onClick:()=>E(i.NUMBER_OF_VIEWS)})]})}),e("th",{children:s("span",{className:"SRC-split",children:[e("span",{children:"Activity"}),e(C,{role:"button","aria-label":"Sort by Last Activity",active:o===i.PINNED_AND_LAST_ACTIVITY,direction:o==="PINNED_AND_LAST_ACTIVITY"?l===!1?a.DESC:a.ASC:a.DESC,onClick:()=>E(i.PINNED_AND_LAST_ACTIVITY)})]})})]})}),e("tbody",{children:L.map(t=>s("tr",{children:[e("td",{children:s("a",{href:g(t.id,t.projectId),children:[t.isPinned?e(j,{options:{icon:"pushpin"}}):e(D,{}),t.title]})}),e("td",{children:e(N,{size:x,ownerId:t.createdBy})}),e("td",{children:t.activeAuthors.map(u=>e("div",{className:"avatarContainer",children:e(N,{showCardOnHover:!0,className:"ActiveUsers",size:w,avatarSize:"MEDIUM",ownerId:u})},u))}),e("td",{children:t.numberOfReplies}),e("td",{children:t.numberOfViews}),e("td",{children:M(t.lastActivity).format("L")})]},t.id))})]}),U?e(R,{variant:"outline-primary",onClick:()=>v(),children:"Show more results"}):e(D,{})]})};try{T.displayName="ForumTable",T.__docgenInfo={description:"",displayName:"ForumTable",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},filter:{defaultValue:null,description:"",name:"filter",required:!1,type:{name:"enum",value:[{value:'"NO_FILTER"'},{value:'"DELETED_ONLY"'},{value:'"EXCLUDE_DELETED"'}]}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/discussion_forum/ForumTable.tsx#ForumTable"]={docgenInfo:T.__docgenInfo,name:"ForumTable",path:"src/lib/containers/discussion_forum/ForumTable.tsx#ForumTable"})}catch{}const xe={parameters:{storySource:{source:`import React from 'react'
import { ComponentStory, ComponentMeta } from '@storybook/react'

import { ForumTable } from './ForumTable'

export default {
  title: 'Synapse/ForumTable',
  component: ForumTable,
  argTypes: {},
} as ComponentMeta<typeof ForumTable>

const Template: ComponentStory<typeof ForumTable> = args => (
  <ForumTable {...args} />
)

export const ForumTableDemo = Template.bind({})
ForumTableDemo.args = {
  forumId: '1032',
  limit: 20,
}
`,locationsMap:{"forum-table-demo":{startLoc:{col:52,line:12},endLoc:{col:1,line:14},startBody:{col:52,line:12},endBody:{col:1,line:14}}}}},title:"Synapse/ForumTable",component:T,argTypes:{}},$=r=>e(T,{...r}),K=$.bind({});K.args={forumId:"1032",limit:20};const we=["ForumTableDemo"];export{K as ForumTableDemo,we as __namedExportsOrder,xe as default};

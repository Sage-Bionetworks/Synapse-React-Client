import{r as v,a as I,j as o,R as Y,F as V}from"./jsx-runtime.a638b984.js";import{I as se}from"./IconSvg.9dec1c98.js";import{az as le,at as ie}from"./index.b83134ec.js";import{u as de}from"./useDataAccessSubmission.96b594a8.js";import{ap as ue,i as me}from"./SynapseConstants.aef18750.js";import{c as pe}from"./useGetQueryResultBundle.625d0cdf.js";import{S as fe}from"./immutable.es.28139da3.js";import{S as he}from"./ManagedACTAccessRequirementStatus.be369a71.js";import{S as be}from"./LoadingScreen.aa28caa1.js";import{F as ge}from"./FullWidthAlert.97efcbea.js";import{d as Ce}from"./ToastMessage.1f086d0d.js";import{M as xe,D as ye,a as Re}from"./DialogContent.7066f2fe.js";import{D as Ie,S as W}from"./Stack.ea7c6c1e.js";import{B as oe}from"./Box.b05d96cb.js";import{I as Se}from"./IconButton.7cd1b748.js";import{B as A}from"./Button.666a2c38.js";import{T as S}from"./Typography.1d6efe32.js";import{u as ne,f as Ee,F as ke}from"./FormLabel.3bba4ebc.js";import{T as ve}from"./TextField.ef885b7e.js";import{g as H,d as Q,s as j,_ as g,h as J,i as K,A as F,j as X,G as Te,D as _e,e as ae}from"./styled.d7b43787.js";import{B as Be}from"./ButtonBase.bc378f3c.js";import{u as we,c as Z}from"./Tooltip.9be437e1.js";function qe(e){return H("PrivateSwitchBase",e)}Q("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Me=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],Fe=e=>{const{classes:t,checked:n,disabled:s,edge:a}=e,r={root:["root",n&&"checked",s&&"disabled",a&&`edge${F(a)}`],input:["input"]};return X(r,qe,t)},Le=j(Be)(({ownerState:e})=>g({padding:9,borderRadius:"50%"},e.edge==="start"&&{marginLeft:e.size==="small"?-3:-12},e.edge==="end"&&{marginRight:e.size==="small"?-3:-12})),Pe=j("input")({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Ae=v.exports.forwardRef(function(t,n){const{autoFocus:s,checked:a,checkedIcon:r,className:d,defaultChecked:b,disabled:m,disableFocusRipple:u=!1,edge:C=!1,icon:x,id:c,inputProps:p,inputRef:l,name:T,onBlur:y,onChange:R,onFocus:f,readOnly:E,required:O,tabIndex:$,type:w,value:M}=t,L=J(t,Me),[i,_]=we({controlled:a,default:Boolean(b),name:"SwitchBase",state:"checked"}),h=ne(),B=k=>{f&&f(k),h&&h.onFocus&&h.onFocus(k)},D=k=>{y&&y(k),h&&h.onBlur&&h.onBlur(k)},P=k=>{if(k.nativeEvent.defaultPrevented)return;const te=k.target.checked;_(te),R&&R(k,te)};let q=m;h&&typeof q>"u"&&(q=h.disabled);const ce=w==="checkbox"||w==="radio",z=g({},t,{checked:i,disabled:q,disableFocusRipple:u,edge:C}),ee=Fe(z);return I(Le,g({component:"span",className:K(ee.root,d),centerRipple:!0,focusRipple:!u,disabled:q,tabIndex:null,role:void 0,onFocus:B,onBlur:D,ownerState:z,ref:n},L,{children:[o(Pe,g({autoFocus:s,checked:a,defaultChecked:b,className:ee.input,disabled:q,id:ce&&c,name:T,onChange:P,readOnly:E,ref:l,required:O,ownerState:z,tabIndex:$,type:w},w==="checkbox"&&M===void 0?{}:{value:M},p)),i?r:x]}))}),Ne=Ae,je=Z(o("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),Oe=Z(o("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),$e=Z(o("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function De(e){return H("MuiCheckbox",e)}const ze=Q("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary"]),U=ze,Ue=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],Ge=e=>{const{classes:t,indeterminate:n,color:s}=e,a={root:["root",n&&"indeterminate",`color${F(s)}`]},r=X(a,De,t);return g({},t,r)},Ye=j(Ne,{shouldForwardProp:e=>Te(e)||e==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,n.color!=="default"&&t[`color${F(n.color)}`]]}})(({theme:e,ownerState:t})=>g({color:(e.vars||e).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${t.color==="default"?e.vars.palette.action.activeChannel:e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.hoverOpacity})`:_e(t.color==="default"?e.palette.action.active:e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${U.checked}, &.${U.indeterminate}`]:{color:(e.vars||e).palette[t.color].main},[`&.${U.disabled}`]:{color:(e.vars||e).palette.action.disabled}})),Ve=o(Oe,{}),We=o(je,{}),He=o($e,{}),Qe=v.exports.forwardRef(function(t,n){var s,a;const r=ae({props:t,name:"MuiCheckbox"}),{checkedIcon:d=Ve,color:b="primary",icon:m=We,indeterminate:u=!1,indeterminateIcon:C=He,inputProps:x,size:c="medium",className:p}=r,l=J(r,Ue),T=u?C:m,y=u?C:d,R=g({},r,{color:b,indeterminate:u,size:c}),f=Ge(R);return o(Ye,g({type:"checkbox",inputProps:g({"data-indeterminate":u},x),icon:v.exports.cloneElement(T,{fontSize:(s=T.props.fontSize)!=null?s:c}),checkedIcon:v.exports.cloneElement(y,{fontSize:(a=y.props.fontSize)!=null?a:c}),ownerState:R,ref:n,className:K(f.root,p)},l,{classes:f}))}),Je=Qe;function Ke(e){return H("MuiFormControlLabel",e)}const Xe=Q("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error"]),N=Xe,Ze=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","value"],et=e=>{const{classes:t,disabled:n,labelPlacement:s,error:a}=e,r={root:["root",n&&"disabled",`labelPlacement${F(s)}`,a&&"error"],label:["label",n&&"disabled"]};return X(r,Ke,t)},tt=j("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${N.label}`]:t.label},t.root,t[`labelPlacement${F(n.labelPlacement)}`]]}})(({theme:e,ownerState:t})=>g({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${N.disabled}`]:{cursor:"default"}},t.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},t.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},t.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${N.label}`]:{[`&.${N.disabled}`]:{color:(e.vars||e).palette.text.disabled}}})),ot=v.exports.forwardRef(function(t,n){const s=ae({props:t,name:"MuiFormControlLabel"}),{className:a,componentsProps:r={},control:d,disabled:b,disableTypography:m,label:u,labelPlacement:C="end"}=s,x=J(s,Ze),c=ne();let p=b;typeof p>"u"&&typeof d.props.disabled<"u"&&(p=d.props.disabled),typeof p>"u"&&c&&(p=c.disabled);const l={disabled:p};["checked","name","onChange","value","inputRef"].forEach(E=>{typeof d.props[E]>"u"&&typeof s[E]<"u"&&(l[E]=s[E])});const T=Ee({props:s,muiFormControl:c,states:["error"]}),y=g({},s,{disabled:p,labelPlacement:C,error:T.error}),R=et(y);let f=u;return f!=null&&f.type!==S&&!m&&(f=o(S,g({component:"span",className:R.label},r.typography,{children:f}))),I(tt,g({className:K(R.root,a),ownerState:y,ref:n},x,{children:[v.exports.cloneElement(d,l),f]}))}),st=ot,re="category",nt="category email prompt",at="rejection reason",rt="email text",ct=`Thank you for submitting your data access request.
`,lt=`
If you have questions, do not respond to this email address. Instead, reply to:
act@sagebionetworks.org`;function it(e){const{category:t,rows:n,selectedRowIds:s,setSelectedRowIds:a,rejectionReasonFormTextIndex:r}=e,[d,b]=Y.useState(!1);return I(V,{children:[I(S,{variant:"body1",onClick:()=>b(!d),sx:{fontWeight:700,cursor:"pointer",my:1},children:[o(se,{icon:d?"expandMore":"chevronRight",sx:{color:"grey.700"},wrap:!1}),t]}),o(ie,{in:d,children:o(W,{sx:{ml:3},children:(n!=null?n:[]).map(m=>o(st,{control:o(Je,{checked:s.has(m.rowId),size:"small",onChange:u=>{u.target.checked?a(s.add(m.rowId)):a(s.remove(m.rowId))}}),label:o(S,{variant:"smallText1",children:m.values[r]})},m.rowId))})})]})}function dt(e){var C,x;const{tableQuery:t,selectedRowIds:n,setSelectedRowIds:s}=e,{data:a,isLoading:r,error:d}=t,b=(C=a==null?void 0:a.queryResult)==null?void 0:C.queryResults.headers.findIndex(c=>c.name.toLowerCase()===re),m=(x=a==null?void 0:a.queryResult)==null?void 0:x.queryResults.headers.findIndex(c=>c.name.toLowerCase()===at),u=a&&a.queryResult&&a.queryResult.queryResults.rows.reduce((c,p)=>{const l=p.values[b];return c[l]=[...c[l]||[],p],c},{});return I(V,{children:[o(S,{variant:"headline3",gutterBottom:!0,children:"Reasons for rejecting"}),o(S,{variant:"body1",gutterBottom:!0,children:"You may wish to reject the user's data access request for a specific reason. The list below contains some common rejection reasons. You will have a chance to edit the response before submitting it, including adding any rejection reason(s) not listed here."}),r&&o(W,{sx:{my:2},children:o(be,{size:30})}),d&&o(le,{error:d}),u&&o(ke,{children:Object.keys(u).map(c=>o(it,{category:c,rows:u[c],selectedRowIds:n,setSelectedRowIds:s,rejectionReasonFormTextIndex:m},c))}),o(S,{variant:"headline3",sx:{mt:1},gutterBottom:!0,children:"We\u2019ll generate a response email message based on your selections."}),o(S,{variant:"body1",gutterBottom:!0,children:"If your reasons for rejecting are not shown here, that\u2019s okay! You can edit the complete text of the message on the next screen before sending it."})]})}function ut(e){const{emailText:t,setEmailText:n}=e;return I(V,{children:[o(S,{variant:"headline3",gutterBottom:!0,children:"Edit the text of the rejection message"}),o(S,{variant:"body1",gutterBottom:!0,children:"This message will be sent to the data requester. You may edit it, or add custom text to the message."}),o(ve,{multiline:!0,fullWidth:!0,rows:15,value:t,onChange:s=>{n(s.target.value)}})]})}function G(e){var w,M,L;const{open:t,tableId:n=ue,onClose:s,submissionId:a}=e,[r,d]=Y.useState(1),[b,m]=Y.useState(null),[u,C]=v.exports.useState(""),[x,c]=v.exports.useState(fe()),p=pe({entityId:n,query:{sql:`SELECT * FROM ${n}`},partMask:me,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),{data:l}=p,T=(w=l==null?void 0:l.queryResult)==null?void 0:w.queryResults.headers.findIndex(i=>i.name.toLowerCase()===re),y=(M=l==null?void 0:l.queryResult)==null?void 0:M.queryResults.headers.findIndex(i=>i.name.toLowerCase()===nt),R=(L=l==null?void 0:l.queryResult)==null?void 0:L.queryResults.headers.findIndex(i=>i.name.toLowerCase()===rt),f=l&&l.queryResult&&x.reduce((i,_)=>{const h=l.queryResult.queryResults.rows.find(q=>q.rowId===_),B=h.values[T],D=h.values[y],P=h.values[R];return i[B]?i[B].reasons=[...i[B].reasons,P]:i[B]={sectionText:D,reasons:[P]},i},{}),E=f&&ct+Object.keys(f).reduce((i,_)=>{const h=f[_].sectionText;i+=`
`+h+`
`;for(const B of f[_].reasons)i+=`
* `+B+`
`;return i},"")+lt;v.exports.useEffect(()=>{E&&C(E)},[x]);const{mutate:O}=de();function $(i){O({submissionId:a.toString(),newState:he.REJECTED,rejectedReason:i},{onSuccess:()=>{m(null),Ce("Submission rejected and message sent to requester","info"),s()},onError:_=>{m(_)}})}return I(xe,{open:t,onClose:s,maxWidth:"md",fullWidth:!0,children:[o(Ie,{children:I(W,{direction:"row",alignItems:"center",gap:"5px",children:["Reject Request?",o(oe,{sx:{flexGrow:1}}),o(Se,{onClick:s,children:o(se,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),I(ye,{children:[r===1&&o(dt,{tableQuery:p,selectedRowIds:x,setSelectedRowIds:c}),r===2&&o(ut,{emailText:u,setEmailText:C}),b&&o(ge,{variant:"danger",description:b.reason,isGlobal:!1})]}),I(Re,{children:[r===2&&o(A,{variant:"outlined",onClick:()=>d(1),children:"Back"}),o(oe,{sx:{flexGrow:1}}),o(A,{variant:"outlined",onClick:s,children:"Cancel"}),r===1&&o(A,{variant:"contained",onClick:()=>d(2),children:"Generate Email"}),r===2&&o(A,{variant:"contained",onClick:()=>{$(u)},children:"Reject and Notify Requester"})]})]})}try{G.displayName="RejectDataAccessRequestModal",G.__docgenInfo={description:`Modal component presented to a data access submission reviewer when they decide to reject a request.
The modal contains a form for selecting rejection reasons and a text field for editing the rejection message.
After crafting a message, the user can reject the submission and send the message to the requester.`,displayName:"RejectDataAccessRequestModal",props:{submissionId:{defaultValue:null,description:"",name:"submissionId",required:!0,type:{name:"string | number"}},tableId:{defaultValue:null,description:"",name:"tableId",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/dataaccess/RejectDataAccessRequestModal.tsx#RejectDataAccessRequestModal"]={docgenInfo:G.__docgenInfo,name:"RejectDataAccessRequestModal",path:"src/lib/containers/dataaccess/RejectDataAccessRequestModal.tsx#RejectDataAccessRequestModal"})}catch{}export{G as R};

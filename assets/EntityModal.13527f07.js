import{e as V,c as H,d as j,E as Y,f as G,a as U}from"./EntityTypeUtils.30cdb3ab.js";import{g as q,B as x}from"./getEndpoint.0de7fccf.js";import{u as K}from"./useEntityBundle.8ae8dd7b.js";import{u as z,S as J}from"./SchemaDrivenAnnotationEditor.f5edd15a.js";import{a as W,J as Q}from"./useUserBundle.07091a81.js";import{e as X}from"./useEntity.11587eee.js";import{S as Z}from"./SkeletonTable.c6b86b10.js";import{a as n,j as a,F as C}from"./jsx-runtime.2e925369.js";import{i as ee}from"./isEmpty.12a3904b.js";import{h as k}from"./moment.81704e1d.js";import{f as L}from"./DateFormatter.13bb0997.js";import{E as R}from"./ExternalFileHandleInterface.65bff6a5.js";import"./assert.5e30d765.js";import{U as B}from"./UserCard.95c0756f.js";import{r as ae}from"./FullWidthAlert.a054f15b.js";import{R as te}from"./index.es.82d55a6a.js";import{T as ne}from"./Typography.e08e7569.js";import{H as oe}from"./HelpPopover.257a6485.js";import{M as y}from"./Modal.739750b1.js";import{S as D}from"./Skeleton.bf1489f0.js";import{B as ie}from"./Button.77571428.js";import{d as le}from"./ToastMessage.574c0fe0.js";function P(e){const{copy:i,skeleton:t,...o}=e;return e.skeleton?a(D,{variant:"rect",width:150}):a(ie,{...o,children:i})}const A=e=>{var i,t,o;return n(y,{className:`FluidModal bootstrap-4-backport ${(i=e.className)!=null?i:""}`,backdrop:"static",animation:!1,show:e.show,onHide:e.onClose,children:[a(y.Header,{closeButton:!0,children:a(y.Title,{children:n(ne,{variant:"headline1",children:[e.title,e.titlePopoverProps&&a(oe,{placement:"right",...e.titlePopoverProps,className:"SRC-margin-left-5 "+((o=(t=e.titlePopoverProps)==null?void 0:t.className)!=null?o:"")})]})})}),a(y.Body,{children:e.children}),n(y.Footer,{children:[e.secondaryActions&&e.secondaryActions.reverse().map((d,r)=>a(P,{variant:"outline",...d},r)),e.primaryAction&&a(P,{variant:"sds-primary",...e.primaryAction})]})]})};try{A.displayName="FluidModal",A.__docgenInfo={description:"Full-screen modal that scales with screen size. Fits requirements defined in SWC-5801",displayName:"FluidModal",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string | Element"}},titlePopoverProps:{defaultValue:null,description:"",name:"titlePopoverProps",required:!1,type:{name:"HelpPopoverProps"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},primaryAction:{defaultValue:null,description:"",name:"primaryAction",required:!1,type:{name:"ModalAction"}},secondaryActions:{defaultValue:null,description:"",name:"secondaryActions",required:!1,type:{name:"ModalAction[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/FluidModal.tsx#FluidModal"]={docgenInfo:A.__docgenInfo,name:"FluidModal",path:"src/lib/containers/FluidModal.tsx#FluidModal"})}catch{}const N=({entityId:e})=>{const{isInExperimentalMode:i}=W(),{entityMetadata:t,annotations:o,isLoading:d}=X(e),{data:r}=z(e,{enabled:i});return d?a(Z,{numRows:3,numCols:2}):n(C,{children:[t&&o&&ee(o)?n("div",{className:"placeholder",children:["This"," ",V(H(t.concreteType))," ","has no annotations."]}):null,a("table",{className:"AnnotationsTable",children:n("tbody",{children:[o&&Object.keys(o).map(s=>n("tr",{className:"AnnotationsTable__Row",children:[a("td",{className:"AnnotationsTable__Row__Key",children:s}),a("td",{className:"AnnotationsTable__Row__Value",children:Array.isArray(o[s])?o[s].join(", "):o[s].toString()})]},s)),r&&i?n("tr",{className:"AnnotationsTable__Row",children:[a("td",{className:"AnnotationsTable__Row__Key Schema",children:"Validation Schema"}),a("td",{className:"AnnotationsTable__Row__Value",children:a("a",{href:`${q(x.REPO_ENDPOINT)}repo/v1/schema/type/registered/${r.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:r.jsonSchemaVersionInfo.schemaName})})]}):null]})})]})};try{N.displayName="AnnotationsTable",N.__docgenInfo={description:"",displayName:"AnnotationsTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/entity/metadata/AnnotationsTable.tsx#AnnotationsTable"]={docgenInfo:N.__docgenInfo,name:"AnnotationsTable",path:"src/lib/containers/entity/metadata/AnnotationsTable.tsx#AnnotationsTable"})}catch{}var O=(e=>(e.S3FileHandle="org.sagebionetworks.repo.model.file.S3FileHandle",e.GoogleCloudFileHandle="org.sagebionetworks.repo.model.file.GoogleCloudFileHandle",e))(O||{});function se(e){switch(e.concreteType){case R.ProxyFileHandle:return e.filePath;case R.ExternalObjectStoreFileHandle:return e.bucket;case R.ExternalFileHandle:return e.externalURL;case O.S3FileHandle:return e.storageLocationId===1?"Synapse Storage":`s3://${e.bucketName}`;case O.GoogleCloudFileHandle:return`gs://${e.bucketName}`;default:throw new Error(`Couldn't determine location name for file handle: ${JSON.stringify(e)}`)}}const re=window.React.useEffect,de=window.React.useState,S=({entityId:e,versionNumber:i})=>{var s,c,f,m,u,p;const{data:t}=K(e,void 0,i),o=t&&j(t.entity),[d,r]=de();return re(()=>{var T;if((t==null?void 0:t.entityType)===Y.FILE){const l=(T=t.fileHandles)==null?void 0:T.filter(M=>M.id===t.entity.dataFileHandleId)[0];l&&r(se(l))}},[t]),t?a("table",{className:"MetadataTable",children:n("tbody",{children:[n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Name"}),a("td",{className:"MetadataTable__Row__Value",children:(s=t.entity)==null?void 0:s.name})]}),n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Type"}),a("td",{className:"MetadataTable__Row__Value",children:V(t.entityType)})]}),n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),a("td",{className:"MetadataTable__Row__Value",children:(c=t.entity)==null?void 0:c.id})]}),o&&n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Version"}),a("td",{className:"MetadataTable__Row__Value",children:G(t.entity)})]}),d&&n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Storage"}),a("td",{className:"MetadataTable__Row__Value",children:d})]}),n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),n("td",{className:"MetadataTable__Row__Value",children:[a(B,{size:"SMALL USER CARD",ownerId:(f=t.entity)==null?void 0:f.modifiedBy})," ","at ",L(k((m=t.entity)==null?void 0:m.modifiedOn))]})]}),n("tr",{className:"MetadataTable__Row",children:[a("td",{className:"MetadataTable__Row__Key",children:"Created By"}),n("td",{className:"MetadataTable__Row__Value",children:[a(B,{size:"SMALL USER CARD",ownerId:(u=t.entity)==null?void 0:u.createdBy})," ","at ",L(k((p=t.entity)==null?void 0:p.createdOn))]})]})]})}):null};try{S.displayName="MetadataTable",S.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/entity/metadata/MetadataTable.tsx#MetadataTable"]={docgenInfo:S.__docgenInfo,name:"MetadataTable",path:"src/lib/containers/entity/metadata/MetadataTable.tsx#MetadataTable"})}catch{}const ce=window.React.useEffect,me=window.React.useRef,w=window.React.useState;var v=(e=>(e.METADATA="METADATA",e.ANNOTATIONS="ANNOTATIONS",e))(v||{});const g=({entityId:e,versionNumber:i,show:t,onClose:o,initialTab:d="METADATA",showTabs:r=!0})=>{var F;const s=me(null),[c,f]=w(d),[m,u]=w(!1),[p,T]=w(!1),{data:l}=K(e,void 0,i),M=l&&((F=l.permissions)==null?void 0:F.canEdit),E=l&&U(l.entityType),I=E&&l.entity.isLatestVersion;ce(()=>{ae()});let b,h;return l?window.location.href.includes(e)||(b={skeleton:!1,copy:`Open ${V(l.entityType)}`,onClick:()=>window.open(`${q(x.PORTAL_ENDPOINT)}#!Synapse:${e}`,"_blank","noopener")}):(b={skeleton:!0},h=void 0),c==="ANNOTATIONS"&&(m?(b={copy:"Save Annotations",onClick:()=>{var _;(_=s.current)==null||_.submit()}},h=[{copy:p?"Are you sure? Unsaved changes will be lost":"Cancel",onClick:()=>{p&&u(!1),T(!p)}}]):M&&(h=[{copy:"Edit",disabled:E&&!I,"data-for":"entityModalTooltip","data-tip":E&&!I?"Annotations can only be edited on the latest version":void 0,onClick:()=>{u(!0)}}])),a(C,{children:a(A,{className:`EntityMetadata ${m?"isInEditMode":""}`,title:l?a(y.Title,{children:l.entity.name}):a(D,{width:"40%"}),show:t,onClose:o,primaryAction:b,secondaryActions:h,children:n(C,{children:[a(te,{id:"entityModalTooltip",delayShow:300,type:"dark",effect:"solid",className:"SRC-tooltip"}),r&&!m?a("div",{className:"Tabs",children:Object.keys(v).map(_=>a("div",{className:"Tab",role:"tab",onClick:$=>{$.stopPropagation(),f(v[_])},"aria-selected":_===c,children:_},_))}):null,a("div",{style:c==="ANNOTATIONS"?{}:{display:"none"},children:m?a(Q,{children:a(J,{entityId:e,formRef:s,onSuccess:()=>{le("Annotations successfully updated.","success"),u(!1)},onCancel:()=>u(!1)})}):a(N,{entityId:e,versionNumber:i})}),a("div",{style:c==="METADATA"?{}:{display:"none"},children:a(S,{entityId:e,versionNumber:i})})]})})})};try{g.displayName="EntityModal",g.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:{value:"EntityModalTabs.METADATA"},description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:{value:"true"},description:"",name:"showTabs",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/entity/metadata/EntityModal.tsx#EntityModal"]={docgenInfo:g.__docgenInfo,name:"EntityModal",path:"src/lib/containers/entity/metadata/EntityModal.tsx#EntityModal"})}catch{}export{g as E,A as F,v as a};
//# sourceMappingURL=EntityModal.13527f07.js.map

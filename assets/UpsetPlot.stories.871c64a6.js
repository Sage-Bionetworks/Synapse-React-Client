import{a as M,j as p,F as ee}from"./jsx-runtime.2e925369.js";import{w as pt,E as ht,B as yt,_ as gt}from"./index.29a7f152.js";import{r as bt}from"./react-sizeme.72bae47f.js";import{g as St}from"./ColorGradient.16f0e0f2.js";import{p as xt}from"./sqlFunctions.b49ac766.js";import{l as $t}from"./LoadingScreen.56f18e4f.js";import{B as vt}from"./Button.c582ea4c.js";import"./objectWithoutPropertiesLoose.090b3c10.js";import"./withStyles.8be28b48.js";import"./toConsumableArray.b3669986.js";import"./Alert.eafe86e9.js";import"./index.f252d424.js";import"./Transition.d42a873e.js";import"./index.06f4a415.js";import"./toString.8ef640ae.js";import"./assert.f243583f.js";import"./iframe.e1b191de.js";import"./index.8cde812d.js";import"./getEndpoint.0de7fccf.js";import"./SvgIcon.31249d58.js";import"./colorPalette.8145e2e2.js";import"./Typography.bfdf676e.js";import"./makeStyles.9dfaa099.js";import"./useTheme.8804f8cd.js";import"./Modal.58357e58.js";import"./useWaitForDOMRef.c89dbc64.js";import"./useWillUnmount.4a16e5cd.js";import"./removeClass.27874bcb.js";import"./hasClass.56fd144a.js";function wt(e){return e instanceof Set?e.size:e.length}function oe(e,t){const r=t?new Set((e instanceof Set?Array.from(e):e).map(t)):e instanceof Set?e:new Set(e),o=r.size,n={setA:o,setB:o,union:o,intersection:o};return s=>{if(s===e)return n;let i=0;s.forEach(a=>{(t&&r.has(t(a))||!t&&r.has(a))&&i++});const l=wt(s);return{setA:o,setB:l,intersection:i,union:o+l-i}}}function Qe(e,t){const r=t?new Set((e instanceof Set?Array.from(e):e).map(t)):e instanceof Set?e:new Set(e),o=Array.isArray(e)?e:Array.from(e),n={setA:o,setB:o,union:o,intersection:o};return s=>{if(s===e)return n;const i=[],l=o.slice();return s.forEach(a=>{t&&r.has(t(a))||!t&&r.has(a)?i.push(a):l.push(a)}),{setA:o,setB:Array.isArray(s)?s:Array.from(s),intersection:i,union:l}}}function Ct(e,t){const r=e instanceof Set?Array.from(e):e,o=t?new Set(r.map(t)):e instanceof Set?e:new Set(e);return n=>{if(n===e)return r;const s=[];return n.forEach(i=>{(t&&o.has(t(i))||!t&&o.has(i))&&s.push(i)}),s}}function K(e){return Array.isArray(e.elems)}function Je(e){return typeof e.overlap=="function"}function Q(e){return e.set!=null}function At(e,t,r){if(Je(e))return e.overlap;if(Q(e)&&e.set.overlap)return e.set.overlap;const o=oe(K(e)?e.elems:e.set.elems,r);return n=>n.overlap&&K(e)&&Array.isArray(e.elems)?n.overlap(e.elems):n.overlap&&Q(e)?n.overlap(e.set):o(n.elems)[t]}function Nt(e,t,r){if(Je(e))return()=>null;if(t==="intersection"){const n=Ct(K(e)?e.elems:e.set.elems,r);return s=>n(s.elems)}const o=Qe(K(e)?e.elems:e.set.elems,r);return n=>o(n.elems)[t]}function Xe(e){const t=e;return e!=null&&typeof t.cardinality=="number"&&typeof e.name=="string"&&Array.isArray(e.elems)}function Se(e){return Xe(e)&&e.type==="set"}function Lt(e){const t=e;return Xe(e)&&["composite","union","intersection","distinctIntersection"].includes(t.type)&&t.sets instanceof Set&&typeof t.degree=="number"}function se(e){return Se(e)||Lt(e)}function q(e,t){return e.name.localeCompare(t.name)}function me(e,t){return t.cardinality-e.cardinality}function Ee(e,t){return e.degree-t.degree}function xe(e){return(t,r)=>e.reduce((o,n)=>o===0?n(t,r):o,0)}function X(e){return(t,r)=>-e(t,r)}function Ie(e){return(t,r)=>{const o=i=>i<0?Number.POSITIVE_INFINITY:i,n=o(e.findIndex(i=>t.sets.has(i))),s=o(e.findIndex(i=>r.sets.has(i)));return n-s}}function Ot(e,t){if(!t)return q;const r=Array.isArray(t)?t:[t];return r.length===0?q:xe(r.map(o=>{switch(o){case"cardinality":case"cardinality:desc":return me;case"cardinality:asc":return X(me);case"name:desc":return X(q);case"degree":case"degree:asc":return Ee;case"degree:desc":return X(Ee);case"group":case"group:asc":return Ie(e);case"group:desc":return X(Ie(e));default:return q}}))}function Mt(e,t,r={}){let o=t;return r.order&&(o=o.sort(Ot(e,r.order))),r.limit!=null?o.slice(0,r.limit):o}const Ae={distinctIntersection:" \u2229 ",intersection:" \u2229 ",union:" \u222A ",composite:","};function kt(e){if(!e)return[255,255,255];const t=e.match(/#([\da-f]{2})([\da-f]{2})([\da-f]{2})/i);if(t)return[Number.parseInt(t[1],16),Number.parseInt(t[2],16),Number.parseInt(t[3],16)];const r=e.match(/\(([\d]+)[, ]([\d]+)[, ]([\d]+)\)/i);return r?[Number.parseInt(r[1],10),Number.parseInt(r[2],10),Number.parseInt(r[3],10)]:[255,255,255]}function Tt(e){if(e.length===1)return e[0];if(e.every(s=>s==null))return;const t=e.map(kt),r=Math.floor(t.reduce((s,i)=>s+i[0],0)/t.length),o=Math.floor(t.reduce((s,i)=>s+i[1],0)/t.length),n=Math.floor(t.reduce((s,i)=>s+i[2],0)/t.length);return`#${r.toString(16)}${o.toString(16)}${n.toString(16)}`}function Ze(e,t,r){const o=Array.from(e).sort((n,s)=>t.get(n)-t.get(s));return o.length===1?o[0].name:`(${o.map(n=>n.name).join(r)})`}function V(e,t,r,o,n){return{type:r.size===0?"composite":e,elems:o,color:n(Array.from(r).map(s=>s.color)),sets:r,name:t,cardinality:o.length,degree:r.size}}function _t(e,t,r,o,n,s,i){const l=new Set(e.sets);t.sets.forEach(A=>l.add(A));const a=Ze(l,n,Ae[s]);if(e.cardinality===0||t.cardinality===0)return V(s,a,l,[],i);let f=e,c=t;e.cardinality>t.cardinality&&(f=t,c=e);const u=new Set,d=r.get(c),m=[],g=f.elems.length;for(let A=0;A<g;A++){const v=f.elems[A],C=o(v);!d.has(C)||(u.add(C),m.push(v))}const x=V(s,a,l,m,i);return r.set(x,u),x}function Et(e,t,r,o,n,s,i){const l=new Set(e.sets);t.sets.forEach(x=>l.add(x));const a=Ze(l,n,Ae[s]);if(e.cardinality===0){const x=V(s,a,l,t.elems,i);return r.set(x,r.get(t)),x}if(t.cardinality===0){const x=V(s,a,l,e.elems,i);return r.set(x,r.get(e)),x}let f=e,c=t;e.cardinality>t.cardinality&&(f=t,c=e);const u=new Set(r.get(c)),d=r.get(c),m=c.elems.slice();f.elems.forEach(x=>{const A=o(x);d.has(A)||(u.add(A),m.push(x))});const g=V(s,a,l,m,i);return r.set(g,u),g}function Ue(e,t,r,o,n,s){if(typeof t=="number")return{type:"composite",elems:[],color:s?s([]):void 0,sets:new Set,name:"()",cardinality:t,overlap(a){return a===this||se(a)&&a.name===this.name&&a.cardinality===this.cardinality?this.cardinality:0},degree:0};if(Array.isArray(t))return V(e,"()",new Set,t,s);const i=Array.from(o.values()),l=r.filter(a=>{const f=n(a);return i.every(c=>!c.has(f))});return V(e,"()",new Set,l,s)}function ze(e,t={}){const{type:r="intersection",min:o=0,max:n=Number.POSITIVE_INFINITY,empty:s=!1,elems:i=[],notPartOfAnySet:l,toElemKey:a,mergeColors:f=Tt}=t,c=[],u=new Map(e.map((b,$)=>[b,$])),d=new Map(e.map(b=>[b,a?new Set(b.elems.map(a)):new Set(b.elems)])),m=a?null:d,g=a?d:null,x=r==="union"?Et:_t;function A(b){if(b.degree<o||b.degree>n||b.cardinality===0&&!s)return;if(r!=="distinctIntersection"){c.push(b);return}const $=e.filter(S=>!b.sets.has(S));let w=[];if(a){const S=$.map(y=>g.get(y));w=b.elems.filter(y=>{const N=a(y);return S.every(L=>!L.has(N))})}else{const S=$.map(y=>m.get(y));w=b.elems.filter(y=>S.every(N=>!N.has(y)))}if(w.length===b.cardinality){c.push(b);return}const h=V(r,b.name,b.sets,w,f);h.cardinality===0&&!s||c.push(h)}function v(b,$,w,h){if($>n)return;const S=b.length;for(let y=0;y<S;y++){const N=b[y],L=[];for(let E=y+1;E<S;E++){const I=b[E],D=x(N,I,w,h,u,r,f);A(D),(r==="union"||D.cardinality>0||s)&&L.push(D)}L.length>1&&v(L,$+1,w,h)}}o<=0&&A(a?Ue(r,l,i,g,a,f):Ue(r,l,i,m,b=>b,f));const C=e.map(b=>{const $=V(r,b.name,new Set([b]),b.elems,f);return d.set($,d.get(b)),A($),$});return a?v(C,2,g,a):v(C,2,m,b=>b),Mt(e,c,t)}function It(e){if(!e)return q;switch(e){case"cardinality":case"cardinality:desc":return xe([me,q]);case"cardinality:asc":return xe([X(me),q]);case"name:desc":return X(q);default:return q}}function Ut(e,t={}){let r=e;if(t.order){const o=It(t.order);r=r.slice().sort(o)}return t.limit!=null?r.slice(0,t.limit):r}function Pt(e,t,r={}){var o;const n=typeof t=="function"?t:l=>l.sets,s=(o=typeof t!="function"?t:r)!==null&&o!==void 0?o:{},i=Object.create(null);return e.forEach(l=>{n(l).forEach(a=>{const f=typeof a=="string"?a:String(a),c=i[f];c==null?i[f]=[l]:c.push(l)})}),Ut(Object.entries(i).map(([l,a])=>({type:"set",elems:a,name:String(l),cardinality:a.length})),s)}function G(e){return`${e.name}:${e.type}#${e.cardinality}`}function Pe(e){return e.sets.size===0}function Ne(e,t,r=G){const o={done:null,aKey:"",bKey:"",aIsSet:!1,bIsSet:!1,toKey:r};return e===t?(o.done=e.cardinality,o):e.cardinality===0||t.cardinality===0?(o.done=0,o):(o.aKey=r(e),o.bKey=r(t),o.aKey===o.bKey?(o.done=e.cardinality,o):(o.aIsSet=Se(e),o.bIsSet=Se(t),(!o.aIsSet&&Pe(e)||!o.bIsSet&&Pe(t))&&(o.done=0),o))}function Le(e,t){return t.bIsSet||!t.aIsSet?!1:Array.from(e.sets).map(t.toKey).includes(t.aKey)}function Oe(e,t){return!t.bIsSet||t.aIsSet?!1:Array.from(e.sets).map(t.toKey).includes(t.bKey)}function Me(e,t=G){return e.map(r=>{const o=Array.from(r.sets).map(t).sort();return{key:o.join("&"),s:o,sets:new Set(o),degree:r.degree,cardinality:r.cardinality}})}function et(e,t,r){const o=new Set;if(r.aIsSet)o.add(r.aKey);else for(const n of Array.from(e.sets))o.add(r.toKey(n));if(r.bIsSet)o.add(r.bKey);else for(const n of Array.from(t.sets))o.add(r.toKey(n));return Array.from(o).sort().join("&")}function Bt(e,t,r=G){const o=new Map;for(const n of Me(e,r))for(const s of n.s)o.has(s)?o.get(s).push(n):o.set(s,[n]);return(n,s)=>{const i=Ne(n,s,r);if(i.done!=null)return i.done;if(!i.aIsSet&&!i.bIsSet)return 0;if(i.aIsSet&&!i.bIsSet)return Le(s,i)?s.cardinality:0;if(!i.aIsSet&&i.bIsSet)return Oe(n,i)?n.cardinality:0;const l=o.get(i.aKey),a=o.get(i.bKey);return!l||!a?t(n,s):l.length<a.length?l.reduce((f,c)=>f+(c.sets.has(i.bKey)?c.cardinality:0),0):a.reduce((f,c)=>f+(c.sets.has(i.aKey)?c.cardinality:0),0)}}function Rt(e,t,r=G){const o=new Map(Me(e,r).map(n=>[n.key,n.cardinality]));return(n,s)=>{const i=Ne(n,s,r);if(i.done!=null)return i.done;if(i.aIsSet&&!i.bIsSet&&Le(s,i))return s.cardinality;if(!i.aIsSet&&i.bIsSet&&Oe(n,i))return n.cardinality;const l=et(n,s,i);return o.has(l)?o.get(l):t(n,s)}}function Dt(e,t,r=G){const o=new Map(Me(e,r).map(n=>[n.key,n.cardinality]));return(n,s)=>{const i=Ne(n,s,r);if(i.done!=null)return i.done;if(i.aIsSet&&!i.bIsSet&&Le(s,i))return n.cardinality;if(!i.aIsSet&&i.bIsSet&&Oe(n,i))return s.cardinality;const l=et(n,s,i);return o.has(l)?n.cardinality+s.cardinality-o.get(l):t(n,s)}}function jt(e,t,r=G){if(e.length===0)return t;const o=e[0].type;if(e.some(n=>n.type!==o))return t;switch(o){case"union":return Dt(e,t,r);case"intersection":return Rt(e,t,r);case"distinctIntersection":return Bt(e,t,r)}return t}function Ft(e){if(e.length===0)return"";const t=[];let r=e[0],o=1;for(let n=1;n<e.length;n++){const s=e[n];s===r?o++:(o>1?t.push(`${r}=${o-1}`):r===0?t.push(""):t.push(r.toString()),r=s,o=1)}return o>1?t.push(`${r}=${o}`):r===0?t.push(""):t.push(r.toString()),t.join(",")}function Ht(e){if(e.length===0)return"";const t=e.length,r=e.flat();return`${t};${Ft(r)}`}function Wt(e,t,{toElemKey:r,what:o="intersection",compress:n="auto"}={}){const s=e.concat(t);function i(u){if(u.overlap)return u.overlap;const d=oe(u.elems,r);return m=>m.overlap?m.overlap(u):d(m.elems)[o]}const l=s.map((u,d)=>{const m=i(u),g=[];for(let x=d+1;x<s.length;x++)g.push(m(s[x]));return g});if(l.pop(),n==="no")return l;const a=Ht(l);if(n==="yes")return a;const f=JSON.stringify(l).length;return a.length+2<f*.6?a:l}const qt=(e,t,r)=>{const o=e.length+r,n=t/Math.max(1,o),s=t-n*e.length,i=new Map(e.map((f,c)=>[f,c])),l=n/(1+r),a=f=>{const c=i.get(f);if(c!=null)return s+n*c};return a.bandwidth=()=>l,a};function Be(e,t,r=1){for(let o=0;o<e.length-r;o+=r){const n=e[o],s=e[o+1];if(n<s){const i=n+t[o]/2,l=s-t[o+1]/2;if(i>l)return!0}else{const i=n-t[o]/2;if(s+t[o+1]/2>i)return!0}}return!1}function $e(e,t,r,o,n){let s=e[e.length-1];if(!s.label){for(let i=e.length-2;i>0;--i)if(e[i].label){s=e[i];break}}if(s.value<t){const i=r(s.value),l=r(t);if(i<l){const a=i+o(s.value)/2,f=l-o(t)/2;a<f&&e.push({value:t,label:n(t)})}else{const a=i-o(s.value)/2;l+o(t)/2<a&&e.push({value:t,label:n(t)})}}return e}function pe(e,t=String,r=1){return e.map((o,n)=>({value:o,label:r===1||n%r===0?t(o):void 0}))}function tt(e,t,r,o,n){const s=e.map(l=>t(l)),i=e.map(l=>r(l));return!Be(s,i)||!Be(s,i,2)?$e(pe(e,n),o,t,r,n):null}function he(e){return e.toLocaleString()}function Vt(e,t=11){const r=Math.max(0,Math.floor(Math.log10(e)-.5)),o=Math.pow(10,r),n=[1,2,5],s=n.map(l=>l*o);r>0&&s.unshift(n[n.length-1]*Math.pow(10,r-1)),s.push(n[0]*Math.pow(10,r+1));const i=Math.ceil(e/t);return s.filter(l=>l>=i&&l<=e)}function Gt(e,t=1){const r=[];for(let o=0;o<=e;o+=t)r.push(o);return r}function Re(e,t,r,o){if(t<=0)return[];const n=Vt(e,t);for(let s=0;s<n.length;s++){const i=Gt(e,n[s]),l=tt(i,r,o,e,he);if(l)return l}return pe([0,e],he)}const Yt=(e,t,r)=>{const o=t[1]-t[0],n=e,s=i=>{const a=Math.max(0,Math.min(i,n))/n;return t[0]+a*o};return s.ticks=(i=10)=>{if(r.orientation==="vertical"){const a=Math.ceil(r.fontSizeHint*1.4);return Re(e,i+1,s,()=>a)}const l=r.fontSizeHint/1.4;return Re(e,i+1,s,a=>Math.ceil(he(a).length*l))},s.tickFormat=()=>he,s};function z(e){const t=["","k","M","G"],r=Math.max(0,Math.min(Math.floor(Math.log10(e)/3),t.length-1));return`${(Math.round(e/Math.pow(10,r*3-1))/10).toLocaleString()}${t[r]}`}function Kt(e,t){const r=[],o=Math.pow(10,t);for(let n=1;n<=e;n*=o)r.push(n);return r}function Qt(e,t){const r=[];for(let n=1,s=0;n<=e;n*=10,s++){r.push({value:n,label:t===1||s%t===0?z(n):void 0});for(let i=n+n;i<n*10&&i<e;i+=n*t)r.push({value:i})}return r}function De(e,t,r,o){if(t<=0)return[];for(const n of[1,2,5]){const s=Kt(e,n);if(tt(s,r,o,e,z))return $e(Qt(e,n),e,r,o,z)}return pe([0,e],z)}const Jt=(e,t,r)=>{const o=t[1]-t[0],n=e<1?1:Math.log10(e),s=i=>{const l=Math.max(0,Math.min(i,n)),a=l<=1?0:Math.log10(l)/n;return t[0]+a*o};return s.ticks=(i=10)=>{if(r.orientation==="vertical"){const a=Math.ceil(r.fontSizeHint*1.4);return De(e,i+1,s,()=>a)}const l=r.fontSizeHint/1.4;return De(e,i+1,s,a=>Math.ceil(z(a).length*l))},s.tickFormat=()=>z,s};function Xt(e){if(e.length===0)return"";const t=[];let r=0;const o=n=>(n===r+1?t.push(e[r].toString()):n===r+2&&n<10?t.push(`${e[r]},${e[r+1]}`):t.push(`${e[r]}+${n-r-1}`),n);for(let n=1;n<e.length;n++){const s=e[n-1]+1;e[n]!==s&&(r=o(n),r=n)}return o(e.length),t.join(",")}function ne(e,t,{sortAble:r,compress:o="auto"}={}){if(e.length===0)return[];const n=e.map(a=>t(a));if(o==="no")return n;r&&n.sort((a,f)=>a-f);const s=Xt(n),i=JSON.stringify(n).length,l=s.length+2;return l<i*.6||i-l>50||o==="yes"&&l<i?s:n}function ye(e,t){return t.color&&(e.color=t.color),e}function Zt(e,t={}){var r;const o=Object.assign({sortAble:!0},t),n=(r=t.toKey)!==null&&r!==void 0?r:G,s=new Map(e.sets.map((f,c)=>[n(f),c])),i=new Map(e.combinations.map((f,c)=>[n(f),c])),l=f=>{if(f.type==="set")return{type:f.type,index:s.get(n(f))};const c=i.get(n(f));return c==null||c<0?ne(f.elems,e.toElemIndex,o):{type:f.type,index:c}},a=e.sets.map((f,c)=>({key:n(f),i:c}));return{sets:e.sets.map(f=>ye({name:f.name,cardinality:f.cardinality,elems:ne(f.elems,e.toElemIndex,o)},f)),combinations:t.compress==="no"?e.combinations.map(f=>{const c=new Set(Array.from(f.sets).map(n));return ye({name:f.name,type:f.type,cardinality:f.cardinality,degree:f.degree,sets:a.filter(({key:u})=>c.has(u)).map(({i:u})=>u),elems:ne(f.elems,e.toElemIndex,o)},f)}):void 0,combinationOptions:e.combinationOptions,selection:e.selection?Array.isArray(e.selection)?ne(e.selection,e.toElemIndex,o):l(e.selection):void 0,queries:e.queries.map(f=>{const c=Q(f)?l(f.set):ne(Array.from(f.elems),e.toElemIndex,o);return{name:f.name,color:f.color,set:typeof c=="string"||Array.isArray(c)?void 0:c,elems:typeof c=="string"||Array.isArray(c)?c:void 0}})}}function zt(e,t){return e.length===1?e[0].name:`(${e.map(r=>r.name).join(Ae[t])})`}function en(e,t={}){var r;const o=(r=t.toKey)!==null&&r!==void 0?r:G,n=new Map(e.sets.map((u,d)=>[o(u),d])),s=new Map(e.combinations.map((u,d)=>[o(u),d])),i=u=>{if(se(u)){if(u.type==="set")return{type:u.type,index:n.get(o(u))};const m=s.get(o(u));if(m!=null&&m>=0)return{type:u.type,index:m}}const d=oe(se(u)?u.elems:u);return e.sets.map(m=>d(m.elems).intersection).concat(e.combinations.map(m=>d(m.elems).intersection))},l=new Map(e.sets.map((u,d)=>[o(u),d])),a=Wt(e.sets,e.combinations,t),f=t.compress==="yes",c=u=>{const d=Array.from(u.sets).map(g=>l.get(o(g))).sort((g,x)=>g-x),m={c:u.cardinality,s:d.reduce((g,x)=>g+Math.pow(2,x),0)};return u.name!==zt(d.map(g=>e.sets[g]),u.type)&&(m.n=u.name),u.type!=="intersection"&&(m.type=u.type[0]),u.color&&(m.cc=u.color),m};return{sets:f?e.sets.map(u=>({n:u.name,cc:u.color,c:u.cardinality})):e.sets.map(u=>ye({name:u.name,cardinality:u.cardinality},u)),combinations:f?e.combinations.map(c):e.combinations.map(u=>ye({name:u.name,cardinality:u.cardinality,type:u.type,sets:Array.from(u.sets).map(d=>l.get(o(d))).sort((d,m)=>d-m)},u)),overlaps:a,selection:e.selection?i(e.selection):void 0,queries:e.queries.map(u=>{if(Q(u)){const g=i(u.set);return Array.isArray(g)?{name:u.name,color:u.color,overlaps:g}:{name:u.name,color:u.color,set:g}}const d=oe(u.elems),m=e.sets.map(g=>d(g.elems).intersection).concat(e.combinations.map(g=>d(g.elems).intersection));return{name:u.name,color:u.color,overlaps:m}})}}var nt={exports:{}};(function(e){var t=function(){var r=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function i(a,f){if(!s[a]){s[a]={};for(var c=0;c<a.length;c++)s[a][a.charAt(c)]=c}return s[a][f]}var l={compressToBase64:function(a){if(a==null)return"";var f=l._compress(a,6,function(c){return o.charAt(c)});switch(f.length%4){default:case 0:return f;case 1:return f+"===";case 2:return f+"==";case 3:return f+"="}},decompressFromBase64:function(a){return a==null?"":a==""?null:l._decompress(a.length,32,function(f){return i(o,a.charAt(f))})},compressToUTF16:function(a){return a==null?"":l._compress(a,15,function(f){return r(f+32)})+" "},decompressFromUTF16:function(a){return a==null?"":a==""?null:l._decompress(a.length,16384,function(f){return a.charCodeAt(f)-32})},compressToUint8Array:function(a){for(var f=l.compress(a),c=new Uint8Array(f.length*2),u=0,d=f.length;u<d;u++){var m=f.charCodeAt(u);c[u*2]=m>>>8,c[u*2+1]=m%256}return c},decompressFromUint8Array:function(a){if(a==null)return l.decompress(a);for(var f=new Array(a.length/2),c=0,u=f.length;c<u;c++)f[c]=a[c*2]*256+a[c*2+1];var d=[];return f.forEach(function(m){d.push(r(m))}),l.decompress(d.join(""))},compressToEncodedURIComponent:function(a){return a==null?"":l._compress(a,6,function(f){return n.charAt(f)})},decompressFromEncodedURIComponent:function(a){return a==null?"":a==""?null:(a=a.replace(/ /g,"+"),l._decompress(a.length,32,function(f){return i(n,a.charAt(f))}))},compress:function(a){return l._compress(a,16,function(f){return r(f)})},_compress:function(a,f,c){if(a==null)return"";var u,d,m={},g={},x="",A="",v="",C=2,b=3,$=2,w=[],h=0,S=0,y;for(y=0;y<a.length;y+=1)if(x=a.charAt(y),Object.prototype.hasOwnProperty.call(m,x)||(m[x]=b++,g[x]=!0),A=v+x,Object.prototype.hasOwnProperty.call(m,A))v=A;else{if(Object.prototype.hasOwnProperty.call(g,v)){if(v.charCodeAt(0)<256){for(u=0;u<$;u++)h=h<<1,S==f-1?(S=0,w.push(c(h)),h=0):S++;for(d=v.charCodeAt(0),u=0;u<8;u++)h=h<<1|d&1,S==f-1?(S=0,w.push(c(h)),h=0):S++,d=d>>1}else{for(d=1,u=0;u<$;u++)h=h<<1|d,S==f-1?(S=0,w.push(c(h)),h=0):S++,d=0;for(d=v.charCodeAt(0),u=0;u<16;u++)h=h<<1|d&1,S==f-1?(S=0,w.push(c(h)),h=0):S++,d=d>>1}C--,C==0&&(C=Math.pow(2,$),$++),delete g[v]}else for(d=m[v],u=0;u<$;u++)h=h<<1|d&1,S==f-1?(S=0,w.push(c(h)),h=0):S++,d=d>>1;C--,C==0&&(C=Math.pow(2,$),$++),m[A]=b++,v=String(x)}if(v!==""){if(Object.prototype.hasOwnProperty.call(g,v)){if(v.charCodeAt(0)<256){for(u=0;u<$;u++)h=h<<1,S==f-1?(S=0,w.push(c(h)),h=0):S++;for(d=v.charCodeAt(0),u=0;u<8;u++)h=h<<1|d&1,S==f-1?(S=0,w.push(c(h)),h=0):S++,d=d>>1}else{for(d=1,u=0;u<$;u++)h=h<<1|d,S==f-1?(S=0,w.push(c(h)),h=0):S++,d=0;for(d=v.charCodeAt(0),u=0;u<16;u++)h=h<<1|d&1,S==f-1?(S=0,w.push(c(h)),h=0):S++,d=d>>1}C--,C==0&&(C=Math.pow(2,$),$++),delete g[v]}else for(d=m[v],u=0;u<$;u++)h=h<<1|d&1,S==f-1?(S=0,w.push(c(h)),h=0):S++,d=d>>1;C--,C==0&&(C=Math.pow(2,$),$++)}for(d=2,u=0;u<$;u++)h=h<<1|d&1,S==f-1?(S=0,w.push(c(h)),h=0):S++,d=d>>1;for(;;)if(h=h<<1,S==f-1){w.push(c(h));break}else S++;return w.join("")},decompress:function(a){return a==null?"":a==""?null:l._decompress(a.length,32768,function(f){return a.charCodeAt(f)})},_decompress:function(a,f,c){var u=[],d=4,m=4,g=3,x="",A=[],v,C,b,$,w,h,S,y={val:c(0),position:f,index:1};for(v=0;v<3;v+=1)u[v]=v;for(b=0,w=Math.pow(2,2),h=1;h!=w;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;switch(b){case 0:for(b=0,w=Math.pow(2,8),h=1;h!=w;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;S=r(b);break;case 1:for(b=0,w=Math.pow(2,16),h=1;h!=w;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;S=r(b);break;case 2:return""}for(u[3]=S,C=S,A.push(S);;){if(y.index>a)return"";for(b=0,w=Math.pow(2,g),h=1;h!=w;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;switch(S=b){case 0:for(b=0,w=Math.pow(2,8),h=1;h!=w;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;u[m++]=r(b),S=m-1,d--;break;case 1:for(b=0,w=Math.pow(2,16),h=1;h!=w;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;u[m++]=r(b),S=m-1,d--;break;case 2:return A.join("")}if(d==0&&(d=Math.pow(2,g),g++),u[S])x=u[S];else if(S===m)x=C+C.charAt(0);else return null;A.push(x),u[m++]=C+x.charAt(0),d--,C=x,d==0&&(d=Math.pow(2,g),g++)}}};return l}();e!=null&&(e.exports=t)})(nt);var je=nt.exports;const P=window.React,tn=window.React.useRef,nn=window.React.useState,Fe=window.React.useLayoutEffect,Z=window.React.useMemo,rn=window.React.useCallback;function rt(e){return Array.from(e.classList).find(t=>t.startsWith("root-")).slice(5)}function ot(e,t){var r,o;return(o=(r=e.querySelector(`titleTextStyle-${t}`))===null||r===void 0?void 0:r.textContent)!==null&&o!==void 0?o:"UpSetJS"}function on(e,t){var r,o;return(o=(r=e.querySelector(`descTextStyle-${t}`))===null||r===void 0?void 0:r.textContent)!==null&&o!==void 0?o:""}const re={},ve=[],we={setLabel:"16px",axisTick:"10px",chartLabel:"16px",barLabel:"10px",legend:"10px",description:"16px",title:"24px",valueLabel:"12px",exportLabel:"10px"},sn=[.18,.12,.7],an=[.6,.4],st={type:"intersection",order:["cardinality:desc","name:asc"]},ln=Object.keys(we),le=[.7,.4],ie=[.15,.3],cn={selectionColor:"#ffa500",color:"#000000",hasSelectionColor:"",opacity:1,hasSelectionOpacity:-1,textColor:"#000000",hoverHintColor:"#cccccc",notMemberColor:"#d3d3d3",alternatingBackgroundColor:"rgba(0,0,0,0.05)",valueTextColor:"#000000",strokeColor:"#000000",backgroundColor:"#ffffff",filled:!1},un={selectionColor:"#ffa500",color:"#cccccc",hasSelectionColor:"",opacity:1,hasSelectionOpacity:-1,textColor:"#ffffff",hoverHintColor:"#d9d9d9",notMemberColor:"#666666",alternatingBackgroundColor:"rgba(255, 255, 255, 0.2)",valueTextColor:"#ffffff",strokeColor:"#ffffff",backgroundColor:"#303030",filled:!1},fn={selectionColor:"#4c78a8",color:"#4c78a8",hasSelectionColor:"#c9d6e5",opacity:1,hasSelectionOpacity:-1,textColor:"#000000",hoverHintColor:"#cccccc",notMemberColor:"#d3d3d3",alternatingBackgroundColor:"rgba(0,0,0,0.05)",valueTextColor:"#000000",strokeColor:"#000000",backgroundColor:"#ffffff",filled:!0};function ke(e){return e==="vega"?fn:e==="dark"?un:cn}function dn(e){return Array.isArray(e)}function mn(e){return p("style",{children:e})}function pn(e,t,r={}){const o=ke(t.theme);return Object.assign(e,{queryLegend:t.queries!=null&&t.queries.length>0,theme:"light",padding:20,selection:null,title:"",description:"",fontFamily:"sans-serif",queries:ve,exportButtons:!0,className:"",fontSizes:we,classNames:re,style:re,styles:re,toKey:G,tooltips:!0,styleFactory:mn},o,t,r,t.fontSizes?{fontSizes:Object.assign({},we,t.fontSizes)}:re)}function hn(e){return pn({barPadding:.3,dotPadding:.7,combinations:st,combinationName:e.combinations!=null&&!dn(e.combinations)&&e.combinations.type==="union"?"Union Size":"Intersection Size",barLabelOffset:2,setNameAxisOffset:"auto",combinationNameAxisOffset:"auto",setName:"Set Size",widthRatios:sn,heightRatios:an,setLabelAlignment:"center",numericScale:"linear",bandScale:"band",childrenFactories:re,setAddons:ve,combinationAddons:ve,setAddonPadding:1,combinationAddonPadding:1,emptySelection:!0},e)}function it(e){return hn(e)}function yn(e,t){const r=e.cloneNode(!0);return r.style.backgroundColor=ke(e.dataset.theme).backgroundColor,t&&Array.from(r.querySelectorAll(t)).forEach(o=>o.remove()),new XMLSerializer().serializeToString(r)}function gn(e,{type:t="png",title:r,toRemove:o}){const n=new Blob([yn(e,o)],{type:"image/svg+xml;charset=utf-8"}),s=rt(e),i=r!=null?r:ot(e,s),l=URL.createObjectURL(n);return t==="svg"?(ge(l,`${i}.${t}`,e.ownerDocument),URL.revokeObjectURL(l),Promise.resolve()):bn(l,e).then(a=>{ge(a,`${i}.${t}`,e.ownerDocument),URL.revokeObjectURL(l)})}function bn(e,t){const r=t.ownerDocument.createElement("canvas"),o=t.getBoundingClientRect();r.width=o.width,r.height=o.height;const n=r.getContext("2d"),s=new Image(r.width,r.height);return new Promise(i=>{s.onload=()=>{n.drawImage(s,0,0);const l=r.toDataURL("image/png");i(l)},s.src=e})}function ge(e,t,r){const o=r.createElement("a");o.href=e,o.style.position="absolute",o.style.left="-10000px",o.style.top="-10000px",o.download=t,r.body.appendChild(o),o.click(),o.remove()}function Sn(e,t){var r,o,n,s,i;const l=(n=e.getComputedStyle||((o=(r=e.ownerDocument)===null||r===void 0?void 0:r.defaultView)===null||o===void 0?void 0:o.getComputedStyle))!==null&&n!==void 0?n:window.getComputedStyle,a=rt(e),f=t!=null?t:ot(e,a),c=Array.from(e.querySelectorAll("[data-upset=sets] [data-cardinality]")).map(O=>({name:O.querySelector(`text.setTextStyle-${a}`).textContent,cardinality:Number.parseInt(O.dataset.cardinality,10)})).reverse(),u=-Number.parseFloat(e.querySelector(`.sBarTextStyle-${a}`).getAttribute("dx")),d=l(e.querySelector(`.fillPrimary-${a}`)).fill,m=l(e.querySelector(`.fillNotMember-${a}`)).fill,g=l(e.querySelector("text")).fill,x=e.querySelector(`.cChartTextStyle-${a}`).textContent,A=e.querySelector(`.sChartTextStyle-${a}`).textContent,v=Array.from(e.querySelectorAll("[data-upset=cs] [data-cardinality]")).map(O=>({name:O.querySelector(`text.hoverBarTextStyle-${a}`).textContent,cardinality:Number.parseInt(O.dataset.cardinality,10),sets:Array.from(O.querySelectorAll(`.fillPrimary-${a} > title`)).map(T=>T.textContent)})),C=O=>Number.parseFloat(O.getAttribute("transform").match(/([\d.]+),/)[1]),b=O=>Number.parseFloat(O.getAttribute("transform").match(/,([\d.]+)/)[1]),$=e.querySelector("[data-upset=base]"),w=C($),h=C(e.querySelector("[data-upset=csaxis]")),S=Number.parseFloat($.querySelector("g").firstElementChild.children[1].getAttribute("x2")),y=b(e.querySelector("[data-upset=setaxis]")),N=Number.parseFloat(e.querySelector("defs rect").getAttribute("width")),L=Number.parseFloat(e.querySelector("defs rect").getAttribute("height")),E=Number.parseFloat(e.querySelector(`[data-cardinality] circle.fillPrimary-${a}`).getAttribute("r")),I=e.querySelector("[data-upset=sets-s] [data-cardinality]")!=null,D=e.querySelector("[data-upset=sets-q] [data-cardinality]")!=null,H=I||D;let j="orange";H&&(Array.from(e.querySelectorAll(`[data-upset=sets-${I?"s]":"q]:first-of-type"} [data-cardinality]`)).forEach(O=>{const T=c.length-Number.parseInt(O.dataset.i,10)-1;c[T].selection=Number.parseInt(O.dataset.cardinality,10)}),Array.from(e.querySelectorAll(`[data-upset=cs-${I?"s]":"q]:first-of-type"} [data-cardinality]`)).forEach(O=>{const T=Number.parseInt(O.dataset.i,10);v[T].selection=Number.parseInt(O.dataset.cardinality,10)}),j=l(e.querySelector(`[data-upset=sets-${I?"s":"q"}] [data-cardinality]`)).fill);const U=Number.parseInt((i=(s=e.querySelector("[data-upset=cs-ss]"))===null||s===void 0?void 0:s.dataset.i)!==null&&i!==void 0?i:"-1",10),B=U>=0?{field:"partOf",oneOf:[1,2]}:{field:"partOf",equal:1};return{$schema:"https://vega.github.io/schema/vega-lite/v4.json",title:f,description:on(e,a),datasets:{sets:c,combinations:v.map((O,T)=>Object.assign({},O,{partOf:U===T?2:1,nsets:[""]})).concat(v.map(O=>({name:O.name,cardinality:O.cardinality,partOf:0,sets:[""],nsets:c.filter(T=>!O.sets.includes(T.name)).map(T=>T.name)})))},vconcat:[{hconcat:[{mark:"bar",width:h+N-40,height:y},{width:S,height:y,data:{name:"combinations"},transform:[{filter:B}],layer:[{mark:{type:"bar",tooltip:!0}},{mark:{type:"text",align:"center",baseline:"bottom",dy:-u},encoding:{text:{field:"cardinality",type:"quantitative"}}},H&&{mark:{type:"bar",fill:j,tooltip:!0},encoding:{y:{field:"selection",type:"quantitative"}}}].filter(Boolean),encoding:{x:{field:"name",type:"ordinal",axis:null,sort:null},y:{field:"cardinality",type:"quantitative",axis:{grid:!1},title:x}}}]},{hconcat:[{width:h,height:L,data:{name:"sets"},layer:[{mark:{type:"bar",tooltip:!0}},{mark:{type:"text",align:"right",baseline:"middle",dx:-u},encoding:{text:{field:"cardinality",type:"quantitative"}}},H&&{mark:{type:"bar",fill:j,tooltip:!0},encoding:{x:{field:"selection",type:"quantitative"}}}].filter(Boolean),encoding:{y:{field:"name",type:"ordinal",axis:null,sort:null},x:{field:"cardinality",type:"quantitative",title:A,sort:"descending",axis:{grid:!1}}}},{data:{name:"sets"},width:N,height:L,mark:{type:"text",align:"center",baseline:"middle",fontSize:Number.parseInt(l(e.querySelector(`.setTextStyle-${a}`)).fontSize,10)},encoding:{y:{field:"name",type:"ordinal",axis:null,sort:null},text:{field:"name",type:"ordinal"}}},{width:S,height:L,data:{name:"combinations"},transform:[{flatten:["sets"],as:["has_set"]},{flatten:["nsets"],as:["has_not_set"]},{calculate:"datum.has_set+datum.has_not_set",as:"set"}],layer:[{mark:{type:"circle",size:E*E*Math.PI,tooltip:!0},encoding:{color:{field:"partOf",type:"nominal",legend:null,scale:{range:[m,d].concat(U>=0?[j]:[])}},y:{field:"set",type:"ordinal",axis:null,sort:null,scale:{domain:c.map(O=>O.name)}}}},{mark:"rule",transform:[{filter:B},{calculate:"datum.sets[datum.sets.length -1]",as:"set_end"}],encoding:Object.assign({y:{field:"sets[0]",type:"ordinal",axis:null,sort:null},y2:{field:"set_end"}},U<0?{}:{color:{field:"partOf",type:"nominal",legend:null,scale:{range:[d,j]}}})}],encoding:{x:{field:"name",type:"ordinal",axis:null,sort:null}}}]}],config:{padding:w,background:ke(e.dataset.theme).backgroundColor,concat:{spacing:0},view:{stroke:null},bar:{fill:d},circle:{opacity:1},rule:{stroke:d,strokeWidth:Number.parseInt(l(e.querySelector("[data-upset=cs] [data-cardinality] line")).strokeWidth,10)},axis:{labelColor:g,labelFontSize:Number.parseInt(l(e.querySelector(`.axisTextStyle-${a}`)).fontSize,10),titleColor:g,titleFontSize:Number.parseInt(l(e.querySelector(`.cChartTextStyle-${a}`)).fontSize,10)},title:{color:g},text:{fill:g,fontSize:Number.parseInt(l(e.querySelector(`.sBarTextStyle-${a}`)).fontSize,10)}}}}function xn(e,{title:t}={}){const r=Sn(e,t),o=URL.createObjectURL(new Blob([JSON.stringify(r,null,2)],{type:"application/json"}));ge(o,`${r.title}.json`,e.ownerDocument),URL.revokeObjectURL(o)}const $n=["selectionColor","color","textColor","hoverHintColor","notMemberColor","alternatingBackgroundColor","hasSelectionColor","hasSelectionOpacity","opacity","strokeColor","valueTextColor"],vn=["padding","barPadding","dotPadding","widthRatios","heightRatios"],wn=["fontSizes","combinationName","setName","barLabelOffset","setNameAxisOffset","combinationNameAxisOffset","theme","fontFamily","emptySelection","exportButtons","queryLegend"],Cn=["bandScale","numericScale"].concat($n,vn,wn);function at(e){var t;const r=it({width:0,height:0,sets:(t=e.sets)!==null&&t!==void 0?t:[],combinations:e.combinations,theme:e.theme}),o={};return Cn.forEach(n=>{const s=e[n],i=r[n];if(n==="theme"&&s!=="light"){o[n]=s;return}if(!(s==null||s===i))if(n==="fontSizes"){let l=!0;const a={};ln.forEach(f=>{const c=s[f],u=i[f];c!==u&&(a[f]=c,l=!1)}),l||(o[n]=a)}else o[n]=s}),o}function An(e,t,r,o,n){return Object.assign({$schema:"https://upset.js.org/schema.1.0.0.json",name:typeof r.title=="string"?r.title:"UpSetJS",description:typeof r.description=="string"?r.description:"",mode:n,author:o,elements:t,attrs:[],props:at(r)},e)}function Nn(e,t,r,o){return Object.assign({$schema:"https://upset.js.org/schema-static.1.0.0.json",name:typeof t.title=="string"?t.title:"UpSetJS",description:typeof t.description=="string"?t.description:"",mode:o,author:r,props:at(t)},e)}function lt(e,t,r=!1,o){var n,s;const i=[],l=new Map,a=c=>l.has(c)?l.get(c):(l.set(c,i.length),i.push(c),i.length-1),f=Zt({sets:e.sets,queries:(s=(n=e.queries)===null||n===void 0?void 0:n.filter(c=>K(c)||Q(c)))!==null&&s!==void 0?s:[],toElemIndex:a,selection:e.selection&&se(e.selection)?e.selection:void 0,combinations:t.cs.v,combinationOptions:Array.isArray(e.combinations)?{}:e.combinations},{compress:r?"yes":"no"});return An(f,i,e,void 0,o)}function Ln(e,t,r=!1,o){var n,s;const i=en({sets:e.sets,queries:(s=(n=e.queries)===null||n===void 0?void 0:n.filter(l=>K(l)||Q(l)))!==null&&s!==void 0?s:[],selection:e.selection&&se(e.selection)?e.selection:void 0,combinations:t.cs.v},{compress:r?"yes":"no"});return Nn(i,e,void 0,o)}function On(e,t,r,o){const n=lt(t,r,!1,o),s=URL.createObjectURL(new Blob([JSON.stringify(n,null,2)],{type:"application/json"}));ge(s,`${n.name}.json`,e.ownerDocument),URL.revokeObjectURL(s)}const He=2048*2;function Mn(e,t,r){const o=lt(e,t,!0,r);delete o.$schema;const n=je.compressToEncodedURIComponent(JSON.stringify(o)),s=new URL("https://upset.js.org/app/embed.html");if(s.searchParams.set("p",n),s.toString().length<He)return window.open(s.toString(),"_blank"),!0;const i=Ln(e,t,!0,r);delete i.$schema;const l=je.compressToEncodedURIComponent(JSON.stringify(i));if(s.searchParams.set("p",l),s.toString().length<He)return window.open(s.toString(),"_blank"),!0;s.searchParams.delete("p");const a=window.open(s.toString(),"_blank");return a==null||a.addEventListener("load",()=>{a==null||a.postMessage(o,s.origin)}),!1}function k(...e){return e.filter(Boolean).join(" ")}function Te(e){return`upset-${Math.random().toString(36).slice(4)}`}function We(e){return e!=null&&!Array.isArray(e)}function qe(e,t){const r=oe(e,t);return o=>r(o.elems).intersection}function kn(){return-1}function Tn(e,t,r){if(!e)return En;if(typeof e=="function")return e;if(Array.isArray(e))return qe(e,r);const o=e;if(o.overlap)return o.overlap.bind(o);let n=null;return s=>{if(s.overlap)return s.overlap(o);const i=t(s,o);return i>=0?i:(n||(n=qe(o.elems,r)),n(s))}}function ct(e){var t;return Array.isArray(e)?`Array(${e.length})`:typeof e=="function"?"?":(t=e)===null||t===void 0?void 0:t.name}function _n(e,t){const r=Qe(e,t);return o=>r(o.elems).intersection}function En(){return 0}function Ve(e){return e==null?10:e.endsWith("pt")?Math.floor(4/3*Number.parseInt(e,10)):Number.parseInt(e,10)}function In(e){var t;return(t={left:"start",center:"middle",right:"end"}[e])!==null&&t!==void 0?t:"middle"}function Un(e){return e==="linear"?Yt:e==="log"?Jt:e}function Pn(e){return e==="band"?qt:e}function Bn(e){return Array.isArray(e)}function Rn(e,t,r,o,n,s,i,l,a,f,c,u,d,m,g){var x;const A=Un(o),v=Pn(n),C=Bn(t)?t:ze(e,Object.assign({toElemKey:u},st,t)),b=C.map(c),$=v(b,r.cs.w,r.padding),w=C.reduce((_,W)=>Math.max(_,W.cardinality),0),h=g!=null?g:w,S=h>w?0:s,y=A(h,[r.cs.h,S],{orientation:"vertical",fontSizeHint:a}),N=_=>Math.floor(s/1.4*.7*_.length),L=_=>N(y.tickFormat()(_)),E=e.reduce((_,W)=>Math.max(_,W.cardinality),0),I=m!=null?m:E,D=L(I);let H=L(h);for(const _ of f){if(!_.scale)continue;const W=_.scale.ticks(3),ae=_.scale.tickFormat();for(const J of W){const mt=typeof J=="number"?ae(J):(x=J.label)!==null&&x!==void 0?x:ae(J.value),_e=N(mt);_e>H&&(H=_e)}}const j=I>E?0:D,U=A(I,[r.sets.w,j],{orientation:"horizontal",fontSizeHint:a}),B=e.map(c),O=v(B.slice().reverse(),r.sets.h,r.padding),T=Math.min(O.bandwidth(),$.bandwidth())/2*i,F=Math.max(2,Math.min(O.bandwidth(),$.bandwidth())/2*l);return{id:d||Te(),r:T,triangleSize:F,sets:{v:e,keys:B,rv:e.slice().reverse(),x:U,xAxisWidth:r.sets.w-j,y:_=>O(c(_)),max:I,bandWidth:O.bandwidth(),cy:O.bandwidth()/2+r.cs.h,format:U.tickFormat(),labelOffset:s+9+2},cs:{v:C,keys:C.map(c),x:_=>$(c(_)),max:h,y,yAxisWidth:r.cs.h-S,cx:$.bandwidth()/2,bandWidth:$.bandwidth(),format:y.tickFormat(),has:(_,W)=>{const ae=c(W);return Array.from(_.sets).some(J=>c(J)===ae)},labelOffset:H+9+6},toKey:c,toElemKey:u,overlapGuesser:jt(C,kn,c)}}function Dn(e,t,r,o,n,s,i,l,a,f,c){const u=i.reduce(($,w)=>$+(w.position==="before"?w.size+f:0),0),d=i.reduce(($,w)=>$+(w.position!=="before"?w.size+f:0),0),m=l.reduce(($,w)=>$+(w.position==="before"?w.size+f:0),0),g=l.reduce(($,w)=>$+(w.position!=="before"?w.size+f:0),0),x=t-2*r-20-g-m,A=e-2*r-u-d,v=n[0]>1?n[0]:A*n[0],C=n[1]>1?n[1]:A*n[1],b=s[0]>1?s[0]:x*s[0];return{id:a||Te(),cs:{before:m,after:g,x:u+v+C,y:m,w:A-v-C,h:b,addons:l,addonPadding:c},labels:{x:u+v,y:m+b,w:C,h:x-b},sets:{before:u,after:d,x:u,y:m+b,w:v,h:x-b,addons:i,addonPadding:f},padding:o,legend:{x:e/2},margin:r,w:e,h:t}}function jn(e,t,r,o,n,s,i,l,a,f,c,u,d,m,g){return{theme:e,styles:t,classNames:r,cs:{name:o,offset:n},sets:{name:s,offset:i},emptySelection:c,id:l,barLabelOffset:a,selectionColor:f,title:u,description:d,tooltips:m,setLabelAlignment:g}}function Fn({transform:e,styleId:t,exportButtons:r,exportChart:o}){if(!r)return null;const n=26,s=26,i=34,l=34,a=42,f=2;let c=0;const u=[];return(r===!0||r.svg!==!1)&&(c+=n,u.push(M("g",{className:`exportButton-${t}`,onClick:o,"data-type":"svg",transform:`translate(-${c}, 0)`,children:[p("title",{children:"Download SVG Image"}),p("rect",{y:-9,width:n,height:11,rx:2,ry:2}),p("text",{className:`exportTextStyle-${t}`,x:n/2,children:"SVG"})]},"svg")),c+=f),(r===!0||r.png!==!1)&&(c+=s,u.push(M("g",{className:`exportButton-${t}`,onClick:o,"data-type":"png",transform:`translate(-${c}, 0)`,children:[p("title",{children:"Download PNG Image"}),p("rect",{y:-9,width:s,height:11,rx:2,ry:2}),p("text",{className:`exportTextStyle-${t}`,x:s/2,children:"PNG"})]},"png")),c+=f),(r===!0||r.vega!==!1)&&(c+=i,u.push(M("g",{className:`exportButton-${t}`,onClick:o,"data-type":"vega",transform:`translate(-${c}, 0)`,children:[p("title",{children:"Download VEGA-Lite Specification"}),p("rect",{y:-9,width:i,height:11,rx:2,ry:2}),p("text",{className:`exportTextStyle-${t}`,x:i/2,children:"VEGA"})]},"vega")),c+=f),(r===!0||r.dump!==!1)&&(c+=l,u.push(M("g",{className:`exportButton-${t}`,onClick:o,"data-type":"dump",transform:`translate(-${c}, 0)`,children:[p("title",{children:"Download UpSet.js JSON Dump"}),p("rect",{y:-9,width:l,height:11,rx:2,ry:2}),p("text",{className:`exportTextStyle-${t}`,x:l/2,children:"DUMP"})]},"dump")),c+=f),(r===!0||r.share!==!1)&&(c+=a,u.push(M("g",{className:`exportButton-${t}`,onClick:o,"data-type":"share",transform:`translate(-${c}, 0)`,children:[p("title",{children:"Open a shareable URL"}),p("rect",{y:-9,width:a,height:11,rx:2,ry:2}),p("text",{className:`exportTextStyle-${t}`,x:a/2,children:"SHARE"})]},"share")),c+=f),p("g",{className:`exportButtons-${t}`,transform:e,children:u})}const Hn=P.memo(function({queries:t,x:r,style:o,data:n}){return p("text",{transform:`translate(${r},4)`,style:o.styles.legend,className:k(`legendTextStyle-${o.id}`,o.classNames.legend),children:t.map((s,i)=>{let l=null;return Q(s)?l=s.set.cardinality:K(s)&&(l=s.elems instanceof Set?s.elems.size:s.elems.length),M(ee,{children:[p("tspan",{className:`fillQ${i}-${n.id}`,children:"  \u2B24 "}),M("tspan",{children:[s.name,l!=null?`: ${n.sets.format(l)}`:""]})]})})})}),Wn=P.memo(function({pos:t,spacing:r,tickSizeInner:o,orient:n,name:s,style:i}){const l=n==="top"||n==="left"?-1:1;return M("g",{transform:`translate(0, ${t+.5})`,children:[s&&p("text",{x:l*r,dy:"0.32em",className:k(`axisTextStyle-${i.id}`,n==="right"?`startText-${i.id}`:`endText-${i.id}`,i.classNames.axisTick),style:i.styles.axisTick,children:s}),p("line",{x2:l*o,className:`axisLine-${i.id}`})]})}),qn=P.memo(function({pos:t,name:r,spacing:o,orient:n,tickSizeInner:s,style:i}){const l=n==="top"||n==="left"?-1:1;return M("g",{transform:`translate(${t+.5}, 0)`,children:[r&&p("text",{y:l*o,dy:n==="top"?"0em":"0.71em",className:k(`axisTextStyle-${i.id}`,i.classNames.axisTick),style:i.styles.axisTick,children:r}),p("line",{y2:l*s,className:`axisLine-${i.id}`})]})});function ce({scale:e,orient:t,tickSizeInner:r=6,tickSizeOuter:o=6,tickPadding:n=3,size:s,start:i,style:l,transform:a}){const f=Math.max(r,0)+n,c=i,u=s,d=t==="top"||t==="left"?-1:1,m=t==="left"||t==="right"?Wn:qn,g=e.ticks().map(x=>typeof x=="number"?{value:x,label:x.toLocaleString()}:x);return M("g",{transform:a,children:[g.map(x=>p(m,{pos:e(x.value),name:x.label,spacing:f,tickSizeInner:r,orient:t,style:l},x.value)),p("path",{className:`axisLine-${l.id}`,d:t==="left"||t==="right"?o?`M${d*o},${c}H0.5V${u}H${d*o}`:`M0.5,${c}V${u}`:o?`M${c},${d*o}V0.5H${u}V${d*o}`:`M${c},0.5H${u}`})]})}const Ge=P.memo(function({width:t,text:r,dy:o,x:n,style:s,className:i}){const l=tn(null),[a,f]=nn(typeof r=="string"?[r]:[]);return Fe(()=>{f(typeof r=="string"?[r]:[])},[r]),Fe(()=>{if(!l.current||l.current.childElementCount>0||typeof r!="string"||typeof l.current.getComputedTextLength!="function")return;const c=l.current.getComputedTextLength(),u=[];let d=t,m=0;const g=l.current.getStartPositionOfChar(0);for(;c>d;){g.x=d;const x=l.current.getCharNumAtPosition(g),A=r.lastIndexOf(" ",x);if(A<m)break;u.push(r.slice(m,A+1));const v=l.current.getEndPositionOfChar(A+1).x;m=A+1,d=v+t}u.push(r.slice(m)),f(u)},[l,r,t]),r?p("tspan",{ref:l,dy:o,style:s,x:n,className:i,children:a.length>1?a.map((c,u)=>p("tspan",{x:0,dy:u>0?"1.2em":o,children:c},c)):r}):null});var Vn=P.memo(function({width:t,descriptionWidth:r=t,style:o}){return!o.title&&!o.description?null:M("text",{children:[p(Ge,{text:o.title,width:t,dy:"10px",className:k(`titleTextStyle-${o.id}`,o.classNames.title),style:o.styles.title}),p(Ge,{x:0,width:r,dy:o.title?"2em":"10px",text:o.description,className:k(`descTextStyle-${o.id}`,o.classNames.description),style:o.styles.description})]})});function Gn(){}function ue(e){return e?(t,r)=>function(o){return e.call(this,t,o.nativeEvent,r.map(n=>n.createOnHandlerData?n.createOnHandlerData(t):null))}:Gn}function te(e,t){let r=0,o=0;return n=>{let s=0;return n.position==="before"?(r+=n.size+t,s=-r):(s=e+o+t,o+=n.size+t),s}}function R(e,t,r="fill"){return t?e?Object.assign({[r]:t},e):t?{[r]:t}:void 0:e}const Yn=P.memo(function({size:t,style:r,data:o}){const n=te(t.sets.w+t.labels.w+t.cs.w,t.sets.addonPadding),s=te(t.cs.h+t.sets.h,t.cs.addonPadding),i=r.cs.offset==="auto"?o.cs.labelOffset:r.cs.offset,l=r.sets.offset==="auto"?o.sets.labelOffset:r.sets.offset;return M("g",{children:[p(Vn,{style:r,width:t.cs.x-i-20}),t.cs.h>0&&M("g",{transform:`translate(${t.cs.x},${t.cs.y})`,"data-upset":"csaxis",children:[p(ce,{scale:o.cs.y,orient:"left",size:t.cs.h,start:t.cs.h-o.cs.yAxisWidth,style:r}),p("line",{x1:0,x2:t.cs.w,y1:t.cs.h+1,y2:t.cs.h+1,className:`axisLine-${r.id}`}),p("text",{className:k(`cChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${-i}, ${t.cs.h/2})rotate(-90)`,children:r.cs.name}),t.cs.addons.map(a=>{const f=s(a),c=p("text",{className:k(`cChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${-i}, ${f+a.size/2})rotate(-90)`,children:a.name},a.name);return a.scale?M(ee,{children:[p(ce,{scale:a.scale,orient:"left",size:a.size,start:0,style:r,transform:`translate(0,${f})`}),c]}):c})]}),t.sets.w>0&&M("g",{transform:`translate(${t.sets.x},${t.sets.y})`,"data-upset":"setaxis",children:[p(ce,{scale:o.sets.x,orient:"bottom",size:t.sets.w,start:t.sets.w-o.sets.xAxisWidth,transform:`translate(0, ${t.sets.h})`,style:r}),p("text",{className:k(`sChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${t.sets.w/2}, ${t.sets.h+l})`,children:r.sets.name}),t.sets.addons.map(a=>{const f=n(a),c=p("text",{className:k(`sChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${f+a.size/2}, ${t.sets.h+l})`,children:a.name},a.name);return a.scale?M(ee,{children:[p(ce,{scale:a.scale,orient:"bottom",size:a.size,start:0,transform:`translate(${f}, ${t.sets.h})`,style:r}),c]}):c})]})]})}),Ce=P.memo(function({cx:t,r,cy:o,name:n,className:s,style:i,fill:l}){return p("circle",{r,cx:t,cy:o,className:s,style:R(i,l),children:n&&p("title",{children:n})})});function be(e,t,r){const o=[r(e)];for(let n=0;n<ie.length&&e>t;n++)e-=t,o.push(r(e));return o}const Kn=P.memo(function({d:t,h:r,className:o,data:n,size:s,style:i,children:l}){const a=be(t.cardinality,n.cs.max,n.cs.y),f=te(s.cs.h+s.sets.h,s.cs.addonPadding);return M("g",{transform:`translate(${n.cs.x(t)}, 0)`,onMouseEnter:r.onMouseEnter(t,s.cs.addons),onMouseLeave:r.onMouseLeave,onClick:r.onClick(t,s.cs.addons),onContextMenu:r.onContextMenu(t,s.cs.addons),onMouseMove:r.onMouseMove(t,s.cs.addons),className:o,"data-cardinality":t.cardinality,children:[i.tooltips&&M("title",{children:[t.name,": ",n.cs.format(t.cardinality)]}),p("rect",{y:-s.cs.before,width:n.cs.bandWidth,height:s.sets.h+s.cs.h+s.cs.before+s.cs.after,className:`hoverBar-${i.id}`}),s.cs.h>0&&M(ee,{children:[a.map((c,u)=>{const d=u>0?Math.floor(n.cs.bandWidth*ie[u-1]):0;return p("rect",{x:d,y:c,height:s.cs.h-c,width:n.cs.bandWidth-d*2,className:k(`fillPrimary-${i.id}`,u<a.length-1&&`fillOverflow${a.length-1-u}-${i.id}`,i.classNames.bar),style:R(i.styles.bar,t.color)},u)}),p("text",{y:a[0]-i.barLabelOffset,x:n.cs.bandWidth/2,style:i.styles.barLabel,className:k(`cBarTextStyle-${i.id}`,i.classNames.barLabel),children:n.cs.format(t.cardinality)})]}),p("text",{y:-i.barLabelOffset-s.cs.before,x:n.cs.bandWidth/2,style:i.styles.barLabel,className:k(`hoverBarTextStyle-${i.id}`,i.classNames.barLabel),children:t.name}),n.sets.v.map((c,u)=>n.cs.has(t,c)?null:p(Ce,{r:n.r,cx:n.cs.cx,cy:n.sets.y(c)+n.sets.cy,name:i.tooltips?t.name:"",style:i.styles.dot,fill:void 0,className:k(`fillNotMember-${i.id}`,i.classNames.dot)},n.sets.keys[u])),t.sets.size>1&&p("line",{x1:n.cs.cx,y1:n.sets.y(n.sets.v.find(c=>n.cs.has(t,c)))+n.sets.cy-(n.r-1),x2:n.cs.cx,y2:n.sets.y(n.sets.rv.find(c=>n.cs.has(t,c)))+n.sets.cy+(n.r-1),style:t.color?{stroke:t.color}:void 0,className:`upsetLine-${n.id}`}),n.sets.v.map((c,u)=>{var d;return n.cs.has(t,c)?p(Ce,{r:n.r,cx:n.cs.cx,cy:n.sets.y(c)+n.sets.cy,name:i.tooltips?c.name:"",style:i.styles.dot,fill:(d=c.color)!==null&&d!==void 0?d:t.color,className:k(`fillPrimary-${i.id}`,i.classNames.dot)},n.sets.keys[u]):null}),s.cs.addons.map(c=>p("g",{transform:`translate(0,${f(c)})`,children:c.render({set:t,width:n.cs.bandWidth,height:c.size,theme:i.theme})},c.name)),l]})}),Qn=P.memo(function({d:t,i:r,h:o,className:n,size:s,data:i,style:l,children:a}){const f=be(t.cardinality,i.sets.max,i.sets.x),c=te(s.sets.w+s.labels.w+s.cs.w,s.sets.addonPadding),u=l.setLabelAlignment==="center"?s.labels.w/2:l.setLabelAlignment==="left"?2:s.labels.w-2;return M("g",{transform:`translate(0, ${i.sets.y(t)})`,onMouseEnter:o.onMouseEnter(t,s.sets.addons),onMouseLeave:o.onMouseLeave,onClick:o.onClick(t,s.sets.addons),onContextMenu:o.onContextMenu(t,s.sets.addons),onMouseMove:o.onMouseMove(t,s.sets.addons),className:n,"data-cardinality":t.cardinality,children:[l.tooltips&&M("title",{children:[t.name,": ",i.sets.format(t.cardinality)]}),p("rect",{x:-s.sets.before,width:s.sets.w+s.labels.w+s.cs.w+s.sets.after,height:i.sets.bandWidth,className:`hoverBar-${l.id}`}),r%2===1&&p("rect",{x:s.sets.w,width:s.labels.w+s.cs.w+s.sets.after,height:i.sets.bandWidth,className:`fillAlternating-${l.id}`}),s.sets.w>0&&M(ee,{children:[f.map((d,m)=>{const g=m>0?Math.floor(i.sets.bandWidth*ie[m-1]):0;return p("rect",{x:d,y:g,width:s.sets.w-d,height:i.sets.bandWidth-g*2,className:k(`fillPrimary-${l.id}`,m<f.length-1&&`fillOverflow${f.length-1-m}-${l.id}`,l.classNames.bar),style:R(l.styles.bar,t.color)},m)}),p("text",{x:f[0],dx:-l.barLabelOffset,y:i.sets.bandWidth/2,style:l.styles.barLabel,className:k(`sBarTextStyle-${l.id}`,l.classNames.barLabel),children:i.sets.format(t.cardinality)})]}),p("text",{x:s.sets.w+u,y:i.sets.bandWidth/2,className:k(`setTextStyle-${l.id}`,l.classNames.setLabel),style:l.styles.setLabel,clipPath:`url(#clip-${s.id})`,children:t.name}),s.sets.addons.map(d=>p("g",{transform:`translate(${c(d)},0)`,children:d.render({set:t,width:d.size,height:i.sets.bandWidth,theme:l.theme})},d.name)),a]})}),Jn=P.memo(function({data:t,size:r,style:o,h:n,setChildrenFactory:s,combinationChildrenFactory:i}){return M("g",{className:n.hasClick?`clickAble-${o.id}`:void 0,children:[p("g",{transform:`translate(${r.sets.x},${r.sets.y})`,"data-upset":"sets",children:t.sets.v.map((l,a)=>p(Qn,{d:l,i:a,h:n,className:n.hasClick||n.hasHover?`interactive-${o.id}`:void 0,data:t,style:o,size:r,children:s&&s(l)},t.sets.keys[a]))}),p("g",{transform:`translate(${r.cs.x},${r.cs.y})`,"data-upset":"cs",children:t.cs.v.map((l,a)=>p(Kn,{d:l,h:n,className:n.hasClick||n.hasHover?`interactive-${o.id}`:void 0,data:t,style:o,size:r,children:i&&i(l)},t.cs.keys[a]))})]})});function ut({data:e,size:t,style:r,elemOverlap:o,secondary:n,tooltip:s,suffix:i,transform:l,empty:a,combinationAddons:f}){const c=e.cs.bandWidth,u=t.cs.h+t.sets.h,d=t.cs.h,m=k(`fill${i}`,!s&&`pnone-${r.id}`,r.classNames.bar);return p("g",{transform:l,"data-upset":n?"cs-q":"cs-s",children:e.cs.v.map((g,x)=>{const A=e.cs.x(g),v=e.cs.keys[x];if(a&&!n)return p("rect",{x:A,y:d,height:0,width:c,className:m,style:R(r.styles.bar,r.selectionColor?void 0:g.color),children:s&&p("title",{})},v);const C=o(g);if(C===0)return null;const b=be(C,e.cs.max,e.cs.y),$=s&&p("title",{children:`${g.name} \u2229 ${s}: ${C}`}),w=n?p("path",{transform:`translate(${A}, ${b[0]})`,d:`M0,-1 l${c},0 l0,2 l${-c},0 L-${e.triangleSize},-${e.triangleSize} L-${e.triangleSize},${e.triangleSize} Z`,className:m,"data-i":x,"data-cardinality":C,style:R(void 0,r.selectionColor?void 0:g.color),children:$},v):b.map((y,N)=>{const L=N>0?Math.floor(e.cs.bandWidth*ie[N-1]):0;return p("rect",{x:A+L,y,height:d-y,width:c-L*2,"data-i":N>0?null:x,"data-cardinality":N>0?null:C,className:k(m,N<b.length-1&&`fillOverflow${b.length-1-N}-${r.id}`),style:R(r.styles.bar,r.selectionColor?void 0:g.color),children:$},N)}),h=te(u,t.cs.addonPadding),S=f.map(y=>{const N=h(y),L=y.render({set:g,width:c,height:y.size,theme:r.theme});return L?p("g",{transform:`translate(${A},${N})`,children:L},y.name):null}).filter(Boolean);return S.length===0?w:M("g",{children:[w,S]},v)})})}function ft({data:e,size:t,style:r,elemOverlap:o,suffix:n,secondary:s,empty:i,tooltip:l,setAddons:a,transform:f}){const c=t.sets.w,u=t.sets.w+t.labels.w+t.cs.w,d=e.sets.bandWidth,m=k(`fill${n}`,!l&&` pnone-${r.id}`,r.classNames.bar);return p("g",{transform:f,"data-upset":s?"sets-q":"sets-s",children:e.sets.v.map((g,x)=>{const A=e.sets.y(g),v=e.sets.keys[x];if(i&&!s)return p("rect",{x:c,y:A,width:0,height:d,className:m,style:R(r.styles.bar,r.selectionColor?void 0:g.color),children:r.tooltips&&l&&p("title",{})},v);const C=o(g);if(C===0)return null;const b=be(C,e.sets.max,e.sets.x),$=r.tooltips&&l&&p("title",{children:`${g.name} \u2229 ${l}: ${C}`}),w=s?p("path",{transform:`translate(${b[0]}, ${A+d})`,d:`M1,0 l0,${-d} l-2,0 l0,${d} L-${e.triangleSize},${e.triangleSize} L${e.triangleSize},${e.triangleSize} Z`,"data-i":x,"data-cardinality":C,className:m,style:R(void 0,r.selectionColor?void 0:g.color),children:$},v):b.map((y,N)=>{const L=N>0?Math.floor(e.sets.bandWidth*ie[N-1]):0;return p("rect",{"data-i":N>0?null:x,"data-cardinality":N>0?null:C,x:y,y:A+L,width:c-y,height:d-L*2,className:k(m,N<b.length-1&&`fillOverflow${b.length-1-N}-${r.id}`),style:R(r.styles.bar,r.selectionColor?void 0:g.color),children:$},N)}),h=te(u,t.sets.addonPadding),S=a.map(y=>{const N=h(y),L=y.render({set:g,width:y.size,height:d,theme:r.theme});return L?p("g",{transform:`translate(${N},${A})`,children:L},y.name):null}).filter(Boolean);return S.length===0?w:M("g",{children:[w,S]},v)})})}const Ye=[],Xn=P.memo(function({size:t,data:r,style:o,hasHover:n,secondary:s,queries:i}){const l=t.sets.addons.some(c=>c.renderQuery!=null)||t.cs.addons.some(c=>c.renderQuery!=null),a=Z(()=>i.map(c=>Object.assign(Object.assign({},c),{overlap:At(c,"intersection",r.toElemKey),elemOverlap:l?Nt(c,"intersection",r.toElemKey):null})),[i,l,r.toElemKey]);function f(c,u,d,m,g){return Object.assign(Object.assign({},c),{render:x=>{const A=m(x.set);return c.renderQuery?c.renderQuery(Object.assign({query:u,overlap:A,index:d,secondary:g},x)):null}})}return M("g",{className:n&&!s?`pnone-${o.id}`:void 0,children:[p("g",{transform:`translate(${t.sets.x},${t.sets.y})`,children:a.map((c,u)=>p(ft,{data:r,size:t,style:o,elemOverlap:c.overlap,suffix:`Q${u}-${r.id}`,secondary:s||u>0,tooltip:n&&!(s||u>0)?void 0:c.name,setAddons:t.sets.addons.length===0?Ye:t.sets.addons.map((d,m)=>f(d,c,m,c.elemOverlap,s||m>0))},c.name))}),p("g",{transform:`translate(${t.cs.x},${t.cs.y})`,children:a.map((c,u)=>p(ut,{data:r,size:t,style:o,elemOverlap:c.overlap,suffix:`Q${u}-${r.id}`,secondary:s||u>0,tooltip:n&&!(s||u>0)?void 0:c.name,combinationAddons:t.cs.addons.length===0?Ye:t.cs.addons.map((d,m)=>f(d,c,m,c.elemOverlap,s||m>0))},c.name))})]})});function Zn({data:e,size:t,style:r,selection:o}){if(!o||o.type!=="set"||!e.sets.keys.includes(e.toKey(o)))return null;const n=o;return p("rect",{y:e.sets.y(n),width:t.labels.w+t.cs.w+t.sets.after,height:e.sets.bandWidth,className:`selectionHint-${r.id}`})}function zn({data:e,size:t,style:r,selection:o}){const n=e.sets.bandWidth/2,s=e.cs.cx,i=e.r,l=t.sets.h+t.sets.after,a=e.cs.bandWidth;if(!o||o.type==="set"||!e.cs)return null;const f=o,c=e.cs.keys.indexOf(e.toKey(f));return c<0?null:M("g",{transform:`translate(${t.labels.w+e.cs.x(f)}, 0)`,"data-upset":"cs-ss","data-i":c,children:[p("rect",{width:a,height:l,className:`selectionHint-${r.id}`}),f.sets.size>1&&p("line",{x1:s,y1:e.sets.y(e.sets.v.find(u=>e.cs.has(f,u)))+n-(e.r-1),x2:s,y2:e.sets.y(e.sets.rv.find(u=>e.cs.has(f,u)))+n+(e.r-1),className:`upsetSelectionLine-${e.id}`,style:R(void 0,r.selectionColor?void 0:f.color,"stroke")}),e.sets.v.filter(u=>e.cs.has(f,u)).map(u=>p(Ce,{r:i*1.1,cx:s,cy:e.sets.y(u)+n,name:r.tooltips?u.name:"",className:k(`fillSelection-${r.id}`,`pnone-${r.id}`,r.classNames.dot),style:R(r.styles.dot,r.selectionColor?void 0:u.color)},e.toKey(u)))]})}const Ke=[];function er({size:e,data:t,style:r,selection:o,hasHover:n}){const s=r.emptySelection,i=Tn(o,t.overlapGuesser,t.toElemKey),l=ct(o),a=e.sets.addons.some(u=>u.renderSelection!=null)||e.cs.addons.some(u=>u.renderSelection!=null),f=o&&typeof o!="function"&&a?_n(Array.isArray(o)?o:o.elems,t.toElemKey):null;function c(u){return Object.assign(Object.assign({},u),{render:d=>{const m=f?f(d.set):null;return u.renderSelection?u.renderSelection(Object.assign({selection:o,selectionColor:r.selectionColor||d.set.color||"orange",overlap:m},d)):null}})}return M("g",{className:n?`pnone-${r.id}`:void 0,children:[(o||s)&&p(ut,{data:t,size:e,style:r,transform:`translate(${e.cs.x},${e.cs.y})`,empty:s&&!o,elemOverlap:i,suffix:`Selection-${r.id}`,tooltip:n?void 0:l,combinationAddons:e.cs.addons.length===0?Ke:e.cs.addons.map(c)}),(o||s)&&p(ft,{data:t,size:e,style:r,transform:`translate(${e.sets.x},${e.sets.y})`,empty:s&&!o,elemOverlap:i,suffix:`Selection-${r.id}`,tooltip:n?void 0:l,setAddons:e.sets.addons.length===0?Ke:e.sets.addons.map(c)}),M("g",{transform:`translate(${e.labels.x},${e.labels.y})`,children:[We(o)&&p(Zn,{data:t,size:e,style:r,selection:o}),We(o)&&p(zn,{data:t,size:e,style:r,selection:o})]})]})}function Y(e,t="font-size"){return e?`${t}: ${e};`:""}function tr(e,t,r,o){const n=[];t.hasSelectionColor&&n.push(`fill: ${t.hasSelectionColor};`);const s=t.hasSelectionOpacity!=null&&t.hasSelectionOpacity>=0;return s&&n.push(`fill-opacity: ${t.hasSelectionOpacity};`),{p:Y,root:`
  .root-${e} {
    ${Y(r,"font-family")}
  }
  `,text:`
  .titleTextStyle-${e} {
    fill: ${t.textColor};
    ${Y(o.title)}
  }
  .descTextStyle-${e} {
    fill: ${t.textColor};
    ${Y(o.description)}
  }

  .legendTextStyle-${e} {
    fill: ${t.textColor};
    ${Y(o.legend)}
    text-anchor: middle;
    dominant-baseline: hanging;
    pointer-events: none;
  }
  `,hasSFill:n.join(" "),hasSStroke:n.join(" ").replace("fill:","stroke:").replace("fill-","stroke-"),fill:`
  .fillPrimary-${e} { fill: ${t.color}; fill-opacity: ${t.opacity}; }
  .fillOverflow1-${e} { fill-opacity: ${t.opacity*le[0]}; }
  .fillOverflow2-${e} { fill-opacity: ${t.opacity*le[1]}; }
  ${n.length>0?`.root-${e}[data-selection] .fillPrimary-${e} { ${n.join(" ")} }`:""}
  ${s?`
      .root-${e}[data-selection] .fillOverflow1-${e} { fill-opacity: ${t.opacity*le[0]}; }
      .root-${e}[data-selection] .fillOverflow2-${e} { fill-opacity: ${t.opacity*le[1]}; }`:""}
  ${t.selectionColor?`.fillSelection-${e} { fill: ${t.selectionColor}; }`:""}
  .fillTransparent-${e} { fill: transparent; }

  .selectionHint-${e} {
    fill: transparent;
    pointer-events: none;
    ${Y(t.selectionColor,"stroke")}
  }
  .clickAble-${e} {
    cursor: pointer;
  }

  .startText-${e} {
    text-anchor: start;
  }
  .endText-${e} {
    text-anchor: end;
  }
  .pnone-${e} {
    pointer-events: none;
  }`,export:`
  .exportTextStyle-${e} {
    fill: ${t.textColor};
    ${Y(o.exportLabel)}
  }
  .exportButtons-${e} {
    text-anchor: middle;
  }
  .exportButton-${e} {
    cursor: pointer;
    opacity: 0.5;
  }
  .exportButton-${e}:hover {
    opacity: 1;
  }
  .exportButton-${e} > rect {
    fill: none;
    stroke: ${t.textColor};
  }
  `}}function nr(e){const t=e.onClick;return Z(()=>({hasClick:t!=null,hasHover:e.onHover!=null,onClick:ue(t),onMouseEnter:ue(e.onHover),onContextMenu:ue(e.onContextMenu),onMouseLeave:e.onHover?r=>e.onHover(null,r.nativeEvent,[]):void 0,onMouseMove:ue(e.onMouseMove),reset:r=>t?t(null,r.nativeEvent,[]):null}),[t,e.onHover,e.onContextMenu,e.onMouseMove])}const rr=P.forwardRef(function(t,r){var o;const n=it(t),{selection:s=null,queries:i=[],fontSizes:l}=n,a=Z(()=>n.id?n.id:Te([n.fontFamily,l.axisTick,l.barLabel,l.chartLabel,l.legend,l.setLabel,l.title,l.exportLabel,l.description,n.textColor,n.hoverHintColor,n.color,n.hasSelectionColor,n.selectionColor,n.notMemberColor,n.alternatingBackgroundColor,n.opacity,n.hasSelectionOpacity]),[n.id,n.fontFamily,l.axisTick,l.barLabel,l.chartLabel,l.legend,l.setLabel,l.title,l.exportLabel,l.description,n.textColor,n.hoverHintColor,n.color,n.hasSelectionColor,n.selectionColor,n.notMemberColor,n.alternatingBackgroundColor,n.opacity,n.hasSelectionOpacity]),f=Z(()=>jn(n.theme,n.styles,n.classNames,n.combinationName,n.combinationNameAxisOffset,n.setName,n.setNameAxisOffset,a,n.barLabelOffset,n.selectionColor,n.emptySelection,n.title,n.description,n.tooltips,n.setLabelAlignment),[n.theme,n.styles,n.classNames,n.barLabelOffset,n.combinationName,n.combinationNameAxisOffset,n.setName,n.setNameAxisOffset,a,n.selectionColor,n.emptySelection,n.title,n.description,n.tooltips,n.setLabelAlignment]),c=Z(()=>Dn(n.width,n.height,n.padding,n.barPadding,n.widthRatios,n.heightRatios,n.setAddons,n.combinationAddons,n.id,n.setAddonPadding,n.combinationAddonPadding),[n.width,n.height,n.padding,n.barPadding,n.widthRatios,n.heightRatios,n.setAddons,n.combinationAddons,n.id,n.setAddonPadding,n.combinationAddonPadding]),u=Z(()=>Rn(n.sets,n.combinations,c,n.numericScale,n.bandScale,n.barLabelOffset+Ve(l.barLabel),n.dotPadding,n.barPadding,Ve(l.axisTick),n.combinationAddons,n.toKey,n.toElemKey,n.id,n.setMaxScale,n.combinationMaxScale),[n.sets,n.combinations,c,n.numericScale,n.bandScale,n.barLabelOffset,l.barLabel,n.dotPadding,n.barPadding,l.axisTick,n.combinationAddons,n.toKey,n.toElemKey,n.id,n.setMaxScale,n.combinationMaxScale]),d=tr(a,n,n.fontFamily,l),m=nr(n),g=`
  ${d.root}
  ${d.text}

  .axisTextStyle-${a} {
    fill: ${n.textColor};
    ${d.p(l.axisTick)}
    text-anchor: middle;
  }
  .barTextStyle-${a} {
    fill: ${n.textColor};
    ${d.p(l.barLabel)}
  }
  .cBarTextStyle-${a} {
    fill: ${n.textColor};
    ${d.p(l.barLabel)}
    text-anchor: middle;
  }
  .sBarTextStyle-${a} {
    fill: ${n.textColor};
    ${d.p(l.barLabel)}
    text-anchor: end;
    dominant-baseline: central;
  }
  .hoverBarTextStyle-${a} {
    ${d.p(l.barLabel)}
    fill: ${n.hoverHintColor};
    display: none;
    text-anchor: middle;
  }
  .setTextStyle-${a} {
    fill: ${n.textColor};
    ${d.p(l.setLabel)}
    text-anchor: ${In(n.setLabelAlignment)};
    dominant-baseline: central;
  }
  .cChartTextStyle-${a} {
    fill: ${n.textColor};
    ${d.p(l.chartLabel)}
    text-anchor: middle;
  }
  .sChartTextStyle-${a} {
    fill: ${n.textColor};
    ${d.p(l.chartLabel)}
    text-anchor: middle;
    dominant-baseline: hanging;
  }

  ${d.fill}
  .fillNotMember-${a} { fill: ${n.notMemberColor}; }
  .fillAlternating-${a} { fill: ${n.alternatingBackgroundColor||"transparent"}; }

  .axisLine-${a} {
    fill: none;
    stroke: ${n.textColor};
  }
  .hoverBar-${a} {
    fill: transparent;
  }

  .interactive-${a}:hover > .hoverBar-${a} {
    stroke: ${n.hoverHintColor};
  }
  .interactive-${a}:hover > .hoverBarTextStyle-${a} {
    display: unset;
  }

  ${d.export}

  .upsetLine-${u.id} {
    stroke-width: ${u.r*.6};
    stroke: ${n.color};
    stroke-opacity: ${n.opacity};
  }
  ${d.hasSStroke?`.root-${a}[data-selection] .upsetLine-${u.id} { ${d.hasSStroke} }`:""}

  .upsetSelectionLine-${u.id} {
    stroke-width: ${u.r*.6*1.1};
    ${d.p(n.selectionColor,"stroke")}
    pointer-events: none;
  }

  ${i.map((v,C)=>`.fillQ${C}-${u.id} {
    fill: ${v.color};
  }`).join(`
`)}
  `,x=rn(v=>{const C=v.currentTarget.closest("svg"),b=v.currentTarget.dataset.type||"png";switch(b){case"vega":xn(C);break;case"dump":On(C,t,u);break;case"share":Mn(t,u);break;case"svg":case"png":gn(C,{type:b,toRemove:`.${v.currentTarget.getAttribute("class")}`})}},[u,t]),A=ct(s);return M("svg",{id:n.id,className:k(`root-${a}`,n.className),style:n.style,width:n.width,height:n.height,ref:r,viewBox:`0 0 ${n.width} ${n.height}`,"data-theme":(o=n.theme)!==null&&o!==void 0?o:"light","data-selection":A||void 0,children:[n.styleFactory(g),p("defs",{children:p("clipPath",{id:`clip-${c.id}`,children:p("rect",{x:c.sets.w,y:0,width:c.labels.w,height:c.sets.h})})}),n.queryLegend&&p(Hn,{queries:i,x:c.legend.x,style:f,data:u}),p(Fn,{transform:`translate(${c.w-2},${c.h-3})`,styleId:a,exportButtons:n.exportButtons,exportChart:x}),M("g",{transform:`translate(${n.padding},${n.padding})`,"data-upset":"base",children:[n.onClick&&p("rect",{width:c.cs.x,height:c.sets.y,onClick:m.reset,className:`fillTransparent-${a}`}),p(Yn,{size:c,style:f,data:u}),p(Jn,{size:c,style:f,data:u,h:m,setChildrenFactory:n.setChildrenFactory,combinationChildrenFactory:n.combinationChildrenFactory}),p(er,{size:c,style:f,data:u,hasHover:m.hasHover,selection:s}),p(Xn,{size:c,style:f,data:u,hasHover:m.hasHover,queries:i,secondary:n.onHover!=null||s!=null})]}),t.children]})}),fe=window.React.useState,or=window.React.useEffect,de=({sql:e,rgbIndex:t,maxBarCount:r,setName:o,combinationName:n,height:s=700,summaryLinkText:i,summaryLink:l})=>{const{accessToken:a}=pt(),[f,c]=fe(),[u,d]=fe(),[m,g]=fe(),[x,A]=fe(null),{colorPalette:v}=St(t,2),C={setLabel:"14px"};return or(()=>{let b=!1;return(async()=>{var w;c(!0);try{const h=xt(e),y={partMask:yt,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:h,query:{sql:e}},{queryResult:N}=await gt(y,a),L={},E={};for(const U of(w=N==null?void 0:N.queryResults.rows)!=null?w:[])for(let B=1;B<U.values.length;B+=1){const O=U.values,T=O[0];let F=O[B];L[T]=L[T]||{},L[T].name=T,L[T].sets=L[T].sets||[],!L[T].sets.find(W=>W==F)&&F&&(E[F.toUpperCase()]?F=E[F.toUpperCase()]:E[F.toUpperCase()]=F,L[T].sets.push(F))}const I=Object.values(L),D=Pt(I),H=D.sort((U,B)=>(""+B.name).localeCompare(U.name)),j=ze(H,{type:"intersection",min:1,limit:r,order:"cardinality:desc"});b||(d({sets:D,combinations:j}),c(!1))}catch(h){if(!b){c(!1);let S=h.reason;S||(console.error(h),S="Error retrieving data"),g(S)}}})(),()=>{b=!0}},[e,a]),M(ee,{children:[f&&$t,!f&&u&&p(bt.SizeMe,{children:({size:b})=>M("div",{className:"UpsetPlot bootstrap-4-backport",children:[p(rr,{sets:u.sets,combinations:u.combinations,width:b.width,height:s,onHover:A,selection:x,color:v[0],selectionColor:v[0],hasSelectionOpacity:.3,setName:o==null?void 0:o.toUpperCase(),combinationName:n==null?void 0:n.toUpperCase(),fontFamily:"Lato, sans-serif",fontSizes:C,exportButtons:!1,notMemberColor:"transparent"}),l&&i&&p("div",{className:"UpsetPlot__summary",children:p(vt,{variant:"secondary",size:"lg",className:"pill",href:l,children:i})})]})}),p(ht,{error:m})]})};var dt=de;try{de.displayName="UpsetPlot",de.__docgenInfo={description:`Upset plot.  See https://medium.com/@sgratzl/upset-js-javascript-tutorial-1b84bfd6896d
Currently this is driven by a Synapse Table/View, but we may want to alter it to read in the data from a flat file instead.`,displayName:"UpsetPlot",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!0,type:{name:"number"}},maxBarCount:{defaultValue:null,description:"",name:"maxBarCount",required:!1,type:{name:"number"}},setName:{defaultValue:null,description:"",name:"setName",required:!1,type:{name:"string"}},combinationName:{defaultValue:null,description:"",name:"combinationName",required:!1,type:{name:"string"}},height:{defaultValue:{value:"700"},description:"",name:"height",required:!1,type:{name:"number"}},summaryLinkText:{defaultValue:null,description:"",name:"summaryLinkText",required:!1,type:{name:"string"}},summaryLink:{defaultValue:null,description:"",name:"summaryLink",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["src/lib/containers/UpsetPlot.tsx#UpsetPlot"]={docgenInfo:de.__docgenInfo,name:"UpsetPlot",path:"src/lib/containers/UpsetPlot.tsx#UpsetPlot"})}catch{}var Pr={parameters:{storySource:{source:`import React from 'react'
import { ComponentStory, ComponentMeta } from '@storybook/react'
import UpsetPlot from './UpsetPlot'

// More on default export: https://storybook.js.org/docs/react/writing-stories/introduction#default-export
export default {
  title: 'Home Page/UpsetPlot',
  component: UpsetPlot,
  // More on argTypes: https://storybook.js.org/docs/react/api/argtypes
  argTypes: {},
} as ComponentMeta<typeof UpsetPlot>

// More on component templates: https://storybook.js.org/docs/react/writing-stories/introduction#using-args
const Template: ComponentStory<typeof UpsetPlot> = args => (
  <UpsetPlot {...args} />
)

export const Demo = Template.bind({})
Demo.args = {
  sql: 'SELECT unnest(individualID), assay FROM syn20821313.6 WHERE individualID is not null GROUP BY assay, unnest(individualID)',
  rgbIndex: 0,
  maxBarCount: 20,
  setName: 'Individuals (#) per Assay',
  combinationName: 'Individuals (#)',
  summaryLink: '#',
  summaryLinkText: 'EXPLORE ALL OF SOMETHING',
}
`,locationsMap:{demo:{startLoc:{col:51,line:14},endLoc:{col:1,line:16},startBody:{col:51,line:14},endBody:{col:1,line:16}}}}},title:"Home Page/UpsetPlot",component:dt,argTypes:{}};const sr=e=>p(dt,{...e}),ir=sr.bind({});ir.args={sql:"SELECT unnest(individualID), assay FROM syn20821313.6 WHERE individualID is not null GROUP BY assay, unnest(individualID)",rgbIndex:0,maxBarCount:20,setName:"Individuals (#) per Assay",combinationName:"Individuals (#)",summaryLink:"#",summaryLinkText:"EXPLORE ALL OF SOMETHING"};const Br=["Demo"];export{ir as Demo,Br as __namedExportsOrder,Pr as default};
//# sourceMappingURL=UpsetPlot.stories.871c64a6.js.map
